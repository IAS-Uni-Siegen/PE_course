%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DC-DC converters %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{DC-DC converters}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step-down converter}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Overview and assumption %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
\frametitle{Step-down converter: overview and assumptions}
    \onslide<2->{We consider the following assumptions:}
    \begin{itemize}
        \item<2-> The switch is ideal, that is, infinitely fast.
        \item<3-> The input voltage is constant: $u_1(t) = U_1$.
        \item<3-> The output voltage is constant: $u_2(t) = U_2$.
        \item<4-> The input voltage is greater than the output voltage: $U_1 > U_2$.
    \end{itemize}
    \begin{figure}
        \begin{circuitikz}[]
            \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
            to ++(-6,0)
            to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
            (-6,2) to  [short, i=$i_1(t)$] ++(1.35,0);   
            \draw (-5.375,2) ++(0.625,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S) {}
            let \p1 = (S.mid) in (S.in) to  [short, i=$i_\mathrm{L}(t)$] ++(1,0)
            to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(2,0)
            to [short, -o, i=$i_2(t)$] (0,2) 
            ([yshift = -0.3cm]S.mid) to [short, o-*](\x1,0);
            \draw (-3.5,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s}(t)$, voltage = straight] ++(0,-2);
        \end{circuitikz}
        \caption{Step-down converter (aka \hl{buck converter}, ideal switch representation)}
        \label{fig:step-down-converter-simple}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-down converter: switch states}
     \onslide<1->{%
        The voltage at the switch is given by
     \begin{equation}
            u_\mathrm{s}(t) = \begin{cases}
                U_1, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}],\\}
                \onslide<2->{0, & t\in [k T_\mathrm{s}+ T_\mathrm{on}, (k+1) T_\mathrm{s}]
            \end{cases}}
     \end{equation}%
     \onslide<1->{with $k\in\mathbb{N}$ being the $k$-th switching period, $T_\mathrm{s}$ the switching period time interval, and $T_\mathrm{on}$ the switch-on time.} 
        \begin{figure}
            \centering	
            \onslide<1->{
            \begin{subfigure}{0.45\textwidth}
                \centering
                \hspace{-0.75cm}
                \begin{circuitikz}[]
                    \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1(t)=i_\mathrm{L}(t)}$] ++(2,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                    \draw (-4,2) to [open, v = ${\hspace{2.4cm}U_\mathrm{s}=U_1}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-on time}
            \end{subfigure}%
            }%
            \hspace{0.5cm}%
            \onslide<2->{
            \begin{subfigure}{0.45\textwidth}
                \centering
                \begin{circuitikz}[]
                    \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                    (-3.75,0) to [short, *-] ++(0,2)
                    to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                    \draw (-3.4,2) to [open, v = ${\hspace{2.4cm}U_\mathrm{s}=0}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time}
            \end{subfigure}
            }
        \caption{Switch states of the step-down converter} 
        \label{fig:step-down-converter-switch-states}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Basic terms and definitions %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[c]
    \frametitle{Basic terms and definitions}
    \onslide<1->
    \centering
     \begin{tabular}{c l c l}
        \onslide<2->{$T_\mathrm{on}$} & \onslide<2->{Switch-on time}  & \onslide<3->{$T_\mathrm{off}$} & \onslide<3->{Switch-off time}\\[1em]
        \onslide<4->{$T_\mathrm{s}= T_\mathrm{on} + T_\mathrm{off}$} & \onslide<4->{Switching period} & \onslide<5->{$f_\mathrm{s} = 1/T_\mathrm{s}$} & \onslide<5->{Switching frequency}\\[1em]
        \onslide<6->{$D = T_\mathrm{on}/T_\mathrm{s}$} & \onslide<6->{Duty cycle} &  & 
     \end{tabular}
     \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                xlabel={$t/T_\mathrm{s}$},
                ylabel={$u_\mathrm{s}(t)/U_1$},
                ymin=-0.05, ymax=1.05,
                xmin=-0.1, xmax=1.1,
                width = 0.5\textwidth,
                height = 0.4\textheight,
                grid,
                thick,
                clip = false,
                ]
                % plt u_out = 1 for t = 0 to D*Ts and u_out = 0 for t = D*Ts to Ts in a single plot
                \addplot[signalblue] coordinates {(-0.1,0) (0,0) (0,1) (0.4,1) (0.4,0) (1,0) (1,1) (1.1,1)};
                \draw [thick,<->, visible on=<2->]  (0,0.5) -- node[above,fill=white]{$T_\mathrm{on}$}(0.4, 0.5);
                \draw [thick,<->, , visible on=<3->]  (0.4,0.5) -- node[above]{$T_\mathrm{off}$}(1.0, 0.5);
                \draw [thick,<->, visible on=<4->]  (0.0,1.2) -- node[above]{$T_\mathrm{s}$}(1.0, 1.2);
            \end{axis}
        \end{tikzpicture}
    \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis}
    The inductor current from \figref{fig:step-down-converter-simple} is represented by the \hl{differential equation}
    \begin{equation}
        L \frac{\mathrm{d}i_\mathrm{L}(t)}{\mathrm{d}t} =  u_\mathrm{L}(t) =  u_\mathrm{s}(t) - U_2.
    \end{equation}
    \pause
    During the \hl{switch-on period} we have
    \begin{equation}
        \begin{split}
            \onslide<2->{i_\mathrm{L}(t) &= i_\mathrm{L}(k T_\mathrm{s}) +\frac{1}{L} \int_{k T_\mathrm{s}}^{t}u_\mathrm{L}(\tau)\mathrm{d}\tau} \\ 
            \onslide<3->{                &= i_\mathrm{L}(k T_\mathrm{s}) + \frac{U_1-U_2}{L} (t - k T_\mathrm{s})
            , \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}]}
        \end{split}
        \label{eq:inductor-current-switch-on-simple-step-down}
    \end{equation}
    \onslide<4->{and during the \hl{switch-off period} we receive}
    \begin{equation}
        \begin{split}
            \onslide<4->{i_\mathrm{L}(t) &= i_\mathrm{L}(k T_\mathrm{s} + T_\mathrm{on}) + \frac{1}{L}\int_{k T_\mathrm{s}+T_\mathrm{on}}^{t}u_\mathrm{L}(\tau)\mathrm{d}\tau}\onslide<5->{= i_\mathrm{L}(k T_\mathrm{s} + T_\mathrm{on}) - \frac{U_2}{L} (t - k T_\mathrm{s} - T_\mathrm{on})}\\
            \onslide<6->{&= i_\mathrm{L}(k T_\mathrm{s}) + \frac{U_1-U_2}{L} T_\mathrm{on} - \frac{U_2}{L} (t - k T_\mathrm{s} - T_\mathrm{on}), \quad 
            t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}].} 
        \end{split} 
        \label{eq:inductor-current-switch-off}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    In steady state the inductor current is periodic with period $T_\mathrm{s}$, that is, $$i_\mathrm{L}(t) = i_\mathrm{L}(t + T_\mathrm{s}).$$\pause
    \onslide<2->{From \eqref{eq:inductor-current-switch-off} we obtain for $t= k T_\mathrm{s}$}
    \begin{equation}
        \begin{split}
            \onslide<2->{\overbrace{i_\mathrm{L}(k T_\mathrm{s})}^{\mbox{Start of period}} &= \hspace{0.5cm}  \overbrace{i_\mathrm{L}(k T_\mathrm{s}) + \frac{U_1-U_2}{L} T_\mathrm{on} - \frac{U_2}{L} (T_\mathrm{s} - T_\mathrm{on})}^{\mbox{End of period}}}\\
            \onslide<3->{\Leftrightarrow \qquad 0 \hspace{1.1cm}&= \hspace{0.5cm}\frac{U_1-U_2}{L} T_\mathrm{on} - \frac{U_2}{L} (T_\mathrm{s} - T_\mathrm{on})}\\
            \onslide<4->{\Leftrightarrow \qquad 0 \hspace{1.1cm}&= \hspace{0.5cm}U_1 T_\mathrm{on} - U_2 T_\mathrm{s}.}
    \end{split}
    \end{equation}
    \onslide<5->{Rewriting delivers the \hl{output voltage} as
    \begin{equation}
        U_2 = \frac{T_\mathrm{on}}{T_\mathrm{s}} U_1 = D U_1.
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter: steady-state time-domain behavior %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Step-down converter: steady-state time-domain behavior}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.6} % duty cycle
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({0 + #1},1) ({\D + #1},1) ({\D + #1},0) ({1 + #1},0) ({1 + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed, visible on=<2->] (axis cs:0, \D) -- (axis cs:4, \D); % dashed line at U_2 (average)
                    \node[above, inner sep = 2pt, anchor = south, visible on=<2->] at (axis cs:1.5+\D/2, \D) {$U_2$}; % label U_2
                    \draw [thick,<->]  (0,0.5) -- node[below]{$T_\mathrm{on}$}(\D, 0.5); % T_on 
                    \draw [thick,<->]  (\D,0.5) -- node[below]{$T_\mathrm{off}$}(1.0, 0.5); % T_off
                    \draw [thick,<->]  (0.0,-0.2) -- node[below]{$T_\mathrm{s}$}(1.0, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, $\overline{i}_\mathrm{L}$, }, visible on=<3->]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5) -- (axis cs:4,0.5); % dashed line at average current
                    \draw[{Latex[length=2mm]}-, thin, visible on=<4->] (axis cs:\D+0.02,0.75) -- node[right=1mm, fill=white, inner sep = 1pt]{$\max\{i_\mathrm{L}\}$}(axis cs:\D+0.3,0.9); % indicate max current
                    \draw[-{Latex[length=2mm]}, thin, visible on=<4->] (axis cs:0.75,0.2) node[right=1mm, fill=white, inner sep = 1pt, anchor = east]{$\min\{i_\mathrm{L}\}$} -- (axis cs:1-0.02,0.25); % indicate min current
                    \draw[thin, visible on=<5->] (axis cs:2+\D/4,0.25+0.125) -- (axis cs:2+\D/4,0.75-0.125) -- (axis cs:2+\D*3/4,0.75-0.125); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south, xshift = -4mm, visible on=<5->] at (axis cs:2+\D/2, 0.75-0.125) {$\nicefrac{(U_1-U_2)}{L}$}; % label positive current slope
                    \draw[thin, visible on=<6->] (axis cs:2.25+3*\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.25+0.125); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south, xshift = 2mm, visible on=<6->] at (axis cs:2.5+\D/2, 0.75-0.125) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}, visible on=<7->]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({\D + #1},0) ({1 + #1},0) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed, visible on=<8->] (axis cs:0,0.5 * \D) -- (axis cs:4, 0.5 * \D); % dashed line at average current
                    \node[above, inner sep = 2pt, anchor = south, fill = white, visible on=<8->] at (axis cs:1.5+\D/2, 0.5 * \D) {$\overline{i}_1$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Alternative steady-state analysis: average values %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Alternative steady-state analysis: average values}
    From the previous slide we know that the average inductor voltage is zero in steady state
    \begin{equation}
        \overline{u}_\mathrm{L} = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{s}} u_\mathrm{L}(t) \mathrm{d}t = \overline{u}_\mathrm{L} = 0,
    \end{equation}%
    \pause%
    since otherwise the average inductor current would change between periods, compare
    $$
    L \frac{\mathrm{d}i_\mathrm{L}(t)}{\mathrm{d}t} =  u_\mathrm{L}(t).
    $$%
    \pause%
    \onslide<3->{From \figref{fig:step-down-converter-simple} we can apply Kirchhoff's voltage law to obtain}
    \begin{equation}
        \onslide<3->{u_\mathrm{s}(t) = u_\mathrm{L}(t) + u_2(t)} \onslide<4->{\quad \Rightarrow \quad \overline{u}_\mathrm{s} = \overline{u}_\mathrm{L} + U_2} \onslide<5->{\quad \Leftrightarrow \quad  \overline{u}_\mathrm{s} = U_2.}
        \label{eq:Kirchhoff-switch-voltage}
    \end{equation}
    \onslide<6->{%
    The average switch voltage is given by  }
    \begin{equation}
        \onslide<6->{\overline{u}_\mathrm{s} = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{s}} u_\mathrm{s}(t) \mathrm{d}t} \onslide<7->{= \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{on}} U_1 \mathrm{d}t}\onslide<8->{ = U_1 \frac{T_\mathrm{on}}{T_\mathrm{s}} = U_1 D.}
        \label{eq:average-switch-voltage}
    \end{equation}
  
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Alternative steady-state analysis: average values (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Alternative steady-state analysis: average values (cont.)}
    Combining \eqref{eq:Kirchhoff-switch-voltage} and \eqref{eq:average-switch-voltage} we obtain the \hl{voltage transfer ratio}
    \begin{equation}
        \frac{U_2}{U_1} =  D.
    \end{equation}
    \pause
    \onslide<2->{In addition, we can calculate the average input current as}
    \begin{equation}
        \onslide<2->{\overline{i}_1 = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{s}} i_1(t) \mathrm{d}t}\onslide<3->{ = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{on}} i_\mathrm{L}(t) \mathrm{d}t} \onslide<4->{= \frac{T_\mathrm{on}}{T_\mathrm{s}} \overline{i}_\mathrm{L} = D \overline{i}_\mathrm{L}.}
    \end{equation}%
    \onslide<5->{%
    Since $i_2(t) = i_\mathrm{L}(t)$ applies, we can conclude
    \begin{equation}
        \frac{U_2}{U_1} = \frac{\overline{i}_1}{\overline{i}_2} = D.
    \end{equation}}%
    \onslide<6->{%
    Hence, the duty cycle $D$ has a similar interpretation for the DC-DC step-down converter as the turn ratio for an ideal transformer in the AC domain.
    }
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Stationary averaged model of the step-down converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Stationary averaged model of the step-down converter}
    \begin{figure}
        \begin{circuitikz}[]
            \draw (-3,0) to [short, o-, i=$\overline{i}_1$] ++(1.5,0)
            to [current source, i=$D \overline{i}_2$] ++(0,-2)
            to [short, -o] ++(-1.5,0);
            \draw (-3,0) to [open, v = $\hspace{-0.25cm}U_1$, voltage = straight] ++(0,-2);
            \draw (3,0) to [short, o-, i_<=$\overline{i}_2$] ++(-1.5,0)
            to [voltage source, v_= $D U_1$] ++(0,-2)
            to [short, -o] ++(1.5,0);
            \draw (3,0) to [open, v = $\hspace{1.5cm}U_2$, voltage = straight] ++(0,-2);
        \end{circuitikz}
        \caption{Stationary averaged model of the step-down converter}
        \label{fig:step-down-converter-averaged}
    \end{figure}%
    \pause%
    \begin{varblock}{Switching vs. linear power conversion}
        In contrast to the linear power conversion approaches from \figref{fig:linear_power_conversion} and \figref{fig:linear_power_conversion_transistor}, the switching step-down converter transforms the current and voltage levels with the same factor $D$ which results from the (idealized) loss-less transformation of energy. 
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple}
    \onslide<1->{Due to the switching operation of the step-down converter, the inductor current exhibits an inherent ripple. The peak-to-peak \hl{current ripple} is given by}
    \begin{equation}
        \begin{split}
            \onslide<1->{ \Delta i_\mathrm{L} &= \max\{i_\mathrm{L}(t)\} - \min\{i_\mathrm{L}(t)\}}  \onslide<2->{= i_\mathrm{L}(t=T_\mathrm{on}) - i_\mathrm{L}(t=T_\mathrm{s})}\\
                                &\onslide<3->{=\frac{U_1 - U_2}{L} T_\mathrm{on}} \onslide<4->{= \frac{U_2}{L} T_\mathrm{off}}\\
                                & \onslide<5->{= \frac{D(1-D)T_\mathrm{s}}{L}U_1.}
        \end{split}
        \label{eq:current-ripple-simple-step-down}
    \end{equation}
    \onslide<6->{The current ripple has two main implications:}
    \begin{itemize}
        \item<6-> The output power is not constant but varies with the current ripple.
        \item<7-> The root mean square (RMS) current is higher than the average current.
    \end{itemize}%
    \onslide<8->{The latter point should be investigated in more detail as it influences the design and loss characteristics of the converter.}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple (cont.)}
    \onslide<2->{We define 
    \begin{equation}
        \Delta I_\mathrm{L} = \sqrt{\frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{s}} \left(i_\mathrm{L}(t) - \overline{i}_\mathrm{L}\right)^2 \mathrm{d}t}
    \end{equation}
    as the \hl{RMS deviation} of the inductor current from its average value.}  \onslide<3->{As the average-corrected inductor current has a triangular shape (cf. \figref{fig:inductor-current-ripple}) we can calculate the RMS current as}%
    \begin{equation}
        \onslide<3->{\Delta I_\mathrm{L} = \frac{1}{\sqrt{3}} \frac{\Delta i_\mathrm{L}}{2}} \onslide<4->{= \frac{D(1-D)T_\mathrm{s}U_1}{2\sqrt{3}L}.}
        \label{eq:RMS-current-ripple}
    \end{equation}%
    \vspace{-0.25cm}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.6} % duty cycle
            \begin{axis}[
                xlabel={$t/T_\mathrm{s}$},
                ylabel={$i_\mathrm{L}(t)-\overline{i}_\mathrm{L}$},
                ymin=-0.3, ymax=0.3,
                xmin=-0.1, xmax=1.1,
                width = 0.7\textwidth,
                height = 0.4\textheight,
                grid,
                thick,
                clip = true,
                ytick = {-0.2, 0, 0.2}, 
                yticklabels = {$\nicefrac{-\Delta i_\mathrm{L}}{2}$, 0, $\nicefrac{\Delta i_\mathrm{L}}{2}$}
                ]
                \addplot[signalred] coordinates {(\D-1,0.22) (0,-0.2) (\D,0.2) (1, -0.2) (1+\D,0.2)};
                \draw[signalred, thick, dashed, visible on=<3->] (axis cs:\D-1,0.2/1.73) -- (axis cs:1+\D, 0.2/1.73); % dashed line at RMS current
                \node[above, inner sep = 2pt, anchor = north, fill = white, visible on=<3->] at (axis cs:0.1, 0.2/1.73) {$\Delta I_\mathrm{L}$};
                \draw [thin, <->]  (0.6,-0.2) -- node[left,fill=white]{$\Delta i_\mathrm{L}$}(0.6, 0.2); 
            \end{axis}
        \end{tikzpicture}
        \caption{Inductor current ripple}
        \label{fig:inductor-current-ripple}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple (cont.)}
    The (total) RMS value of the inductor current (triangular signal with offset) is given by
    \begin{equation}
        I_\mathrm{L} = \sqrt{\overline{i}^2_\mathrm{L} + \Delta I^2_\mathrm{L}}.
    \end{equation}
    \pause
    Considering the internal resistance $R_\mathrm{i}$ of the inductor, the \hl{ohmic power loss} in the inductor is
    \begin{equation}
        P_\mathrm{L} = R_\mathrm{i} I^2_\mathrm{L} = R_\mathrm{i} \left(\overline{i}^2_\mathrm{L} + \Delta I^2_\mathrm{L}\right).
        \label{eq:power-loss-ripple-inductor-step-down-converter}
    \end{equation}
    \pause
    The power loss in the inductor is thus composed of a constant part $\overline{P}_\mathrm{L} = R_\mathrm{i} \overline{i}^2_\mathrm{L}$, which is related to the power transfer from input to output, and a ripple part $\Delta P_\mathrm{L} = R_\mathrm{i} \Delta I^2_\mathrm{L}$.   
    \pause%
    \begin{varblock}{Current ripple and power losses}
        The current ripple produces additional losses in the inductor. From \eqref{eq:RMS-current-ripple} it seems tempting to increase the switching frequency $f_\mathrm{s}$ to reduce the ripple, but this will increase switching losses (compare \figref{fig:idealized_switch_model}). Hence, there is a trade-off decision between switching and conduction losses.
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple and duty cycle %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple and duty cycle}
    \onslide<1->{Rewriting the current ripple expression}
    \begin{equation*}
        \onslide<1->{\Delta i_\mathrm{L} = \frac{D(1-D)T_\mathrm{s}}{L}U_1} \onslide<2->{= (D-D^2)\frac{T_\mathrm{s}U_1}{L}}
    \end{equation*}
    \onslide<3->{and calculating the derivative with respect to the duty cycle $D$ delivers}
    \begin{equation}
        \onslide<3->{\frac{\mathrm{d}\Delta i_\mathrm{L}}{\mathrm{d}D} = \frac{T_\mathrm{s}U_1}{L} - 2D\frac{T_\mathrm{s}U_1}{L}.}
    \end{equation}
    \onslide<4->{Setting the derivative to zero, we find the duty cycle $D_\mathrm{max}$ as}
    \begin{equation}
        \onslide<4->{\frac{\mathrm{d}\Delta i_\mathrm{L}}{\mathrm{d}D} = 0} \onslide<5->{\quad \Leftrightarrow \quad D_\mathrm{max} = \frac{1}{2}}
        \label{eq:duty-cycle-max}
    \end{equation}
    \onslide<6->{which is associated with the maximum current ripple since the second derivative 
    \begin{equation}
        \frac{\mathrm{d}^2\Delta i_\mathrm{L}}{\mathrm{d}D^2} = -\frac{2T_\mathrm{s}U_\mathrm{on}}{L}
    \end{equation}
    is negative.} 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple and duty cycle (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple and duty cycle (cont.)}
    \onslide<1->{From \eqref{eq:duty-cycle-max} we can conclude that the maximum current ripple is given by}
    \begin{equation}
        \onslide<1->{\Delta i_\mathrm{L, \max} = \frac{1}{4}\frac{T_\mathrm{s}U_1}{L}} \onslide<2->{\quad \Rightarrow \quad \Delta i_\mathrm{L} = 4D(1-D) \Delta i_\mathrm{L, \max}.}
        \label{eq:current-ripple-max-simple-step-down}
    \end{equation}
    \onslide<3->{
    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                xlabel={$D$},
                ylabel={$\Delta i_\mathrm{L}$},
                ymin=0, ymax=1.1,
                xmin=0, xmax=1,
                width = 0.6\textwidth,
                height = 0.5\textheight,
                grid,
                thick,
                clip = true,
                xtick = {0, 0.25, 0.5, 0.75, 1.0}, 
                ytick = {0, 0.5, 1.0}, 
                yticklabels = {0, $\nicefrac{\Delta i_\mathrm{L, max}}{2}$, $\Delta i_\mathrm{L, max}$}
                ]
                \addplot[signalblue, domain=0:1, samples=100] {x*(1-x)*4};
                \draw[dashed] (axis cs:0.5,0) -- (axis cs:0.5,1); % dashed line at max current ripple
                \node[above, inner sep = 2pt, anchor = east, fill = white] at (axis cs:0.5, 0.5) {$D_\mathrm{max}$};
            \end{axis}
        \end{tikzpicture}
        \caption{Inductor current ripple as a function of the duty cycle}
        \label{fig:inductor-current-ripple-duty}
    \end{figure}
    }
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter with output capacitor %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step-down converter: output capacitor}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter with output capacitor: overview and assumption %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-down converter with output capacitor: overview and assumption}
        We consider the following assumptions:
        \begin{itemize}
            \item The switch is ideal, that is, infinitely fast.
            \item<2-> The input voltage is constant: $u_1(t) = U_1$.
            \item<3-> The output current is constant: $i_2(t) = I_2$.
            \item<4-> The input voltage is greater than the output voltage: $U_1 > u_2(t)$.
        \end{itemize}
        \begin{figure}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to ++(-7,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                (-7,2) to  [short, i=$i_1(t)$] ++(1.35,0);   
                \draw (-6.375,2) ++(0.625,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S) {}
                let \p1 = (S.mid) in (S.in) to  [short, i=$i_\mathrm{L}(t)$] ++(1,0)
                to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(2,0)
                to [short] ++(1,0)
                to [short, -o, i=$i_2(t)$] (0,2) 
                ([yshift = -0.3cm]S.mid) to [short, o-*](\x1,0);
                \draw (-4.5,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s}(t)$, voltage = straight] ++(0,-2);
                \draw (-1.5,2) to [capacitor, *-*, l=$C$, i>^=$i_\mathrm{C}(t)$] ++(0,-2);
            \end{circuitikz}
            \caption{Step-down converter (ideal switch representation) with output capacitor}
            \label{fig:step-down-converter-simple-output-cap}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis}
    From \eqref{eq:inductor-current-switch-on-simple-step-down} we know that the inductor current during the switch-on period is given by
    \begin{equation*}
        i_\mathrm{L}(t) = i_\mathrm{L}(k T_\mathrm{s}) + \frac{U_1-u_\mathrm{C}(t)}{L} (t - k T_\mathrm{s}), \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}]. 
    \end{equation*}
    \pause
   Note that the inductor current is now dependent on $u_\mathrm{C}(t)$:
    \begin{itemize}
        \item Formally, we need to consider the impact of the varying output capacitor voltage. \pause
        \item This would lead to a second-order differential equation which is more complex to solve. \pause
        \item We will \hl{simplify the analysis} by assuming that the impact of the output capacitor voltage variation on the inductor current is negligible: $u_\mathrm{C}(t) \approx U_2=\overline{u}_\mathrm{c}$. \pause
    \end{itemize} 
    \vspace{-0.5cm}
    \begin{varblock}{Simplification comment}
        The above assumption is valid for sufficiently large output capacitors with only small voltage ripples. Otherwise, the output voltage ripple and the inductor current ripple will be significantly coupled and require a more thoughtful analysis.
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    \onslide<1->
     The \hl{capacitor's voltage differential equation} is given by
    \begin{equation}
        C \frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} = i_\mathrm{C}(t) \onslide<2-> = i_\mathrm{L}(t) - I_2.
        \label{eq:capacitor-voltage-differential-equation-step-down-converter}
    \end{equation}
    \onslide<3->
    While $I_2$ is considered a known constant, we first need to determine the inductor current $i_\mathrm{L}(t)$. Combining \eqref{eq:inductor-current-switch-on-simple-step-down} and \eqref{eq:current-ripple-simple-step-down} we obtain
    \begin{equation}
         i_\mathrm{L}(k T_\mathrm{s})  = I_2 - \frac{\Delta i_\mathrm{L}}{2} \onslide<4-> = I_2 - \frac{U_1 - U_2}{L} \frac{T_\mathrm{on}}{2} \onslide<5->
    \end{equation}
    and
    \begin{equation}
        i_\mathrm{L}(k T_\mathrm{s} + T_\mathrm{on})  = I_2 + \frac{\Delta i_\mathrm{L}}{2} \onslide<6-> = I_2 + \frac{U_1 - U_2}{L} \frac{T_\mathrm{on}}{2}
   \end{equation}
    as the \hl{initial conditions for the inductor current} in steady state. 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    \onslide<1->{%
     The \hl{capacitor's current} during the \hl{switch-on period} is given by}
    \begin{equation}
        \begin{split}
            \onslide<1->{i_\mathrm{C}(t) &= i_\mathrm{L}(t) - I_2} \onslide<2->{= \frac{U_1-U_2}{L} (t - \frac{T_\mathrm{on}}{2}-k T_\mathrm{s}) } \\
            \onslide<3->{&= -\frac{\Delta i_\mathrm{L}}{2} + \frac{U_1-U_2}{L} (t -k T_\mathrm{s}), \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}]} 
        \end{split}
        \label{eq:capacitor-current-switch-on-step-down-converter}
    \end{equation}
    \onslide<4->{%
    and during the \hl{switch-off period} we receive}
    \begin{equation}
        \begin{split}
            \onslide<4->{i_\mathrm{C}(t) &= i_\mathrm{L}(t) - I_2} \onslide<5->{ = \frac{U_1 - U_2}{L} \frac{T_\mathrm{on}}{2} -\frac{U_2}{L} (t - k T_\mathrm{s} - T_\mathrm{on})}  \\
            \onslide<6->{&= \frac{\Delta i_\mathrm{L}}{2} - \frac{U_2}{L} (t - k T_\mathrm{s} - T_\mathrm{on}), \quad t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}].}
        \end{split}
        \label{eq:capacitor-current-switch-off-step-down-converter}
    \end{equation}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.6} % duty cycle
            \begin{axis}[
                xlabel={$t/T_\mathrm{s}$},
                ylabel={$i_\mathrm{C}(t)$},
                ymin=-0.3, ymax=0.3,
                xmin=-0.1, xmax=1.1,
                width = 0.7\textwidth,
                height = 0.4\textheight,
                grid,
                thick,
                clip = true,
                ytick = {-0.2, 0, 0.2}, 
                yticklabels = {$\nicefrac{-\Delta i_\mathrm{L}}{2}$, 0, $\nicefrac{\Delta i_\mathrm{L}}{2}$}
                ]
                \addplot[signalred] coordinates {(\D-1,0.22) (0,-0.2) (\D,0.2) (1, -0.2) (1+\D,0.2)};
                \draw [thin, <->]  (0.6,-0.2) -- node[left,fill=white]{$\Delta i_\mathrm{L}$}(0.6, 0.2); 
            \end{axis}
        \end{tikzpicture}
    \end{figure}
    \pause
    \begin{varblock}{Current ripples through the capacitor and inductor}
        Based on the made assumptions, the capacitor's current is raising and falling linearly during the switch-on and switch-off periods, that is, it corresponds to the previously considered inductor current ripple. 
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    \onslide<1->{
    Inserting \eqref{eq:capacitor-current-switch-on-step-down-converter} in \eqref{eq:capacitor-voltage-differential-equation-step-down-converter} and integrating the differential equation delivers the \hl{capacitor voltage during the switch-on period} as}
    \begin{equation}
        \begin{split}
            \onslide<1->{u_\mathrm{C}(t) &= u_\mathrm{C}(k T_\mathrm{s}) + \frac{1}{C}\int_{k T_\mathrm{s}}^t i_\mathrm{C}(\tau) \mathrm{d}\tau , \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}]} \\
            \onslide<2->{&= u_\mathrm{C}(k T_\mathrm{s}) + \frac{1}{C}\int_{k T_\mathrm{s}}^t -\frac{\Delta i_\mathrm{L}}{2} + \frac{U_1-U_2}{L} (\tau -k T_\mathrm{s}) \mathrm{d}\tau} \\
            \onslide<3->{&=u_\mathrm{C}(k T_\mathrm{s}) + \frac{1}{C} \left[-\frac{\Delta i_\mathrm{L}}{2}\tau + \frac{U_1-U_2}{L} (\frac{1}{2}\tau^2 -k T_\mathrm{s}\tau)\right]_{k T_\mathrm{s}}^t} \\
            \onslide<4->{&=u_\mathrm{C}(k T_\mathrm{s}) - \frac{\Delta i_\mathrm{L}}{2 C}(t- kT_\mathrm{s}) + \frac{U_1-U_2}{LC} \left[t(\frac{t}{2}-kT_\mathrm{s}) + \frac{(kT_\mathrm{s})^2}{2}\right].}
        \end{split}
        \label{eq:capacitor-voltage-switch-on-step-down-converter}
    \end{equation}
    \onslide<5->{%
    Here, $u_\mathrm{C}(k T_\mathrm{s})$ is the initial capacitor voltage at the beginning of the switch-on period.}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    \onslide<1->{At the \hl{end of the switch-on period}, the capacitor voltage is given by}
    \begin{equation}
        \begin{split}
            \onslide<1->{u_\mathrm{C}(k T_\mathrm{s} + T_\mathrm{on}) &= u_\mathrm{C}(k T_\mathrm{s}) -\frac{\Delta i_\mathrm{L}}{2 C}(k T_\mathrm{s} + T_\mathrm{on}- kT_\mathrm{s})} \\\onslide<1->{&+ \frac{U_1-U_2}{LC} \left[(k T_\mathrm{s} + T_\mathrm{on})(\frac{k T_\mathrm{s} + T_\mathrm{on}}{2}-kT_\mathrm{s}) + \frac{(kT_\mathrm{s})^2}{2}\right]}\\
            \onslide<2->{&= u_\mathrm{C}(k T_\mathrm{s}) - \frac{\Delta i_\mathrm{L}}{2 C}T_\mathrm{on} +\frac{\Delta i_\mathrm{L}}{2 C}T_\mathrm{on}}\\
            \onslide<3->{&= u_\mathrm{C}(k T_\mathrm{s}),}
        \end{split}
        \label{eq:capacitor-voltage-switch-on-step-down-converter-end}
    \end{equation}
    \onslide<4->{i.e., the capacitor voltage at the end of the switch-on period is equal to the voltage at the beginning of the switch-on period. Since the capacitor voltage needs to be continuous over time, this also marks the \hl{initial condition for the switch-off period.}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    \onslide<1->{
    Inserting \eqref{eq:capacitor-current-switch-off-step-down-converter} in \eqref{eq:capacitor-voltage-differential-equation-step-down-converter} and integrating the differential equation delivers the \hl{capacitor voltage during the switch-off period} as}
    \begin{equation}
        \begin{split}
            \onslide<1->{u_\mathrm{C}(t) &= u_\mathrm{C}(k T_\mathrm{s}+T_\mathrm{on}) + \frac{1}{C}\int_{k T_\mathrm{s}+T_\mathrm{on}}^t i_\mathrm{C}(\tau) \mathrm{d}\tau, \quad t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}]} \\
            \onslide<2->{&= u_\mathrm{C}(k T_\mathrm{s}) + \frac{1}{C}\int_{k T_\mathrm{s}+T_\mathrm{on}}^t \frac{\Delta i_\mathrm{L}}{2} - \frac{U_2}{L} (\tau - k T_\mathrm{s} - T_\mathrm{on}) \mathrm{d}\tau}\\
            \onslide<3->{& = u_\mathrm{C}(k T_\mathrm{s}) + \left[\frac{\Delta i_\mathrm{L}}{2}\tau - \frac{U_2}{L} (\frac{1}{2}\tau^2 - k T_\mathrm{s}\tau - T_\mathrm{on}\tau) \right]_{k T_\mathrm{s}+T_\mathrm{on}}^t}\\
            \onslide<4->{&= u_\mathrm{C}(k T_\mathrm{s}) + \frac{\Delta i_\mathrm{L}}{2 C}(t - k T_\mathrm{s} - T_\mathrm{on}) - \frac{U_2}{LC} \left[t(\frac{t}{2} - k T_\mathrm{s} - T_\mathrm{on}) + \frac{(k T_\mathrm{s} + T_\mathrm{on})^2}{2}\right].}
        \end{split}
        \label{eq:capacitor-voltage-switch-off-step-down-converter}
    \end{equation}
    \onslide<5->{Here, $u_\mathrm{C}(k T_\mathrm{s}+T_\mathrm{on})=u_\mathrm{C}(k T_\mathrm{s})$ is the initial capacitor voltage at the beginning of both the switch-on and switch-off period.}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state time-domain behavior %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Steady-state time-domain behavior}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.6} % duty cycle

            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({0 + #1},1) ({\D + #1},1) ({\D + #1},0) ({1 + #1},0) ({1 + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \D) -- (axis cs:4, \D); % dashed line at U_2 (average)
                    \node[above, inner sep = 2pt, anchor = south, visible on=<2->] at (axis cs:1-\D/4-0.04, \D+0.05) {$u(t)$}; % label U_2
                    \draw [thick,<->]  (0,0.42) -- node[below]{$T_\mathrm{on}$}(\D, 0.42); % T_on 
                    \draw [thick,<->]  (\D,0.42) -- node[below]{$T_\mathrm{off}$}(1.0, 0.42); % T_off
                    \draw [thick,<->]  (0.0,-0.2) -- node[below]{$T_\mathrm{s}$}(1.0, -0.2); % T_s
                    \tikzmath{
                        real \D, \u0, \Ts, \Ton, \Toff, \ripple;
                        \D = 0.6;
                        \Ts = 1;
                        \Ton = \D;
                        \Toff = 1-\D;
                        \ripple = 0.75;
                        \u0 = \D - \ripple / 6 * \Ts*(1-2*\D);
                    } 
                    \pgfplotsinvokeforeach{0,...,3}{
                            \edef\AddPlot{\noexpand\addplot[signalblue, thick, domain=#1:#1+\Ton, samples=50, visible on=<2->] {\u0 - \ripple*(x - #1 * \Ts) + 2 * \ripple / \Ton * (x^2/2 - #1 * \Ts *x + (#1 * \Ts)^2/2)};}
                            \AddPlot
                            \edef\AddPlot{\noexpand\addplot[signalblue, thick, domain=#1+\Ton:#1+\Ts, samples=50, visible on=<2->] {\u0 + \ripple*(x - #1 * \Ts - \Ton) - 2 * \ripple / \Toff * (x^2/2 - #1 * \Ts *x - x*\Ton + (#1 * \Ts + \Ton)^2/2)};}
                            \AddPlot
                        }
                    \draw[dashed, thin, visible on=<2->] (axis cs:0, \u0+\ripple*\Toff/4) -- (axis cs:4, \u0+\ripple*\Toff/4);
                    \draw[dashed, thin, visible on=<2->] (axis cs:0, \u0-\ripple*\Ton/4) -- (axis cs:4, \u0-\ripple*\Ton/4);
                    \draw[thin, -{Latex[length=2mm]}, visible on=<2->] (axis cs:1+\D/2, \u0+\ripple*\Toff/4+0.25) -- (axis cs:1+\D/2, \u0+\ripple*\Toff/4);
                    \draw[thin, -{Latex[length=2mm]}, visible on=<2->] (axis cs:1+\D/2, \u0-\ripple*\Ton/4-0.25) -- (axis cs:1+\D/2, \u0-\ripple*\Ton/4);
                    \node[above, inner sep = 2pt, anchor = west, visible on=<2->] at (axis cs:1+\D/2, \u0-\ripple*\Ton/4-0.2) {$\Delta u_\mathrm{C}$}; 
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:1.5+\D/2,\D) -- node[right=1mm, fill=white, inner sep = 1pt, anchor = north]{$\overline{u}_\mathrm{c}$}(axis cs:1.5+\D/2,0.1);
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:2,\D/3) -- node[right=1mm, fill=white, inner sep = 1pt, anchor = west]{$u_\mathrm{s}(t)$}(axis cs:2+\D/2,\D/3);


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, $\overline{i}_\mathrm{L}$, }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5) -- (axis cs:4,0.5); % dashed line at average current
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:\D+0.02,0.75) -- node[right=1mm, fill=white, inner sep = 1pt]{$\max\{i_\mathrm{L}\}$}(axis cs:\D+0.3,0.9); % indicate max current
                    \draw[-{Latex[length=2mm]}, thin] (axis cs:0.75,0.2) node[right=1mm, fill=white, inner sep = 1pt, anchor = east]{$\min\{i_\mathrm{L}\}$} -- (axis cs:1-0.02,0.25); % indicate min current
                    \draw[thin] (axis cs:2+\D/4,0.25+0.125) -- (axis cs:2+\D/4,0.75-0.125) -- (axis cs:2+\D*3/4,0.75-0.125); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south, xshift = -4mm] at (axis cs:2+\D/2, 0.75-0.125) {$\nicefrac{(U_1-U_2)}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2.25+3*\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.25+0.125); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south, xshift = 2mm] at (axis cs:2.5+\D/2, 0.75-0.125) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({\D + #1},0) ({1 + #1},0) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5 * \D) -- (axis cs:4, 0.5 * \D); % dashed line at average current
                    \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\D/2, 0.5 * \D) {$\overline{i}_1$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output voltage ripple %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Output voltage ripple}
    \onslide<1->{
    Utilizing \eqref{eq:capacitor-voltage-switch-on-step-down-converter} and calculating the derivative with respect to $t$ we obtain}
    \begin{equation}
        \begin{split}
            \onslide<1->{\frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} &= -\frac{\Delta i_\mathrm{L}}{2 C} + \frac{U_1-U_2}{LC} t}\\
                                                          & \onslide<2->{= -\frac{U_1-U_2}{LC}\frac{T_\mathrm{on}}{2} +\frac{U_1-U_2}{LC} (t-kT_\mathrm{s}), \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}].}
        \end{split}
    \end{equation}
    \onslide<2->{Setting the derivative to zero, we find the time $t_\mathrm{min}$ at which the minimum voltage occurs as
    \begin{equation}
        \frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} = 0 \quad \Rightarrow \quad t_\mathrm{min} = \frac{T_\mathrm{on}}{2} + kT_\mathrm{s}
        \label{eq:time-min-voltage-ripple-step-down-converter}
    \end{equation}
    since the second derivative is positive.} \onslide<3->{Inserting \eqref{eq:time-min-voltage-ripple-step-down-converter} in \eqref{eq:capacitor-voltage-switch-on-step-down-converter} reveals the minimum voltage as
    \begin{equation}
        u_\mathrm{C}(t_\mathrm{min}) = u_\mathrm{C}(kT_\mathrm{s}) - \frac{U_1-U_2}{LC} \frac{T_\mathrm{on}^2}{8} = u_\mathrm{C}(kT_\mathrm{s}) - \Delta i_\mathrm{L}\frac{T_\mathrm{on}}{8C}.
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output voltage ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Output voltage ripple (cont.)}
    \onslide<1->{Likewise, calculating the derivative of \eqref{eq:capacitor-voltage-switch-off-step-down-converter} leads to}
    \begin{equation}
        \begin{split}
            \onslide<2->{\frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} &= \frac{\Delta i_\mathrm{L}}{2 C} - \frac{U_2}{LC} (t-kT_\mathrm{s} - T_\mathrm{on})}\\
            \onslide<3->{&= \frac{U_1-U_2}{LC}\frac{T_\mathrm{on}}{2} -\frac{U_2}{LC} (t-kT_\mathrm{s} - T_\mathrm{on}), \quad t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}].}
        \end{split}
    \end{equation}
    \onslide<3->{Setting the derivative to zero, we find the time $t_\mathrm{max}$ at which the maximum voltage occurs as
    \begin{equation}
        \frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} = 0 \quad \Rightarrow \quad t_\mathrm{max} = \frac{T_\mathrm{off}}{2} + T_\mathrm{on} + k T_\mathrm{s}
    \end{equation}
    since the second derivative is negative.} \onslide<4->{The maximum voltage is then given by
    \begin{equation}
        u_\mathrm{C}(t_\mathrm{max}) = u_\mathrm{C}(kT_\mathrm{s}) + \Delta i_\mathrm{L}\frac{T_\mathrm{off}}{8C}.
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output voltage ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Output voltage ripple (cont.)}
    \onslide<1->{The \hl{voltage ripple} is then given by}
    \begin{equation}
        \begin{split}
            \onslide<1->{\Delta u_\mathrm{C} &= u_\mathrm{C}(t_\mathrm{max}) - u_\mathrm{C}(t_\mathrm{min})} \onslide<2->{= \Delta i_\mathrm{L}\frac{T_\mathrm{off}}{8C} + \Delta i_\mathrm{L}\frac{T_\mathrm{on}}{8C}}\\
            \onslide<3->{&= \Delta i_\mathrm{L}\frac{T_\mathrm{s}}{8C} = \frac{D(1-D)T_\mathrm{s}^2U_1}{8LC}.}
        \end{split}
    \end{equation}
    \onslide<4->{The voltage ripple is proportionally depending on the inductor current ripple. Hence, the maximum voltage ripple occurs at the same characteristic duty cycle $D_\mathrm{max}$ and is given by
    \begin{equation}
        D_\mathrm{max}=\frac{1}{2} \quad \Rightarrow \quad \Delta u_\mathrm{C, max} =  \frac{T_\mathrm{s}^2U_1}{32 LC}.
    \end{equation}}
    \onslide<5->{Hence, we can rewrite the voltage ripple as
    \begin{equation}
        \Delta u_\mathrm{C} =   4D(1-D)\Delta u_\mathrm{C, max}.
    \end{equation}
    The voltage ripple is associated with \hl{additional losses} in the output capacitor and the load, that is, an \hl{important stress parameter.}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output voltage ripple: alternative via charge balance %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Output voltage ripple: alternative via charge balance}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            If one is not interested in the specific signal shape $u_\mathrm{C}(t)$, the output voltage ripple can be derived from the charge balance over half a period (cf. \figref{fig:step-down-converter-voltage-ripple-charge-balance}):
            \begin{equation}
                \Delta Q = \frac{1}{2}\frac{\Delta i_\mathrm{L}}{2}\frac{T_\mathrm{s}}{2}.
            \end{equation}
        \onslide<2->{From $$\frac{1}{C}\int i_\mathrm{C}(t)\mathrm{d}t = u_\mathrm{C}(t) + u_\mathrm{C}(0)$$}
        \onslide<3->{we receive
        \begin{equation}
                \Delta u_\mathrm{C} = \frac{\Delta Q}{C} = \frac{\Delta i_\mathrm{L}T_\mathrm{s}}{8C}.
        \end{equation}}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \begin{tikzpicture}

                    \tikzmath{
                        real \D, \u0, \Ts, \Ton, \Toff, \ripple;
                        \D = 0.6;
                        \Ts = 1;
                        \Ton = \D;
                        \Toff = 1-\D;
                        \ripple = 1.2;
                        \u0 = \D - \ripple / 6 * \Ts*(1-2*\D);
                        } 

                    \begin{groupplot}[group style={group size=1 by 2, xticklabels at = edge bottom}, height=0.4\textheight, width=0.9\textwidth, xmin=-0.1, xmax=1.1, grid,clip = false, ymin = 0, ymax =1.1]

                        % Capacitor voltage
                        \nextgroupplot[ylabel = {$u_\mathrm{C}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                            % Half cycle for t<0
                            \addplot[signalblue, thick, domain=-0.1:-1+\Ts, samples=15] {\u0 + \ripple*(x - -1 * \Ts - \Ton) - 2 * \ripple / \Toff * (x^2/2 - -1 * \Ts *x - x*\Ton + (-1 * \Ts + \Ton)^2/2)};
                            % Half cycle for 0<t<Ton
                            \addplot[signalblue, thick, domain=0:\Ton, samples=50] {\u0 - \ripple*(x) + 2 * \ripple / \Ton * (x^2/2)};
                            % Half cycle for Ton<t<Ts
                            \addplot[signalblue, thick, domain=\Ton:\Ts, samples=50] {\u0 + \ripple*(x - \Ton) - 2 * \ripple / \Toff * (x^2/2 - x*\Ton + (\Ton)^2/2)};
                            % Half cycle for t>Ts
                            \addplot[signalblue, thick, domain=1:1.1, samples=15] {\u0 - \ripple*(x - 1 * \Ts) + 2 * \ripple / \Ton * (x^2/2 - 1 * \Ts *x + (1 * \Ts)^2/2)};

                            % Dashed lines for voltage ripple (upper limit)
                            \draw[dashed, thin] (axis cs:-0.1, \u0+\ripple*\Toff/4) -- (axis cs:1.1, \u0+\ripple*\Toff/4);
                            % Dashed lines for voltage ripple (lower limit)
                            \draw[dashed, thin] (axis cs:-0.1, \u0-\ripple*\Ton/4) -- (axis cs:1.1, \u0-\ripple*\Ton/4);
                            % Voltage ripple arrow indication (top)
                            \draw[thin, -{Latex[length=2mm]}] (axis cs:0, \u0+\ripple*\Toff/4+0.25) -- (axis cs:0, \u0+\ripple*\Toff/4);
                            % Voltage ripple arrow indication (buttom)
                            \draw[thin, -{Latex[length=2mm]}] (axis cs:0, \u0-\ripple*\Ton/4-0.25) -- (axis cs:0, \u0-\ripple*\Ton/4);
                            % Voltage ripple label
                            \node[above, inner sep = 2pt, anchor = west] at (axis cs:0, \u0-\ripple*\Ton/4-0.2) {$\Delta u_\mathrm{C}$}; 
                            \coordinate (a) at (\Ton/2,\u0-\ripple*\Ton/4); %coordinate for left vertical grouplot line
                            \coordinate (b) at (\Ton+\Toff/2,\u0+\ripple*\Ton/4); %coordinate for right vertical grouplot line


                        % Capacitor current
                        \nextgroupplot[ylabel = {$i_\mathrm{C}(t)$}, xlabel={$t/T_\mathrm{s}$}, ymin=-0.3, ymax=0.3, ytick = {-0.2, 0, 0.2}, yticklabels = {$\nicefrac{-\Delta i_\mathrm{L}}{2}$, 0,$\nicefrac{\Delta i_\mathrm{L}}{2}$}]
                            % Current signal
                            \addplot[signalred, thick] coordinates {(-0.1,-0.2+0.4/6) (0,-0.2) (\D,0.2) (1, -0.2) (1.1,-0.2+0.4/6)};
                            % Current ripple arrow indication
                            \draw [thin, <->]  (0,-0.2) -- (0, 0.2);
                            % Current ripple label
                            \node[inner sep = 1pt, anchor = west, fill = white] at (axis cs:0.025, 0.1) {$\Delta i_\mathrm{L}$};
                            % Positive \Delta Q charge area indication
                            \addplot[signalred, fill=shadecolor, fill opacity=0.3] coordinates {(\D/2,0) (\D,0.2) (0.5+\D/2,0)};
                            % \Delta Q charge area indication arrow
                            \draw[thin, -{Latex[length=2mm]}] (axis cs:\D-0.1,-0.1) -- (axis cs:\D,0.125);
                            % \Delta Q charge area indication label
                            \node[inner sep = 1pt, anchor = east, fill = white] at (axis cs:\D-0.1, -0.2) {$\Delta Q$};
                            % \Delta Q time indication
                            \draw [<->]  (\Ton -\Ton/2,\pgfkeysvalueof{/pgfplots/ymax}+0.1) -- node[above]{$\nicefrac{T_\mathrm{s}}{2}$}(\Ton +\Toff/2, \pgfkeysvalueof{/pgfplots/ymax}+0.1);
                            \coordinate (c) at (\Ton/2,0); %coordinate for left vertical grouplot line
                            \coordinate (d) at (\Ton+\Toff/2,0);  %coordinate for right vertical grouplot line
                    \end{groupplot}
                    \draw [dashed] (a) -- (c);
                    \draw [dashed] (b) -- (d);
                \end{tikzpicture}
                \caption{Voltage ripple derivation via charge balance}
                \label{fig:step-down-converter-voltage-ripple-charge-balance}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Average and initial capacitor voltage %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Average and initial capacitor voltage}
    \onslide<1->{The initial voltage $u_\mathrm{C}(k T_\mathrm{s})$ at the beginning of a period is still unknown.} \onslide<2->{We can derive it from the capacitor's average voltage over one period. For simplicity, we consider $k=0$:}
    \begin{equation}
        \onslide<2->{\overline{u}_\mathrm{c} = \frac{1}{T_\mathrm{s}}\int_0^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t} \onslide<3->{= \frac{1}{T_\mathrm{s}}\left(\int_0^{T_\mathrm{on}} u_\mathrm{C}(t) \mathrm{d}t + \int_{T_\mathrm{on}}^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t\right)  \stackrel{!}{=} D U_1.}
            \label{eq:capacitor-voltage-average-step-down-converter}
    \end{equation}
    \onslide<4->{Inserting \eqref{eq:capacitor-voltage-switch-on-step-down-converter} we receive for the first part
    \begin{equation}
        \begin{split}
            \int_0^{T_\mathrm{on}} u_\mathrm{C}(t) \mathrm{d}t &= \left[u_\mathrm{C}(0)t + \frac{\Delta i_\mathrm{L}}{2C}\frac{t^2}{2} + \frac{U_1-U_2}{LC}\frac{t^3}{6} \right]_{0}^{T_\mathrm{on}}=\ldots\\ &= u_\mathrm{C}(0) T_\mathrm{on} - \frac{\Delta i_\mathrm{L}}{C}\frac{T_\mathrm{on}^2}{12}. 
        \end{split}
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Average and initial capacitor voltage (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Average and initial capacitor voltage (cont.)}
    \onslide<1->{Inserting \eqref{eq:capacitor-voltage-switch-off-step-down-converter} into the second part of \eqref{eq:capacitor-voltage-average-step-down-converter} delivers
    \begin{equation}
        \begin{split}
            \int_{T_\mathrm{on}}^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t &= \left[u_\mathrm{C}(0)t +  \frac{\Delta i_\mathrm{L}}{2C}(\frac{t^2}{2} - T_\mathrm{on}t) - \frac{U_2}{LC}(\frac{t^3}{6} - T_\mathrm{on}\frac{t^2}{2} + \frac{T_\mathrm{on}^2}{2}t)  \right]_{T_\mathrm{on}}^{T_\mathrm{s}} =\ldots \\ &= u_\mathrm{C}(0) T_\mathrm{off} + \frac{\Delta i_\mathrm{L}}{C}\frac{T_\mathrm{off}^2}{12}.
        \end{split}
    \end{equation}}
    \onslide<2->{Combining both parts results in}
    \begin{equation}
    \begin{split}
        \onslide<2->{\overline{u}_\mathrm{c} &= \frac{1}{T_\mathrm{s}}\left(u_\mathrm{C}(0)T_\mathrm{s} + \frac{\Delta i_\mathrm{L}}{C}\frac{T_\mathrm{off}^2-T_\mathrm{on}^2}{12} \right)}\\
        \onslide<3->{& = u_\mathrm{C}(0) + \frac{\Delta i_\mathrm{L}}{12C}T_\mathrm{s}(1-2D) \stackrel{!}{=} D U_1.}
        \end{split}
    \end{equation}
    \onslide<4->{Solving for $u_\mathrm{C}(0)$ we receive the \hl{initial capacitor voltage} as
    \begin{equation}
        u_\mathrm{C}(0) = D U_1 - \frac{\Delta i_\mathrm{L}}{12C}T_\mathrm{s}(1-2D).
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter: circuit realization and operation modes %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step-down converter: circuit realization and operation modes}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Circuit realization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Circuit realization}
    \begin{itemize}
        \item<1-> The ideal (mechanical) switch cannot be operated with high frequency in practice.  
        \item<2-> It must be replaced with \hl{semiconductor devices} to allow for a practical realization.
        \item<3-> In \figref{fig:step-down-converter-realization-1Q} the simplest realization is shown utilizing one transistor and one diode. 
        \item<4-> However, this configuration can only provide positive voltages and currents.
        \item<5-> Hence, the converter can operate in the \hl{first quadrant} only.
    \end{itemize}
    \begin{figure}
        \onslide<3->
        \begin{circuitikz}[]                
            \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
            to ++(-6,0)
            to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
            (-6,2) to  [short, i=$i_1(t)$] ++(1.0,0);   
            \draw (-5.375,2) node [npn, anchor=C, rotate=90](npn1) {}
            (npn1.E) to  [short] ++(0.5,0) coordinate (S)
            to [short] ++(0.5,0)
            to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(1.8,0)
            to [short, -o, i=$i_2(t)$] (0,2);
            \draw (S)--++(0,-2) to [diode, *-*, l=$D$, v_<=$u_\mathrm{s}(t)$, voltage = straight] ++(0,2);
            %\draw  [node]{$T$} at (npn1.B)++(0,-0.5);
            \draw let \p1 = (npn1.B) in node[anchor=north] at (\x1,\y1) {$T$};
        \end{circuitikz}
        \caption{Step-down converter with real components (single quadrant type)}
        \label{fig:step-down-converter-realization-1Q}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Discontinous conduction mode (DCM) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Discontinous conduction mode (DCM)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                real \D,\Ts, \Ton, \Toff1, \Toff2, \ripple, \relrip, \currentavg;
                \Ts = 1;
                \Ton = 0.5;
                \D = \Ton/\Ts;
                \ripple = 0.65;
                \relrip = 1/3;
                \Uout = 1/(1+(\relrip/(2*\D^2)));
                \Toff1 = (1-\Uout)/\Uout*\Ton;
                \Toff2 = \Ts - \Ton - \Toff1;
                \currentavg = \ripple/2*(\Ton+\Toff1)/\Ts;
            }
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},1) ({\Ton + #1},1) ({\Ton + #1},0) ({\Ton+\Toff1 + #1},0) ({\Ton+\Toff1 + #1},\Uout) ({\Ts + #1},\Uout) ({\Ts + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \Uout) -- (axis cs:4, \Uout); % dashed line at U_2 (average)
                    \node[above, inner sep = 1pt, anchor = north, fill = white, yshift= -1pt] at (axis cs:1+\Ton/2, \Uout) {$U_2$}; % label U_2
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (0,-0.2) -- node[below]{$T_\mathrm{on}$}(\Ton, -0.2); % T_on 
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ton,-0.2) -- node[below]{$T'_\mathrm{off}$}(\Ton+\Toff1, -0.2); % T'_off
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ton+\Toff1,-0.2) -- node[below]{$T''_\mathrm{off}$}(\Ts, -0.2); % T''_off
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ts,-0.2) -- node[below]{$T_\mathrm{s}$}(2*\Ts, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0) ({\Ton + #1}, \ripple) ({\Ton+\Toff1 + #1},0) ({\Ts + #1},0)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,\currentavg) -- (axis cs:4,\currentavg); % dashed line at average current
                    \node[above, inner sep = 1pt, anchor = south, fill = white, yshift= 1pt] at (axis cs:2-\Toff2/2, \currentavg) {$\overline{i}_\mathrm{L}$}; % label \overline{i}_\mathrm{L}
                    \draw[thin] (axis cs:1+\Ton/2,\ripple/2) -- (axis cs:1+\Ton/2,\ripple*5/6) -- (axis cs:1+5*\Ton/6,\ripple*5/6); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south east] at (axis cs:1+\Ton*4/6, \ripple-1/6) {$\nicefrac{(U_1-U_2)}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2+\Ton+\Toff1/6,\ripple*5/6) -- (axis cs:2+\Ton+\Toff1/2,\ripple*5/6) -- (axis cs:2+\Ton+\Toff1/2,\ripple/2); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south west, xshift = -2mm] at (axis cs:2+\Ton+\Toff1/2, \ripple-1/6) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                \pgfplotsinvokeforeach{0,...,3}{
                    \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0) ({\Ton + #1},\ripple) ({\Ton + #1},0) ({\Ts + #1},0)};}
                    \AddPlot
                }
                \draw[signalred, thick, dashed] (axis cs:0,\ripple/2*\Ton/\Ts) -- (axis cs:4, \ripple/2*\Ton/\Ts); % dashed line at average current
                \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\Ton/2, \ripple/2*\Ton/\Ts) {$\overline{i}_1$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Switch states DCM}
    \onslide<1->{In contrast to the previous \hl{continuous conduction mode (CCM)}, the converter traverses three states in the \hl{discontinuous conduction mode (DCM)}:}
    \begin{itemize}
            \item<2-> Transistor on-time:  $T_\mathrm{on}=DT_\mathrm{s}$,
            \item<3-> Transistor off-time (conducting diode): $T'_\mathrm{off}=D'T_\mathrm{s}$,
            \item<4-> Transistor off-time (no conduction):  $T''_\mathrm{off}=T_\mathrm{s}-T_\mathrm{on}-T'_\mathrm{off}$.
    \end{itemize}
        \begin{figure}
            \centering
            \onslide<2->{%	
            \begin{subfigure}{0.33\textwidth}
                \centering
                \hspace{-1.4cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1(t)=i_\mathrm{L}(t)}$] ++(2,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                    \draw (-4,2) to [open, v = ${\hspace{2.2cm}U_\mathrm{s}=U_1}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-on time $T_\mathrm{on}$}
            \end{subfigure}%
            }%
            \onslide<3->{%	
            \begin{subfigure}{0.33\textwidth}
                \centering
                \hspace{-0.6cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                    (-3.75,0) to [short, *-] ++(0,2)
                    to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                    \draw (-3.4,2) to [open, v = ${\hspace{1.8cm}U_\mathrm{s}=0}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time $T'_\mathrm{off}$}
            \end{subfigure}
            }%
            \onslide<4->{%	
            \begin{subfigure}{0.33\textwidth}
                \centering
                \hspace{-1.3cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                    (-3.75,0) to [open] ++(0,2)
                    to [short] ++(0.5,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=${i_2=0}$] (0,2);
                    \draw (-3.75,2) to [open, v = ${\hspace{2.3cm}U_\mathrm{s}=U_2}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time $T''_\mathrm{off}$}
            \end{subfigure}
            }%
        \onslide<2->{\caption{Switch states of the step-down converter including DCM}} 
        \label{fig:step-down-converter-switch-states-DCM}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{DCM operation characteristics}
    The operation in CCM and DCM can be distinguished by the inductor current ripple
    \begin{equation}
        \overline{i}_\mathrm{L}=\overline{i}_2\begin{cases}
            \geq \frac{\Delta i_\mathrm{L}}{2}= 2D(1-D)\Delta i_\mathrm{L,max}: & \text{CCM},\\
            < \frac{\Delta i_\mathrm{L}}{2}= 2D(1-D)\Delta i_\mathrm{L,max}: & \text{DCM}
        \end{cases}
    \end{equation}
    with $$\Delta i_\mathrm{L,max} = \frac{U_1T_\mathrm{s}}{4L}.$$ \pause  Hence, the operation mode directly depends on the duty cycle $D$ and average load current $\overline{i}_2$, that is, it can change during runtime. While we have already discussed the operation in CCM, we will now focus on the operation in DCM. Here, it must be noted that
    $$ U_2 \neq U_1 D \quad \mbox{(DCM operation)}$$
    applies due to the non-conducting diode during  $T''_\mathrm{off}$.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DCM operation characteristics (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{DCM operation characteristics (cont.)}
    \onslide<1->{To find the input-to-output voltage ratio in DCM, we can utilize the current ripple balance:}
    \begin{equation}
        \begin{alignedat}{2}
            \onslide<2->{\Delta i_\mathrm{L} &= \frac{U_1-U_2}{L}T_\mathrm{on} = i_\mathrm{L} = \frac{U_1-U_2}{L}DT_\mathrm{s} \quad &&\mbox{(rising edge)},}\\
            \onslide<3->{\Delta i_\mathrm{L} &= \frac{U_2}{L}T'_\mathrm{off} = \frac{U_2}{L}D'T_\mathrm{s} \quad &&\mbox{(falling edge)}.}
        \end{alignedat}
    \end{equation}
    \onslide<4->{Solving for $D'$ results in
    \begin{equation}
        D' = \frac{L\Delta i_\mathrm{L}}{U_2T_\mathrm{s}} = \frac{U_1-U_2}{U_2}D = \left(\frac{U_1}{U_2}-1\right)D.
        \label{eq:Dprime-DCM}
    \end{equation}}
    \onslide<5->{The average load current is
    \begin{equation}
        \overline{i}_2 = \overline{i}_\mathrm{L} = \frac{1}{2}\Delta i_\mathrm{L}\frac{T_\mathrm{on}+T'_\mathrm{off}}{T_\mathrm{s}} = \frac{1}{2}\Delta i_\mathrm{L}(D+D')
        \label{eq:average-load-current-DCM}
    \end{equation}
    which is derived from the area under the triangular-shaped current during $T_\mathrm{on}$ and $T'_\mathrm{off}$.} 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DCM operation characteristics (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{DCM operation characteristics (cont.)}
    \onslide<1->{Inserting \eqref{eq:Dprime-DCM} into \eqref{eq:average-load-current-DCM} yields}
    \begin{equation}
        \begin{split}
            \onslide<1->{ \overline{i}_2 &= \frac{1}{2}\Delta i_\mathrm{L}D\frac{U_1}{U_2} = \frac{U_1-U_2}{2L}DT_\mathrm{s}D\frac{U_1}{U_2}}\\ \onslide<2->{&= 2D^2\left(\frac{U_1}{U_2}-1\right)\Delta i_\mathrm{L,max}.}
        \end{split}
        \label{eq:average-load-current-DCM-2}
    \end{equation}
    \onslide<3->{Solving for the \hl{DCM input-to-output voltage ratio} results in
    \begin{equation}
        \frac{U_2}{U_1} = \frac{1}{1+\frac{\overline{i}_2}{2\Delta i_\mathrm{L,max}D^2}}.
        \label{eq:voltage-ratio-DCM}
    \end{equation}
    Since $\Delta i_\mathrm{L,max}$ also depends on $U_1$, cf.  \eqref{eq:current-ripple-max-simple-step-down}, the relation \eqref{eq:voltage-ratio-DCM} only holds for a given $U_1$.} \onslide<4->{Alternatively, we can utilize \eqref{eq:average-load-current-DCM-2} and solve for $U_2$ to receive
    \begin{equation}
        U_2 = \frac{D^2T_\mathrm{s}U_1^2}{D^2T_\mathrm{s}U_1+2L\overline{i}_2}.
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter load curves %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-down converter load curves}
    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                xlabel={$\overline{i}_2/\Delta i_\mathrm{L,max}$},
                ylabel={$U_2/U_1$},
                axis lines=left,
                thick,
                smooth,
                no markers,
                axis equal image,
                height = 0.8\textheight,
                grid,
                ymin=0, ymax=1,
                xmin=0, xmax=1,
                clip = false
                ]
                \foreach \D in {0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0}{
                    \addplot[signalblue, domain=2*\D*(1-\D):1, samples=10] {\D}; %CCM
                    \addplot[signalblue, domain=0.001:2*\D*(1-\D), samples=30] {1/(1+x/(2*\D^2))}; %DCM
                }
                \foreach \D in {0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0}{
                    \edef\temp{\noexpand\node[inner sep = 1pt, align = center, fill = white] at (axis cs:0.8, \D) {$D=\D$};} % Duty-cycle labels
                    \temp
                }
                \addplot[signalred, domain = 0.001:0.5, samples=30, thick, name path = upper] {1/2 + (1/4 - x/2)^(0.5)}; % Upper boundary area
                \addplot[signalred, domain = 0.001:0.5, samples=30, thick, name path = lower] {1/2 - (1/4 - x/2)^(0.5)}; % Lower boundary area
                \addplot[shadecolor, opacity=0.3] fill between[of=upper and lower];
                \node[inner sep = 1pt, anchor = west, fill = white, font=\footnotesize] at (axis cs:0.295, 0.15) {CCM}; % CCM label
                \node[inner sep = 1pt, anchor = center, font=\footnotesize] at (axis cs:0.185, 0.175) {DCM}; % DCM label
            \end{axis}
        \end{tikzpicture}
        \caption{Step-down converter load curves for CCM and DCM}
        \label{fig:step-down-converter-load-curves}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Boundary conduction mode (BCM) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Boundary conduction mode (BCM)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                real \D,\Ts, \Ton, \Toff1, \Toff2, \ripple, \relrip, \currentavg;
                \Ts = 1;
                \Ton = 0.7;
                \D = \Ton/\Ts;
                \ripple = 0.65;
                \relrip = 1/2; % average load current devided by ripple current
                \Uout = \D;
                \Toff1 = \Ts - \Ton;
                \Toff2 = \Ts - \Ton - \Toff1;
                \currentavg = \ripple/2*(\Ton+\Toff1)/\Ts;
            }
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},1) ({\Ton + #1},1) ({\Ton + #1},0) ({\Ton+\Toff1 + #1},0) ({\Ton+\Toff1 + #1},\Uout) ({\Ts + #1},\Uout) ({\Ts + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \Uout) -- (axis cs:4, \Uout); % dashed line at U_2 (average)
                    \node[above, inner sep = 1pt, anchor = north, fill = white, yshift= -1pt] at (axis cs:1+\Ton/2, \Uout) {$U_2$}; % label U_2
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (0,-0.2) -- node[below]{$T_\mathrm{on}$}(\Ton, -0.2); % T_on 
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ton,-0.2) -- node[below]{$T_\mathrm{off}$}(\Ton+\Toff1, -0.2); % T'_off
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ts,-0.2) -- node[below]{$T_\mathrm{s}$}(2*\Ts, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0) ({\Ton + #1}, \ripple) ({\Ton+\Toff1 + #1},0) ({\Ts + #1},0)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,\currentavg) -- (axis cs:4,\currentavg); % dashed line at average current
                    \node[above, inner sep = 1pt, anchor = south, fill = white, yshift= 1pt] at (axis cs:2-\Toff2/2, \currentavg) {$\overline{i}_\mathrm{L}$}; % label \overline{i}_\mathrm{L}
                    \draw[thin] (axis cs:1+\Ton/2,\ripple/2) -- (axis cs:1+\Ton/2,\ripple*5/6) -- (axis cs:1+5*\Ton/6,\ripple*5/6); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south east] at (axis cs:1+\Ton*4/6, \ripple-1/6) {$\nicefrac{(U_1-U_2)}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2+\Ton+\Toff1/6,\ripple*5/6) -- (axis cs:2+\Ton+\Toff1/2,\ripple*5/6) -- (axis cs:2+\Ton+\Toff1/2,\ripple/2); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south west, xshift = -2mm] at (axis cs:2+\Ton+\Toff1/2, \ripple-1/6) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                \pgfplotsinvokeforeach{0,...,3}{
                    \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0) ({\Ton + #1},\ripple) ({\Ton + #1},0) ({\Ts + #1},0)};}
                    \AddPlot
                }
                \draw[signalred, thick, dashed] (axis cs:0,\ripple/2*\Ton/\Ts) -- (axis cs:4, \ripple/2*\Ton/\Ts); % dashed line at average current
                \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\Ton/2, \ripple/2*\Ton/\Ts) {$\overline{i}_1$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{BCM operation characteristics}
    In the \hl{boundary conduction mode (BCM)}, the average inductor current load is exactly half of the current ripple, that is, 
    \begin{equation}
        \overline{i}_\mathrm{L}=\overline{i}_2=\frac{\Delta i_\mathrm{L}}{2}= 2D(1-D)\Delta i_\mathrm{L,max}.
        \label{eq:average-load-current-BCM-step-down}
    \end{equation}
    \pause
    \vspace{-0.5cm}
    \begin{itemize}
        \item<2-> Diode current becomes zero and then the transistor turns on again.
        \begin{itemize}
            \item The diode is not hard turned-off but its current naturally decays to zero.
            \item Also known as \hl{zero current switching (ZCS)} or generally \hl{soft switching}.
        \end{itemize}
        \item<3-> Requires adaptive switching frequency control if load changes. From \eqref{eq:current-ripple-simple-step-down} and \eqref{eq:average-load-current-BCM-step-down} the BCM switching frequency results in 
    \end{itemize}
    \onslide<3->{
    \begin{equation}
        f_\mathrm{s} = \frac{1}{T_\mathrm{s}} = \frac{D(1-2)U_1}{L\Delta i_\mathrm{L} } = \frac{D(1-2)U_1}{2L \overline{i}_2 }.
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Motivation for BCM: diode reverse recovery %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Motivation for BCM: diode reverse recovery}
     % tikz plot which shows a diode and its charge distributions in forward and and backward direction
    \begin{figure}
        \begin{tikzpicture}

            % --- First Subplot: Forward Bias Mode ---
            \begin{scope}[shift={(-3,0)}, scale=0.55]  % Shift to create space for second subplot
            
            % N region (right side)
            \draw[fill=signalblue!20] (0,0) rectangle (3,4);
            \node at (1.5,4.3) {n};
            
            % P region (left side)
            \draw[fill=signalred!20] (-3,0) rectangle (0,4);
            \node at (-1.5,4.3) {p};
            
            % Diode symbol
            \draw[thick] (-4,2) -- (-3,2);  % Anode lead
            \draw[thick] (3,2) -- (4,2);    % Cathode lead
            
            % Forward bias current
            \draw[->, thick] (-5,2) -- (-3.5,2) node[above, midway] {$i_\mathrm{D}$};  
            
            \fill[signalred] (-1, 0.35) circle (0.3cm);
            \draw (-1, 0.35) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.15, 1) circle (0.3cm);
            \draw (-2.15, 1) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-0.6, 1.65) circle (0.3cm);
            \draw (-0.6, 1.65) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-1.8, 2.3) circle (0.3cm);
            \draw (-1.8, 2.3) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.4, 2.95) circle (0.3cm);
            \draw (-2.4, 2.95) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-1.25, 3.6) circle (0.3cm);
            \draw (-1.25, 3.6) node[white, scale=0.75] {\textbf{+}};
           
            \fill[signalblue] (1.8, 0.35) circle (0.3cm);
            \draw (1.8, 0.35) node[white] {\textbf{-}};
            \fill[signalblue] (2.35, 1) circle (0.3cm);
            \draw (2.35, 1) node[white] {\textbf{-}};
            \fill[signalblue] (0.9, 1.65) circle (0.3cm);
            \draw (0.9, 1.65) node[white] {\textbf{-}};
            \fill[signalblue] (2.6, 2.3) circle (0.3cm);
            \draw (2.6, 2.3) node[white] {\textbf{-}};
            \fill[signalblue] (1.4, 2.95) circle (0.3cm);
            \draw (1.4, 2.95) node[white] {\textbf{-}};
            \fill[signalblue] (0.65, 3.6) circle (0.3cm);
            \draw (0.65, 3.6) node[white] {\textbf{-}};
            \node at (0,-0.5) {Forward mode};
            \end{scope}
            
            % --- Second Subplot: Reverse Bias Mode (Reverse Recovery) ---
            \begin{scope}[shift={(3,0)}, scale=0.55]  % Shift second subplot to the right
            
            % N region (right side)
            \draw[fill=signalblue!20] (0,0) rectangle (3,4);
            \node at (1.5,4.3) {n};
            
            % P region (left side)
            \draw[fill=signalred!20] (-3,0) rectangle (0,4);
            \node at (-1.5,4.3) {p};
            
            % Diode symbol
            \draw[thick] (-4,2) -- (-3,2);  % Anode lead
            \draw[thick] (3,2) -- (4,2);    % Cathode lead
            
            % Forward bias current
            \draw[->, thick] (-5,2) -- (-3.5,2) node[above, midway] {${i_\mathrm{D}=0}$};  
            
            \fill[signalred] (-2.5, 0.35) circle (0.3cm);
            \draw (-2.5, 0.35) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 1) circle (0.3cm);
            \draw (-2.5, 1) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 1.65) circle (0.3cm);
            \draw (-2.5, 1.65) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 2.3) circle (0.3cm);
            \draw (-2.5, 2.3) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 2.95) circle (0.3cm);
            \draw (-2.5, 2.95) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 3.6) circle (0.3cm);
            \draw (-2.5, 3.6) node[white, scale=0.75] {\textbf{+}};
           
            \fill[signalblue] (2.5, 0.35) circle (0.3cm);
            \draw (2.5, 0.35) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 1) circle (0.3cm);
            \draw (2.5, 1) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 1.65) circle (0.3cm);
            \draw (2.5, 1.65) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 2.3) circle (0.3cm);
            \draw (2.5, 2.3) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 2.95) circle (0.3cm);
            \draw (2.5, 2.95) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 3.6) circle (0.3cm);
            \draw (2.5, 3.6) node[white] {\textbf{-}};
            \node at (0,-0.5) {Blocking mode};
            \end{scope}

            % --- Third Subplot: Time-Domain Plot of Current ---
            \begin{scope}[shift={(-5.25,-4.25)}]  % Shift the third subplot to the right
                \centering
                \begin{axis}[
                    width=6cm,
                    height=5cm,
                    axis lines=middle,
                    xlabel={$t$},
                    ylabel={$i_\mathrm{D}(t)$},
                    xtick=\empty,
                    ytick=\empty,
                    xmin=1, xmax=6,
                    ymin=-3, ymax=5,
                    samples=200,
                    domain=0:8,
                    thick
                ]
                    % Plot of current showing reverse recovery
                    \addplot [shadecolor, opacity=0.3, fill=shadecolor, 
                            domain=3.01:4.99, samples=20
                        ] {(-3*exp(-(2*(\x-3))))} \closedcycle;
                    \addplot[red, thick] plot (\x, 
                        {(\x<=3)*(4 - 0.7*\x) + 
                        (\x>3 && \x<=5)*(-3*exp(-(2*(\x-3)))) + 
                        (\x>5)*0});
                    % label pointing towards shaded area with reverse recovery charge
                    \draw[<-, thin] (axis cs:3.15, -0.6) -- (axis cs:4.0, -1.5) node[anchor = west] {$Q_\mathrm{rr}$};

                    %annotation at switch off point "high current turn-off"
                    \draw[<-, thin] (axis cs:3, 2) -- (axis cs:3.5, 2.5) node[anchor = west, align=left, node font=\small] {High current\\turn-off};
    
                \end{axis}
                \end{scope}
                \begin{scope}[shift={(0.75,-4.25)}]  % Shift the third subplot to the right
                    \centering
                    \begin{axis}[
                        width=6cm,
                        height=5cm,
                        axis lines=middle,
                        xlabel={$t$},
                        ylabel={$i_\mathrm{D}(t)$},
                        xtick=\empty,
                        ytick=\empty,
                        xmin=1, xmax=6,
                        ymin=-3, ymax=5,
                        samples=200,
                        domain=0:8,
                        thick
                    ]
    
                        % Plot of current showing reverse recovery
                        \addplot [shadecolor, opacity=0.3, fill=shadecolor, 
                            domain=3.01:4.99, samples=20
                        ] {(-2*exp(-(2*(\x-3))))} \closedcycle;
                        \addplot[red, thick] plot (\x, 
                            {(\x<=3)*(3 - 0.7*\x) + 
                            (\x>3 && \x<=5)*(-2*exp(-(2*(\x-3)))) + 
                            (\x>5)*0});

                        % label pointing towards shaded area with reverse recovery charge
                        \draw[<-, thin] (axis cs:3.15, -0.5) -- (axis cs:4.0, -1.5) node[anchor = west] {$Q_\mathrm{rr}$};

                        %annotation at switch off point "high current turn-off"
                        \draw[<-, thin] (axis cs:3, 1) -- (axis cs:3.5, 1.5) node[anchor = west, align=left, node font=\small] {Low current\\turn-off};
        
                    \end{axis}
                    \end{scope}
            
            \end{tikzpicture}
        \caption{Qualitative and simplified representation of the reverse recovery effect}
        \label{fig:diode-reverse-recovery}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{BCM operation characteristics: comments}
   \onslide<1->{Advantages of BCM:}
   \begin{itemize}
        \item<1-> Reduces the reverse recovery effect, that is, ZCS of the diode during turn on.
        \item<2-> Also allows ZCS transistor turn on.  
   \end{itemize}
   \vspace{1em}
   \onslide<3->{Limitations of BCM:}
    \begin{itemize}
          \item<3-> Transistor turn off and diode turn on cannot be soft switched due to topology constraints.
          \item<4-> Ripple current increases with load current: $ \Delta i_\mathrm{L} = 2\overline{i}_2$.
          \begin{itemize}
            \item May negatively affects load.
            \item Increases conduction losses due to higher RMS current -- compare \eqref{eq:power-loss-ripple-inductor-step-down-converter}.
            \item High switching frequency required at low loads (switching losses).
          \end{itemize}
    \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step-up converter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: overview and assumptions %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-up converter: overview and assumptions}
        \onslide<2->{We consider the following assumptions:}
        \begin{itemize}
            \item<2-> The switch is ideal, that is, infinitely fast.
            \item<3-> The input voltage is constant: $u_1(t) = U_1$.
            \item<3-> The output voltage is constant: $u_2(t) = U_2$.
            \item<4-> The input voltage is lower than the output voltage: $U_1 < U_2$.
        \end{itemize}
        \begin{figure}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to ++(-6,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                (-6,2) to  [short, i=$i_1(t)$] ++(1.25,0)
                to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(1.75,0)
                to  [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S) {}
                let \p1 = (S.mid) in (S.out) to  [short, i=$i_2(t)$] (0,2)
                ([yshift = -0.3cm]S.mid) to [short, o-*](\x1,0);
                \draw (-2.2,2) to [open, v_>=$u_\mathrm{s}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Step-up converter (aka \hl{boost converter}, ideal switch representation)}
            \label{fig:step-up-converter-simple}
        \end{figure}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: Switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-up converter: switch states}
     \onslide<1->{The voltage at the switch is given by}
     \begin{equation}
        \onslide<1->{u_\mathrm{s}(t) = \begin{cases}
                0, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}],}\\
                \onslide<2->{U_2, & t\in [k T_\mathrm{s}+ T_\mathrm{on}, (k+1) T_\mathrm{s}].}
            \end{cases}
     \end{equation}
     \onslide<3->{Note: switch on/off definition is reversed compared to the step-down converter.} 
    \begin{figure}
        \centering	
        \begin{subfigure}{0.45\textwidth}
            \centering
            \hspace{-0.75cm}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=$i_1(t)$] ++(1.0,0)
                to [inductor, l=$L$] ++(1.75,0)
                to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to [short, -*] ++(0,-2);
                \draw (0,2) to [short, i_<=${i_2=0}$, -o] ++(-1.0,0);
                \draw (-1.8,2) to [open, v_>=${U_\mathrm{s}=0\hspace{0.75cm}}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Switch-on time}
        \end{subfigure}%
        \hspace{0.5cm}
        \onslide<2->{
        \begin{subfigure}{0.45\textwidth}
            \centering
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=$i_1(t)$] ++(1.0,0)
                to [inductor, l=$L$] ++(1.75,0)
                to [short, i=${i_\mathrm{L}(t)=i_2(t)}$] (0,2);
                \draw (-1.5,2) to [open, v_>=${U_\mathrm{s}=U_2\hspace{1.2cm}}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Switch-off time}
        \end{subfigure}
        }
    \caption{Switch states of the step-up converter} 
    \label{fig:step-up-converter-switch-states}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: steady-state time-domain behavior %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Step-up converter: steady-state time-domain behavior}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.7} % duty cycle
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_2$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({0 + #1},1) ({\D + #1},1) ({\D + #1},0) ({1 + #1},0) ({1 + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \D) -- (axis cs:4, \D); % dashed line at U_1
                    \node[above, inner sep = 1pt, anchor = north, fill = white] at (axis cs:1.5+\D/2, \D-0.01) {$U_1$}; % label U_1
                    \draw [thick,<->]  (0,0.5) -- node[below]{$T_\mathrm{off}$}(\D, 0.5); % T_on 
                    \draw [thick,<->]  (\D,0.5) -- node[below]{$T_\mathrm{on}$}(1.0, 0.5); % T_off
                    \draw [thick,<->]  (0.0,-0.2) -- node[below]{$T_\mathrm{s}$}(1.0, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, $\overline{i}_\mathrm{L}$, }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.75) ({\D + #1},0.25) ({1 + #1},0.75)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5) -- (axis cs:4,0.5); % dashed line at average current
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:1-0.02,0.75) -- node[fill=white, inner sep = 1pt, anchor = east]{$\max\{i_\mathrm{L}\}$}(axis cs:1-0.4,0.9); % indicate max current
                    \draw[-{Latex[length=2mm]}, thin] (axis cs:\D+0.25,0.2) node[fill=white, inner sep = 1pt, anchor = west]{$\min\{i_\mathrm{L}\}$} -- (axis cs:\D+0.02,0.25); % indicate min current
                    \draw[thin] (axis cs:1.25+3/4*\D,0.25+0.125) -- (axis cs:1.25+3/4*\D,0.75-0.125) -- (axis cs:1.75+1/4*\D,0.75-0.125); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south, xshift = -4mm] at (axis cs:1.5+\D/2, 0.75-0.125) {$\nicefrac{U_1}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2.0+\D/4,0.75-0.125) -- (axis cs:2+3*\D/4,0.75-0.125) -- (axis cs:2.0+3*\D/4,0.25+0.125); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south, xshift = 2mm] at (axis cs:2.0+\D/2, 0.75-0.125) {$\nicefrac{U_1-U_2}{L}$}; % label negative current slope
                    \draw [thin, <->]  (3+\D,0.25) -- (3+\D, 0.75); % Current ripple arrow
                    \node[inner sep = 1pt, anchor = east, fill = white] at (axis cs:3+\D-0.025, 0.75) {$\Delta i_\mathrm{L}$}; % Current ripple label
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_2(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.75) ({\D + #1},0.25) ({\D + #1},0) ({1 + #1},0) ({1 + #1},0.75)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5 * \D) -- (axis cs:4, 0.5 * \D); % dashed line at average current
                    \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\D/2, 0.5 * \D) {$\overline{i}_2$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: voltage and current transfer ratios during steady state %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: voltage and current transfer ratios during steady state}
    In steady state, the absolute voltage-time integral over the inductor must be identical for the switch-on and switch-off interval, that is,
    \begin{equation}
        \int_{0}^{T_\mathrm{off}} \left|u_\mathrm{L}(t)\right| \mathrm{d}t \stackrel{!}{=} \int_{T_\mathrm{off}}^{T_\mathrm{off}+T_\mathrm{on}} \left|u_\mathrm{L}(t)\right| \mathrm{d}t
    \end{equation}\pause
    resulting in
    \begin{equation}
            (U_2-U_1)T_\mathrm{off} = U_1T_\mathrm{on} \quad \pause  \Leftrightarrow \quad  (U_2-U_1)(1-D)T_\mathrm{s} = U_1DT_\mathrm{s}
    \end{equation}\pause
    and finally delivering the \hl{voltage transfer ratio}
    \begin{equation}
        \frac{U_2}{U_1} = \frac{1}{1-D}.
    \end{equation}\pause
    Assuming a lossless converter ($P_\mathrm{in}=P_\mathrm{out}$), the \hl{current transfer ratio} is 
    \begin{equation}
        \frac{\overline{i}_1}{\overline{i}_2} = \frac{1}{1-D}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: current ripple %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: current ripple}
    The \hl{inductor current ripple} can be found considering the positive slope during $T_\mathrm{on}$ with
    \begin{equation}
        \Delta i_\mathrm{L} = \frac{U_1}{L}T_\mathrm{on} = \frac{U_1}{L}DT_\mathrm{s}
        \label{eq:current-ripple-simple-step-up-pos}
    \end{equation}\pause
    or alternatively evaluating the negative slope during $T_\mathrm{off}$ with
    \begin{equation}
        \Delta i_\mathrm{L} = \frac{U_2-U_1}{L}T_\mathrm{off} = \frac{U_2-U_1}{L}(1-D)T_\mathrm{s}=\frac{D(1-D)T_\mathrm{s}}{L}U_2.
        \label{eq:current-ripple-simple-step-up-neg}
    \end{equation}\pause
    In addition, one can find that the output current and power is changing step-like within the step-up converter, while this is the case for the input side in the step-down converter: 
    \begin{equation*}
        \mbox{step-down:} \quad i_1(t) = \begin{cases}
            i_\mathrm{L}(t), & \mbox{switch on},\\
            0, & \mbox{switch off},
        \end{cases}\pause
        \qquad
        \mbox{step-up:} \quad i_1(t) = \begin{cases}
            i_\mathrm{L}(t), & \mbox{switch on},\\
            i_\mathrm{L}(t), & \mbox{switch off},
        \end{cases}
    \end{equation*}\pause
    \begin{equation*}
        \mbox{step-down:} \quad i_2(t) = \begin{cases}
            i_\mathrm{L}(t), & \mbox{switch on},\\
            i_\mathrm{L}(t), & \mbox{switch off},
        \end{cases}\pause
        \qquad
        \mbox{step-up:} \quad i_2(t) = \begin{cases}
            0, & \mbox{switch on},\\
            i_\mathrm{L}(t), & \mbox{switch off}.
        \end{cases}
    \end{equation*}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: current ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: current ripple (cont.)}
    In contrast to the step-down converter, cf. \eqref{eq:duty-cycle-max}, the worst-case current ripple of the step-up converter occurs for 
    \begin{equation}
        \Delta i_\mathrm{L} =  \frac{U_1}{L}DT_\mathrm{s} \quad \Rightarrow \quad D_\mathrm{max} \rightarrow 1.
        \label{eq:ripple-current-duty-cycle-max-step-up_converter}
    \end{equation}\pause
    This corresponds to the case of an infinitely large output voltage $U_2$:
    \begin{equation}
        \lim_{D\rightarrow1}U_2 = \lim_{D\rightarrow1} \frac{1}{1-D}U_1=\infty.
    \end{equation}\pause
    The \hl{maximum current ripple} is then
    \begin{equation}
        \Delta i_\mathrm{L,\max} = \frac{1}{L}U_1T_\mathrm{s}.
        \label{eq:current-ripple-max-step-up}
    \end{equation}\pause
    Consequently, we can express the current ripple as:
    \begin{equation}
        \Delta i_\mathrm{L} = D \Delta i_\mathrm{L,\max}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter with output capacitor: overview and assumptions %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-up converter with output capacitor: overview and assumptions}
        \onslide<2->{We consider the following assumptions:}
        \begin{itemize}
            \item<2-> The switch is ideal, that is, infinitely fast.
            \item<2-> The input voltage is constant: $u_1(t) = U_1$.
            \item<3-> The output current is constant: $i_2(t) = I_2$.
            \item<4-> The inductor current $i_\mathrm{L}(t)$ is unaffected by the output voltage ripple (remains triangular).
            \item<5-> The output voltage is greater than the output voltage: $u_2(t) > U_1$.
        \end{itemize}
        \begin{figure}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to ++(-7,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                (-7,2) to  [short, i=$i_1(t)$] ++(1.25,0)
                to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(1.75,0)
                to  [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S) {}
                let \p1 = (S.mid) in (S.out) to  [short] (-1.5,2)
                to [short, i=$i_2(t)$, -o] (0,2)
                ([yshift = -0.3cm]S.mid) to [short, o-*](\x1,0);
                \draw (-3.2,2) to [open, v_>=$u_\mathrm{s}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
                \draw (-1.5,2) to [capacitor, *-*, l=$C$, i>^=$i_\mathrm{C}(t)$] ++(0,-2);
            \end{circuitikz}
            \caption{Step-up converter (ideal switch representation) with output capacitor}
            \label{fig:step-up-converter-simple-output-cap}
        \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Capacitor voltage analysis %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis}
     In contrast to the step-down converter, the \hl{capacitor current} is changing step-like during the switching event:
     \begin{equation}
        i_\mathrm{C}(t) = \begin{cases}
            i_\mathrm{L}(t) - I_2, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}],\\
            -I_2, & t\in [k T_\mathrm{s}+ T_\mathrm{off}, (k+1) T_\mathrm{s}].
        \end{cases}
        \label{eq:capacitor-current-step-up-converter}
    \end{equation}\pause
  The steady-state inductor current during the switch-off interval is
  \begin{equation}
    \begin{split}
        \onslide<2->{i_\mathrm{L}(t) &= \overline{i}_\mathrm{L} + \frac{\Delta i_\mathrm{L}}{2} - \frac{\Delta i_\mathrm{L}}{T_\mathrm{off}}(t-kT_\mathrm{s})}\\
        \onslide<3->{&= \frac{1}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2(t-kT_\mathrm{s})}{2T_\mathrm{off}}, \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}].}
    \end{split}
  \end{equation}
  \onslide<3->{which follows from the triangular signal shape.} \onslide<4->{Inserting into \eqref{eq:capacitor-current-step-up-converter} yields}
  \begin{equation}
    \onslide<4->{i_\mathrm{C}(t) = \begin{cases}
        \frac{D}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2(t-kT_\mathrm{s})}{2T_\mathrm{off}}, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}],\\
        -I_2, & t\in [k T_\mathrm{s}+ T_\mathrm{off}, (k+1) T_\mathrm{s}].
    \end{cases}}
\end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: capacitor voltage analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis (cont.)}
    \onslide<1->{The \hl{capacitor voltage during the switch-off period} is then}
  \begin{equation}
      \begin{split}
        \onslide<1->{u_\mathrm{C}(t) &= u_\mathrm{C}(kT_\mathrm{s}) + \frac{1}{C}\int_{kT_\mathrm{s}}^t i_\mathrm{C}(\tau) \mathrm{d}\tau , \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}]}\\
        \onslide<2->{&= u_\mathrm{C}(kT_\mathrm{s}) + \frac{1}{C}\left(\int_{kT_\mathrm{s}}^{t} \frac{D}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2(\tau-kT_\mathrm{s})}{2T_\mathrm{off}}\mathrm{d}\tau\right)}\\
        \onslide<3->{&= u_\mathrm{C}(kT_\mathrm{s}) + \left[\frac{D\tau}{(1-D)C}I_2 + \frac{\Delta i_\mathrm{L}}{2T_\mathrm{off}C}\left(T_\mathrm{off}\tau - \tau^2 + 2\tau k T_\mathrm{s}\right)\right]_{kT_\mathrm{s}}^t}\\
        \onslide<4->{&= u_\mathrm{C}(kT_\mathrm{s}) + \frac{D(t-kT_\mathrm{s})}{(1-D)C}I_2 + \frac{\Delta i_\mathrm{L}}{2T_\mathrm{off}C}\left(T_\mathrm{off}(t-kT_\mathrm{s}) - t(t-2kT_\mathrm{s})-(kT_\mathrm{s})^2\right).}
      \end{split}
      \label{eq:capacitor-voltage-switch-off-step-up-converter}
  \end{equation}
  \onslide<5->{The capacitor voltage at the end of the switch-off period is
    \begin{equation}
        u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off}) = u_\mathrm{C}(kT_\mathrm{s}) + \frac{DI_2}{(1-D)C}T_\mathrm{off}.
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: capacitor voltage analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis (cont.)}
    \onslide<1->{The \hl{capacitor voltage during the switch-on period} is then}
    \begin{equation}
        \begin{split}
            \onslide<1->{u_\mathrm{C}(t) &= u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off}) + \frac{1}{C}\int_{kT_\mathrm{s}+T_\mathrm{off}}^t i_\mathrm{C}(\tau) \mathrm{d}\tau , \quad t\in [k T_\mathrm{s}+T_\mathrm{off}, (k+1) T_\mathrm{s}]}\\
            \onslide<2->{&= u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off}) + \frac{1}{C}\int_{kT_\mathrm{s}+T_\mathrm{off}}^t -I_2 \mathrm{d}\tau}\\
            \onslide<3->{&= u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off}) - \frac{I_2}{C}(t-kT_\mathrm{s}-T_\mathrm{off})}\\
            \onslide<4->{&= \underbrace{u_\mathrm{C}(kT_\mathrm{s}) + \frac{DI_2}{(1-D)C}T_\mathrm{off}}_{=u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off})} - \frac{I_2}{C}(t-kT_\mathrm{s}-T_\mathrm{off}).}\\
        \end{split}
        \label{eq:capacitor-voltage-switch-on-step-up-converter}
    \end{equation}
    \onslide<5->{Here, $u_\mathrm{C}(kT_\mathrm{s})$ is the (yet unknown)  initial capacitor voltage at the beginning of a period, which will be derived later.} 
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: capacitor voltage analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis (cont.)}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \onslide<1->{In steady state, the capacitor voltage at the end of the switch-on period is identical to the voltage at the beginning of the switch-off period, that is,
            \begin{equation*}
                    u_\mathrm{C}(kT_\mathrm{s}) = u_\mathrm{C}((k+1)T_\mathrm{s}).
            \end{equation*}}%
            \onslide<3->{%
                Hence, we can identify the \hl{voltage ripple} from \eqref{eq:capacitor-voltage-switch-on-step-up-converter} as}
            \begin{equation}
                \begin{split}
                    \onslide<3->{\Delta u_\mathrm{C}&=\frac{I_2}{C}T_\mathrm{on} = \frac{DI_2}{(1-D)C}T_\mathrm{off}\\}
                    \onslide<4->{&=\frac{I_2}{C}DT_\mathrm{s}=\frac{\Delta Q}{C}} 
                \end{split}
            \end{equation}
            \onslide<4->{with the charge ripple $\Delta Q = DI_2T_\mathrm{s}$.}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \begin{tikzpicture}

                    \tikzmath{
                        real \D, \u0, \Ts, \Ton, \Toff, \rippleI, \rippleU, \Iout, \c, \Iavg;
                        \D = 0.25;
                        \Ts = 1;
                        \Ton = \D;
                        \Toff = 1-\D;
                        \Iout = 1;
                        \rippleI = 0.5; % current ripple (normalized)
                        \c = 0.5; % capacitance (normalized)
                        \rippleU = \Iout/\c*\D*\Ts;
                        \u0 = 1-\rippleU/2 - \rippleI/12/\c*\Ts*(1-\D)^2;      
                        \Iavg = \D/(1-\D)*\Iout; % avg capacitor current             
                        } 

                    \begin{groupplot}[group style={group size=1 by 2, xticklabels at = edge bottom}, height=0.4\textheight, width=0.9\textwidth, xmin=-0.1, xmax=1.1, grid,clip = false]

                        % Capacitor voltage
                        \nextgroupplot[ylabel = {$u_\mathrm{C}(t)/\overline{u}_\mathrm{C}$},visible on=<2->]
                            % Half cycle for t<0
                            \addplot[signalblue, thick, domain=-0.1:0, samples=15] {\u0 +\rippleU-\rippleU/\Ton*((x+\Ts)-\Toff)};
                            % Half cycle for 0<t<Toff
                            \addplot[signalblue, thick, domain=0:\Toff, samples=50] {\u0 + \rippleU*(x)/\Toff+\rippleI/\Toff/\c/2*(\Toff * x - x^2)};
                            % Half cycle for Toff<t<Ts
                            \addplot[signalblue, thick, domain=\Toff:\Ts, samples=50] {\u0 +\rippleU-\rippleU/\Ton*(x-\Toff)};
                            % Half cycle for t>Ts
                            \addplot[signalblue, thick, domain=\Ts:1.1, samples=50] {\u0 + \rippleU*(x-\Ts)/\Toff+\rippleI/\Toff/\c/2*(\Toff * (x-\Ts) - (x-\Ts)^2)};

                            % Dashed lines for voltage ripple (upper limit)
                            \draw[dashed, thin] (axis cs:-0.1, \u0+\rippleU) -- (axis cs:1.1, \u0+\rippleU);
                            % Dashed lines for voltage ripple (lower limit)
                            \draw[dashed, thin] (axis cs:-0.1, \u0) -- (axis cs:1.1, \u0);
                            % Voltage ripple arrow indication 
                            \draw[thin, {Latex[length=2mm]}-{Latex[length=2mm]}] (axis cs:0, \u0) -- (axis cs:0, \u0+\rippleU);
                            % Voltage ripple label
                            \node[above, inner sep = 2pt, anchor = west] at (axis cs:0, 1) {$\Delta u_\mathrm{C}$}; 


                        % Capacitor current
                        \nextgroupplot[ylabel = {$i_\mathrm{C}(t)/I_2$}, xlabel={$t/T_\mathrm{s}$},visible on=<3->]
                            % Current signal
                            \addplot[signalred, thick] coordinates {(-0.1, -\Iout) (0, -\Iout) (0, \Iavg + \rippleI/2)}; % Capacitor current for t < 0
                            \addplot[signalred, thick, domain=0:\Toff, samples=50] {\D/(1-\D)*\Iout + \rippleI*(\Toff-2*x)/(2*\Toff)}; % Capacitor current for 0 < t < Toff
                            \addplot[signalred, thick] coordinates {(\Toff, \Iavg - \rippleI/2) (\Toff, -\Iout) (\Ts, -\Iout) (\Ts, \Iavg + \rippleI/2)}; % Capacitor current for Toff < t < Ts
                            \addplot[signalred, thick, domain=\Ts:1.1, samples=15] {\D/(1-\D)*\Iout + \rippleI*(\Toff-2*(x-\Ts))/(2*\Toff)}; % Capacitor current for Ts < t
                            \addplot[dashed,thin] coordinates {(-0.1, \Iavg - \rippleI/2) (1.1, \Iavg - \rippleI/2)}; % lower limit of current riplle
                            \addplot[dashed,thin] coordinates {(-0.1, \Iavg + \rippleI/2) (1.1, \Iavg + \rippleI/2)}; % upper limit of current ripple
                            \draw [thin, <->]  (1-\Ton/4,\Iavg - \rippleI/2) -- (1-\Ton/4, \Iavg + \rippleI/2); % current ripple arrow
                            \node[inner sep = 1pt, anchor = east, fill = white] at (axis cs:1-\Ton/3, \Iavg) {$\Delta i_\mathrm{L}$}; % current ripple label
                            % \Delta Q charge area indication
                            \addplot[signalred, fill=shadecolor, fill opacity=0.3,visible on=<4->] coordinates {(\Toff,0) (\Toff,-\Iout) (\Ts,-\Iout) (\Ts,0)}; %Delta-Q indicator for  Toff < t < Ts
                            \addplot[signalred, fill=shadecolor, fill opacity=0.3,visible on=<4->] coordinates {(0,0) (0,\Iavg+\rippleI/2) (\Toff,\Iavg-\rippleI/2) (\Toff,0)}; %Delta-Q indicator for t < Toff
                            % \Delta Q charge area indication arrow
                            \draw[thin, -{Latex[length=2mm]},visible on=<4->] (axis cs:0.2,-0.4) -- (axis cs:0.1,\Iavg);
                            % \Delta Q charge area indication label
                            \node[inner sep = 1pt, anchor = west, fill = white,visible on=<4->] at (axis cs:0.2,-0.4) {$\Delta Q$};
                            \node[inner sep = 1pt, anchor = center,visible on=<4->] at (axis cs:\Ts-\Ton/2,-0.5) {$\Delta Q$};
                            \draw [<->]  (0,\pgfkeysvalueof{/pgfplots/ymax}+0.25) -- node[above]{$T_\mathrm{off}$}(\Toff, \pgfkeysvalueof{/pgfplots/ymax}+0.25);
                            \draw [<->]  (\Toff,\pgfkeysvalueof{/pgfplots/ymax}+0.25) -- node[above]{$T_\mathrm{on}$}(\Ts, \pgfkeysvalueof{/pgfplots/ymax}+0.25);
                    \end{groupplot}
                \end{tikzpicture}
                \onslide<2->{\caption{Step-up converter voltage ripple}}
                \label{fig:step-up-converter-voltage-ripple}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: capacitor voltage analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis (cont.)}
    \onslide<1->{To calculate the \hl{initial capacitor voltage} $u_\mathrm{C}(kT_\mathrm{s})$, we can utilize}
    \begin{equation}
        \onslide<1->{\overline{u}_\mathrm{c} = \frac{1}{T_\mathrm{s}}\int_0^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t   \stackrel{!}{=} \overline{u}_2}  \onslide<2->{= \frac{U_1}{1-D}}
        \label{eq:capacitor-voltage-average-step-up-converter}
    \end{equation}
    \onslide<2->{since the average capacitor voltage must be equal to the average output voltage.}  \onslide<3->{This yields}
    \begin{equation}
        \begin{split}
            \onslide<3->{\overline{u}_\mathrm{c} &=  \frac{1}{T_\mathrm{s}}\left(\int_0^{T_\mathrm{off}} u_\mathrm{C}(t) \mathrm{d}t + \int_{T_\mathrm{off}}^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t\right)}  \\
            \onslide<4->{& =\ldots}\\
            \onslide<5->{&=u_\mathrm{C}(kT_\mathrm{s}) + \frac{\Delta u_\mathrm{C}}{2} +\frac{\Delta i_\mathrm{L}T_\mathrm{s}}{12C}(1-D)^2 }
        \end{split}
    \end{equation}
    \onslide<6->{and finally delivers}
    \begin{equation}
        \begin{split}
            \onslide<6->{u_\mathrm{C}(kT_\mathrm{s}) &= \frac{U_1}{1-D} - \frac{\Delta u_\mathrm{C}}{2} -\frac{\Delta i_\mathrm{L}T_\mathrm{s}}{12C}(1-D)^2}\\
            \onslide<7->{&= \frac{U_1}{1-D} - \frac{I_2}{2C}DT_\mathrm{s} -\frac{U_1T^2_\mathrm{s}}{12LC}D(1-D)^2.}
        \end{split}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Circuit realization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Circuit realization}
    \begin{itemize}
        \item In \figref{fig:step-up-converter-realization-1Q} the simplest realization is shown utilizing one transistor and one diode. 
        \item<2-> This configuration can only provide positive voltages and currents (\hl{first quadrant}).
        \item<3-> The previously made step-up converter's switch-on definition (cf.  \figref{fig:step-up-converter-switch-states}) results from the transistor position in the circuit -- difference to the step-down converter.
    \end{itemize}
    \begin{figure}
        \begin{circuitikz}[]                
            \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
            to ++(-6,0)
            to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
            (-6,2) to  [short, i=$i_1(t)$] ++(0.75,0)
            to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(1.5,0)
            to  [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
            to [diode, l=$D$] ++(2.0,0)
            to  [short, -o, i=$i_2(t)$] (0,2);            ;   
            \draw (-3,1) node[npn](npn1) {}
            (npn1.C) to [short, -*] (-3,2)
            (npn1.E) to [short, -*] (-3,0);
            \draw let \p1 = (npn1.B) in node[anchor=east] at (\x1,\y1) {$T$};
            \draw (-2.8,2) to [open, v^>=$\hspace{0.5cm}u_\mathrm{s}(t)$, voltage = straight] ++(0,-2);
        \end{circuitikz}
        \caption{Step-up converter with real components (single quadrant type)}
        \label{fig:step-up-converter-realization-1Q}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: DCM %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Step-up converter: DCM}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.7} % duty cycle
            \tikzmath{
                real \Ts, \Ton, \Toff1, \Toff2, \Uin, \Uout, \ripple;
                \Ts = 1;
                \Uout = 1;
                \Toff1 = 0.5;
                \Toff2 = 0.25;
                \Ton = \Ts - \Toff1 - \Toff2;
                \Uin = \Uout*\Toff1/(\Toff1+\Ton);      
                \ripple = 0.65;
                \Iavg = \ripple /2 * (\Toff1+\Ton)/\Ts;
            } 
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_2$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({0 + #1},\Uout) ({\Toff1 + #1},\Uout) ({\Toff1 + #1},\Uin) ({\Toff1+\Toff2 + #1},\Uin) ({\Toff1 + \Toff2 + #1},0) ({\Ts + #1},0) ({\Ts + #1},\Uout)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \Uin) -- (axis cs:4, \Uin); % dashed line at U_1
                    \node[above, inner sep = 1pt, anchor = north, fill = white, yshift= -1pt] at (axis cs:1+\Toff1/2, \Uin) {$U_1$}; % label U_1
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (0,-0.2) -- node[below]{$T'_\mathrm{off}$}(\Toff1, -0.2); % T'_off 
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Toff1,-0.2) -- node[below]{$T''_\mathrm{off}$}(\Toff1+\Toff2, -0.2); % T''_off
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Toff1+\Toff2,-0.2) -- node[below]{$T_\mathrm{on}$}(\Ts, -0.2); % T_on
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ts,-0.2) -- node[below]{$T_\mathrm{s}$}(2*\Ts, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},\ripple) ({\Toff1 + #1},0) ({\Toff1+\Toff2 + #1},0) ({\Ts + #1},\ripple)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,\Iavg) -- (axis cs:4,\Iavg); % dashed line at average current
                    \draw[thin] (axis cs:2*\Ts-3/4*\Ton,\ripple/4) -- (axis cs:2*\Ts-3/4*\Ton,3*\ripple/4) -- (axis cs:2*\Ts-1/4*\Ton,3*\ripple/4); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south east] at (axis cs:2*\Ts-\Ton/2, \ripple*3/4) {$\nicefrac{U_1}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2*\Ts+\Toff1/4,\ripple*3/4) -- (axis cs:2*\Ts+\Toff1*3/4,\ripple*3/4) -- (axis cs:2*\Ts+3*\Toff1/4,\ripple*1/4); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south west, xshift=-3mm] at (axis cs:2*\Ts+\Toff1/2, \ripple*3/4) {$\nicefrac{U_1-U_2}{L}$}; % label negative current slope

                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_2(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},\ripple) ({\Toff1 + #1},0) ({\Ts + #1},0) ({\Ts + #1},\ripple)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,\ripple/2*\Toff1/\Ts) -- (axis cs:4, \ripple/2*\Toff1/\Ts); % dashed line at average current
                    \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\D/2, \ripple/2*\Toff1/\Ts) {$\overline{i}_2$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-up converter: switch states in DCM}
    \onslide<1->{The step-up converter in DCM has three different switch states:}
    \begin{itemize}
            \item<1-> Transistor on-time:  $T_\mathrm{on}=DT_\mathrm{s}$,
            \item<2-> Transistor off-time (conducting diode): $T'_\mathrm{off}=D'T_\mathrm{s}$,
            \item<3-> Transistor off-time (no conduction):  $T''_\mathrm{off}=T_\mathrm{s}-T_\mathrm{on}-T'_\mathrm{off}$.
    \end{itemize}
        \begin{figure}
            \centering	
            \onslide<1->{
            \begin{subfigure}{0.33\textwidth}
                \centering
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1}(t)$] ++(1,0)
                    to [inductor, l=$L$] ++(1.5,0)
                    to [short, i=$i_\mathrm{L}(t)$] ++(1,0)
                    to [short, -*] ++(0,-2);
                    \draw (-1,2) to [short, -o, i=${i_2=0}$] (0,2);
                    \draw (-1.9,2) to [open, v_= ${U_\mathrm{s}=0}\hspace{0.6cm}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-on time $T_\mathrm{on}$}
            \end{subfigure}%
            }%
            \onslide<2->{%
            \begin{subfigure}{0.33\textwidth}
                \centering
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1}(t)$] ++(1,0)
                    to [inductor, l=$L$] ++(1.5,0)
                    to [short, -o, i=$\hspace{2mm}{i_\mathrm{L}(t)=i_2(t)}$] (0,2);
                    \draw (-1.5,2) to [open, v_= ${U_\mathrm{s}=U_2}\hspace{1cm}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time $T'_\mathrm{off}$}
            \end{subfigure}
            }%
            \onslide<3->{%
            \begin{subfigure}{0.33\textwidth}
                \centering
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}\hspace{0.15cm}$] ++(1.25,0)
                    to [inductor, l=$L$] ++(1.5,0)
                    to [short] ++(0.75,0);
                    \draw (-1,2) to [short, -o, i=${i_2=0}$] (0,2);
                    \draw (-1.5,2) to [open, v_= ${U_\mathrm{s}=U_1}\hspace{1cm}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time $T''_\mathrm{off}$}
            \end{subfigure}
            }%
        \caption{Switch states of the step-up converter including DCM} 
        \label{fig:step-up-converter-switch-states-DCM}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: DCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: DCM operation characteristics}
    \onslide<1->{In DCM operation 
    $$  \overline{i}_\mathrm{L}=\overline{i}_1 < \frac{\Delta i_\mathrm{L}}{2} \quad \Rightarrow \quad U_2 \neq U_1 \frac{1}{1-D}$$
    applies due to the non-conducting diode during  $T''_\mathrm{off}$.} \onslide<2->{To find the input-to-output voltage ratio in DCM, we again utilize the current ripple balance:}
    \begin{equation}
        \begin{alignedat}{2}
            \onslide<2->{\Delta i_\mathrm{L} &= \frac{U_1}{L}T_\mathrm{on}  = \frac{U_1}{L}DT_\mathrm{s} \quad &&\mbox{(rising edge)},}\\
            \onslide<3->{\Delta i_\mathrm{L} &= \frac{U_2-U_1}{L}T'_\mathrm{off} = \frac{U_2-U_1}{L}D'T_\mathrm{s} \quad &&\mbox{(falling edge)}.}
        \end{alignedat}
    \end{equation}
    \onslide<4->{Solving for $D'$ yields
    \begin{equation}
        D' = \frac{U_1}{U_2-U_1}D.
    \end{equation}}
    \onslide<5->{The average load current is
    \begin{equation}}
        \onslide<5->{\overline{i}_2 = \frac{\Delta i_\mathrm{L}}{2}\frac{T'_\mathrm{off}}{T_\mathrm{s}}} \onslide<6->{= \frac{\Delta i_\mathrm{L,max}D}{2}D'}\onslide<7->{= \frac{\Delta i_\mathrm{L,max}}{2}\frac{U_1}{U_2-U_1}D^2.}
        \onslide<6->{\label{eq:step-up-converter-average-output-current-DCM}
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: DCM operation characteristics (cont.)%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: DCM operation characteristics (cont.)}
    \onslide<1->{Solving \eqref{eq:step-up-converter-average-output-current-DCM} delivers the step-up \hl{converter voltage gain in DCM} as
    \begin{equation}
        \frac{U_2}{U_1} = 1+ \frac{D^2}{2} \frac{\Delta i_\mathrm{L,max}}{\overline{i}_2}.
        \label{eq:voltage-ratio-DCM-step-up}
    \end{equation}}%
    \onslide<2->{Since $\Delta i_\mathrm{L,max}$ also depends on $U_1$, cf.  \eqref{eq:current-ripple-max-step-up}, the relation \eqref{eq:voltage-ratio-DCM-step-up} only holds for a given $U_1$. Hence, we can insert \eqref{eq:current-ripple-max-step-up} in \eqref{eq:voltage-ratio-DCM-step-up} and solve for $U_2$ to receive
    \begin{equation}
        U_2= U_1 + \frac{D^2}{2} \frac{T_\mathrm{s}}{L \overline{i}_2}.
    \end{equation}}
    \onslide<3->{Finally, the step-up converter \hl{operates in BCM} if}
    \begin{equation}
        \onslide<3->{\overline{i}_\mathrm{L}=\overline{i}_1 = \frac{\Delta i_\mathrm{L}}{2}} \onslide<4->{\quad \Leftrightarrow \quad  \overline{i}_2 = (1-D)\frac{\Delta i_\mathrm{L}}{2}.} 
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter load curves %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter load curves}
    \begin{figure}
        \begin{tikzpicture}
            \begin{semilogyaxis}[
                xlabel={$\overline{i}_2/\Delta i_\mathrm{L,max}$},
                ylabel={$U_2/U_1$},
                axis lines=left,
                thick,
                smooth,
                no markers,
                height = 0.8\textheight,
                grid,
                log ticks with fixed point,
                ymin=0.9, ymax=11,
                xmin=0, xmax=0.4,
                clip = true
                ]
                \foreach \D in {0.01, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9}{
                    \addplot[signalblue, domain=\D*(1-\D)/2:1, samples=15] {1/(1-\D)}; %CCM
                    \addplot[signalblue, domain=0.01:\D*(1-\D)/2, samples=30] {1+\D^2/2/x}; %DCM
                }
                 \foreach \D [count=\xi] in {0.01, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9}{
                    \pgfmathsetmacro{\gain}{1/(1-\D)}
                    \pgfmathsetmacro{\shift}{(-1)^(Mod(\xi,2))}
                     \edef\temp{\noexpand\node[inner sep = 1pt, align = center, fill = white] at (axis cs:0.3+\shift/20, \gain) {$\scriptstyle D=\D$};} % Duty-cycle labels
                     \temp
                 }
                \addplot[signalred, domain = 0.005:1/8, samples=30, thick, name path = upper] {1/(4*x) + (1/(4*x)^2 - 1/(2*x))^(0.5)}; % Upper boundary area
                 \addplot[signalred, domain = 0.005:1/8, samples=30, thick, name path = lower] {1/(4*x) - (1/(4*x)^2 - 1/(2*x))^(0.5)}; % Lower boundary area
                \addplot[shadecolor, opacity=0.3] fill between[of=upper and lower];
                \node[inner sep = 1pt, anchor = west, fill = white, font=\footnotesize] at (axis cs:0.125, 7) {CCM}; % CCM label
                \draw[thin, -{Latex[length=2mm]}] (axis cs:0.125, 4) -- (axis cs:0.09, 2.7);
                \node[inner sep = 1pt, anchor = west, font=\footnotesize] at (axis cs:0.125, 4) {DCM}; % DCM label
            \end{semilogyaxis}
        \end{tikzpicture}
        \caption{Step-up converter load curves for CCM and DCM (note: logarithmic ordinate)}
        \label{fig:step-up-converter-load-curves}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Buck-boost converter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: overview and assumptions %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Buck-boost converter: combining step-up and step-down stages}
        \begin{figure}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_0(t)$, voltage = straight] ++(0,-2);
                %Boost part
                \draw (5,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to [short, -o]++(-5,0)
                to [open, voltage = straight, o-o] ++(0,2)
                to [short, o-]++(0.5,0)
                to [inductor, l=$L_2$] ++(1.5,0)
                to [short, i=$i_{\mathrm{L}_2}(t)$] ++(1.0,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S2) {}
                let \p2 = (S2.mid) in (S2.out) to  [short, i=$i_2(t)$] (5,2)
                ([yshift = -0.3cm]S2.mid) to [short, o-*](\x2,0);
                \draw (2.5,2) to [open, v_>=$u_{\mathrm{s}_2}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2)
                (S2.out) node[below, anchor = north west] {$S_\mathrm{2,off}$}
                ([yshift = -0.3cm]S2.mid) node[below, anchor = north west] {$S_\mathrm{2,on}$};

                % gray background behind boost part
               \begin{scope}[on background layer]
                \node[rectangle, draw = shadecolor,	fill = shadecolor,	opacity=0.3, minimum width = 4.75cm, minimum height = 3.4cm] (B1) at (2.625,1.1) {};
                \node[inner sep = 1pt, anchor = south, font=\small] at (B1.south) {Boost};
                \end{scope}
                % Buck part
                \draw (0,0) to [short, o-]++(-5,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                to  [short, i=$i_1(t)$] ++(1.0,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S1) {}
                let \p1 = (S1.mid) in (S1.in) to  [short, i=$i_\mathrm{L_1}(t)$] ++(1.15,0)
                to [inductor, l=$L_1$] ++(1.3,0)
                to [short, -o] (0,2) 
                ([yshift = -0.3cm]S1.mid) to [short, o-*](\x1,0);
                \draw (-2.5,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s_1}(t)$, voltage = straight] ++(0,-2)
                (S1.out) node[below, anchor = north east] {$S_\mathrm{1,on}$}
                ([yshift = -0.3cm]S1.mid) node[below, anchor = north east] {$S_\mathrm{1,off}$};
                 % gray background behind buck part
                 \begin{scope}[on background layer]
                    \node[rectangle, draw = shadecolor,	fill = shadecolor,	opacity=0.3, minimum width = 4.75cm, minimum height = 3.4cm] (B2) at (-2.625,1.1) {};
                    \node[inner sep = 1pt, anchor = south, font=\small] at (B2.south) {Buck};
                \end{scope}
                 %Curly bracket that points from the upper circuit to the lower circuit
                \draw [decorate,decoration={brace,amplitude=10pt,mirror,raise=0.5cm},yshift=0pt] (-2.5,-0.25) -- (2.5,-0.25) node [black,midway,yshift=-0.6cm] {};
            \end{circuitikz}
            \begin{circuitikz}[]
                %Boost part
                \draw (3.5,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to [short]++(-3.5,0)
                (1.25,2) to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S2) {}
                let \p2 = (S2.mid) in (S2.out) to  [short, i=$i_2(t)$] (3.5,2)
                ([yshift = -0.3cm]S2.mid) to [short, o-*](\x2,0);
                \draw (1.4,2) to [open, v_>=$u_{\mathrm{s}_2}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
                % Buck part
                \draw (0,0) to [short]++(-3.5,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                to  [short, i=$i_1(t)$] ++(1.25,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S1) {}
                let \p1 = (S1.mid) in (S1.in) to  [short] (-1.0,2)
                ([yshift = -0.3cm]S1.mid) to [short, o-*](\x1,0);
                \draw (-1.4,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s_1}(t)$, voltage = straight] ++(0,-2);
                %Combining inductor
                \draw (S1.in) to [inductor, l=$L$, i=$i_\mathrm{L}(t)$, v = $u_\mathrm{L}(t)$, voltage = straight] (S2.in)
                (S1.out) node[below, anchor = north east] {$S_\mathrm{1,on}$}
                ([yshift = -0.3cm]S1.mid) node[below, anchor = north east] {$S_\mathrm{1,off}$}
                (S2.out) node[below, anchor = north west] {$S_\mathrm{2,off}$}
                ([yshift = -0.3cm]S2.mid) node[below, anchor = north west] {$S_\mathrm{2,on}$};;
            \end{circuitikz}
            \caption{Buck-boost converter (ideal switch representation)}
            \label{fig:buck-boost-simple}
        \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: switching states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Buck-boost converter: switching states}
    \onslide<1->{The buck-boost converter switches are \hl{operated synchronously}, that is, $S_1$ and $S_2$ are either on or off at the same time.} \onslide<2->{Thus, the converter has only two switch states:}
    \begin{equation}
        \begin{alignedat}{3}
            \onslide<2->{\{S_\mathrm{1,on}, S_\mathrm{2,on}\} \quad &\rightarrow \quad u_{\mathrm{s}_1}(t) &&= U_1, \,&&u_{\mathrm{s}_2}(t) = 0, \quad} \\
            \onslide<3->{\{S_\mathrm{1,off}, S_\mathrm{2,off}\} \quad &\rightarrow \quad u_{\mathrm{s}_1}(t) &&= 0, &&u_{\mathrm{s}_2}(t) = U_2.}
        \end{alignedat}
    \end{equation}
    \begin{figure}
        \centering
        \onslide<2->{%	
        \begin{subfigure}{0.45\textwidth}
            \centering
            \hspace{-0.75cm}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=$i_1(t)$] ++(1.0,0)
                to [inductor, l=$L$] ++(1.75,0)
                to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to [short, -*] ++(0,-2);
                \draw (0,2) to [short, i_<=${i_2=0}$, -o] ++(-1.0,0);
                \draw (-1.8,2) to [open, v_>=${U_{\mathrm{s}_2}\hspace{0.2cm}}$, voltage = straight] ++(0,-2);
                \draw (-4.4,2) to [open, v = ${\hspace{1.5cm}U_{\mathrm{s}_1}}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Switch-on time}
        \end{subfigure}%
        }%
        \hspace{0.5cm}%
        \onslide<3->{%
        \begin{subfigure}{0.45\textwidth}
            \centering
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                (-3.75,0) to [short, *-] ++(0,2)
                to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to [inductor, l=$L$] ++(2,0)
                to [short, i=$i_2(t)$] (0,2);
                \draw (-3.4,2) to [open, v = ${\hspace{1.5cm}U_{\mathrm{s}_1}}$, voltage = straight] ++(0,-2);
                \draw (-0.5,2) to [open, v_>=${U_{\mathrm{s}_2}\hspace{0.2cm}}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Switch-off time}
        \end{subfigure}
        }%
        \onslide<2->{\caption{Switch states of the buck-boost converter}} 
    \label{fig:buck-boost-converter-switch-states}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: CCM voltage transfer ratio %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
    \frametitle{Buck-boost converter: CCM voltage transfer ratio}
    \onslide<1->{In CCM, we can derive the \hl{voltage transfer ratio} directly by the serial connection of the buck and boost stages from \figref{fig:buck-boost-simple}}
    \begin{equation}
        \onslide<2->{\frac{U_0}{U_1} = D,}\onslide<3->{ \qquad   \frac{U_2}{U_0} = \frac{1}{1-D},}
    \end{equation}
    \onslide<4->{leading to} 
    \begin{equation}
        \onslide<4->{\frac{U_2}{U_1} = \frac{D}{1-D}.}
    \end{equation}
    \onslide<5->{Alternatively, we can derive this result from the \hl{voltage balance} of the inductor $L$:
    \begin{equation}
        u_\mathrm{L}(t) = \begin{cases} 
            U_1, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}],\\ 
            -U_2 & t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}].
        \end{cases}
    \end{equation}}
    \onslide<6->{In steady state, the average inductor voltage per period must be zero, yielding}
    \begin{equation}
        \onslide<6->{U_1 T_\mathrm{on} = U_2 T_\mathrm{off}}  \onslide<7->{\quad \Leftrightarrow \quad  U_1 D T_\mathrm{s} = U_2 (1-D) T_\mathrm{s}}  \onslide<8->{\quad \Leftrightarrow \quad \frac{U_2}{U_1} = \frac{D}{1-D}.}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: steady-state time-domain behavior %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Buck-boost converter: steady-state time-domain behavior}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.4} % duty cycle
            \pgfmathsetmacro{\gain}{\D/(1-\D)} % current ripple
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{L}(t)$}, ytick = {-1, -0.5, 0, 0.5, 1}, yticklabels = {$-U_1$, , 0, , $U_1$}, ymin = -1.1]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},-\gain) ({0 + #1},1) ({\D + #1},1) ({\D + #1},-\gain) ({1 + #1},-\gain) ({1 + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \gain) -- (axis cs:4, \gain); % dashed line at U_2 (average)
                    \node[above, inner sep = 2pt, anchor = north] at (axis cs:1.5+\D/2, \gain) {$U_2$}; % label U_2
                    \draw [thick,<->]  (0,0.2) -- node[below]{$T_\mathrm{on}$}(\D, 0.2); % T_on 
                    \draw [thick,<->]  (\D,0.2) -- node[below]{$T_\mathrm{off}$}(1.0, 0.2); % T_off
                    \draw [thick,<->]  (0.0,-1.4) -- node[below]{$T_\mathrm{s}$}(1.0, -1.4); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, $\overline{i}_\mathrm{L}$, }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5) -- (axis cs:4,0.5); % dashed line at average current
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:\D+0.02,0.75) -- node[right=1mm, fill=white, inner sep = 1pt]{$\max\{i_\mathrm{L}\}$}(axis cs:\D+0.3,0.9); % indicate max current
                    \draw[-{Latex[length=2mm]}, thin] (axis cs:0.75,0.2) node[right=1mm, fill=white, inner sep = 1pt, anchor = east]{$\min\{i_\mathrm{L}\}$} -- (axis cs:1-0.02,0.25); % indicate min current
                    \draw[thin] (axis cs:2+\D/4,0.25+0.125) -- (axis cs:2+\D/4,0.75-0.125) -- (axis cs:2+\D*3/4,0.75-0.125); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south, xshift = -4mm] at (axis cs:2+\D/2, 0.75-0.125) {$\nicefrac{U_1}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2.25+3*\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.25+0.125); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south, xshift = 2mm] at (axis cs:2.5+\D/2, 0.75-0.125) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({\D + #1},0) ({1 + #1},0) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.75 * \D) -- (axis cs:4, 0.75 * \D); % dashed line at average current
                    \node[signalred, above, inner sep = 1pt, anchor = east, fill = white, xshift=-1mm, yshift=-1mm] at (axis cs:\D, 0.75 * \D) {$\overline{i}_1$}; % label average current
                    \node[signalred, above, inner sep = 2pt, anchor = center, fill = white] at (axis cs:\D/2-0.05, 0.85) {$i_1(t)$}; % label input current
            \end{groupplot}

            % second y-axis for the bottom plot
					\begin{groupplot}[group style={group size=1 by 3, y descriptions at = edge right}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, xtick=\empty, axis line style=transparent, ymin = 0, ymax =1.1]
						\nextgroupplot[ytick = \empty]
							%
                        \nextgroupplot[ytick = \empty, ymin =-1.1]
                        %
						\nextgroupplot[ylabel = {$i_2(t)$}, ytick = {}, yticklabels = {}]
                            \pgfplotsinvokeforeach{0,...,3}{
                                \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({\D + #1},0) ({\D + #1},0.75) ({1 + #1},0.25) ({1 + #1},0)};}
                                \AddPlot
                            }
                            \node[signalblue, above, inner sep = 2pt, anchor = center, fill = white] at (axis cs:0.5+\D/2, 0.85) {$i_2(t)$}; % label output current
                            \draw[signalblue, thick, dashed] (axis cs:0,0.5-0.25*\D) -- (axis cs:4, 0.5-0.25*\D); % dashed line at average current
                            \node[signalblue, above, inner sep = 1pt, anchor = west, fill = white, xshift=1mm] at (axis cs:\D, 0.5-0.25*\D) {$\overline{i}_2$}; % label average current
					\end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: Current ripple %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Buck-boost converter: current ripple}
    \onslide<1->{The peak-to-peak \hl{current ripple} of the buck-boost converter is given by}
    \begin{equation}
        \begin{split}
            \onslide<1->{ \Delta i_\mathrm{L} &= \max\{i_\mathrm{L}(t)\} - \min\{i_\mathrm{L}(t)\}}  \onslide<2->{= i_\mathrm{L}(t=T_\mathrm{on}) - i_\mathrm{L}(t=T_\mathrm{s})}\\
                                &\onslide<3->{=\frac{U_1}{L} T_\mathrm{on}} \onslide<4->{= \frac{U_2}{L} T_\mathrm{off}}\\
                                & \onslide<5->{= \frac{DT_\mathrm{s}}{L}U_1=D \Delta i_\mathrm{L,max}.}
        \end{split}
        \label{eq:current-ripple-simple-buck-boost}
    \end{equation}
    \onslide<6->{The buck-boost converter current ripple characteristic matches the previous boost converter behavior (cf. \eqref{eq:ripple-current-duty-cycle-max-step-up_converter}):}
    \begin{itemize}
        \item<6-> Its minimal for $D \rightarrow 0$ since the output voltage becomes zero and the inductor is connected to the output voltage over the entire switching period. 
        \item<7-> Its maximal for $D \rightarrow 1$ since the inductor is connected to the (none-zero) input voltage over the entire switching period.
    \end{itemize}%
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: output capacitor and voltage ripple %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Buck-boost converter: output capacitor and voltage ripple}
    \onslide<2->{With the usual \hl{simplifying assumptions} (cf. \figref{fig:step-up-converter-simple-output-cap}), in particular, a constant output current $i_2(t)=I_2,$ the capacitor's current during the switch-on time is given by
    \begin{equation*}
        i_\mathrm{C}(t) = -i_2(t) = -I_2, \quad t \in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}].
    \end{equation*}}
    \onslide<3->{This is \hl{identical to the step-up converter}, leading to the same voltage ripple
    \begin{equation*}
        \Delta u_\mathrm{C} = \frac{I_2}{C}T_\mathrm{on}= \frac{I_2}{C}DT_\mathrm{s}.
    \end{equation*}}
    \begin{figure}
        \begin{circuitikz}[]
            %Boost part
            \draw (4.5,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
            to [short]++(-4.5,0)
            (1.25,2) to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S2) {}
            let \p2 = (S2.mid) in (S2.out) to  [short] (3.5,2)
            to [short, i=$i_2(t)$] (4.5,2)
            ([yshift = -0.3cm]S2.mid) to [short, o-*](\x2,0);
            \draw (1.4,2) to [open, v_>=$u_{\mathrm{s}_2}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
            % Buck part
            \draw (0,0) to [short]++(-3.5,0)
            to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
            to  [short, i=$i_1(t)$] ++(1.25,0)
            to ++(0.1,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S1) {}
            let \p1 = (S1.mid) in (S1.in) to  [short] (-1.0,2)
            ([yshift = -0.3cm]S1.mid) to [short, o-*](\x1,0);
            \draw (-1.4,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s_1}(t)$, voltage = straight] ++(0,-2);
            %Combining inductor
            \draw (S1.in) to [inductor, l=$L$, i=$i_\mathrm{L}(t)$, v = $u_\mathrm{L}(t)$, voltage = straight] (S2.in)
            (S1.out) node[below, anchor = north east] {$S_\mathrm{1,on}$}
            ([yshift = -0.3cm]S1.mid) node[below, anchor = north east] {$S_\mathrm{1,off}$}
            (S2.out) node[below, anchor = north west] {$S_\mathrm{2,off}$}
            ([yshift = -0.3cm]S2.mid) node[below, anchor = north west] {$S_\mathrm{2,on}$};
            %output capacitor
            \draw (3.5,2) to [capacitor, l=$C$, i>^=$i_\mathrm{C}(t)$, *-*] ++(0,-2);
        \end{circuitikz}
        \caption{Buck-boost converter with output capacitor}
        \label{fig:buck-boost-output-capacitor}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: circuit realization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Buck-boost converter: circuit realization}
    \begin{itemize}
        \item In \figref{fig:buck-boost-converter-realization-1Q} the buck-boost converter realization is a direct series circuit combination of \figref{fig:step-down-converter-realization-1Q} and \figref{fig:step-up-converter-realization-1Q}. 
        \item This configuration can only provide positive voltages and currents (\hl{first quadrant}).
        \item<2-> It should be noted that this circuit requires two diodes and two transistors.
    \end{itemize}
    \begin{figure}
        \begin{circuitikz}[]
            %Boost part
            \draw (4,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
            to [short]++(-4,0)
            (2.0,2) to [diode, l_=$D_2$, -o, i=$i_2(t)$] (4,2)
            (2,1) node[npn](npn2) {}
            (npn2.C) to [short, -*] (2,2)
            (npn2.E) to [short, -*] (2,0);
            \draw let \p2 = (npn2.B) in node[anchor=east] at (\x2,\y2) {$T_2$};
            % Buck part
            \draw (0,0) to [short]++(-4,0)
            to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
            (-2,2) to [Tnpn, o-*, n=npn1] ++(-2,0)
            (-4,2) to [short, i=$i_1(t)$] (-3.3,2)
            (-2,0) to [diode, l_=$D_1$, *-*] (-2,2);
            \draw let \p1 = (npn1.B) in node[anchor=north] at (\x1,\y1) {$T_1$};
            %Combining inductor
            \draw (-2,2) to [short] (-1,2)
             to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] (1,2)
             to [short, i=$i_\mathrm{L}(t)$](2,2);
        \end{circuitikz}
        \caption{Buck-boost converter with real components (single quadrant type)}
        \label{fig:buck-boost-converter-realization-1Q}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Buck-boost converter: switch states in DCM}
    \onslide<1->{The buck-boost converter in DCM has three different switch states:}
    \begin{itemize}
            \item<1-> Transistor on-time:  $T_\mathrm{on}=DT_\mathrm{s}$,
            \item<2-> Transistor off-time (conducting diode): $T'_\mathrm{off}=D'T_\mathrm{s}$,
            \item<3-> Transistor off-time (no conduction):  $T''_\mathrm{off}=T_\mathrm{s}-T_\mathrm{on}-T'_\mathrm{off}$.
    \end{itemize}
        \begin{figure}
            \centering
            \onslide<1->{%	
            \begin{subfigure}{0.33\textwidth}
                \centering
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1}(t)$] ++(1,0)
                    to [inductor, l=$L$] ++(1.5,0)
                    to [short, i=$i_\mathrm{L}(t)$] ++(1,0)
                    to [short, -*] ++(0,-2);
                    \draw (-1,2) to [short, -o, i=${i_2=0}$] (0,2);
                \end{circuitikz}
                \caption{Switch-on time $T_\mathrm{on}$}
            \end{subfigure}%
            }%
            \onslide<2->{%
            \begin{subfigure}{0.33\textwidth}
                \centering
                \hspace{-0.6cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                    (-3.75,0) to [short, *-] ++(0,2)
                    to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                \end{circuitikz}
                \caption{Switch-off time $T'_\mathrm{off}$}
            \end{subfigure}
            }%
            \onslide<3->{%
            \begin{subfigure}{0.33\textwidth}
                \centering
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}\hspace{0.15cm}$] ++(1.0,0)
                    to [open] ++(0.5, 0)
                    to [short] ++(0.25,0)
                    to [inductor, l=$L$] ++(1.5,0)
                    to [short] ++(0.25,0);
                    \draw (-1,2) to [short, -o, i=${i_2=0}$] (0,2);
                \end{circuitikz}
                \caption{Switch-off time $T''_\mathrm{off}$}
            \end{subfigure}
            }%
        \caption{Switch states of the buck-boost converter including DCM} 
        \label{fig:buck-boost-converter-switch-states-DCM}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter: DCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Buck-boost converter: DCM operation characteristics}
    \onslide<1->{In DCM operation 
    $$  \overline{i}_\mathrm{L} < \frac{\Delta i_\mathrm{L}}{2} \quad \Rightarrow \quad U_2 \neq U_1 \frac{D}{1-D}$$
    applies due to the non-conducting diode during  $T''_\mathrm{off}$.} \onslide<2->{To find the input-to-output voltage ratio in DCM, we again utilize the current ripple balance:}
    \begin{equation}
        \begin{alignedat}{2}
            \onslide<2->{\Delta i_\mathrm{L} &= \frac{U_1}{L}T_\mathrm{on} = \frac{U_1}{L}DT_\mathrm{s} \quad &&\mbox{(rising edge)},}\\
            \onslide<3->{\Delta i_\mathrm{L} &= \frac{U_2}{L}T'_\mathrm{off} = \frac{U_2}{L}D'T_\mathrm{s} \quad &&\mbox{(falling edge)}.}
        \end{alignedat}
    \end{equation}
    \onslide<4->{Solving for $D'$ yields
    \begin{equation}
        D' = \frac{U_1}{U_2}D.
    \end{equation}}
    \onslide<5->{The average load current is }
    \begin{equation}
        \onslide<5->{\overline{i}_2 = \frac{\Delta i_\mathrm{L}}{2}\frac{T'_\mathrm{off}}{T_\mathrm{s}}} \onslide<6->{= \frac{\Delta i_\mathrm{L,max}D}{2}D'}\onslide<7->{= \frac{\Delta i_\mathrm{L,max}}{2}\frac{U_1}{U_2}D^2.}
            \label{eq:buck-boost-converter-average-output-current-DCM}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: DCM operation characteristics (cont.)%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Buck-boost converter: DCM operation characteristics (cont.)}
    Solving \eqref{eq:buck-boost-converter-average-output-current-DCM} delivers the buck-boost \hl{converter voltage gain in DCM} as
    \begin{equation}
        \frac{U_2}{U_1} = \frac{D^2}{2} \frac{\Delta i_\mathrm{L,max}}{\overline{i}_2}.
        \label{eq:voltage-ratio-DCM-buck-boost}
    \end{equation}
    Since $\Delta i_\mathrm{L,max}$ also depends on $U_1$, the relation \eqref{eq:voltage-ratio-DCM-buck-boost} only holds for a given $U_1$. Hence, we can insert \eqref{eq:current-ripple-simple-buck-boost} in \eqref{eq:current-ripple-simple-buck-boost} and solve for $U_2$ to receive
    \begin{equation}
        U_2= U_1^2 \frac{D^2}{2} \frac{T_\mathrm{s}}{L \overline{i}_2}.
    \end{equation}
    Finally, the buck-boost converter \hl{operates in BCM} if
    \begin{equation}
        \overline{i}_\mathrm{L} = \frac{\Delta i_\mathrm{L}}{2} \quad \Leftrightarrow \quad  \overline{i}_2 = \Delta i_\mathrm{L,max} \frac{1}{2} \frac{D}{1-D}. 
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter load curves %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Buck-boost converter load curves}
    \begin{figure}
        \begin{tikzpicture}
            \begin{semilogyaxis}[
                xlabel={$\overline{i}_2/\Delta i_\mathrm{L,max}$},
                ylabel={$U_2/U_1$},
                axis lines=left,
                thick,
                smooth,
                no markers,
                height = 0.8\textheight,
                grid,
                log ticks with fixed point,
                ymin=0.04, ymax=11,
                xmin=0, xmax=0.4,
                clip = true
                ]
                \foreach \D in {0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9}{
                    \addplot[signalblue, domain=\D*(1-\D)/2:1, samples=15] {\D/(1-\D)}; %CCM
                    \addplot[signalblue, domain=0.01:\D*(1-\D)/2, samples=30] {\D^2/2/x}; %DCM
                }
                 \foreach \D [count=\xi] in {0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9}{
                    \pgfmathsetmacro{\gain}{\D/(1-\D)}
                    \pgfmathsetmacro{\shift}{(-1)^(Mod(\xi,2))}
                     \edef\temp{\noexpand\node[inner sep = 1pt, align = center, fill = white] at (axis cs:0.3+\shift/20, \gain) {$\scriptstyle D=\D$};} % Duty-cycle labels
                     \temp
                 }
                 \addplot[signalred, domain = 0.005:0.15, samples=30, thick, name path = upper] {-(1-1/(4*x)) + ((1-1/(4*x))^2 - 1)^(0.5)}; % Upper boundary area
                 \addplot[signalred, domain = 0.005:0.15, samples=30, thick, name path = lower] {-(1-1/(4*x)) - ((1-1/(4*x))^2 - 1)^(0.5)}; % Lower boundary area
                \addplot[shadecolor, opacity=0.3] fill between[of=upper and lower];
                \node[inner sep = 1pt, anchor = west, fill = white, font=\footnotesize] at (axis cs:0.102, 0.165) {CCM}; % CCM label
                \node[inner sep = 1pt, anchor = center, font=\footnotesize] at (axis cs:0.0475, 0.25) {DCM}; % DCM label
            \end{semilogyaxis}
        \end{tikzpicture}
        \caption{Buck-boost converter load curves for CCM and DCM (note: logarithmic ordinate)}
        \label{fig:buck-boost-converter-load-curves}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Inverting buck-boost converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Inverting buck-boost converter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Recap: Buck-boost converter switching states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Recap: Buck-boost converter switching states}
    \begin{varblock}{Key characteristic of (synchronous) buck-boost converter}
        The switching scheme of the (synchronous) buck-boost converter from \figref{fig:buck-boost-converter-switch-states} is realized by \hl{two switches} and characterized by:
        \begin{itemize}
            \item \hl{During switch-on}: inductor is connected to $u_1(t)$,
            \item \hl{During switch-off}: inductor is connected to $u_2(t)$.
        \end{itemize}
    \end{varblock}
    \begin{figure}
        \centering	
        \begin{subfigure}{0.45\textwidth}
            \centering
            \hspace{-0.75cm}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=$i_1(t)$] ++(1.0,0)
                to [inductor, l=$L$] ++(1.75,0)
                to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to [short, -*] ++(0,-2);
                \draw (0,2) to [short, i_<=${i_2=0}$, -o] ++(-1.0,0);
                \draw (-1.8,2) to [open, v_>=${U_{\mathrm{s}_2}\hspace{0.2cm}}$, voltage = straight] ++(0,-2);
                \draw (-4.4,2) to [open, v = ${\hspace{1.5cm}U_{\mathrm{s}_1}}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Switch-on time}
        \end{subfigure}%
        \hspace{0.5cm}
        \begin{subfigure}{0.45\textwidth}
            \centering
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                (-3.75,0) to [short, *-] ++(0,2)
                to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to [inductor, l=$L$] ++(2,0)
                to [short, i=$i_2(t)$] (0,2);
                \draw (-3.4,2) to [open, v = ${\hspace{1.5cm}U_{\mathrm{s}_1}}$, voltage = straight] ++(0,-2);
                \draw (-0.5,2) to [open, v_>=${U_{\mathrm{s}_2}\hspace{0.2cm}}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Switch-off time}
        \end{subfigure}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Recap: Buck-boost converter switching states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Inverting buck-boost converter: overview}
    \begin{figure}
        \begin{itemize}
            \item Voltage change at the inductor can be also achieved by a \hl{single switch} which input is connected to the inductor.
            \item Assuming an ideal, infinitely fast switch, the inductor current $i_\mathrm{L}(t)$ remains well-defined (no open switch at inductor).
        \end{itemize}
        \begin{circuitikz}[]
            \draw(0,3) node[cute spdt mid, rotate=90] (S) {}
            (S.cout 2) to [short, -o, i=$i_2(t)$] ++(3,0)
            to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-3) coordinate (A)
            (S.cout 1) to [short, -o, i_<=$i_1(t)$] ++(-3,0)
            to [open, o-o, v_= $u_1(t)\hspace{0.75cm}$, voltage = straight] ++(0,-3)
            to [short, o-o] (A)
            (S.out 1) node[below, anchor = north east] {$S_\mathrm{on}$}
            (S.out 2) node[below, anchor = north west] {$S_\mathrm{off}$};
            \draw let \p1 = (A) in (S.cin) to [inductor, i=$i_\mathrm{L}(t)$, v=$u_\mathrm{L}(t)$,voltage = straight, o-*] (0,\y1);
        \end{circuitikz}
        \caption{Inverting buck-boost converter (ideal switch representation)}
        \label{fig:inverting-buck-boost-simple}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Polarity change of inverting buck-boost converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Polarity change of inverting buck-boost converter}
    \begin{itemize}
        \item One side of the inductor remains connected to the common connection rail between input and output side.
        \item The other inductor side switches between the upper input and output rail.
        \item Consequence: voltage and current directions are inverted between the two switch states. 
    \end{itemize}
    \begin{figure}
        \centering	
        \begin{subfigure}{0.45\textwidth}
            \centering
            \hspace{-0.75cm}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=$i_1(t)$] ++(1.0,0)
                to [inductor, l=$L$, v=$u_\mathrm{L}(t)$, voltage = straight] ++(1.5,0)
                to [short] ++(0.25,0)
                to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to [short, -*] ++(0,-2);
                \draw (0,2) to [short, i_<=${i_2=0}$, -o] ++(-1.0,0);
            \end{circuitikz}
            \caption{Switch-on time}
        \end{subfigure}%
        \hspace{0.5cm}
        \begin{subfigure}{0.45\textwidth}
            \centering
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                (-3.75,0) to [short, *-] ++(0,2)
                to [short, i<=$i_\mathrm{L}(t)$] ++(0.75,0)
                to [inductor, l=$L$, v_<=$u_\mathrm{L}(t)$, voltage = straight] ++(1.5,0)
                to [short] ++(0.5,0)
                to [short, i=$i_2(t)$] (0,2);
            \end{circuitikz}
            \caption{Switch-off time}
        \end{subfigure}
        \caption{Voltage and current definitions of the inverting buck-boost converter}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Inverting buck-boost converter: voltage voltage transfer ratio %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
    \frametitle{Inverting buck-boost converter: voltage transfer ratios}
    In CCM, the voltage balance of the inductor $L$ delivers:
    \begin{equation}
        u_\mathrm{L}(t) = \begin{cases} 
            U_1, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}],\\ 
            U_2 & t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}].
        \end{cases}
    \end{equation}
    In steady state, the average inductor voltage per period must be zero, yielding
    \begin{equation}
        U_1 T_\mathrm{on} = -U_2 T_\mathrm{off}  \quad \Leftrightarrow \quad  U_1 D T_\mathrm{s} = -U_2 (1-D) T_\mathrm{s} \quad \Leftrightarrow \quad \frac{U_2}{U_1} = -\frac{D}{1-D}.
    \end{equation}
    Likewise, the analysis of the DCM mode reveals
    \begin{equation}
        \frac{U_2}{U_1} = -\frac{D^2}{2} \frac{\Delta i_\mathrm{L,max}}{\overline{i}_2} \quad \Leftrightarrow \quad U_2 = -U_1^2 \frac{D^2}{2} \frac{T_\mathrm{s}}{L \overline{i}_2}.
    \end{equation}
    Hence, the inverting buck-boost converter has a \hl{negative voltage transfer ratio} in CCM and DCM, but the same absolute voltage gain as the synchronous buck-boost converter.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Inverting buck-boost converter: circuit realization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Inverting buck-boost converter: circuit realization}
    \begin{itemize}
        \item Energy transfer takes place solely indirect by intermediate storage within inductor.
        \item Further characteristics (current and voltage ripple, operation modes) are analogous to the synchronous buck-boost converter.  
        \item Transistor needs to block up to $|u_1(t)|+|u_2(t)|$, in contrast to step-down/up converter where only the input or output voltage is blocked by the transistor.
    \end{itemize}
    \begin{figure}
        \begin{circuitikz}[]
            \draw (0,0) to [short, *-] ++(1.0,0)
            to [diode, l=$D$, invert]  ++(1.0,0)
            to [short, -o, i=$i_2(t)$] ++(1.0,0)
            to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2.5) coordinate (A)
            (0,0) to [short, *-] ++(-1.0,0) 
            to [Tnpn, n=npn1] ++(-1.0,0)
            to [short, -o, i_<=$i_1(t)$] ++(-1.0,0)
            to [open, o-o, v_= $u_1(t)\hspace{0.75cm}$, voltage = straight] ++(0,-2.5)
            to [short, o-o] (A)
            (0,0) to [inductor, i=$i_\mathrm{L}(t)$, v=$u_\mathrm{L}(t)$,voltage = straight, *-*] ++(0,-2.5);
            \draw let \p1 = (npn1.B) in node[anchor=north] at (\x1,\y1) {$T$};
        \end{circuitikz}
        \caption{Inverting buck-boost converter with real components (single quadrant type)}
        \label{fig:inverting-buck-boost-converter-realization-1Q}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Silicon utilization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Silicon utilization}
    We define the \hl{silicon utilization} as the ratio of the average output power to the transistor (peak) power:
    \begin{equation}
        \frac{P_2}{P_\mathrm{T}} = \frac{U_2 I_2}{\max\{u_\mathrm{T}\}\cdot\max\{i_\mathrm{T}\}}.
    \end{equation}
    Background and interpretation:
    \begin{itemize}
        \item Transistor rating needs to withstand the peak voltage and current. 
        \item The lower the silicon utilization, the more costly / bulky the transistor for a given converter power (key parameter for the selection of the power stage).
    \end{itemize}
    Assumptions for following calculations:
    \begin{itemize}
        \item Operation in CCM. 
        \item Current and voltage ripple are marginal and can be neglected.
        \item Given a constant $P_2$, the duty cycle $D$ is adjusted to achieve the desired output power.
    \end{itemize}
\end{frame}