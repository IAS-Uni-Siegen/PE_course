\section{DC-DC converters}
\title{DC-DC converters}  

\begin{frame}[plain]
    \titlepage
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step-down converter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Outline / table of content %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Section's content}
    \tableofcontents[currentsection, hideothersubsections]
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Overview and assumption %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
\frametitle{Step-down converter: overview and assumptions}
    We consider the following assumptions:
    \begin{itemize}
        \item The switch is ideal, that is, infinitely fast.
        \item The input voltage is constant: $u_1(t) = U_1$.
        \item The output voltage is constant: $u_2(t) = U_2$.
        \item The input voltage is greater than the output voltage: $U_1 > U_2$.
    \end{itemize}
    \begin{figure}
        \begin{circuitikz}[]
            \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
            to ++(-6,0)
            to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
            (-6,2) to  [short, i=$i_1(t)$] ++(1.35,0);   
            \draw (-5.375,2) ++(0.625,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S) {}
            let \p1 = (S.mid) in (S.in) to  [short, i=$i_\mathrm{L}(t)$] ++(1,0)
            to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(2,0)
            to [short, -o, i=$i_2(t)$] (0,2) 
            ([yshift = -0.3cm]S.mid) to [short, o-*](\x1,0);
            \draw (-3.5,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s}(t)$, voltage = straight] ++(0,-2);
        \end{circuitikz}
        \caption{Step-down converter (aka \hl{buck converter}, ideal switch representation)}
        \label{fig:step-down-converter-simple}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-down converter: switch states}
     The voltage at the switch is given by
     \begin{equation}
            u_\mathrm{s}(t) = \begin{cases}
                U_1, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}],\\
                0, & t\in [k T_\mathrm{s}+ T_\mathrm{on}, (k+1) T_\mathrm{s}]
            \end{cases}
     \end{equation}
     with $k\in\mathbb{N}$ being the $k$-th switching period, $T_\mathrm{s}$ the switching period, and $T_\mathrm{on}$ the switch-on time. 
        \begin{figure}
            \centering	
            \begin{subfigure}{0.45\textwidth}
                \centering
                \hspace{-0.75cm}
                \begin{circuitikz}[]
                    \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1(t)=i_\mathrm{L}(t)}$] ++(2,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                    \draw (-4,2) to [open, v = ${\hspace{2.4cm}U_\mathrm{s}=U_1}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-on time}
            \end{subfigure}%
            \hspace{0.5cm}
            \begin{subfigure}{0.45\textwidth}
                \centering
                \begin{circuitikz}[]
                    \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                    (-3.75,0) to [short, *-] ++(0,2)
                    to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                    \draw (-3.4,2) to [open, v = ${\hspace{2.4cm}U_\mathrm{s}=0}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time}
            \end{subfigure}
        \caption{Switch states of the step-down converter} 
        \label{fig:step-down-converter-switch-states}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Basic terms and definitions %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[c]
    \frametitle{Basic terms and definitions}
    \centering
     \begin{tabular}{c l c l}
        $T_\mathrm{on}$ & Switch-on time  & $T_\mathrm{off}$ & Switch-off time\\[1em]
        $T_\mathrm{s}= T_\mathrm{on} + T_\mathrm{off}$ & Switching period & $f_\mathrm{s} = 1/T_\mathrm{s}$ & Switching frequency\\[1em]
        $D = T_\mathrm{on}/T_\mathrm{s}$ & Duty cycle &  & 
     \end{tabular}
     \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                xlabel={$t/T_\mathrm{s}$},
                ylabel={$u_\mathrm{s}(t)/U_1$},
                ymin=-0.05, ymax=1.05,
                xmin=-0.1, xmax=1.1,
                width = 0.5\textwidth,
                height = 0.4\textheight,
                grid,
                thick,
                clip = false,
                ]
                % plt u_out = 1 for t = 0 to D*Ts and u_out = 0 for t = D*Ts to Ts in a single plot
                \addplot[signalblue] coordinates {(-0.1,0) (0,0) (0,1) (0.4,1) (0.4,0) (1,0) (1,1) (1.1,1)};
                \draw [thick,<->]  (0,0.5) -- node[above,fill=white]{$T_\mathrm{on}$}(0.4, 0.5); 
                \draw [thick,<->]  (0.4,0.5) -- node[above]{$T_\mathrm{off}$}(1.0, 0.5);
                \draw [thick,<->]  (0.0,1.2) -- node[above]{$T_\mathrm{s}$}(1.0, 1.2); 
            \end{axis}
        \end{tikzpicture}
    \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis}
    The inductor current from \figref{fig:step-down-converter-simple} is represented by the \hl{differential equation}
    \begin{equation}
        L \frac{\mathrm{d}i_\mathrm{L}(t)}{\mathrm{d}t} =  u_\mathrm{L}(t) =  u_\mathrm{s}(t) - U_2.
    \end{equation}
    During the \hl{switch-on period} we have
    \begin{equation}
        \begin{split}
            i_\mathrm{L}(t) &= i_\mathrm{L}(k T_\mathrm{s}) + \int_{k T_\mathrm{s}}^{t}u_\mathrm{L}(\tau)\mathrm{d}\tau \\
                            &= i_\mathrm{L}(k T_\mathrm{s}) + \frac{U_1-U_2}{L} (t - k T_\mathrm{s})
            , \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}]
        \end{split}
        \label{eq:inductor-current-switch-on-simple-step-down}
    \end{equation}
    and during the \hl{switch-off period} we receive
    \begin{equation}
        \begin{split}
            i_\mathrm{L}(t) &= i_\mathrm{L}(k T_\mathrm{s} + T_\mathrm{on}) + \int_{k T_\mathrm{s}+T_\mathrm{on}}^{t}u_\mathrm{L}(\tau)\mathrm{d}\tau= i_\mathrm{L}(k T_\mathrm{s} + T_\mathrm{on}) - \frac{U_2}{L} (t - k T_\mathrm{s} - T_\mathrm{on})\\
            \               &= i_\mathrm{L}(k T_\mathrm{s}) + \frac{U_1-U_2}{L} T_\mathrm{on} - \frac{U_2}{L} (t - k T_\mathrm{s} - T_\mathrm{on}), \quad 
            t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}]. 
        \end{split} 
        \label{eq:inductor-current-switch-off}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    In steady state the inductor current is periodic with period $T_\mathrm{s}$, that is, $$i_\mathrm{L}(t) = i_\mathrm{L}(t + T_\mathrm{s}).$$
    From \eqref{eq:inductor-current-switch-off} we obtain for $t= k T_\mathrm{s}$
    \begin{equation}
        \begin{split}
        \overbrace{i_\mathrm{L}(k T_\mathrm{s})}^{\mbox{Start of period}} &= \hspace{0.5cm}  \overbrace{i_\mathrm{L}(k T_\mathrm{s}) + \frac{U_1-U_2}{L} T_\mathrm{on} - \frac{U_2}{L} (T_\mathrm{s} - T_\mathrm{on})}^{\mbox{End of period}}\\
        \Leftrightarrow \qquad 0 \hspace{1.1cm}&= \hspace{0.5cm}\frac{U_1-U_2}{L} T_\mathrm{on} - \frac{U_2}{L} (T_\mathrm{s} - T_\mathrm{on})\\
        \Leftrightarrow \qquad 0 \hspace{1.1cm}&= \hspace{0.5cm}U_1 T_\mathrm{on} - U_2 T_\mathrm{s}.
    \end{split}
    \end{equation}
    Rewritting delivers the \hl{output voltage} as
    \begin{equation}
        U_2 = \frac{T_\mathrm{on}}{T_\mathrm{s}} U_1 = D U_1.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter: steady-state time-domain behavior %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Step-down converter: steady-state time-domain behavior}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.6} % duty cycle
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({0 + #1},1) ({\D + #1},1) ({\D + #1},0) ({1 + #1},0) ({1 + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \D) -- (axis cs:4, \D); % dashed line at U_2 (average)
                    \node[above, inner sep = 2pt, anchor = south] at (axis cs:1.5+\D/2, \D) {$U_2$}; % label U_2
                    \draw [thick,<->]  (0,0.5) -- node[below]{$T_\mathrm{on}$}(\D, 0.5); % T_on 
                    \draw [thick,<->]  (\D,0.5) -- node[below]{$T_\mathrm{off}$}(1.0, 0.5); % T_off
                    \draw [thick,<->]  (0.0,-0.2) -- node[below]{$T_\mathrm{s}$}(1.0, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, $\overline{i}_\mathrm{L}$, }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5) -- (axis cs:4,0.5); % dashed line at average current
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:\D+0.02,0.75) -- node[right=1mm, fill=white, inner sep = 1pt]{$\max\{i_\mathrm{L}\}$}(axis cs:\D+0.3,0.9); % indicate max current
                    \draw[-{Latex[length=2mm]}, thin] (axis cs:0.75,0.2) node[right=1mm, fill=white, inner sep = 1pt, anchor = east]{$\min\{i_\mathrm{L}\}$} -- (axis cs:1-0.02,0.25); % indicate min current
                    \draw[thin] (axis cs:2+\D/4,0.25+0.125) -- (axis cs:2+\D/4,0.75-0.125) -- (axis cs:2+\D*3/4,0.75-0.125); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south, xshift = -4mm] at (axis cs:2+\D/2, 0.75-0.125) {$\nicefrac{(U_1-U_2)}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2.25+3*\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.25+0.125); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south, xshift = 2mm] at (axis cs:2.5+\D/2, 0.75-0.125) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({\D + #1},0) ({1 + #1},0) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5 * \D) -- (axis cs:4, 0.5 * \D); % dashed line at average current
                    \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\D/2, 0.5 * \D) {$\overline{i}_1$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Alternative steady-state analysis: average values %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Alternative steady-state analysis: average values}
    From the previous slide we know that the average inductor voltage is zero in steady state
    \begin{equation}
        \overline{u}_\mathrm{L} = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{s}} u_\mathrm{L}(t) \mathrm{d}t = \overline{u}_\mathrm{L} = 0,
    \end{equation}
    since otherwise the average inductor current would change between periods, compare
    $$
    L \frac{\mathrm{d}i_\mathrm{L}(t)}{\mathrm{d}t} =  u_\mathrm{L}(t).
    $$
    From \figref{fig:step-down-converter-simple} we can apply Kirchhoff's voltage law to obtain
    \begin{equation}
        u_\mathrm{s}(t) = u_\mathrm{L}(t) + u_2(t) \quad \Rightarrow \quad \overline{u}_\mathrm{s} = \overline{u}_\mathrm{L} + U_2 \quad \Leftrightarrow \quad  \overline{u}_\mathrm{s} = U_2.
        \label{eq:Kirchhoff-switch-voltage}
    \end{equation}
    The average switch voltage is given by
    \begin{equation}
        \overline{u}_\mathrm{s} = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{s}} u_\mathrm{s}(t) \mathrm{d}t = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{on}} U_1 \mathrm{d}t = U_1 \frac{T_\mathrm{on}}{T_\mathrm{s}} = U_1 D.
        \label{eq:average-switch-voltage}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Alternative steady-state analysis: average values (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Alternative steady-state analysis: average values (cont.)}
    Combining \eqref{eq:Kirchhoff-switch-voltage} and \eqref{eq:average-switch-voltage} we obtain
    \begin{equation}
        \frac{U_2}{U_1} =  D.
    \end{equation}
    In addition, we can calculate the average input current as
    \begin{equation}
        \overline{i}_1 = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{s}} i_1(t) \mathrm{d}t = \frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{on}} i_\mathrm{L}(t) \mathrm{d}t = \frac{T_\mathrm{on}}{T_\mathrm{s}} \overline{i}_\mathrm{L} = D \overline{i}_\mathrm{L}.
    \end{equation}
    Since $i_2(t) = i_\mathrm{L}(t)$ applies, we can conclude
    \begin{equation}
        \frac{U_2}{U_1} = \frac{\overline{i}_1}{\overline{i}_2} = D.
    \end{equation}
    Hence, the duty cycle $D$ has a similar interpretation for the DC-DC step-down converter as the turn ratio for an ideal transformer in the AC domain.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Stationary averaged model of the step-down converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Stationary averaged model of the step-down converter}
    \begin{figure}
        \begin{circuitikz}[]
            \draw (-3,0) to [short, o-, i=$\overline{i}_1$] ++(1.5,0)
            to [current source, i=$D \overline{i}_2$] ++(0,-2)
            to [short, -o] ++(-1.5,0);
            \draw (-3,0) to [open, v = $\hspace{-0.25cm}U_1$, voltage = straight] ++(0,-2);
            \draw (3,0) to [short, o-, i_<=$\overline{i}_2$] ++(-1.5,0)
            to [voltage source, v_= $D U_1$] ++(0,-2)
            to [short, -o] ++(1.5,0);
            \draw (3,0) to [open, v = $\hspace{1.5cm}U_2$, voltage = straight] ++(0,-2);
        \end{circuitikz}
        \caption{Stationary averaged model of the step-down converter}
        \label{fig:step-down-converter-averaged}
    \end{figure}
    \begin{varblock}{Switching vs. linear power conversion}
        In contrast to the linear power conversion approaches from \figref{fig:linear_power_conversion} and \figref{fig:linear_power_conversion_transistor}, the switching step-down converter transforms the current and voltage levels with the same factor $D$ which results from the (idealized) loss-less transformation of energy. 
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple}
    Due to the switching operation of the step-down converter, the inductor current exhibits an inherent ripple. The peak-to-peak \hl{current ripple} is given by
    \begin{equation}
        \begin{split}
            \Delta i_\mathrm{L} &= \max\{i_\mathrm{L}(t)\} - \min\{i_\mathrm{L}(t)\}  = i_\mathrm{L}(t=T_\mathrm{on}) - i_\mathrm{L}(t=T_\mathrm{s})\\
                                &=\frac{U_1 - U_2}{L} T_\mathrm{on} = \frac{U_2}{L} T_\mathrm{off}\\
                                & = \frac{D(1-D)T_\mathrm{s}}{L}U_1.
        \end{split}
        \label{eq:current-ripple-simple-step-down}
    \end{equation}
    The current ripple has two main implications:
    \begin{itemize}
        \item The output power is not constant but varies with the current ripple.
        \item The root mean square (RMS) current is higher than the average current.
    \end{itemize}
    The latter point should be investigated in more detail as it influences the design and loss characteristics of the converter.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple (cont.)}
    We define 
    \begin{equation}
        \Delta I_\mathrm{L} = \sqrt{\frac{1}{T_\mathrm{s}} \int_{0}^{T_\mathrm{s}} \left(i_\mathrm{L}(t) - \overline{i}_\mathrm{L}\right)^2 \mathrm{d}t}
    \end{equation}
    as the RMS deviation of the inductor current from its average value. As the average-corrected inductor current has a triangular shape (cf. \figref{fig:inductor-current-ripple}) we can calculate the RMS current as
    \begin{equation}
        \Delta I_\mathrm{L} = \frac{1}{\sqrt{3}} \frac{\Delta i_\mathrm{L}}{2} = \frac{D(1-D)T_\mathrm{s}U_1}{2\sqrt{3}L}.
        \label{eq:RMS-current-ripple}
    \end{equation}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.6} % duty cycle
            \begin{axis}[
                xlabel={$t/T_\mathrm{s}$},
                ylabel={$i_\mathrm{L}(t)-\overline{i}_\mathrm{L}$},
                ymin=-0.3, ymax=0.3,
                xmin=-0.1, xmax=1.1,
                width = 0.7\textwidth,
                height = 0.4\textheight,
                grid,
                thick,
                clip = true,
                ytick = {-0.2, 0, 0.2}, 
                yticklabels = {$\nicefrac{-\Delta i_\mathrm{L}}{2}$, 0, $\nicefrac{\Delta i_\mathrm{L}}{2}$}
                ]
                \addplot[signalred] coordinates {(\D-1,0.22) (0,-0.2) (\D,0.2) (1, -0.2) (1+\D,0.2)};
                \draw[signalred, thick, dashed] (axis cs:\D-1,0.2/1.73) -- (axis cs:1+\D, 0.2/1.73); % dashed line at RMS current
                \node[above, inner sep = 2pt, anchor = north, fill = white] at (axis cs:0.1, 0.2/1.73) {$\Delta I_\mathrm{L}$};
                \draw [thin, <->]  (0.6,-0.2) -- node[left,fill=white]{$\Delta i_\mathrm{L}$}(0.6, 0.2); 
            \end{axis}
        \end{tikzpicture}
        \caption{Inductor current ripple}
        \label{fig:inductor-current-ripple}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple (cont.)}
    The (total) RMS value of the inductor current (triangular signal with offset) is given by
    \begin{equation}
        I_\mathrm{L} = \sqrt{\overline{i}^2_\mathrm{L} + \Delta I^2_\mathrm{L}}.
    \end{equation}
    Considering the internal resistance $R_\mathrm{i}$ of the inductor, the ohmic power loss in the inductor is
    \begin{equation}
        P_\mathrm{L} = R_\mathrm{i} I^2_\mathrm{L} = R_\mathrm{i} \left(\overline{i}^2_\mathrm{L} + \Delta I^2_\mathrm{L}\right).
    \end{equation}
    The power loss in the inductor is thus composed of a constant part $\overline{P}_\mathrm{L} = R_\mathrm{i} \overline{i}^2_\mathrm{L}$, which is related to the power transfer from input to output, and a ripple part $\Delta P_\mathrm{L} = R_\mathrm{i} \Delta I^2_\mathrm{L}$.   
    \begin{varblock}{Current ripple and power losses}
        The current ripple produces additional losses in the inductor. From \eqref{eq:RMS-current-ripple} it seems tempting to increase the switching frequency $f_\mathrm{s}$ to reduce the ripple, but this will increase switching losses (compare \figref{fig:idealized_switch_model}). Hence, there is a trade-off decision between switching and conduction losses.
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple and duty cycle %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple and duty cycle}
    Rewriting the current ripple expression
    \begin{equation*}
            \Delta i_\mathrm{L} = \frac{D(1-D)T_\mathrm{s}}{L}U_1 = (D-D^2)\frac{T_\mathrm{s}U_1}{L}.
    \end{equation*}
    and calculating the derivative with respect to the duty cycle $D$ delivers
    \begin{equation}
        \frac{\mathrm{d}\Delta i_\mathrm{L}}{\mathrm{d}D} = \frac{T_\mathrm{s}U_1}{L} - 2D\frac{T_\mathrm{s}U_1}{L}.
    \end{equation}
    Setting the derivative to zero, we find the duty cycle $D_\mathrm{max}$ as
    \begin{equation}
        \frac{\mathrm{d}\Delta i_\mathrm{L}}{\mathrm{d}D} = 0 \quad \Leftrightarrow \quad D_\mathrm{max} = \frac{1}{2}
        \label{eq:duty-cycle-max}
    \end{equation}
    which is associated with the maximum current ripple since the second derivative 
    \begin{equation}
        \frac{\mathrm{d}^2\Delta i_\mathrm{L}}{\mathrm{d}D^2} = -\frac{2T_\mathrm{s}U_\mathrm{on}}{L}
    \end{equation}
    is negative. 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Current ripple and duty cycle (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Current ripple and duty cycle (cont.)}
    From \eqref{eq:duty-cycle-max} we can conclude that the maximum current ripple is given by
    \begin{equation}
        \Delta i_\mathrm{L, \max} = \frac{1}{4}\frac{T_\mathrm{s}U_1}{L} \quad \Rightarrow \quad \Delta i_\mathrm{L} = 4D(1-D) \Delta i_\mathrm{L, \max}.
        \label{eq:current-ripple-max-simple-step-down}
    \end{equation}

    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                xlabel={$D$},
                ylabel={$\Delta i_\mathrm{L}$},
                ymin=0, ymax=1.1,
                xmin=0, xmax=1,
                width = 0.6\textwidth,
                height = 0.5\textheight,
                grid,
                thick,
                clip = true,
                xtick = {0, 0.25, 0.5, 0.75, 1.0}, 
                ytick = {0, 0.5, 1.0}, 
                yticklabels = {0, $\nicefrac{\Delta i_\mathrm{L, max}}{2}$, $\Delta i_\mathrm{L, max}$}
                ]
                \addplot[signalblue, domain=0:1, samples=100] {x*(1-x)*4};
                \draw[dashed] (axis cs:0.5,0) -- (axis cs:0.5,1); % dashed line at max current ripple
                \node[above, inner sep = 2pt, anchor = east, fill = white] at (axis cs:0.5, 0.5) {$D_\mathrm{max}$};
            \end{axis}
        \end{tikzpicture}
        \caption{Inductor current ripple as a function of the duty cycle}
        \label{fig:inductor-current-ripple-duty}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter with output capacitor %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step-down converter: output capacitor}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter with output capacitor: overview and assumption %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-down converter with output capacitor: overview and assumption}
        We consider the following assumptions:
        \begin{itemize}
            \item The switch is ideal, that is, infinitely fast.
            \item The input voltage is constant: $u_1(t) = U_1$.
            \item The output current is constant: $i_2(t) = I_2$.
            \item The input voltage is greater than the output voltage: $U_1 > u_2(t)$.
        \end{itemize}
        \begin{figure}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to ++(-7,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                (-7,2) to  [short, i=$i_1(t)$] ++(1.35,0);   
                \draw (-6.375,2) ++(0.625,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S) {}
                let \p1 = (S.mid) in (S.in) to  [short, i=$i_\mathrm{L}(t)$] ++(1,0)
                to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(2,0)
                to [short] ++(1,0)
                to [short, -o, i=$i_2(t)$] (0,2) 
                ([yshift = -0.3cm]S.mid) to [short, o-*](\x1,0);
                \draw (-4.5,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s}(t)$, voltage = straight] ++(0,-2);
                \draw (-1.5,2) to [capacitor, *-*, l=$C$, i>^=$i_\mathrm{C}(t)$] ++(0,-2);
            \end{circuitikz}
            \caption{Step-down converter (ideal switch representation) with output capacitor}
            \label{fig:step-down-converter-simple-output-cap}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis}
    From \eqref{eq:inductor-current-switch-on-simple-step-down} we know that the inductor current during the switch-on period is given by
    \begin{equation*}
        i_\mathrm{L}(t) = i_\mathrm{L}(k T_\mathrm{s}) + \frac{U_1-u_\mathrm{C}(t)}{L} (t - k T_\mathrm{s}), \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}]. 
    \end{equation*}
   Note that the inductor current is now dependent on $u_\mathrm{C}(t)$:
    \begin{itemize}
        \item Formally, we need to consider the impact of the varying output capacitor voltage.
        \item This would lead to a second-order differential equation which is more complex to solve.
        \item We will simplify the analysis by assuming that the impact of the output capacitor voltage variation on the inductor current is negligible: $u_\mathrm{C}(t) \approx U_2=\overline{u}_\mathrm{c}$.
    \end{itemize} 
    \vspace{-0.5cm}
    \begin{varblock}{Simplification comment}
        The above assumption is valid for sufficiently large output capacitors with only small voltage ripples. Otherwise, the output voltage ripple and the inductor current ripple will be significantly coupled and require a more thoughtful analysis.
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
     The \hl{capacitor's voltage differential equation} is given by
    \begin{equation}
        C \frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} = i_\mathrm{C}(t) = i_\mathrm{L}(t) - I_2.
        \label{eq:capacitor-voltage-differential-equation-step-down-converter}
    \end{equation}
    While $I_2$ is considered a known constant, we first need to determine the inductor current $i_\mathrm{L}(t)$. Combining \eqref{eq:inductor-current-switch-on-simple-step-down} and \eqref{eq:current-ripple-simple-step-down} we obtain
    \begin{equation}
         i_\mathrm{L}(k T_\mathrm{s})  = I_2 - \frac{\Delta i_\mathrm{L}}{2} = I_2 - \frac{U_1 - U_2}{L} \frac{T_\mathrm{on}}{2}
    \end{equation}
    and
    \begin{equation}
        i_\mathrm{L}(k T_\mathrm{s} + T_\mathrm{on})  = I_2 + \frac{\Delta i_\mathrm{L}}{2} = I_2 + \frac{U_1 - U_2}{L} \frac{T_\mathrm{on}}{2}
   \end{equation}
    as the \hl{initial conditions for the inductor current} in steady state. 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
     The \hl{capacitor's current} during the \hl{switch-on period} is given by
    \begin{equation}
        \begin{split}
            i_\mathrm{C}(t) &= i_\mathrm{L}(t) - I_2 = \frac{U_1-U_2}{L} (t - \frac{T_\mathrm{on}}{2}-k T_\mathrm{s})\\
                            &= -\frac{\Delta i_\mathrm{L}}{2} + \frac{U_1-U_2}{L} (t -k T_\mathrm{s}), \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}]
        \end{split}
        \label{eq:capacitor-current-switch-on-step-down-converter}
    \end{equation}
    and during the \hl{switch-off period} we receive
    \begin{equation}
        \begin{split}
            i_\mathrm{C}(t) &= i_\mathrm{L}(t) - I_2 = \frac{U_1 - U_2}{L} \frac{T_\mathrm{on}}{2} -\frac{U_2}{L} (t - k T_\mathrm{s} - T_\mathrm{on})\\
                            &= \frac{\Delta i_\mathrm{L}}{2} - \frac{U_2}{L} (t - k T_\mathrm{s} - T_\mathrm{on}), \quad t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}].
        \end{split}
        \label{eq:capacitor-current-switch-off-step-down-converter}
    \end{equation}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.6} % duty cycle
            \begin{axis}[
                xlabel={$t/T_\mathrm{s}$},
                ylabel={$i_\mathrm{C}(t)$},
                ymin=-0.3, ymax=0.3,
                xmin=-0.1, xmax=1.1,
                width = 0.7\textwidth,
                height = 0.4\textheight,
                grid,
                thick,
                clip = true,
                ytick = {-0.2, 0, 0.2}, 
                yticklabels = {$\nicefrac{-\Delta i_\mathrm{L}}{2}$, 0, $\nicefrac{\Delta i_\mathrm{L}}{2}$}
                ]
                \addplot[signalred] coordinates {(\D-1,0.22) (0,-0.2) (\D,0.2) (1, -0.2) (1+\D,0.2)};
                \draw [thin, <->]  (0.6,-0.2) -- node[left,fill=white]{$\Delta i_\mathrm{L}$}(0.6, 0.2); 
            \end{axis}
        \end{tikzpicture}
    \end{figure}
    \begin{varblock}{Current ripples through the capacitor and inductor}
        Based on the made assumptions, the capacitor's current is raising and falling linearly during the switch-on and switch-off periods, that is, it corresponds to the previously considered inductor current ripple. 
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    Inserting \eqref{eq:capacitor-current-switch-on-step-down-converter} in \eqref{eq:capacitor-voltage-differential-equation-step-down-converter} and integrating the differential equation delivers the \hl{capacitor voltage during the switch-on period} as
    \begin{equation}
        \begin{split}
            u_\mathrm{C}(t) &= u_\mathrm{C}(k T_\mathrm{s}) + \frac{1}{C}\int_{k T_\mathrm{s}}^t i_\mathrm{C}(\tau) \mathrm{d}\tau , \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}]\\
            &= u_\mathrm{C}(k T_\mathrm{s}) + \frac{1}{C}\int_{k T_\mathrm{s}}^t -\frac{\Delta i_\mathrm{L}}{2} + \frac{U_1-U_2}{L} (\tau -k T_\mathrm{s}) \mathrm{d}\tau\\
            &=u_\mathrm{C}(k T_\mathrm{s}) + \frac{1}{C} \left[-\frac{\Delta i_\mathrm{L}}{2}\tau + \frac{U_1-U_2}{L} (\frac{1}{2}\tau^2 -k T_\mathrm{s}\tau)\right]_{k T_\mathrm{s}}^t\\
            &=u_\mathrm{C}(k T_\mathrm{s}) - \frac{\Delta i_\mathrm{L}}{2 C}(t- kT_\mathrm{s}) + \frac{U_1-U_2}{LC} \left[t(\frac{t}{2}-kT_\mathrm{s}) + \frac{(kT_\mathrm{s})^2}{2}\right].
        \end{split}
        \label{eq:capacitor-voltage-switch-on-step-down-converter}
    \end{equation}
    Here, $u_\mathrm{C}(k T_\mathrm{s})$ is the initial capacitor voltage at the beginning of the switch-on period.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    At the end of the switch-on period, the capacitor voltage is given by
    \begin{equation}
        \begin{split}
            u_\mathrm{C}(k T_\mathrm{s} + T_\mathrm{on}) &= u_\mathrm{C}(k T_\mathrm{s}) -\frac{\Delta i_\mathrm{L}}{2 C}(k T_\mathrm{s} + T_\mathrm{on}- kT_\mathrm{s}) \\&+ \frac{U_1-U_2}{LC} \left[(k T_\mathrm{s} + T_\mathrm{on})(\frac{k T_\mathrm{s} + T_\mathrm{on}}{2}-kT_\mathrm{s}) + \frac{(kT_\mathrm{s})^2}{2}\right]\\
            &= u_\mathrm{C}(k T_\mathrm{s}) - \frac{\Delta i_\mathrm{L}}{2 C}T_\mathrm{on} +\frac{\Delta i_\mathrm{L}}{2 C}T_\mathrm{on}\\
            &= u_\mathrm{C}(k T_\mathrm{s}),
        \end{split}
        \label{eq:capacitor-voltage-switch-on-step-down-converter-end}
    \end{equation}
    i.e., the capacitor voltage at the end of the switch-on period is equal to the voltage at the beginning of the switch-on period. Since the capacitor voltage needs to be continuous over time, this also marks the initial condition for the switch-off period.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state analysis (cont.)}
    Inserting \eqref{eq:capacitor-current-switch-off-step-down-converter} in \eqref{eq:capacitor-voltage-differential-equation-step-down-converter} and integrating the differential equation delivers the \hl{capacitor voltage during the switch-off period} as
    \begin{equation}
        \begin{split}
            u_\mathrm{C}(t) &= u_\mathrm{C}(k T_\mathrm{s}+T_\mathrm{on}) + \frac{1}{C}\int_{k T_\mathrm{s}+T_\mathrm{on}}^t i_\mathrm{C}(\tau) \mathrm{d}\tau, \quad t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}] \\
            &= u_\mathrm{C}(k T_\mathrm{s}) + \frac{1}{C}\int_{k T_\mathrm{s}+T_\mathrm{on}}^t \frac{\Delta i_\mathrm{L}}{2} - \frac{U_2}{L} (\tau - k T_\mathrm{s} - T_\mathrm{on}) \mathrm{d}\tau\\
            & = u_\mathrm{C}(k T_\mathrm{s}) + \left[\frac{\Delta i_\mathrm{L}}{2}\tau - \frac{U_2}{L} (\frac{1}{2}\tau^2 - k T_\mathrm{s}\tau - T_\mathrm{on}\tau) \right]_{k T_\mathrm{s}+T_\mathrm{on}}^t\\
            &= u_\mathrm{C}(k T_\mathrm{s}) + \frac{\Delta i_\mathrm{L}}{2 C}(t - k T_\mathrm{s} - T_\mathrm{on}) - \frac{U_2}{LC} \left[t(\frac{t}{2} - k T_\mathrm{s} - T_\mathrm{on}) + \frac{(k T_\mathrm{s} + T_\mathrm{on})^2}{2}\right].
        \end{split}
        \label{eq:capacitor-voltage-switch-off-step-down-converter}
    \end{equation}
    Here, $u_\mathrm{C}(k T_\mathrm{s}+T_\mathrm{on})=u_\mathrm{C}(k T_\mathrm{s})$ is the initial capacitor voltage at the beginning of both the switch-on and switch-off period.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state time-domain behavior %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Steady-state time-domain behavior}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.6} % duty cycle

            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({0 + #1},1) ({\D + #1},1) ({\D + #1},0) ({1 + #1},0) ({1 + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \D) -- (axis cs:4, \D); % dashed line at U_2 (average)
                    \node[above, inner sep = 2pt, anchor = south] at (axis cs:1-\D/4-0.04, \D+0.05) {$u(t)$}; % label U_2
                    \draw [thick,<->]  (0,0.42) -- node[below]{$T_\mathrm{on}$}(\D, 0.42); % T_on 
                    \draw [thick,<->]  (\D,0.42) -- node[below]{$T_\mathrm{off}$}(1.0, 0.42); % T_off
                    \draw [thick,<->]  (0.0,-0.2) -- node[below]{$T_\mathrm{s}$}(1.0, -0.2); % T_s
                    \tikzmath{
                        real \D, \u0, \Ts, \Ton, \Toff, \ripple;
                        \D = 0.6;
                        \Ts = 1;
                        \Ton = \D;
                        \Toff = 1-\D;
                        \ripple = 0.75;
                        \u0 = \D - \ripple / 6 * \Ts*(1-2*\D);
                    } 
                    \pgfplotsinvokeforeach{0,...,3}{
                            \edef\AddPlot{\noexpand\addplot[signalblue, thick, domain=#1:#1+\Ton, samples=50] {\u0 - \ripple*(x - #1 * \Ts) + 2 * \ripple / \Ton * (x^2/2 - #1 * \Ts *x + (#1 * \Ts)^2/2)};}
                            \AddPlot
                            \edef\AddPlot{\noexpand\addplot[signalblue, thick, domain=#1+\Ton:#1+\Ts, samples=50] {\u0 + \ripple*(x - #1 * \Ts - \Ton) - 2 * \ripple / \Toff * (x^2/2 - #1 * \Ts *x - x*\Ton + (#1 * \Ts + \Ton)^2/2)};}
                            \AddPlot
                        }
                    \draw[dashed, thin] (axis cs:0, \u0+\ripple*\Toff/4) -- (axis cs:4, \u0+\ripple*\Toff/4);
                    \draw[dashed, thin] (axis cs:0, \u0-\ripple*\Ton/4) -- (axis cs:4, \u0-\ripple*\Ton/4);
                    \draw[thin, -{Latex[length=2mm]}] (axis cs:1+\D/2, \u0+\ripple*\Toff/4+0.25) -- (axis cs:1+\D/2, \u0+\ripple*\Toff/4);
                    \draw[thin, -{Latex[length=2mm]}] (axis cs:1+\D/2, \u0-\ripple*\Ton/4-0.25) -- (axis cs:1+\D/2, \u0-\ripple*\Ton/4);
                    \node[above, inner sep = 2pt, anchor = west] at (axis cs:1+\D/2, \u0-\ripple*\Ton/4-0.2) {$\Delta u_\mathrm{C}$}; 
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:1.5+\D/2,\D) -- node[right=1mm, fill=white, inner sep = 1pt, anchor = north]{$\overline{u}_\mathrm{c}$}(axis cs:1.5+\D/2,0.1);
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:2,\D/3) -- node[right=1mm, fill=white, inner sep = 1pt, anchor = west]{$u_\mathrm{s}(t)$}(axis cs:2+\D/2,\D/3);


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, $\overline{i}_\mathrm{L}$, }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5) -- (axis cs:4,0.5); % dashed line at average current
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:\D+0.02,0.75) -- node[right=1mm, fill=white, inner sep = 1pt]{$\max\{i_\mathrm{L}\}$}(axis cs:\D+0.3,0.9); % indicate max current
                    \draw[-{Latex[length=2mm]}, thin] (axis cs:0.75,0.2) node[right=1mm, fill=white, inner sep = 1pt, anchor = east]{$\min\{i_\mathrm{L}\}$} -- (axis cs:1-0.02,0.25); % indicate min current
                    \draw[thin] (axis cs:2+\D/4,0.25+0.125) -- (axis cs:2+\D/4,0.75-0.125) -- (axis cs:2+\D*3/4,0.75-0.125); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south, xshift = -4mm] at (axis cs:2+\D/2, 0.75-0.125) {$\nicefrac{(U_1-U_2)}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2.25+3*\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.75-0.125) -- (axis cs:2.75+\D/4,0.25+0.125); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south, xshift = 2mm] at (axis cs:2.5+\D/2, 0.75-0.125) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.25) ({\D + #1},0.75) ({\D + #1},0) ({1 + #1},0) ({1 + #1},0.25)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5 * \D) -- (axis cs:4, 0.5 * \D); % dashed line at average current
                    \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\D/2, 0.5 * \D) {$\overline{i}_1$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output voltage ripple %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Output voltage ripple}
    Utilizing \eqref{eq:capacitor-voltage-switch-on-step-down-converter} and calculating the derivative with respect to $t$ we obtain
    \begin{equation}
        \begin{split}
            \frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} &= -\frac{\Delta i_\mathrm{L}}{2 C} + \frac{U_1-U_2}{LC} t\\
                                                          &= -\frac{U_1-U_2}{LC}\frac{T_\mathrm{on}}{2} +\frac{U_1-U_2}{LC} (t-kT_\mathrm{s}), \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}].
        \end{split}
    \end{equation}
    Setting the derivative to zero, we find the time $t_\mathrm{min}$ at which the minimum voltage occurs as
    \begin{equation}
        \frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} = 0 \quad \Rightarrow \quad t_\mathrm{min} = \frac{T_\mathrm{on}}{2} + kT_\mathrm{s}
        \label{eq:time-min-voltage-ripple-step-down-converter}
    \end{equation}
    since the second derivative is positive. Inserting \eqref{eq:time-min-voltage-ripple-step-down-converter} in \eqref{eq:capacitor-voltage-switch-on-step-down-converter} reveals the minimum voltage as
    \begin{equation}
        u_\mathrm{C}(t_\mathrm{min}) = u_\mathrm{C}(kT_\mathrm{s}) - \frac{U_1-U_2}{LC} \frac{T_\mathrm{on}^2}{8} = u_\mathrm{C}(kT_\mathrm{s}) - \Delta i_\mathrm{L}\frac{T_\mathrm{on}}{8C}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output voltage ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Output voltage ripple (cont.)}
    Likewise, calculating the derivative of \eqref{eq:capacitor-voltage-switch-off-step-down-converter} leads to
    \begin{equation}
        \begin{split}
            \frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} &= \frac{\Delta i_\mathrm{L}}{2 C} - \frac{U_2}{LC} (t-kT_\mathrm{s} - T_\mathrm{on})\\
                                                          &= \frac{U_1-U_2}{LC}\frac{T_\mathrm{on}}{2} -\frac{U_2}{LC} (t-kT_\mathrm{s} - T_\mathrm{on}), \quad t\in [k T_\mathrm{s} + T_\mathrm{on}, (k+1) T_\mathrm{s}].
        \end{split}
    \end{equation}
    Setting the derivative to zero, we find the time $t_\mathrm{max}$ at which the maximum voltage occurs as
    \begin{equation}
        \frac{\mathrm{d}u_\mathrm{C}(t)}{\mathrm{d}t} = 0 \quad \Rightarrow \quad t_\mathrm{max} = \frac{T_\mathrm{off}}{2} + T_\mathrm{on} + k T_\mathrm{s}
    \end{equation}
    since the second derivative is negative. The maximum voltage is then given by
    \begin{equation}
        u_\mathrm{C}(t_\mathrm{max}) = u_\mathrm{C}(kT_\mathrm{s}) + \Delta i_\mathrm{L}\frac{T_\mathrm{off}}{8C}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output voltage ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Output voltage ripple (cont.)}
    The \hl{voltage ripple} is then given by
    \begin{equation}
        \begin{split}
            \Delta u_\mathrm{C} &= u_\mathrm{C}(t_\mathrm{max}) - u_\mathrm{C}(t_\mathrm{min}) = \Delta i_\mathrm{L}\frac{T_\mathrm{off}}{8C} + \Delta i_\mathrm{L}\frac{T_\mathrm{on}}{8C}\\
                                &= \Delta i_\mathrm{L}\frac{T_\mathrm{s}}{8C} = \frac{D(1-D)T_\mathrm{s}^2U_\mathrm{in}}{8LC}.
        \end{split}
    \end{equation}
    The voltage ripple is proportionally depending on the inductor current ripple. Hence, the maximum voltage ripple occurs at the same characteristic duty cycle $D_\mathrm{max}$ and is given by
    \begin{equation}
        D_\mathrm{max}=\frac{1}{2} \quad \Rightarrow \quad \Delta u_\mathrm{C, max} =  \frac{T_\mathrm{s}^2U_\mathrm{in}}{32 LC}.
    \end{equation}
    Hence, we can rewrite the voltage ripple as
    \begin{equation}
        \Delta u_\mathrm{C} =   4D(1-D)\Delta u_\mathrm{C, max}.
    \end{equation}
    The voltage ripple is associated with additional losses in the output capacitor and the load, that is, an important stress parameter.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Output voltage ripple: alternative via charge balance %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Output voltage ripple: alternative via charge balance}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            If one is not interested in the specific signal shape $u_\mathrm{C}(t)$, the output voltage ripple can be derived from the charge balance over half a period (cf. \figref{fig:step-down-converter-voltage-ripple-charge-balance}):
            \begin{equation}
                \Delta Q = \frac{1}{2}\frac{\Delta i_\mathrm{L}}{2}\frac{T_\mathrm{s}}{2}.
            \end{equation}
        From $$\frac{1}{C}\int i_\mathrm{C}(t)\mathrm{d}t = u_\mathrm{C}(t) + u_\mathrm{C}(0)$$
        we receive
        \begin{equation}
                \Delta u_\mathrm{C} = \frac{\Delta Q}{C} = \frac{\Delta i_\mathrm{L}T_\mathrm{s}}{8C}.
        \end{equation}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \begin{tikzpicture}

                    \tikzmath{
                        real \D, \u0, \Ts, \Ton, \Toff, \ripple;
                        \D = 0.6;
                        \Ts = 1;
                        \Ton = \D;
                        \Toff = 1-\D;
                        \ripple = 1.2;
                        \u0 = \D - \ripple / 6 * \Ts*(1-2*\D);
                        } 

                    \begin{groupplot}[group style={group size=1 by 2, xticklabels at = edge bottom}, height=0.4\textheight, width=0.9\textwidth, xmin=-0.1, xmax=1.1, grid,clip = false, ymin = 0, ymax =1.1]

                        % Capacitor voltage
                        \nextgroupplot[ylabel = {$u_\mathrm{C}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                            % Half cycle for t<0
                            \addplot[signalblue, thick, domain=-0.1:-1+\Ts, samples=15] {\u0 + \ripple*(x - -1 * \Ts - \Ton) - 2 * \ripple / \Toff * (x^2/2 - -1 * \Ts *x - x*\Ton + (-1 * \Ts + \Ton)^2/2)};
                            % Half cycle for 0<t<Ton
                            \addplot[signalblue, thick, domain=0:\Ton, samples=50] {\u0 - \ripple*(x) + 2 * \ripple / \Ton * (x^2/2)};
                            % Half cycle for Ton<t<Ts
                            \addplot[signalblue, thick, domain=\Ton:\Ts, samples=50] {\u0 + \ripple*(x - \Ton) - 2 * \ripple / \Toff * (x^2/2 - x*\Ton + (\Ton)^2/2)};
                            % Half cycle for t>Ts
                            \addplot[signalblue, thick, domain=1:1.1, samples=15] {\u0 - \ripple*(x - 1 * \Ts) + 2 * \ripple / \Ton * (x^2/2 - 1 * \Ts *x + (1 * \Ts)^2/2)};

                            % Dashed lines for voltage ripple (upper limit)
                            \draw[dashed, thin] (axis cs:-0.1, \u0+\ripple*\Toff/4) -- (axis cs:1.1, \u0+\ripple*\Toff/4);
                            % Dashed lines for voltage ripple (lower limit)
                            \draw[dashed, thin] (axis cs:-0.1, \u0-\ripple*\Ton/4) -- (axis cs:1.1, \u0-\ripple*\Ton/4);
                            % Voltage ripple arrow indication (top)
                            \draw[thin, -{Latex[length=2mm]}] (axis cs:0, \u0+\ripple*\Toff/4+0.25) -- (axis cs:0, \u0+\ripple*\Toff/4);
                            % Voltage ripple arrow indication (buttom)
                            \draw[thin, -{Latex[length=2mm]}] (axis cs:0, \u0-\ripple*\Ton/4-0.25) -- (axis cs:0, \u0-\ripple*\Ton/4);
                            % Voltage ripple label
                            \node[above, inner sep = 2pt, anchor = west] at (axis cs:0, \u0-\ripple*\Ton/4-0.2) {$\Delta u_\mathrm{C}$}; 
                            \coordinate (a) at (\Ton/2,\u0-\ripple*\Ton/4); %coordinate for left vertical grouplot line
                            \coordinate (b) at (\Ton+\Toff/2,\u0+\ripple*\Ton/4); %coordinate for right vertical grouplot line


                        % Capacitor current
                        \nextgroupplot[ylabel = {$i_\mathrm{C}(t)$}, xlabel={$t/T_\mathrm{s}$}, ymin=-0.3, ymax=0.3, ytick = {-0.2, 0, 0.2}, yticklabels = {$\nicefrac{-\Delta i_\mathrm{L}}{2}$, 0,$\nicefrac{\Delta i_\mathrm{L}}{2}$}]
                            % Current signal
                            \addplot[signalred, thick] coordinates {(-0.1,-0.2+0.4/6) (0,-0.2) (\D,0.2) (1, -0.2) (1.1,-0.2+0.4/6)};
                            % Current ripple arrow indication
                            \draw [thin, <->]  (0,-0.2) -- (0, 0.2);
                            % Current ripple label
                            \node[inner sep = 1pt, anchor = west, fill = white] at (axis cs:0.025, 0.1) {$\Delta i_\mathrm{L}$};
                            % Positive \Delta Q charge area indication
                            \addplot[signalred, fill=shadecolor, fill opacity=0.3] coordinates {(\D/2,0) (\D,0.2) (0.5+\D/2,0)};
                            % \Delta Q charge area indication arrow
                            \draw[thin, -{Latex[length=2mm]}] (axis cs:\D-0.1,-0.1) -- (axis cs:\D,0.125);
                            % \Delta Q charge area indication label
                            \node[inner sep = 1pt, anchor = east, fill = white] at (axis cs:\D-0.1, -0.2) {$\Delta Q$};
                            % \Delta Q time indication
                            \draw [<->]  (\Ton -\Ton/2,\pgfkeysvalueof{/pgfplots/ymax}+0.1) -- node[above]{$\nicefrac{T_\mathrm{s}}{2}$}(\Ton +\Toff/2, \pgfkeysvalueof{/pgfplots/ymax}+0.1);
                            \coordinate (c) at (\Ton/2,0); %coordinate for left vertical grouplot line
                            \coordinate (d) at (\Ton+\Toff/2,0);  %coordinate for right vertical grouplot line
                    \end{groupplot}
                    \draw [dashed] (a) -- (c);
                    \draw [dashed] (b) -- (d);
                \end{tikzpicture}
                \caption{Voltage ripple derivation via charge balance}
                \label{fig:step-down-converter-voltage-ripple-charge-balance}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Average and initial capacitor voltage %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Average and initial capacitor voltage}
    The initial voltage $u_\mathrm{C}(k T_\mathrm{s})$ at the beginning of a period is still unknown. We can derive it from the capacitor's average voltage over one period. For simplicity, we consider $k=0$:
    \begin{equation}
            \overline{u}_\mathrm{c} = \frac{1}{T_\mathrm{s}}\int_0^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t = \frac{1}{T_\mathrm{s}}\left(\int_0^{T_\mathrm{on}} u_\mathrm{C}(t) \mathrm{d}t + \int_{T_\mathrm{on}}^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t\right)  \stackrel{!}{=} D U_1.
            \label{eq:capacitor-voltage-average-step-down-converter}
    \end{equation}
    Inserting \eqref{eq:capacitor-voltage-switch-on-step-down-converter} we receive for the first part
    \begin{equation}
        \begin{split}
            \int_0^{T_\mathrm{on}} u_\mathrm{C}(t) \mathrm{d}t &= \left[u_\mathrm{C}(0)t + \frac{\Delta i_\mathrm{L}}{2C}\frac{t^2}{2} + \frac{U_1-U_2}{LC}\frac{t^3}{6} \right]_{0}^{T_\mathrm{on}}=\ldots\\ &= u_\mathrm{C}(0) T_\mathrm{on} - \frac{\Delta i_\mathrm{L}}{C}\frac{T_\mathrm{on}^2}{12}. 
        \end{split}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Average and initial capacitor voltage (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Average and initial capacitor voltage (cont.)}
     Inserting \eqref{eq:capacitor-voltage-switch-off-step-down-converter} into the second part of \eqref{eq:capacitor-voltage-average-step-down-converter} delivers
    \begin{equation}
        \begin{split}
            \int_{T_\mathrm{on}}^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t &= \left[u_\mathrm{C}(0)t +  \frac{\Delta i_\mathrm{L}}{2C}(\frac{t^2}{2} - T_\mathrm{on}t) - \frac{U_2}{LC}(\frac{t^3}{6} - T_\mathrm{on}\frac{t^2}{2} + \frac{T_\mathrm{on}^2}{2}t)  \right]_{T_\mathrm{on}}^{T_\mathrm{s}} =\ldots \\ &= u_\mathrm{C}(0) T_\mathrm{off} + \frac{\Delta i_\mathrm{L}}{C}\frac{T_\mathrm{off}^2}{12}.
        \end{split}
    \end{equation}
    Combining both parts results in
    \begin{equation}
    \begin{split}
        \overline{u}_\mathrm{c} &= \frac{1}{T_\mathrm{s}}\left(u_\mathrm{C}(0)T_\mathrm{s} + \frac{\Delta i_\mathrm{L}}{C}\frac{T_\mathrm{off}^2-T_\mathrm{on}^2}{12} \right)\\
                                & = u_\mathrm{C}(0) + \frac{\Delta i_\mathrm{L}}{12C}T_\mathrm{s}(1-2D) \stackrel{!}{=} D U_1.
        \end{split}
    \end{equation}
    Solving for $u_\mathrm{C}(0)$ we receive the \hl{initial capacitor voltage} as
    \begin{equation}
        u_\mathrm{C}(0) = D U_1 - \frac{\Delta i_\mathrm{L}}{12C}T_\mathrm{s}(1-2D).
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter: circuit realization and operation modes %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step-down converter: circuit realization and operation modes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Circuit realization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Circuit realization}
    \begin{itemize}
        \item The ideal (mechanical) switch cannot be operated with high frequency in practice.  
        \item It must be replaced with \hl{semiconductor devices} to allow for a practical realization.
        \item In \figref{fig:step-down-converter-realization-1Q} the simplest realization is shown utilizing one transistor and one diode. 
        \item However, this configuration can only provide positive voltages and currents.
        \item Hence, the converter can operate in the \hl{first quadrant} only.
    \end{itemize}
    \begin{figure}
        \begin{circuitikz}[]                
            \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
            to ++(-6,0)
            to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
            (-6,2) to  [short, i=$i_1(t)$] ++(1.0,0);   
            \draw (-5.375,2) node [npn, anchor=C, rotate=90](npn1) {}
            (npn1.E) to  [short] ++(0.5,0) coordinate (S)
            to [short] ++(0.5,0)
            to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(1.8,0)
            to [short, -o, i=$i_2(t)$] (0,2);
            \draw (S)--++(0,-2) to [diode, *-*, l=$D$, v_<=$u_\mathrm{s}(t)$, voltage = straight] ++(0,2);
            %\draw  [node]{$T$} at (npn1.B)++(0,-0.5);
            \draw let \p1 = (npn1.B) in node[anchor=north] at (\x1,\y1) {$T$};
        \end{circuitikz}
        \caption{Step-down converter with real components (single quadrant type)}
        \label{fig:step-down-converter-realization-1Q}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Discontinous conduction mode (DCM) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Discontinous conduction mode (DCM)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                real \D,\Ts, \Ton, \Toff1, \Toff2, \ripple, \relrip, \currentavg;
                \Ts = 1;
                \Ton = 0.5;
                \D = \Ton/\Ts;
                \ripple = 0.65;
                \relrip = 1/3;
                \Uout = 1/(1+(\relrip/(2*\D^2)));
                \Toff1 = (1-\Uout)/\Uout*\Ton;
                \Toff2 = \Ts - \Ton - \Toff1;
                \currentavg = \ripple/2*(\Ton+\Toff1)/\Ts;
            }
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},1) ({\Ton + #1},1) ({\Ton + #1},0) ({\Ton+\Toff1 + #1},0) ({\Ton+\Toff1 + #1},\Uout) ({\Ts + #1},\Uout) ({\Ts + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \Uout) -- (axis cs:4, \Uout); % dashed line at U_2 (average)
                    \node[above, inner sep = 1pt, anchor = north, fill = white, yshift= -1pt] at (axis cs:1+\Ton/2, \Uout) {$U_2$}; % label U_2
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (0,-0.2) -- node[below]{$T_\mathrm{on}$}(\Ton, -0.2); % T_on 
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ton,-0.2) -- node[below]{$T'_\mathrm{off}$}(\Ton+\Toff1, -0.2); % T'_off
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ton+\Toff1,-0.2) -- node[below]{$T''_\mathrm{off}$}(\Ts, -0.2); % T''_off
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ts,-0.2) -- node[below]{$T_\mathrm{s}$}(2*\Ts, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0) ({\Ton + #1}, \ripple) ({\Ton+\Toff1 + #1},0) ({\Ts + #1},0)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,\currentavg) -- (axis cs:4,\currentavg); % dashed line at average current
                    \node[above, inner sep = 1pt, anchor = south, fill = white, yshift= 1pt] at (axis cs:2-\Toff2/2, \currentavg) {$\overline{i}_\mathrm{L}$}; % label \overline{i}_\mathrm{L}
                    \draw[thin] (axis cs:1+\Ton/2,\ripple/2) -- (axis cs:1+\Ton/2,\ripple*5/6) -- (axis cs:1+5*\Ton/6,\ripple*5/6); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south east] at (axis cs:1+\Ton*4/6, \ripple-1/6) {$\nicefrac{(U_1-U_2)}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2+\Ton+\Toff1/6,\ripple*5/6) -- (axis cs:2+\Ton+\Toff1/2,\ripple*5/6) -- (axis cs:2+\Ton+\Toff1/2,\ripple/2); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south west, xshift = -2mm] at (axis cs:2+\Ton+\Toff1/2, \ripple-1/6) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                \pgfplotsinvokeforeach{0,...,3}{
                    \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0) ({\Ton + #1},\ripple) ({\Ton + #1},0) ({\Ts + #1},0)};}
                    \AddPlot
                }
                \draw[signalred, thick, dashed] (axis cs:0,\ripple/2*\Ton/\Ts) -- (axis cs:4, \ripple/2*\Ton/\Ts); % dashed line at average current
                \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\Ton/2, \ripple/2*\Ton/\Ts) {$\overline{i}_1$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Switch states DCM}
    In contrast to the previous \hl{continuous conduction mode (CCM)}, the converter traverses three states in the \hl{discontinuous conduction mode (DCM)}:
    \begin{itemize}
            \item Transistor on-time:  $T_\mathrm{on}=DT_\mathrm{s}$,
            \item Transistor off-time (conducting diode): $T'_\mathrm{off}=D'T_\mathrm{s}$,
            \item Transistor off-time (no conduction):  $T''_\mathrm{off}=T_\mathrm{s}-T_\mathrm{on}-T'_\mathrm{off}$.
    \end{itemize}
        \begin{figure}
            \centering	
            \begin{subfigure}{0.33\textwidth}
                \centering
                \hspace{-1.4cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1(t)=i_\mathrm{L}(t)}$] ++(2,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                    \draw (-4,2) to [open, v = ${\hspace{2.2cm}U_\mathrm{s}=U_1}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-on time $T_\mathrm{on}$}
            \end{subfigure}%
            \begin{subfigure}{0.33\textwidth}
                \centering
                \hspace{-0.6cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                    (-3.75,0) to [short, *-] ++(0,2)
                    to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=$i_2(t)$] (0,2);
                    \draw (-3.4,2) to [open, v = ${\hspace{1.8cm}U_\mathrm{s}=0}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time $T'_\mathrm{off}$}
            \end{subfigure}
            \begin{subfigure}{0.33\textwidth}
                \centering
                \hspace{-1.3cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}$] ++(0.75,0)
                    (-3.75,0) to [open] ++(0,2)
                    to [short] ++(0.5,0)
                    to [inductor, l=$L$] ++(2,0)
                    to [short, i=${i_2=0}$] (0,2);
                    \draw (-3.75,2) to [open, v = ${\hspace{2.3cm}U_\mathrm{s}=U_2}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time $T''_\mathrm{off}$}
            \end{subfigure}
        \caption{Switch states of the step-down converter including DCM} 
        \label{fig:step-down-converter-switch-states-DCM}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{DCM operation characteristics}
    The operation in CCM and DCM can be distinguished by the inductor current ripple
    \begin{equation}
        \overline{i}_\mathrm{L}=\overline{i}_2\begin{cases}
            \geq \frac{\Delta i_\mathrm{L}}{2}= 2D(1-D)\Delta i_\mathrm{L,max}: & \text{CCM},\\
            < \frac{\Delta i_\mathrm{L}}{2}= 2D(1-D)\Delta i_\mathrm{L,max}: & \text{DCM}
        \end{cases}
    \end{equation}
    with $$\Delta i_\mathrm{L,max} = \frac{U_1T_\mathrm{s}}{4L}.$$
    Hence, the operation mode directly depends on the duty cycle $D$ and average load current $\overline{i}_2$, that is, it can change during runtime. While we have already discussed the operation in CCM, we will now focus on the operation in DCM. Here, it must be noted that
    $$ U_2 \neq U_1 D \quad \mbox{(DCM operation)}$$
    applies due to the non-conducting diode during  $T''_\mathrm{off}$.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DCM operation characteristics (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{DCM operation characteristics (cont.)}
    To find the input-to-output voltage ratio in DCM, we can utilize the current ripple balance:
    \begin{equation}
        \begin{alignedat}{2}
            \Delta i_\mathrm{L} &= \frac{U_1-U_2}{L}T_\mathrm{on} = i_\mathrm{L} = \frac{U_1-U_2}{L}DT_\mathrm{s} \quad &&\mbox{(rising edge)},\\
            \Delta i_\mathrm{L} &= \frac{U_2}{L}T'_\mathrm{off} = \frac{U_2}{L}D'T_\mathrm{s} \quad &&\mbox{(falling edge)}.
        \end{alignedat}
    \end{equation}
    Solving for $D'$ results in
    \begin{equation}
        D' = \frac{L\Delta i_\mathrm{L}}{U_2T_\mathrm{s}} = \frac{U_1-U_2}{U_2}D = \left(\frac{U_1}{U_2}-1\right)D.
        \label{eq:Dprime-DCM}
    \end{equation}
    The average load current is
    \begin{equation}
        \overline{i}_2 = \overline{i}_\mathrm{L} = \frac{1}{2}\Delta i_\mathrm{L}\frac{T_\mathrm{on}+T'_\mathrm{off}}{T_\mathrm{s}} = \frac{1}{2}\Delta i_\mathrm{L}(D+D')
        \label{eq:average-load-current-DCM}
    \end{equation}
    which is derived from the area under the triangular-shaped current during $T_\mathrm{on}$ and $T'_\mathrm{off}$. 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DCM operation characteristics (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{DCM operation characteristics (cont.)}
    Inserting \eqref{eq:Dprime-DCM} into \eqref{eq:average-load-current-DCM} yields
    \begin{equation}
        \begin{split}
            \overline{i}_2 &= \frac{1}{2}\Delta i_\mathrm{L}D\frac{U_1}{U_2} = \frac{U_1-U_2}{2L}DT_\mathrm{s}D\frac{U_1}{U_2}\\ &= 2D^2\left(\frac{U_1}{U_2}-1\right)\Delta i_\mathrm{L,max}.
        \end{split}
        \label{eq:average-load-current-DCM-2}
    \end{equation}
    Solving for the \hl{DCM input-to-output voltage ratio} results in
    \begin{equation}
        \frac{U_2}{U_1} = \frac{1}{1+\frac{\overline{i}_2}{2\Delta i_\mathrm{L,max}D^2}}.
        \label{eq:voltage-ratio-DCM}
    \end{equation}
    Since $\Delta i_\mathrm{L,max}$ also depends on $U_1$, cf.  \eqref{eq:current-ripple-max-simple-step-down}, the relation \eqref{eq:voltage-ratio-DCM} only holds for a given $U_1$. Alternatively, we can utilize \eqref{eq:average-load-current-DCM-2} and solve for $U_2$ to receive
    \begin{equation}
        U_2 = \frac{D^2T_\mathrm{s}U_1^2}{D^2T_\mathrm{s}U_1+2L\overline{i}_2}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter load curves %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-down converter load curves}
    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                xlabel={$\overline{i}_2/\Delta i_\mathrm{L,max}$},
                ylabel={$U_2/U_1$},
                axis lines=left,
                thick,
                smooth,
                no markers,
                axis equal image,
                height = 0.8\textheight,
                grid,
                ymin=0, ymax=1,
                xmin=0, xmax=1,
                clip = false
                ]
                \foreach \D in {0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0}{
                    \addplot[signalblue, domain=2*\D*(1-\D):1, samples=10] {\D}; %CCM
                    \addplot[signalblue, domain=0.001:2*\D*(1-\D), samples=30] {1/(1+x/(2*\D^2))}; %DCM
                }
                \foreach \D in {0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0}{
                    \edef\temp{\noexpand\node[inner sep = 1pt, align = center, fill = white] at (axis cs:0.8, \D) {$D=\D$};} % Duty-cycle labels
                    \temp
                }
                \addplot[signalred, domain = 0.001:0.5, samples=30, thick, name path = upper] {1/2 + (1/4 - x/2)^(0.5)}; % Upper boundary area
                \addplot[signalred, domain = 0.001:0.5, samples=30, thick, name path = lower] {1/2 - (1/4 - x/2)^(0.5)}; % Lower boundary area
                \addplot[shadecolor, opacity=0.3] fill between[of=upper and lower];
                \node[inner sep = 1pt, anchor = west, fill = white, font=\footnotesize] at (axis cs:0.295, 0.15) {CCM}; % CCM label
                \node[inner sep = 1pt, anchor = center, font=\footnotesize] at (axis cs:0.185, 0.175) {DCM}; % DCM label
            \end{axis}
        \end{tikzpicture}
        \caption{Step-down converter load curves for CCM and DCM}
        \label{fig:step-down-converter-load-curves}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Boundary conduction mode (BCM) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Boundary conduction mode (BCM)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                real \D,\Ts, \Ton, \Toff1, \Toff2, \ripple, \relrip, \currentavg;
                \Ts = 1;
                \Ton = 0.7;
                \D = \Ton/\Ts;
                \ripple = 0.65;
                \relrip = 1/2; % average load current devided by ripple current
                \Uout = \D;
                \Toff1 = \Ts - \Ton;
                \Toff2 = \Ts - \Ton - \Toff1;
                \currentavg = \ripple/2*(\Ton+\Toff1)/\Ts;
            }
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_1$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},1) ({\Ton + #1},1) ({\Ton + #1},0) ({\Ton+\Toff1 + #1},0) ({\Ton+\Toff1 + #1},\Uout) ({\Ts + #1},\Uout) ({\Ts + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \Uout) -- (axis cs:4, \Uout); % dashed line at U_2 (average)
                    \node[above, inner sep = 1pt, anchor = north, fill = white, yshift= -1pt] at (axis cs:1+\Ton/2, \Uout) {$U_2$}; % label U_2
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (0,-0.2) -- node[below]{$T_\mathrm{on}$}(\Ton, -0.2); % T_on 
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ton,-0.2) -- node[below]{$T_\mathrm{off}$}(\Ton+\Toff1, -0.2); % T'_off
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ts,-0.2) -- node[below]{$T_\mathrm{s}$}(2*\Ts, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0) ({\Ton + #1}, \ripple) ({\Ton+\Toff1 + #1},0) ({\Ts + #1},0)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,\currentavg) -- (axis cs:4,\currentavg); % dashed line at average current
                    \node[above, inner sep = 1pt, anchor = south, fill = white, yshift= 1pt] at (axis cs:2-\Toff2/2, \currentavg) {$\overline{i}_\mathrm{L}$}; % label \overline{i}_\mathrm{L}
                    \draw[thin] (axis cs:1+\Ton/2,\ripple/2) -- (axis cs:1+\Ton/2,\ripple*5/6) -- (axis cs:1+5*\Ton/6,\ripple*5/6); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south east] at (axis cs:1+\Ton*4/6, \ripple-1/6) {$\nicefrac{(U_1-U_2)}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2+\Ton+\Toff1/6,\ripple*5/6) -- (axis cs:2+\Ton+\Toff1/2,\ripple*5/6) -- (axis cs:2+\Ton+\Toff1/2,\ripple/2); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south west, xshift = -2mm] at (axis cs:2+\Ton+\Toff1/2, \ripple-1/6) {$\nicefrac{-U_2}{L}$}; % label negative current slope
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                \pgfplotsinvokeforeach{0,...,3}{
                    \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0) ({\Ton + #1},\ripple) ({\Ton + #1},0) ({\Ts + #1},0)};}
                    \AddPlot
                }
                \draw[signalred, thick, dashed] (axis cs:0,\ripple/2*\Ton/\Ts) -- (axis cs:4, \ripple/2*\Ton/\Ts); % dashed line at average current
                \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\Ton/2, \ripple/2*\Ton/\Ts) {$\overline{i}_1$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{BCM operation characteristics}
    In the \hl{boundary conduction mode (BCM)}, the average inductor current load is exactly half of the current ripple, that is, 
    \begin{equation}
        \overline{i}_\mathrm{L}=\overline{i}_2=\frac{\Delta i_\mathrm{L}}{2}= 2D(1-D)\Delta i_\mathrm{L,max}.
        \label{eq:average-load-current-BCM-step-down}
    \end{equation}
    \vspace{-0.5cm}
    \begin{itemize}
        \item Diode current becomes zero and then the transistor turns on again.
        \begin{itemize}
            \item The diode is not hard turned-off but its current naturally decays to zero.
            \item Also known as \hl{zero current switching (ZCS)} or generally \hl{soft switching}.
        \end{itemize}
        \item Requires adaptive switching frequency control if load changes. From \eqref{eq:current-ripple-simple-step-down} and \eqref{eq:average-load-current-BCM-step-down} the BCM switching frequency results in 
    \end{itemize}
    \begin{equation}
        f_\mathrm{s} = \frac{1}{T_\mathrm{s}} = \frac{D(1-2)U_1}{L\Delta i_\mathrm{L} } = \frac{D(1-2)U_1}{2L \overline{i}_2 }.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Motivation for BCM: diode reverse recovery %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Motivation for BCM: diode reverse recovery}
     % tikz plot which shows a diode and its charge distributions in forward and and backward direction
    \begin{figure}
        \begin{tikzpicture}

            % --- First Subplot: Forward Bias Mode ---
            \begin{scope}[shift={(-3,0)}, scale=0.55]  % Shift to create space for second subplot
            
            % N region (right side)
            \draw[fill=signalblue!20] (0,0) rectangle (3,4);
            \node at (1.5,4.3) {n};
            
            % P region (left side)
            \draw[fill=signalred!20] (-3,0) rectangle (0,4);
            \node at (-1.5,4.3) {p};
            
            % Diode symbol
            \draw[thick] (-4,2) -- (-3,2);  % Anode lead
            \draw[thick] (3,2) -- (4,2);    % Cathode lead
            
            % Forward bias current
            \draw[->, thick] (-5,2) -- (-3.5,2) node[above, midway] {$i_\mathrm{D}$};  
            
            \fill[signalred] (-1, 0.35) circle (0.3cm);
            \draw (-1, 0.35) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.15, 1) circle (0.3cm);
            \draw (-2.15, 1) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-0.6, 1.65) circle (0.3cm);
            \draw (-0.6, 1.65) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-1.8, 2.3) circle (0.3cm);
            \draw (-1.8, 2.3) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.4, 2.95) circle (0.3cm);
            \draw (-2.4, 2.95) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-1.25, 3.6) circle (0.3cm);
            \draw (-1.25, 3.6) node[white, scale=0.75] {\textbf{+}};
           
            \fill[signalblue] (1.8, 0.35) circle (0.3cm);
            \draw (1.8, 0.35) node[white] {\textbf{-}};
            \fill[signalblue] (2.35, 1) circle (0.3cm);
            \draw (2.35, 1) node[white] {\textbf{-}};
            \fill[signalblue] (0.9, 1.65) circle (0.3cm);
            \draw (0.9, 1.65) node[white] {\textbf{-}};
            \fill[signalblue] (2.6, 2.3) circle (0.3cm);
            \draw (2.6, 2.3) node[white] {\textbf{-}};
            \fill[signalblue] (1.4, 2.95) circle (0.3cm);
            \draw (1.4, 2.95) node[white] {\textbf{-}};
            \fill[signalblue] (0.65, 3.6) circle (0.3cm);
            \draw (0.65, 3.6) node[white] {\textbf{-}};
            \node at (0,-0.5) {Forward mode};
            \end{scope}
            
            % --- Second Subplot: Reverse Bias Mode (Reverse Recovery) ---
            \begin{scope}[shift={(3,0)}, scale=0.55]  % Shift second subplot to the right
            
            % N region (right side)
            \draw[fill=signalblue!20] (0,0) rectangle (3,4);
            \node at (1.5,4.3) {n};
            
            % P region (left side)
            \draw[fill=signalred!20] (-3,0) rectangle (0,4);
            \node at (-1.5,4.3) {p};
            
            % Diode symbol
            \draw[thick] (-4,2) -- (-3,2);  % Anode lead
            \draw[thick] (3,2) -- (4,2);    % Cathode lead
            
            % Forward bias current
            \draw[->, thick] (-5,2) -- (-3.5,2) node[above, midway] {${i_\mathrm{D}=0}$};  
            
            \fill[signalred] (-2.5, 0.35) circle (0.3cm);
            \draw (-2.5, 0.35) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 1) circle (0.3cm);
            \draw (-2.5, 1) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 1.65) circle (0.3cm);
            \draw (-2.5, 1.65) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 2.3) circle (0.3cm);
            \draw (-2.5, 2.3) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 2.95) circle (0.3cm);
            \draw (-2.5, 2.95) node[white, scale=0.75] {\textbf{+}};
            \fill[signalred] (-2.5, 3.6) circle (0.3cm);
            \draw (-2.5, 3.6) node[white, scale=0.75] {\textbf{+}};
           
            \fill[signalblue] (2.5, 0.35) circle (0.3cm);
            \draw (2.5, 0.35) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 1) circle (0.3cm);
            \draw (2.5, 1) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 1.65) circle (0.3cm);
            \draw (2.5, 1.65) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 2.3) circle (0.3cm);
            \draw (2.5, 2.3) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 2.95) circle (0.3cm);
            \draw (2.5, 2.95) node[white] {\textbf{-}};
            \fill[signalblue] (2.5, 3.6) circle (0.3cm);
            \draw (2.5, 3.6) node[white] {\textbf{-}};
            \node at (0,-0.5) {Blocking mode};
            \end{scope}

            % --- Third Subplot: Time-Domain Plot of Current ---
            \begin{scope}[shift={(-5.25,-4.25)}]  % Shift the third subplot to the right
                \centering
                \begin{axis}[
                    width=6cm,
                    height=5cm,
                    axis lines=middle,
                    xlabel={$t$},
                    ylabel={$i_\mathrm{D}(t)$},
                    xtick=\empty,
                    ytick=\empty,
                    xmin=1, xmax=6,
                    ymin=-3, ymax=5,
                    samples=200,
                    domain=0:8,
                    thick
                ]
                    % Plot of current showing reverse recovery
                    \addplot [shadecolor, opacity=0.3, fill=shadecolor, 
                            domain=3.01:4.99, samples=20
                        ] {(-3*exp(-(2*(\x-3))))} \closedcycle;
                    \addplot[red, thick] plot (\x, 
                        {(\x<=3)*(4 - 0.7*\x) + 
                        (\x>3 && \x<=5)*(-3*exp(-(2*(\x-3)))) + 
                        (\x>5)*0});
                    % label pointing towards shaded area with reverse recovery charge
                    \draw[<-, thin] (axis cs:3.15, -0.6) -- (axis cs:4.0, -1.5) node[anchor = west] {$Q_\mathrm{rr}$};

                    %annotation at switch off point "high current turn-off"
                    \draw[<-, thin] (axis cs:3, 2) -- (axis cs:3.5, 2.5) node[anchor = west, align=left, node font=\small] {High current\\turn-off};
    
                \end{axis}
                \end{scope}
                \begin{scope}[shift={(0.75,-4.25)}]  % Shift the third subplot to the right
                    \centering
                    \begin{axis}[
                        width=6cm,
                        height=5cm,
                        axis lines=middle,
                        xlabel={$t$},
                        ylabel={$i_\mathrm{D}(t)$},
                        xtick=\empty,
                        ytick=\empty,
                        xmin=1, xmax=6,
                        ymin=-3, ymax=5,
                        samples=200,
                        domain=0:8,
                        thick
                    ]
    
                        % Plot of current showing reverse recovery
                        \addplot [shadecolor, opacity=0.3, fill=shadecolor, 
                            domain=3.01:4.99, samples=20
                        ] {(-2*exp(-(2*(\x-3))))} \closedcycle;
                        \addplot[red, thick] plot (\x, 
                            {(\x<=3)*(3 - 0.7*\x) + 
                            (\x>3 && \x<=5)*(-2*exp(-(2*(\x-3)))) + 
                            (\x>5)*0});

                        % label pointing towards shaded area with reverse recovery charge
                        \draw[<-, thin] (axis cs:3.15, -0.5) -- (axis cs:4.0, -1.5) node[anchor = west] {$Q_\mathrm{rr}$};

                        %annotation at switch off point "high current turn-off"
                        \draw[<-, thin] (axis cs:3, 1) -- (axis cs:3.5, 1.5) node[anchor = west, align=left, node font=\small] {Low current\\turn-off};
        
                    \end{axis}
                    \end{scope}
            
            \end{tikzpicture}
        \caption{Qualitative and simplified representation of the reverse recovery effect}
        \label{fig:diode-reverse-recovery}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{BCM operation characteristics: comments}
   Advantages of BCM:
   \begin{itemize}
        \item Reduces the reverse recovery effect, that is, ZCS of the diode during turn on.
        \item Also allows also ZCS transistor turn on.  
   \end{itemize}
   \vspace{1em}
   Limitations of BCM:
    \begin{itemize}
          \item Transistor turn off and diode turn on cannot be soft switched due to topology constraints.
          \item Ripple current increases with load current: $ \Delta i_\mathrm{L} = 2=\overline{i}_2$.
          \begin{itemize}
            \item May negatively affects load.
            \item Increases conduction losses due to higher RMS current.
            \item High switching frequency required at low loads (switching losses).
          \end{itemize}
    \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Step-up converter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: overview and assumptions %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-up converter: overview and assumptions}
        We consider the following assumptions:
        \begin{itemize}
            \item The switch is ideal, that is, infinitely fast.
            \item The input voltage is constant: $u_1(t) = U_1$.
            \item The output voltage is constant: $u_2(t) = U_2$.
            \item The input voltage is lower than the output voltage: $U_1 < U_2$.
        \end{itemize}
        \begin{figure}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to ++(-6,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                (-6,2) to  [short, i=$i_1(t)$] ++(1.25,0)
                to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(1.75,0)
                to  [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S) {}
                let \p1 = (S.mid) in (S.out) to  [short, i=$i_2(t)$] (0,2)
                ([yshift = -0.3cm]S.mid) to [short, o-*](\x1,0);
                \draw (-2.2,2) to [open, v_>=$u_\mathrm{s}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Step-up converter (aka \hl{boost converter}, ideal switch representation)}
            \label{fig:step-up-converter-simple}
        \end{figure}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: Switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-up converter: switch states}
     The voltage at the switch is given by
     \begin{equation}
            u_\mathrm{s}(t) = \begin{cases}
                0, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{on}],\\
                U_2, & t\in [k T_\mathrm{s}+ T_\mathrm{on}, (k+1) T_\mathrm{s}].
            \end{cases}
     \end{equation}
    Note: switch on/off definition is reversed compared to the step-down converter. 
    \begin{figure}
        \centering	
        \begin{subfigure}{0.45\textwidth}
            \centering
            \hspace{-0.75cm}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=$i_1(t)$] ++(1.0,0)
                to [inductor, l=$L$] ++(1.75,0)
                to [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to [short, -*] ++(0,-2);
                \draw (0,2) to [short, i_<=${i_2=0}$, -o] ++(-1.0,0);
                \draw (-1.8,2) to [open, v_>=${U_\mathrm{s}=0\hspace{0.75cm}}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Switch-on time}
        \end{subfigure}%
        \hspace{0.5cm}
        \begin{subfigure}{0.45\textwidth}
            \centering
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}U_2$, voltage = straight] ++(0,-2)
                to ++(-5,0)
                to [open, o-o, v<= $U_1 \hspace{2cm}$, voltage = straight] ++(0,2)
                (-5,2) to  [short, i=$i_1(t)$] ++(1.0,0)
                to [inductor, l=$L$] ++(1.75,0)
                to [short, i=${i_\mathrm{L}(t)=i_2(t)}$] (0,2);
                \draw (-1.5,2) to [open, v_>=${U_\mathrm{s}=U_2\hspace{1.2cm}}$, voltage = straight] ++(0,-2);
            \end{circuitikz}
            \caption{Switch-off time}
        \end{subfigure}
    \caption{Switch states of the step-up converter} 
    \label{fig:step-up-converter-switch-states}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: steady-state time-domain behavior %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Step-up converter: steady-state time-domain behavior}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.7} % duty cycle
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_2$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({0 + #1},1) ({\D + #1},1) ({\D + #1},0) ({1 + #1},0) ({1 + #1},1)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \D) -- (axis cs:4, \D); % dashed line at U_1
                    \node[above, inner sep = 1pt, anchor = north, fill = white] at (axis cs:1.5+\D/2, \D-0.01) {$U_1$}; % label U_1
                    \draw [thick,<->]  (0,0.5) -- node[below]{$T_\mathrm{off}$}(\D, 0.5); % T_on 
                    \draw [thick,<->]  (\D,0.5) -- node[below]{$T_\mathrm{on}$}(1.0, 0.5); % T_off
                    \draw [thick,<->]  (0.0,-0.2) -- node[below]{$T_\mathrm{s}$}(1.0, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, $\overline{i}_\mathrm{L}$, }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.75) ({\D + #1},0.25) ({1 + #1},0.75)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5) -- (axis cs:4,0.5); % dashed line at average current
                    \draw[{Latex[length=2mm]}-, thin] (axis cs:1-0.02,0.75) -- node[fill=white, inner sep = 1pt, anchor = east]{$\max\{i_\mathrm{L}\}$}(axis cs:1-0.4,0.9); % indicate max current
                    \draw[-{Latex[length=2mm]}, thin] (axis cs:\D+0.25,0.2) node[fill=white, inner sep = 1pt, anchor = west]{$\min\{i_\mathrm{L}\}$} -- (axis cs:\D+0.02,0.25); % indicate min current
                    \draw[thin] (axis cs:1.25+3/4*\D,0.25+0.125) -- (axis cs:1.25+3/4*\D,0.75-0.125) -- (axis cs:1.75+1/4*\D,0.75-0.125); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south, xshift = -4mm] at (axis cs:1.5+\D/2, 0.75-0.125) {$\nicefrac{U_1}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2.0+\D/4,0.75-0.125) -- (axis cs:2+3*\D/4,0.75-0.125) -- (axis cs:2.0+3*\D/4,0.25+0.125); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south, xshift = 2mm] at (axis cs:2.0+\D/2, 0.75-0.125) {$\nicefrac{U_1-U_2}{L}$}; % label negative current slope
                    \draw [thin, <->]  (3+\D,0.25) -- (3+\D, 0.75); % Current ripple arrow
                    \node[inner sep = 1pt, anchor = east, fill = white] at (axis cs:3+\D-0.025, 0.75) {$\Delta i_\mathrm{L}$}; % Current ripple label
                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_2(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},0.75) ({\D + #1},0.25) ({\D + #1},0) ({1 + #1},0) ({1 + #1},0.75)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,0.5 * \D) -- (axis cs:4, 0.5 * \D); % dashed line at average current
                    \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\D/2, 0.5 * \D) {$\overline{i}_2$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: voltage and current transfer ratios during steady state %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: voltage and current transfer ratios during steady state}
    In steady state, the absolute voltage-time integral over the inductor must be identical for the switch-on and switch-off interval, that is,
    \begin{equation}
        \int_{0}^{T_\mathrm{off}} \left|u_\mathrm{L}(t)\right| \mathrm{d}t \stackrel{!}{=} \int_{T_\mathrm{off}}^{T_\mathrm{off}+T_\mathrm{on}} \left|u_\mathrm{L}(t)\right| \mathrm{d}t
    \end{equation}
    resulting in
    \begin{equation}
            (U_2-U_1)T_\mathrm{off} = U_1T_\mathrm{on} \quad  \Leftrightarrow \quad  (U_2-U_1)(1-D)T_\mathrm{s} = U_1DT_\mathrm{s}
    \end{equation}
    and finally delivering the \hl{voltage transfer ratio}
    \begin{equation}
        \frac{U_2}{U_1} = \frac{1}{1-D}.
    \end{equation}
    Assuming a lossless converter ($P_\mathrm{in}=P_\mathrm{out}$), the \hl{current transfer ratio} is 
    \begin{equation}
        \frac{\overline{i}_1}{\overline{i}_2} = \frac{1}{1-D}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: current ripple %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: current ripple}
    The \hl{inductor current ripple} can be found considering the positive slope during $T_\mathrm{on}$ with
    \begin{equation}
        \Delta i_\mathrm{L} = \frac{U_1}{L}T_\mathrm{on} = \frac{U_1}{L}DT_\mathrm{s}
        \label{eq:current-ripple-simple-step-up-pos}
    \end{equation}
    or alternatively evaluating the negative slope during $T_\mathrm{off}$ with
    \begin{equation}
        \Delta i_\mathrm{L} = \frac{U_2-U_1}{L}T_\mathrm{off} = \frac{U_2-U_1}{L}(1-D)T_\mathrm{s}=\frac{D(1-D)T_\mathrm{s}}{L}U_2.
        \label{eq:current-ripple-simple-step-up-neg}
    \end{equation}
    In addition, one can find that the output current and power is changing step-like within the step-up converter, while this is the case for the input side in the step-down converter: 
    \begin{equation*}
        \mbox{step-down:} \quad i_1(t) = \begin{cases}
            i_\mathrm{L}(t), & \mbox{switch on},\\
            0, & \mbox{switch off},
        \end{cases}
        \qquad
        \mbox{step-up:} \quad i_1(t) = \begin{cases}
            i_\mathrm{L}(t), & \mbox{switch on},\\
            i_\mathrm{L}(t), & \mbox{switch off},
        \end{cases}
    \end{equation*}
    \begin{equation*}
        \mbox{step-down:} \quad i_2(t) = \begin{cases}
            i_\mathrm{L}(t), & \mbox{switch on},\\
            i_\mathrm{L}(t), & \mbox{switch off},
        \end{cases}
        \qquad
        \mbox{step-up:} \quad i_2(t) = \begin{cases}
            0, & \mbox{switch on},\\
            i_\mathrm{L}(t), & \mbox{switch off}.
        \end{cases}
    \end{equation*}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: current ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: current ripple (cont.)}
    In contrast to the step-down converter, cf. \eqref{eq:duty-cycle-max}, the worst-case current ripple of the step-up converter occurs for 
    \begin{equation}
        \Delta i_\mathrm{L} =  \frac{U_1}{L}DT_\mathrm{s} \quad \Rightarrow \quad D_\mathrm{max} \rightarrow 1.
    \end{equation}
    This corresponds to the case of an infinitely large output voltage $U_2$:
    \begin{equation}
        \lim_{D\rightarrow1}U_2 = \lim_{D\rightarrow1} \frac{1}{1-D}U_1=\infty.
    \end{equation}
    The \hl{maximum current ripple} is then
    \begin{equation}
        \Delta i_\mathrm{L,\max} = \frac{1}{L}U_1T_\mathrm{s}.
        \label{eq:current-ripple-max-step-up}
    \end{equation}
    Consequently, we can express the current ripple as:
    \begin{equation}
        \Delta i_\mathrm{L} = D \Delta i_\mathrm{L,\max}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter with output capacitor: overview and assumptions %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-up converter with output capacitor: overview and assumptions}
        We consider the following assumptions:
        \begin{itemize}
            \item The switch is ideal, that is, infinitely fast.
            \item The input voltage is constant: $u_1(t) = U_1$.
            \item The output current is constant: $i_2(t) = I_2$.
            \item The inductor current $i_\mathrm{L}(t)$ is unaffected by the output voltage ripple (remains triangular).
            \item The output voltage is greater than the output voltage: $u_2(t) > U_1$.
        \end{itemize}
        \begin{figure}
            \begin{circuitikz}[]
                \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to ++(-7,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                (-7,2) to  [short, i=$i_1(t)$] ++(1.25,0)
                to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(1.75,0)
                to  [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S) {}
                let \p1 = (S.mid) in (S.out) to  [short] (-1.5,2)
                to [short, i=$i_2(t)$, -o] (0,2)
                ([yshift = -0.3cm]S.mid) to [short, o-*](\x1,0);
                \draw (-3.2,2) to [open, v_>=$u_\mathrm{s}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
                \draw (-1.5,2) to [capacitor, *-*, l=$C$, i>^=$i_\mathrm{C}(t)$] ++(0,-2);
            \end{circuitikz}
            \caption{Step-up converter (ideal switch representation) with output capacitor}
            \label{fig:step-up-converter-simple-output-cap}
        \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Capacitor voltage analysis %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis}
     In contrast to the step-down converter, the \hl{capacitor current} is changing step-like during the switching event:
     \begin{equation}
        i_\mathrm{C}(t) = \begin{cases}
            i_\mathrm{L}(t) - I_2, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}],\\
            -I_2, & t\in [k T_\mathrm{s}+ T_\mathrm{off}, (k+1) T_\mathrm{s}].
        \end{cases}
        \label{eq:capacitor-current-step-up-converter}
    \end{equation}
  The steady-state inductor current during the switch-off interval is
  \begin{equation}
    \begin{split}
        i_\mathrm{L}(t) &= \overline{i}_\mathrm{L} + \frac{\Delta i_\mathrm{L}}{2} - \frac{\Delta i_\mathrm{L}}{T_\mathrm{off}}(t-kT_\mathrm{s})\\
        &= \frac{1}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2(t-kT_\mathrm{s})}{2T_\mathrm{off}}, \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}].
    \end{split}
  \end{equation}
  which follows from the triangular signal shape. Inserting into \eqref{eq:capacitor-current-step-up-converter} yields
  \begin{equation}
    i_\mathrm{C}(t) = \begin{cases}
        \frac{D}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2(t-kT_\mathrm{s})}{2T_\mathrm{off}}, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}],\\
        -I_2, & t\in [k T_\mathrm{s}+ T_\mathrm{off}, (k+1) T_\mathrm{s}].
    \end{cases}
\end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: capacitor voltage analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis (cont.)}
     The \hl{capacitor voltage during the switch-off period} is then
  \begin{equation}
      \begin{split}
          u_\mathrm{C}(t) &= u_\mathrm{C}(kT_\mathrm{s}) + \frac{1}{C}\int_{kT_\mathrm{s}}^t i_\mathrm{C}(\tau) \mathrm{d}\tau , \quad t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}]\\
          &= u_\mathrm{C}(kT_\mathrm{s}) + \frac{1}{C}\left(\int_{kT_\mathrm{s}}^{t} \frac{D}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2(\tau-kT_\mathrm{s})}{2T_\mathrm{off}}\mathrm{d}\tau\right)\\
            &= u_\mathrm{C}(kT_\mathrm{s}) + \left[\frac{D\tau}{(1-D)C}I_2 + \frac{\Delta i_\mathrm{L}}{2T_\mathrm{off}C}\left(T_\mathrm{off}\tau - \tau^2 + 2\tau k T_\mathrm{s}\right)\right]_{kT_\mathrm{s}}^t\\
            &= u_\mathrm{C}(kT_\mathrm{s}) + \frac{D(t-kT_\mathrm{s})}{(1-D)C}I_2 + \frac{\Delta i_\mathrm{L}}{2T_\mathrm{off}C}\left(T_\mathrm{off}(t-kT_\mathrm{s}) - t(t-2kT_\mathrm{s})-(kT_\mathrm{s})^2\right).
      \end{split}
      \label{eq:capacitor-voltage-switch-off-step-up-converter}
  \end{equation}
  The capacitor voltage at the end of the switch-off period is
    \begin{equation}
        u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off}) = u_\mathrm{C}(kT_\mathrm{s}) + \frac{DI_\mathrm{out}}{(1-D)C}T_\mathrm{off}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: capacitor voltage analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis (cont.)}
     The \hl{capacitor voltage during the switch-on period} is then
    \begin{equation}
        \begin{split}
            u_\mathrm{C}(t) &= u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off}) + \frac{1}{C}\int_{kT_\mathrm{s}+T_\mathrm{off}}^t i_\mathrm{C}(\tau) \mathrm{d}\tau , \quad t\in [k T_\mathrm{s}+T_\mathrm{off}, (k+1) T_\mathrm{s}]\\
            &= u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off}) + \frac{1}{C}\int_{kT_\mathrm{s}+T_\mathrm{off}}^t -I_2 \mathrm{d}\tau\\
                &= u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off}) - \frac{I_2}{C}(t-kT_\mathrm{s}-T_\mathrm{off})\\
                &= \underbrace{u_\mathrm{C}(kT_\mathrm{s}) + \frac{DI_\mathrm{out}}{(1-D)C}T_\mathrm{off}}_{=u_\mathrm{C}(kT_\mathrm{s}+T_\mathrm{off})} - \frac{I_2}{C}(t-kT_\mathrm{s}-T_\mathrm{off}).\\
        \end{split}
        \label{eq:capacitor-voltage-switch-on-step-up-converter}
    \end{equation}
    Here, $u_\mathrm{C}(kT_\mathrm{s})$ is the (yet unknown)  initial capacitor voltage at the beginning of a period, which will be derived in a follow-up slide starting at \eqref{eq:capacitor-voltage-switch-on-step-up-converter}. 
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: capacitor voltage analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis (cont.)}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            In steady state, the capacitor voltage at the end of the switch-on period is identical to the voltage at the beginning of the switch-off period, that is,
            \begin{equation*}
                    u_\mathrm{C}(kT_\mathrm{s}) = u_\mathrm{C}((k+1)T_\mathrm{s}).
            \end{equation*}
            Hence, we can identify the \hl{voltage ripple} from \eqref{eq:capacitor-voltage-switch-on-step-up-converter} as
            \begin{equation}
                \begin{split}
                    \Delta u_\mathrm{C}&=\frac{I_2}{C}T_\mathrm{on} = \frac{DI_\mathrm{out}}{(1-D)C}T_\mathrm{off}\\
                                       &=\frac{I_2}{C}DT_\mathrm{s}=\frac{\Delta Q}{C} 
                \end{split}
            \end{equation}
            with the charge ripple $\Delta Q = DI_\mathrm{out}T_\mathrm{s}$.
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \begin{tikzpicture}

                    \tikzmath{
                        real \D, \u0, \Ts, \Ton, \Toff, \rippleI, \rippleU, \Iout, \c, \Iavg;
                        \D = 0.25;
                        \Ts = 1;
                        \Ton = \D;
                        \Toff = 1-\D;
                        \Iout = 1;
                        \rippleI = 0.5; % current ripple (normalized)
                        \c = 0.5; % capacitance (normalized)
                        \rippleU = \Iout/\c*\D*\Ts;
                        \u0 = 1-\rippleU/2 - \rippleI/12/\c*\Ts*(1-\D)^2;      
                        \Iavg = \D/(1-\D)*\Iout; % avg capacitor current             
                        } 

                    \begin{groupplot}[group style={group size=1 by 2, xticklabels at = edge bottom}, height=0.4\textheight, width=0.9\textwidth, xmin=-0.1, xmax=1.1, grid,clip = false]

                        % Capacitor voltage
                        \nextgroupplot[ylabel = {$u_\mathrm{C}(t)/\overline{u}_\mathrm{C}$}]
                            % Half cycle for t<0
                            \addplot[signalblue, thick, domain=-0.1:0, samples=15] {\u0 +\rippleU-\rippleU/\Ton*((x+\Ts)-\Toff)};
                            % Half cycle for 0<t<Toff
                            \addplot[signalblue, thick, domain=0:\Toff, samples=50] {\u0 + \rippleU*(x)/\Toff+\rippleI/\Toff/\c/2*(\Toff * x - x^2)};
                            % Half cycle for Toff<t<Ts
                            \addplot[signalblue, thick, domain=\Toff:\Ts, samples=50] {\u0 +\rippleU-\rippleU/\Ton*(x-\Toff)};
                            % Half cycle for t>Ts
                            \addplot[signalblue, thick, domain=\Ts:1.1, samples=50] {\u0 + \rippleU*(x-\Ts)/\Toff+\rippleI/\Toff/\c/2*(\Toff * (x-\Ts) - (x-\Ts)^2)};

                            % Dashed lines for voltage ripple (upper limit)
                            \draw[dashed, thin] (axis cs:-0.1, \u0+\rippleU) -- (axis cs:1.1, \u0+\rippleU);
                            % Dashed lines for voltage ripple (lower limit)
                            \draw[dashed, thin] (axis cs:-0.1, \u0) -- (axis cs:1.1, \u0);
                            % Voltage ripple arrow indication 
                            \draw[thin, {Latex[length=2mm]}-{Latex[length=2mm]}] (axis cs:0, \u0) -- (axis cs:0, \u0+\rippleU);
                            % Voltage ripple label
                            \node[above, inner sep = 2pt, anchor = west] at (axis cs:0, 1) {$\Delta u_\mathrm{C}$}; 
                            %\coordinate (a) at (\Ton/2,\u0-\ripple*\Ton/4); %coordinate for left vertical grouplot line
                            %\coordinate (b) at (\Ton+\Toff/2,\u0+\ripple*\Ton/4); %coordinate for right vertical grouplot line


                        % Capacitor current
                        \nextgroupplot[ylabel = {$i_\mathrm{C}(t)/I_2$}, xlabel={$t/T_\mathrm{s}$}]
                            % Current signal
                            \addplot[signalred, thick] coordinates {(-0.1, -\Iout) (0, -\Iout) (0, \Iavg + \rippleI/2)}; % Capacitor current for t < 0
                            \addplot[signalred, thick, domain=0:\Toff, samples=50] {\D/(1-\D)*\Iout + \rippleI*(\Toff-2*x)/(2*\Toff)}; % Capacitor current for 0 < t < Toff
                            \addplot[signalred, thick] coordinates {(\Toff, \Iavg - \rippleI/2) (\Toff, -\Iout) (\Ts, -\Iout) (\Ts, \Iavg + \rippleI/2)}; % Capacitor current for Toff < t < Ts
                            \addplot[signalred, thick, domain=\Ts:1.1, samples=15] {\D/(1-\D)*\Iout + \rippleI*(\Toff-2*(x-\Ts))/(2*\Toff)}; % Capacitor current for Ts < t
                            \addplot[dashed,thin] coordinates {(-0.1, \Iavg - \rippleI/2) (1.1, \Iavg - \rippleI/2)}; % lower limit of current riplle
                            \addplot[dashed,thin] coordinates {(-0.1, \Iavg + \rippleI/2) (1.1, \Iavg + \rippleI/2)}; % upper limit of current ripple
                            \draw [thin, <->]  (1-\Ton/4,\Iavg - \rippleI/2) -- (1-\Ton/4, \Iavg + \rippleI/2); % current ripple arrow
                            \node[inner sep = 1pt, anchor = east, fill = white] at (axis cs:1-\Ton/3, \Iavg) {$\Delta i_\mathrm{L}$}; % current ripple label
                            % \Delta Q charge area indication
                            \addplot[signalred, fill=shadecolor, fill opacity=0.3] coordinates {(\Toff,0) (\Toff,-\Iout) (\Ts,-\Iout) (\Ts,0)}; %Delta-Q indicator for  Toff < t < Ts
                            \addplot[signalred, fill=shadecolor, fill opacity=0.3] coordinates {(0,0) (0,\Iavg+\rippleI/2) (\Toff,\Iavg-\rippleI/2) (\Toff,0)}; %Delta-Q indicator for t < Toff
                            % \Delta Q charge area indication arrow
                            \draw[thin, -{Latex[length=2mm]}] (axis cs:0.2,-0.4) -- (axis cs:0.1,\Iavg);
                            % \Delta Q charge area indication label
                            \node[inner sep = 1pt, anchor = west, fill = white] at (axis cs:0.2,-0.4) {$\Delta Q$};
                            \node[inner sep = 1pt, anchor = center] at (axis cs:\Ts-\Ton/2,-0.5) {$\Delta Q$};
                            \draw [<->]  (0,\pgfkeysvalueof{/pgfplots/ymax}+0.25) -- node[above]{$T_\mathrm{off}$}(\Toff, \pgfkeysvalueof{/pgfplots/ymax}+0.25);
                            \draw [<->]  (\Toff,\pgfkeysvalueof{/pgfplots/ymax}+0.25) -- node[above]{$T_\mathrm{on}$}(\Ts, \pgfkeysvalueof{/pgfplots/ymax}+0.25);
                            %\coordinate (c) at (\Ton/2,0); %coordinate for left vertical grouplot line
                            %\coordinate (d) at (\Ton+\Toff/2,0);  %coordinate for right vertical grouplot line
                    \end{groupplot}
                    %\draw [dashed] (a) -- (c);
                    %\draw [dashed] (b) -- (d);
                \end{tikzpicture}
                \caption{Step-up converter voltage ripple}
                \label{fig:step-up-converter-voltage-ripple}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: capacitor voltage analysis (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: capacitor voltage analysis (cont.)}
    To calculate the \hl{initial capacitor voltage} $u_\mathrm{C}(kT_\mathrm{s})$, we can utilize
    \begin{equation}
        \overline{u}_\mathrm{c} = \frac{1}{T_\mathrm{s}}\int_0^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t   \stackrel{!}{=} \overline{u}_2 = \frac{U_1}{1-D}
        \label{eq:capacitor-voltage-average-step-up-converter}
    \end{equation}
    since the average capacitor voltage must be equal to the average output voltage. This yields
    \begin{equation}
        \begin{split}
            \overline{u}_\mathrm{c} &=  \frac{1}{T_\mathrm{s}}\left(\int_0^{T_\mathrm{off}} u_\mathrm{C}(t) \mathrm{d}t + \int_{T_\mathrm{off}}^{T_\mathrm{s}} u_\mathrm{C}(t) \mathrm{d}t\right)  \\
                                    &=\ldots\\
                                    &=u_\mathrm{C}(kT_\mathrm{s}) + \frac{\Delta u_\mathrm{C}}{2} +\frac{\Delta i_\mathrm{L}T_\mathrm{s}}{12C}(1-D)^2 
        \end{split}
    \end{equation}
    and finally delivers
    \begin{equation}
        \begin{split}
            u_\mathrm{C}(kT_\mathrm{s}) &= \frac{U_1}{1-D} - \frac{\Delta u_\mathrm{C}}{2} -\frac{\Delta i_\mathrm{L}T_\mathrm{s}}{12C}(1-D)^2\\
                                        &= \frac{U_1}{1-D} - \frac{I_2}{2C}DT_\mathrm{s} -\frac{U_1T^2_\mathrm{s}}{12LC}D(1-D)^2.
        \end{split}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Circuit realization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Circuit realization}
    \begin{itemize}
        \item In \figref{fig:step-up-converter-realization-1Q} the simplest realization is shown utilizing one transistor and one diode. 
        \item This configuration can only provide positive voltages and currents (\hl{first quadrant}).
        \item The previously made step-up converter's switch-on definition (cf.  \figref{fig:step-up-converter-switch-states}) results from the transistor position in the circuit -- difference to the step-down converter.
    \end{itemize}
    \begin{figure}
        \begin{circuitikz}[]                
            \draw (0,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
            to ++(-6,0)
            to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
            (-6,2) to  [short, i=$i_1(t)$] ++(0.75,0)
            to [inductor, l=$L$, v = $u_\mathrm{L}(t)$, voltage = straight] ++(1.5,0)
            to  [short, i=$i_\mathrm{L}(t)$] ++(0.75,0)
            to [diode, l=$D$] ++(2.0,0)
            to  [short, -o, i=$i_2(t)$] (0,2);            ;   
            \draw (-3,1) node[npn](npn1) {}
            (npn1.C) to [short, -*] (-3,2)
            (npn1.E) to [short, -*] (-3,0);
            \draw let \p1 = (npn1.B) in node[anchor=east] at (\x1,\y1) {$T$};
            \draw (-2.8,2) to [open, v^>=$\hspace{0.5cm}u_\mathrm{s}(t)$, voltage = straight] ++(0,-2);
        \end{circuitikz}
        \caption{Step-up converter with real components (single quadrant type)}
        \label{fig:step-up-converter-realization-1Q}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: DCM %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
    \frametitle{Step-up converter: DCM}
    \begin{figure}
        \begin{tikzpicture}
            \pgfmathsetmacro{\D}{0.7} % duty cycle
            \tikzmath{
                real \Ts, \Ton, \Toff1, \Toff2, \Uin, \Uout, \ripple;
                \Ts = 1;
                \Uout = 1;
                \Toff1 = 0.5;
                \Toff2 = 0.25;
                \Ton = \Ts - \Toff1 - \Toff2;
                \Uin = \Uout*\Toff1/(\Toff1+\Ton);      
                \ripple = 0.65;
                \Iavg = \ripple /2 * (\Toff1+\Ton)/\Ts;
            } 
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=4, grid,clip = false, ymin = 0, ymax =1.1]

                % Top plot: voltage at the switch
                \nextgroupplot[ylabel = {$u_\mathrm{s}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , $U_2$}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalblue, thick] coordinates {({0 + #1},0) ({0 + #1},\Uout) ({\Toff1 + #1},\Uout) ({\Toff1 + #1},\Uin) ({\Toff1+\Toff2 + #1},\Uin) ({\Toff1 + \Toff2 + #1},0) ({\Ts + #1},0) ({\Ts + #1},\Uout)};}
                        \AddPlot
                    }
                    \draw[signalblue, thick, dashed] (axis cs:0, \Uin) -- (axis cs:4, \Uin); % dashed line at U_1
                    \node[above, inner sep = 1pt, anchor = north, fill = white, yshift= -1pt] at (axis cs:1+\Toff1/2, \Uin) {$U_1$}; % label U_1
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (0,-0.2) -- node[below]{$T'_\mathrm{off}$}(\Toff1, -0.2); % T'_off 
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Toff1,-0.2) -- node[below]{$T''_\mathrm{off}$}(\Toff1+\Toff2, -0.2); % T''_off
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Toff1+\Toff2,-0.2) -- node[below]{$T_\mathrm{on}$}(\Ts, -0.2); % T_on
                    \draw [thick,{Latex[length=2mm]}-{Latex[length=2mm]}]  (\Ts,-0.2) -- node[below]{$T_\mathrm{s}$}(2*\Ts, -0.2); % T_s 


                % Middle plot: inductor current
                \nextgroupplot[ylabel = {$i_\mathrm{L}(t)$}, ytick = {0, 0.5, 1}, yticklabels = {0, , }]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},\ripple) ({\Toff1 + #1},0) ({\Toff1+\Toff2 + #1},0) ({\Ts + #1},\ripple)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,\Iavg) -- (axis cs:4,\Iavg); % dashed line at average current
                    \draw[thin] (axis cs:2*\Ts-3/4*\Ton,\ripple/4) -- (axis cs:2*\Ts-3/4*\Ton,3*\ripple/4) -- (axis cs:2*\Ts-1/4*\Ton,3*\ripple/4); % indicate positive current slopde
                    \node[above, inner sep = 2pt, anchor = south east] at (axis cs:2*\Ts-\Ton/2, \ripple*3/4) {$\nicefrac{U_1}{L}$}; % label positive current slope
                    \draw[thin] (axis cs:2*\Ts+\Toff1/4,\ripple*3/4) -- (axis cs:2*\Ts+\Toff1*3/4,\ripple*3/4) -- (axis cs:2*\Ts+3*\Toff1/4,\ripple*1/4); % indicate negative current slope
                    \node[above, inner sep = 2pt, anchor = south west, xshift=-3mm] at (axis cs:2*\Ts+\Toff1/2, \ripple*3/4) {$\nicefrac{U_1-U_2}{L}$}; % label negative current slope

                
                % Bottom plot: input current
                \nextgroupplot[ylabel = {$i_2(t)$}, xlabel={$t/T_\mathrm{s}$}, ytick = {0, 0.5, 1}, yticklabels = {0, ,}]
                    \pgfplotsinvokeforeach{0,...,3}{
                        \edef\AddPlot{\noexpand\addplot[signalred, thick] coordinates {({0 + #1},\ripple) ({\Toff1 + #1},0) ({\Ts + #1},0) ({\Ts + #1},\ripple)};}
                        \AddPlot
                    }
                    \draw[signalred, thick, dashed] (axis cs:0,\ripple/2*\Toff1/\Ts) -- (axis cs:4, \ripple/2*\Toff1/\Ts); % dashed line at average current
                    \node[above, inner sep = 2pt, anchor = south, fill = white] at (axis cs:1.5+\D/2, \ripple/2*\Toff1/\Ts) {$\overline{i}_2$}; % label average current
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: switch states %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Step-up converter: switch states in DCM}
    The step-up converter in DCM has three different switch states:
    \begin{itemize}
            \item Transistor on-time:  $T_\mathrm{on}=DT_\mathrm{s}$,
            \item Transistor off-time (conducting diode): $T'_\mathrm{off}=D'T_\mathrm{s}$,
            \item Transistor off-time (no conduction):  $T''_\mathrm{off}=T_\mathrm{s}-T_\mathrm{on}-T'_\mathrm{off}$.
    \end{itemize}
        \begin{figure}
            \centering	
            \begin{subfigure}{0.33\textwidth}
                \centering
                %\hspace{-1.4cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1}(t)$] ++(1,0)
                    to [inductor, l=$L$] ++(1.5,0)
                    to [short, i=$i_\mathrm{L}(t)$] ++(1,0)
                    to [short, -*] ++(0,-2);
                    \draw (-1,2) to [short, -o, i=${i_2=0}$] (0,2);
                    \draw (-1.9,2) to [open, v_= ${U_\mathrm{s}=0}\hspace{0.6cm}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-on time $T_\mathrm{on}$}
            \end{subfigure}%
            \begin{subfigure}{0.33\textwidth}
                \centering
                %\hspace{-0.6cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1}(t)$] ++(1,0)
                    to [inductor, l=$L$] ++(1.5,0)
                    to [short, -o, i=$\hspace{2mm}{i_\mathrm{L}(t)=i_2(t)}$] (0,2);
                    \draw (-1.5,2) to [open, v_= ${U_\mathrm{s}=U_2}\hspace{1cm}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time $T'_\mathrm{off}$}
            \end{subfigure}
            \begin{subfigure}{0.33\textwidth}
                \centering
                %\hspace{-1.3cm}
                \begin{circuitikz}[scale=0.75, font=\small]
                    \draw (0,2) to [open, o-o, v = $\hspace{-0.4cm}U_2$, voltage = straight] ++(0,-2)
                    to ++(-5,0)
                    to [open, o-o, v<= $U_1 \hspace{-0.1cm}$, voltage = straight] ++(0,2)
                    (-5,2) to  [short, i=${i_1=0}\hspace{0.15cm}$] ++(1.25,0)
                    to [inductor, l=$L$] ++(1.5,0)
                    to [short] ++(0.75,0);
                    \draw (-1,2) to [short, -o, i=${i_2=0}$] (0,2);
                    \draw (-1.5,2) to [open, v_= ${U_\mathrm{s}=U_1}\hspace{1cm}$, voltage = straight] ++(0,-2);
                \end{circuitikz}
                \caption{Switch-off time $T''_\mathrm{off}$}
            \end{subfigure}
        \caption{Switch states of the step-up converter including DCM} 
        \label{fig:step-up-converter-switch-states-DCM}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: DCM operation characteristics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: DCM operation characteristics}
    In DCM operation 
    $$  \overline{i}_\mathrm{L}=\overline{i}_1 < \frac{\Delta i_\mathrm{L}}{2} \quad \Rightarrow \quad U_2 \neq U_1 \frac{1}{1-D}$$
    applies due to the non-conducting diode during  $T''_\mathrm{off}$. To find the input-to-output voltage ratio in DCM, we again utilize the current ripple balance:
    \begin{equation}
        \begin{alignedat}{2}
            \Delta i_\mathrm{L} &= \frac{U_1}{L}T_\mathrm{on} = i_\mathrm{L} = \frac{U_1}{L}DT_\mathrm{s} \quad &&\mbox{(rising edge)},\\
            \Delta i_\mathrm{L} &= \frac{U_2-U_1}{L}T'_\mathrm{off} = \frac{U_2-U_1}{L}D'T_\mathrm{s} \quad &&\mbox{(falling edge)}.
        \end{alignedat}
    \end{equation}
    Solving for $D'$ yields
    \begin{equation}
        D' = \frac{U_1}{U_2-U_1}D.
    \end{equation}
    The average load current is 
    \begin{equation}
            \overline{i}_2 = \frac{\Delta i_\mathrm{L}}{2}\frac{T'_\mathrm{off}}{T_\mathrm{s}} = \frac{\Delta i_\mathrm{L,max}D}{2}D'= \frac{\Delta i_\mathrm{L,max}}{2}\frac{U_1}{U_2-U_1}D^2.
            \label{eq:step-up-converter-average-output-current-DCM}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: DCM operation characteristics (cont.)%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-up converter: DCM operation characteristics (cont.)}
    Solving \eqref{eq:step-up-converter-average-output-current-DCM} delivers the step-up \hl{converter voltage gain in DCM} as
    \begin{equation}
        \frac{U_2}{U_1} = 1+ \frac{D^2}{2} \frac{\Delta i_\mathrm{L,max}}{\overline{i}_2}.
        \label{eq:voltage-ratio-DCM-step-up}
    \end{equation}
    Since $\Delta i_\mathrm{L,max}$ also depends on $U_1$, cf.  \eqref{eq:current-ripple-max-step-up}, the relation \eqref{eq:voltage-ratio-DCM-step-up} only holds for a given $U_1$. Hence, we can insert \eqref{eq:current-ripple-max-step-up} in \eqref{eq:voltage-ratio-DCM-step-up} and solve for $U_2$ to receive
    \begin{equation}
        U_2= U_1 + \frac{D^2}{2} \frac{T_\mathrm{s}}{L \overline{i}_2}.
    \end{equation}
    One can note the inverse proportionality of $U_2$ to $\overline{i}_2$, that is, the lower the load current, the higher the output voltage.

    Finally, the step-up converter \hl{operates in BCM} if
    \begin{equation}
        \overline{i}_\mathrm{L}=\overline{i}_1 = \frac{\Delta i_\mathrm{L}}{2} \quad \Leftrightarrow \quad  \overline{i}_2 = (1-D)\frac{\Delta i_\mathrm{L}}{2}. 
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-down converter load curves %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Step-down converter load curves}
    \begin{figure}
        \begin{tikzpicture}
            \begin{semilogyaxis}[
                xlabel={$\overline{i}_2/\Delta i_\mathrm{L,max}$},
                ylabel={$U_2/U_1$},
                axis lines=left,
                thick,
                smooth,
                no markers,
                height = 0.8\textheight,
                grid,
                log ticks with fixed point,
                ymin=0.9, ymax=11,
                xmin=0, xmax=0.4,
                clip = true
                ]
                \foreach \D in {0.01, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9}{
                    \addplot[signalblue, domain=\D*(1-\D)/2:1, samples=15] {1/(1-\D)}; %CCM
                    \addplot[signalblue, domain=0.01:\D*(1-\D)/2, samples=30] {1+\D^2/2/x}; %DCM
                }
                 \foreach \D [count=\xi] in {0.01, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9}{
                    \pgfmathsetmacro{\gain}{1/(1-\D)}
                    \pgfmathsetmacro{\shift}{(-1)^(Mod(\xi,2))}
                     \edef\temp{\noexpand\node[inner sep = 1pt, align = center, fill = white] at (axis cs:0.3+\shift/20, \gain) {$\scriptstyle D=\D$};} % Duty-cycle labels
                     \temp
                 }
                \addplot[signalred, domain = 0.005:1/8, samples=30, thick, name path = upper] {1/(4*x) + (1/(4*x)^2 - 1/(2*x))^(0.5)}; % Upper boundary area
                 \addplot[signalred, domain = 0.005:1/8, samples=30, thick, name path = lower] {1/(4*x) - (1/(4*x)^2 - 1/(2*x))^(0.5)}; % Lower boundary area
                \addplot[shadecolor, opacity=0.3] fill between[of=upper and lower];
                \node[inner sep = 1pt, anchor = west, fill = white, font=\footnotesize] at (axis cs:0.125, 7) {CCM}; % CCM label
                \draw[thin, -{Latex[length=2mm]}] (axis cs:0.125, 4) -- (axis cs:0.09, 2.7);
                \node[inner sep = 1pt, anchor = west, font=\footnotesize] at (axis cs:0.125, 4) {DCM}; % DCM label
            \end{semilogyaxis}
        \end{tikzpicture}
        \caption{Step-up converter load curves for CCM and DCM}
        \label{fig:step-up-converter-load-curves}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Buck-boost converter%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Buck-boost converter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Step-up converter: overview and assumptions %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[b]
    \frametitle{Buck-boost converter: combining step-up and step-down stages}
        \begin{figure}
            \begin{circuitikz}[]
                %Boost part
                \draw (5,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to [short, -o]++(-5,0)
                to [open, voltage = straight, o-o] ++(0,2)
                to [short, o-]++(0.5,0)
                to [inductor, l=$L_2$] ++(1.5,0)
                to [short, i=$i_{\mathrm{L}_2}(t)$] ++(1.0,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S2) {}
                let \p2 = (S2.mid) in (S2.out) to  [short, i=$i_2(t)$] (5,2)
                ([yshift = -0.3cm]S2.mid) to [short, o-*](\x2,0);
                \draw (2.5,2) to [open, v_>=$u_{\mathrm{s}_2}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
                % gray background behind boost part
               \begin{scope}[on background layer]
                \node[rectangle, draw = shadecolor,	fill = shadecolor,	opacity=0.3, minimum width = 4.75cm, minimum height = 3.4cm] (B1) at (2.625,1.1) {};
                \node[inner sep = 1pt, anchor = south, font=\small] at (B1.south) {Boost};
                \end{scope}
                % Buck part
                \draw (0,0) to [short, o-]++(-5,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                to  [short, i=$i_1(t)$] ++(1.0,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S1) {}
                let \p1 = (S1.mid) in (S1.in) to  [short, i=$i_\mathrm{L_1}(t)$] ++(1.15,0)
                to [inductor, l=$L_1$] ++(1.3,0)
                to [short, -o] (0,2) 
                ([yshift = -0.3cm]S1.mid) to [short, o-*](\x1,0);
                \draw (-2.5,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s_1}(t)$, voltage = straight] ++(0,-2);
                 % gray background behind buck part
                 \begin{scope}[on background layer]
                    \node[rectangle, draw = shadecolor,	fill = shadecolor,	opacity=0.3, minimum width = 4.75cm, minimum height = 3.4cm] (B2) at (-2.625,1.1) {};
                    \node[inner sep = 1pt, anchor = south, font=\small] at (B2.south) {Buck};
                \end{scope}
                 %Curly bracket that points from the upper circuit to the lower circuit
                \draw [decorate,decoration={brace,amplitude=10pt,mirror,raise=0.5cm},yshift=0pt] (-2.5,-0.25) -- (2.5,-0.25) node [black,midway,yshift=-0.6cm] {};
            \end{circuitikz}
            \begin{circuitikz}[]
                %Boost part
                \draw (3,2) to [open, o-o, v = $\hspace{2cm}u_2(t)$, voltage = straight] ++(0,-2)
                to [short]++(-3,0)
                (1.25,2) to ++(0.1,0) node [cuteopenswitchshape, anchor = in, yscale=-1] (S2) {}
                let \p2 = (S2.mid) in (S2.out) to  [short, i=$i_2(t)$] (3,2)
                ([yshift = -0.3cm]S2.mid) to [short, o-*](\x2,0);
                \draw (1.4,2) to [open, v_>=$u_{\mathrm{s}_2}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
                % Buck part
                \draw (0,0) to [short]++(-3,0)
                to [open, o-o, v<= $u_1(t) \hspace{2cm}$, voltage = straight] ++(0,2)
                to  [short, i=$i_1(t)$] ++(0.75,0)
                to ++(0.1,0) node [cuteopenswitchshape, anchor = out, rotate=180] (S1) {}
                let \p1 = (S1.mid) in (S1.in) to  [short] (-1.0,2)
                ([yshift = -0.3cm]S1.mid) to [short, o-*](\x1,0);
                \draw (-1.4,2) to [open, v = $\hspace{1.75cm}u_\mathrm{s_1}(t)$, voltage = straight] ++(0,-2);
                %Combining inductor
                \draw (S1.in) to [inductor, l=$L$, i=$i_\mathrm{L}(t)$] (S2.in);
            \end{circuitikz}
            \caption{Buck-boost converter (ideal switch representation)}
            \label{fig:buck-boost-simple}
        \end{figure}
\end{frame}