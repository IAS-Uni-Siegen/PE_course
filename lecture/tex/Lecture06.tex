%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Transistor-based AC/DC converters %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Transistor-based AC/DC converters}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Extending AC/DC converter to four quadrant operation %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
	\frametitle{Extending AC/DC converters to four quadrant operation}
	\begin{columns}
		\begin{column}{0.5\textwidth}
			
			\onslide<1->{\hl{Up to now}:}
            \begin{itemize}
                \item<1-> Diode-based converters
                \begin{itemize}
                    \item<1-> Rectification only
                    \item<1-> Single quadrant operation
                \end{itemize}
                \item<2-> Thyristor-based converters
                \begin{itemize}
                    \item<2-> Rectification and inversion
                    \item<2-> Two quadrant operation
                \end{itemize}
            \end{itemize}
            \vspace{1em}
            \onslide<3->{
            \hl{Extension in this section:}
            \begin{itemize}
                \item Transistor-based converters
                \begin{itemize}
                    \item Rectification and inversion
                    \item Four quadrant operation
                \end{itemize}
            \end{itemize}}
		\end{column}
		\begin{column}{0.5\textwidth}
			\begin{figure}
				\centering
				\begin{tikzpicture}
                    \begin{scope}[]
                        \fill[signalgreen, opacity=0.3] (0,0) -- (2,0) -- (2,2) -- (0,2) -- cycle;
                        \fill[signalgreen, opacity=0.3] (0,0) -- (2,0) -- (2,-2) -- (0,-2) -- cycle;
                    \end{scope}
                    \begin{scope}[]
                        \fill[shadecolor, opacity=0.3] (0,0) -- (-2,0) -- (-2,2) -- (0,2) -- cycle;
                        \fill[shadecolor, opacity=0.3] (0,0) -- (-2,0) -- (-2,-2) -- (0,-2) -- cycle;
                    \end{scope}
                    \draw[<->] (-2,0) -- (2,0) node[anchor=west] {$i$};
                    \draw[<->] (0,-2) -- (0,2) node[anchor=south] {$u$};
                    \node[anchor=center, align = center] at (1.0,1.0) {$\mathrm{I}$\\$P \geq 0$\\(recitifier)};
                    \node[anchor=center, align = center] at (-1.0,1.0) {$\mathrm{II}$\\$P \leq 0$\\(inverter)};
                    \node[anchor=center, align = center] at (-1.0,-1.0) {$\mathrm{III}$\\$P \geq 0$\\(recitifier)};
                    \node[anchor=center, align = center] at (1.0,-1.0) {$\mathrm{IV}$\\$P \leq 0$\\(inverter)};
                    \draw[thin, visible on=<2->] (1.75,0.75) to (2.4,0.25) node[anchor=north west] {Thyristors};
                    \draw[thin, visible on=<2->] (1.75,-0.75) to (2.4,-0.25) node[anchor=south west] {};
                    \draw[thin] (1.75,1.75) to (2.4,2.25) node[anchor=west] {Diodes};
					\node[anchor = center, xshift = 1mm] at (0, 3.5) {
						\begin{circuitikz}
							\node[twoportsplitshape, scale = 1.5](tp){};
							\draw (tp.left up) to [short, -o, i_<= $i_1$] ++(-0.75,0) coordinate(tpin1)
							(tp.left down) to [short, -o] ++(-0.75,0) coordinate(tpin2);
							\draw[->] ([xshift=-0.9cm]tp.left up) to node[anchor = east]{DC $u_1$} ([xshift=-0.9cm]tp.left down);
							\draw (tp.right up) to [short, -o, i= $i_2$] ++(0.75,0) coordinate(tpout1)
							(tp.right down) to [short, -o] ++(+0.75,0) coordinate(tpout2);
							\draw[->] ([xshift=1cm]tp.right up) to node[anchor = west]{$u_2$ AC} ([xshift=1cm]tp.right down);
						\end{circuitikz}	
					} ;
				\end{tikzpicture}
			\end{figure}
		\end{column}
	\end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Single-phase bridge converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Single-phase AC/DC bridge converter} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Idealized switch representation %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Idealized switch representation of a single-phase AC/DC bridge converter}
    \begin{columns}
        \begin{column}{0.4\textwidth}
            \onslide<2->{%
            Define \hl{switching function}:
            \begin{equation}
                s_i(t)=\begin{cases}
                    +1 & \text{upper position,}\\
                    -1 & \text{lower position.}
                \end{cases}
                \label{eq:switching_function_VSI}
            \end{equation}}%
            \onslide<3->{Output voltage considering a voltage source at the input is:
            \begin{equation}
                u_2(t)=\underbrace{\frac{1}{2}\left(s_1(t)-s_2(t)\right)}_{s(t)}u_1(t).
            \end{equation}}%
            \onslide<4->{Input current assuming a current source at the output results in:
            \begin{equation}
                i_1(t)=s(t)i_2(t).
            \end{equation}}
        \end{column}
        \begin{column}{0.6\textwidth}
            \begin{figure}
                \begin{circuitikz}
                    \draw (0,0) node[cute spdt up arrow, xscale=-1] (Sw1) {};
                    \draw (2,-1.5) node[cute spdt down arrow, xscale=-1] (Sw2) {};
                    \draw (Sw2.in) to [short, -o] ++(1,0) coordinate (out2);
                    \draw (Sw1.in) to [short] ++(1.75,0) to [short, -o, i=$i_2(t)$] (Sw1.in -| out2) coordinate (out1);
                    \draw (out1) to [open, v^=$\hspace{0.5cm}u_2(t)$, voltage = straight] (out2);
                    \draw (Sw1-out 1.n) to [short, -*] ++(0,0.5) coordinate (int1);
                    \draw (Sw2-out 2.s) to [short] ++(0,-0.5) coordinate (int2);
                    \draw (int2) to [short] (int2 -| Sw1-out 2.s) coordinate (int3) to [short, *-] (Sw1-out 2.s);
                    \draw node[crossingshape, name=x1, rotate=-90] at (out1 -| Sw2-out 1.n) {};
                    \draw (x1.west) to [short] (int1 -| x1.west) to [short] (int1);
                    \draw (x1.east) to [short] (Sw2-out 1.n);
                    \draw (int1) to [short] ++(-1,0) to [short, i_<=$i_1(t)$, -o] ++(-1,0) coordinate (in1);
                    \draw (int3) to [short, -o] ++(-2,0) coordinate (in2);
                    \draw (in1) to [open, v=$u_1(t)\hspace{0.5cm}$, voltage = straight] (in2);
                    \draw node[anchor = east, xshift=-0.3cm] at (Sw1) {$s_1(t)$};
                    \draw node[anchor = east, xshift=-0.3cm] at (Sw2) {$s_2(t)$};
                \end{circuitikz}
                \caption{Idealized switch representation of a single-phase AC/DC bridge converter}
                \label{fig:idealized_switch_single_phase_bridge_converter}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Circuit realization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Circuit realization}
    \begin{columns}
        \begin{column}{0.45\textwidth}
            \begin{itemize}
                \item<2-> Remember: complementary switching of $\{T_1, T_2\}$ and $\{T_3, T_4\}$ to prevent a DC-link short-circuit. 
                \item<3-> Possible (allowed) switching states:
            \end{itemize} 
            \vspace{-0.25cm}
            \onslide<3->{     
            \begin{center}
                \begin{tabular}{c c c c c c c}
                    \toprule
                    $T_1$ & $T_2$ &$T_3$ & $T_4$ & $s_1$ & $s_2$ & $s$\\
                    \midrule
                    on & off & off & on & $+1$ & $-1$ & $+1$\\
                    off & on & on & off & $-1$ & $+1$ & $-1$\\
                    on & off & on & off & $+1$ & $+1$ & $0$\\
                    off & on & off & on & $-1$ & $-1$ & $0$\\
                    \bottomrule
                \end{tabular}
            \end{center}}% 
        \end{column}
        \hfill
        \begin{column}{0.55\textwidth}
            \begin{figure}
                \begin{circuitikz}[]
                    \draw (0,4) coordinate (A) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-5) coordinate (B)
                    (A) to [short, o-, i=$i_1(t)$] ++(2,0) coordinate (E)
                    to [Tnpn, n=npn1, invert, bodydiode] ++(0,-2) coordinate (C)
                    to [short, *-] ++(1,0) to [crossing] ++(2,0)   
                    to [short, i=$i_2(t)$, -o] ++(1,0) coordinate (G)
                    (C) to [short] ++(0,-1) 
                    to [Tnpn, n=npn2, invert, bodydiode] ++(0,-2) coordinate (D)
                    (E) to [short, *-] ++(2,0)
                    to [Tnpn, n=npn3, invert, bodydiode] ++(0,-2)
                    to [short] ++(0,-1) coordinate (F)
                    to [Tnpn, n=npn4, invert, bodydiode] ++(0,-2) 
                    to [short, -*] ++(-2,0)
                    to [short, -o] (B)
                    (F) to [short,*-o] ++(2,0) coordinate (H)
                    (G) to [open, o-o, v = $\hspace{1.9cm}u_2(t)$, voltage = straight] (H);
                    \draw let \p1 = (npn1.B) in node[anchor=east] at (\x1,\y1) {$T_1$};
                    \draw let \p1 = (npn2.B) in node[anchor=east] at (\x1,\y1) {$T_2$};
                    \draw let \p1 = (npn3.B) in node[anchor=east] at (\x1,\y1) {$T_3$};
                    \draw let \p1 = (npn4.B) in node[anchor=east] at (\x1,\y1) {$T_4$};
                \end{circuitikz}
                \caption{Full-bridge single-phase AC/DC converter (identical to the one used in the DC/DC section in \figref{fig:DCDC-4Q-switch})}
                \label{fig:ACDC-4Q-switch}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Pulse width modulation (PWM) options %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Pulse width modulation (PWM) options}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \begin{circuitikz}
                    \def\cwidth{1.5}
                    \def\cheight{1}
                    \draw[->] (0,0) to node[above]{$s^*(t)$} ++(1.5,0) node[adder, anchor = west, name=add1]{};
                    \draw node[ctrlblock, anchor = west, minimum width = \cwidth cm, minimum height = \cheight cm](carrier) at (0,-2.25) {}; 
                    \path (carrier.south west) coordinate (blockBottomLeft);
                    
                    % Triangular signal pattern within block
                    \begin{scope}
                        % Define the number of signal steps
                        \def\signalsteps{6}
                        
                        % Compute step width and height of the triangular pattern
                        \pgfmathsetmacro{\stepwidth}{\cwidth/\signalsteps}
                        \pgfmathsetmacro{\signalheight}{\cheight/(1.3)}

                        % Start drawing the triangular signal
                        \draw[signalblue, thick] 
                    ($(blockBottomLeft) + (0.025, 0.1*\cheight)$) % Starting point with a margin
                    \foreach \x in {1,...,\signalsteps} {
                        -- ($
                            (blockBottomLeft) + 
                            (\x*\stepwidth - 0*\stepwidth, {0.1*\cheight + mod(\x, 2)*\signalheight})
                        $)
                    };
                    \end{scope}
                    \draw[->] (carrier.east) -- (carrier.east -| add1.south) -- node[left]{$c(t)$} (add1.south) node[anchor = north west] {$-$};
                    \draw[->] (add1.east) -- ++(0.5,0) node[ctrlblock, anchor = west, minimum width = \cwidth cm, minimum height = \cheight cm](comp){};
                    
                    % Comperator block 
                    \begin{axis}[at={(comp)}, scale only axis, width = 0.8*\cwidth cm, height = 0.8*\cheight cm, anchor = center, xtick=\empty, ytick={0,1}, axis lines=middle, ymax=1.25, ymin = -1.25, font = \footnotesize, extra y ticks={-1}, extra y tick style = {yticklabel shift = -0.75cm}]
                        \addplot[thick, signalblue] coordinates {(-1,-1) (0,-1) (0,1) (1,1)};
                    \end{axis}
                    \draw[-] (comp.east) -- ++(0.5,0) coordinate (out1);
                    \draw[->] ($(comp.east)!0.5!(out1)$) to [short, *-] ++(0,-2.25) to ++(0.5,0) node[ctrlblock, anchor = west, minimum width = \cheight cm, minimum height = \cheight cm](comp2){-1};
                    \draw[->] (comp2.east) to ++(0.5, 0) node[anchor = west]{$s_2(t)$} coordinate (out2);
                    \draw[->] (out1) to (out1 -| out2) node[anchor = west]{$s_1(t)$};
                \end{circuitikz}
                \caption{PWM with \hl{complementary} switching}
                \label{fig:PWM_complementary}
                \end{figure}
        \end{column}
        \begin{column}{0.5\textwidth}
            \onslide<2->{%
            \begin{figure}
                \begin{circuitikz}
                    \def\cwidth{1.5}
                    \def\cheight{1}
                    \draw[->] (0,0) to node[above]{$s^*(t)$} ++(1.5,0) node[adder, anchor = west, name=add1]{};
                    \draw node[ctrlblock, anchor = west, minimum width = \cwidth cm, minimum height = \cheight cm](carrier) at (0,-2.25) {}; 
                    \path (carrier.south west) coordinate (blockBottomLeft);
                    
                    % Triangular signal pattern within block
                    \begin{scope}
                        % Define the number of signal steps
                        \def\signalsteps{6}
                        
                        % Compute step width and height of the triangular pattern
                        \pgfmathsetmacro{\stepwidth}{\cwidth/\signalsteps}
                        \pgfmathsetmacro{\signalheight}{\cheight/(1.3)}

                        % Start drawing the triangular signal
                        \draw[signalblue, thick] 
                    ($(blockBottomLeft) + (0.025, 0.1*\cheight)$) % Starting point with a margin
                    \foreach \x in {1,...,\signalsteps} {
                        -- ($
                            (blockBottomLeft) + 
                            (\x*\stepwidth - 0*\stepwidth, {0.1*\cheight + mod(\x, 2)*\signalheight})
                        $)
                    };
                    \end{scope}
                    \draw[->] (carrier.east) -- (carrier.east -| add1.south) coordinate (c1) -- (add1.south) node[anchor = north west] {$-$};
                    \draw[->] (add1.east) -- ++(2,0) node[ctrlblock, anchor = west, minimum width = \cwidth cm, minimum height = \cheight cm](comp1){};

                    \draw node[ctrlblock, below=0.2cm of comp1, minimum width = \cwidth cm, minimum height = \cheight cm](comp2){};
                    \draw[<-] (comp2.west) -- ++(-1,0) node[adder, anchor = east, name=add2]{};
                    \draw node[crossingshape, name=x1] at (add1.south |- add2.west) {};
                    \draw[-] ($(0,0)!0.5!(add1.west)$) to [short,*-] (\tikztostart |-  x1.west) to [short] (x1.west);
                    \draw[->] (x1.east) to [short] (add2.west) node[anchor = north east] {$-$};
                    \draw[->] (c1) to [short, *-, l=$c(t)$] (c1 -| add2.south) to [short] (add2.south) node[anchor = north west] {$-$};
                    
                    % Comperator block #1
                    \begin{axis}[at={(comp1)}, scale only axis, width = 0.8*\cwidth cm, height = 0.8*\cheight cm, anchor = center, xtick=\empty, ytick={0,1}, axis lines=middle, ymax=1.25, ymin = -1.25, font = \footnotesize, extra y ticks={-1}, extra y tick style = {yticklabel shift = -0.75cm}]
                        \addplot[thick, signalblue] coordinates {(-1,-1) (0,-1) (0,1) (1,1)};
                    \end{axis}
                     % Comperator block #2
                     \begin{axis}[at={(comp2)}, scale only axis, width = 0.8*\cwidth cm, height = 0.8*\cheight cm, anchor = center, xtick=\empty, ytick={0,1}, axis lines=middle, ymax=1.25, ymin = -1.25, font = \footnotesize, extra y ticks={-1}, extra y tick style = {yticklabel shift = -0.75cm}]
                        \addplot[thick, signalblue] coordinates {(-1,-1) (0,-1) (0,1) (1,1)};
                    \end{axis}
                    \draw[->] (comp1.east) -- ++(0.5,0) node[anchor = west]{$s_1(t)$};
                    \draw[->] (comp2.east) -- ++(0.5,0) node[anchor = west]{$s_2(t)$};
                \end{circuitikz}
                \caption{PWM with \hl{interleaved} switching}
                \label{fig:PWM_interleaved}
                \end{figure}}%
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM example with complementary switching %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM example with complementary switching} 
    \vspace{-0.1cm}
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec06}}
            \begin{groupplot}[group style={group size=1 by 5, xticklabels at = edge bottom, vertical sep=0.25cm}, height=0.31\textheight, width=0.875\textwidth, xmin=0, xmax=2*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi}, xticklabels = {0,$\nicefrac{1}{2}\pi$,$\pi$, $\nicefrac{3}{2}\pi$, $2\pi$}, ytick = {-1, 0, 1}, yticklabels = {$-1$, $0$, $1$}]

                 % Top plot: duty cycle reference and carrier signal
                \nextgroupplot[ylabel = {$s^*(t), c(t)$}, legend pos=north east, legend columns=2]
                \addplot[signalred, thick] table[x=wt, y=d, col sep=comma] {PWM_single_phase_comp_example.csv}; 
                \addplot[signalblue, thick] table[x=wt, y=c, col sep=comma] {PWM_single_phase_comp_example.csv}; 
                \legend{$s^*(t)$, $c(t)$}

                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$s_1(t)$}] 
                \addplot[signalgreen, thick] table[x=wt, y=s1, col sep=comma] {PWM_single_phase_comp_example.csv}; 

                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$s_2(t)$}] 
                \addplot[signallavender, thick] table[x=wt, y=s2, col sep=comma] {PWM_single_phase_comp_example.csv}; 

                % bottom middle plot: combined switching signal
                \nextgroupplot[ylabel = {$s(t)$}] 
                \addplot[signalblue, thick] table[x=wt, y=s, col sep=comma] {PWM_single_phase_comp_example.csv}; 

                % bottom plot: approximation error 
                \nextgroupplot[ylabel = {$e(t)$}, xlabel={$\omega t$}, ymax = 0.175, ymin = -0.175, ytick = {-0.15, 0, 0.15}, yticklabels = {$-0.15$, $0$, $0.15$}] 
                \addplot[signalblue, thick] table[x=wt, y=e, col sep=comma] {PWM_single_phase_comp_example.csv}; 
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM example with interleaved switching %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM example with interleaved switching} 
    \vspace{-0.1cm}
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec06}}
            \begin{groupplot}[group style={group size=1 by 5, xticklabels at = edge bottom, vertical sep=0.25cm}, height=0.31\textheight, width=0.875\textwidth, xmin=0, xmax=2*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi}, xticklabels = {0,$\nicefrac{1}{2}\pi$,$\pi$, $\nicefrac{3}{2}\pi$, $2\pi$}, ytick = {-1, 0, 1}, yticklabels = {$-1$, $0$, $1$}]

                 % Top plot: duty cycle reference and carrier signal
                \nextgroupplot[ylabel = {$s^*(t), c(t)$}, legend pos=north east, legend columns=2, ymin = -1.1, ymax =1.1]
                \addplot[signalred, thick] table[x=wt, y=d, col sep=comma] {PWM_single_phase_int_example.csv}; 
                \addplot[signalblue, thick] table[x=wt, y=c, col sep=comma] {PWM_single_phase_int_example.csv}; 
                \addplot[signalred, thick, dashed] table[x=wt, y expr=-\thisrow{d}, col sep=comma] {PWM_single_phase_int_example.csv};
                \legend{$s^*(t)$, $c(t)$}

                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$s_1(t)$}] 
                \addplot[signalgreen, thick] table[x=wt, y=s1, col sep=comma] {PWM_single_phase_int_example.csv}; 

                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$s_2(t)$}] 
                \addplot[signallavender, thick] table[x=wt, y=s2, col sep=comma] {PWM_single_phase_int_example.csv}; 

                % bottom middle plot: combined switching signal
                \nextgroupplot[ylabel = {$s(t)$}] 
                \addplot[signalblue, thick] table[x=wt, y=s, col sep=comma] {PWM_single_phase_int_example.csv}; 

                % bottom plot: approximation error 
                \nextgroupplot[ylabel = {$e(t)$}, xlabel={$\omega t$}, ymax = 0.175, ymin = -0.175, ytick = {-0.15, 0, 0.15}, yticklabels = {$-0.15$, $0$, $0.15$}] 
                \addplot[signalblue, thick] table[x=wt, y=e, col sep=comma] {PWM_single_phase_int_example.csv}; 
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM approximation error analysis %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM approximation error analysis} 
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \begin{tikzpicture}[baseline=(current bounding box.center)] % complemntary switching
                    \tikzmath{
                                real \d, \t1;
                                \d = 0.6;
                                \t1 = 0.5*(0.5+\d/2);
                            }
                     \begin{groupplot}[group style={group size=1 by 4, xticklabels at = edge bottom, vertical sep=1em}, 
                         width=0.9\textwidth,
                         height=0.27\textheight,
                         axis x line=middle,
                         axis y line=left,
                         xmin=-0.1, xmax=1.1,
                         ymin=-1.10, ymax=1.10,
                         xtick={0, 1/2, 1},
                         xticklabels={$0$,$\frac{T_\mathrm{s}}{2}$,$T_\mathrm{s}$},
                         ytick={-1,0,1},
                         yticklabels={$-1$,$0$,$1$},
                         grid=both,
                         clip=false,
                         xlabel={$t$},
                         xlabel style={anchor=west}
                         ]
                     \nextgroupplot[ylabel = {$s^*(t), c(t)$}, height=0.36\textheight]
                         \addplot[signalblue, thick] coordinates {(-0.1,-0.6) (0,-1) (0.5,1) (1,-1)(1.1,-0.6)};
                         \addplot[domain = -0.1:1.1, samples = 10, signalred, thick] {\d};   
                         \node[anchor=west] at (axis cs:1.1,\d) {$s^*$};
                         \draw[<->] (axis cs:\t1,-1) -- node[above, fill=white, inner sep=1pt,yshift=2pt]{\footnotesize$\frac{T_\mathrm{s}(1-s^*)}{2}$} (axis cs:1-\t1,-1);
                         \draw[<->] (axis cs:0,1) -- node[above, fill=white, inner sep=1pt,yshift=2pt]{\footnotesize$\frac{T_\mathrm{s}(1+s^*)}{4}$} (axis cs:\t1,1);
                         \draw[<->] (axis cs:1-\t1,1) -- node[above, fill=white, inner sep=1pt,yshift=2pt]{\footnotesize$\frac{T_\mathrm{s}(1+s^*)}{4}$} (axis cs:1,1);
                         \coordinate (a1) at (axis cs:\t1,1);
                         \coordinate (b1) at (axis cs:1-\t1,1);
                        
                        \nextgroupplot[ylabel = {$s_1(t)$}];
                            \addplot[signalgreen, thick] coordinates {(-0.1,1) (\t1,1) (\t1,-1) (1-\t1,-1) (1-\t1,1) (1.1,1)};
            
                        \nextgroupplot[ylabel = {$s_2(t)$}];
                        \addplot[signallavender, thick] coordinates {(-0.1,-1) (\t1,-1) (\t1,1) (1-\t1,1) (1-\t1,-1) (1.1,-1)};
            
                        \nextgroupplot[ylabel = {$u_2(t)/U_1$}, , height=0.36\textheight, xticklabel style={below, yshift=-0.75cm}];
                            \addplot[domain = -0.1:1.1, samples = 10, signalblue, thick, dashed, name path = A] {\d}; 
                            \node[anchor=west] at (axis cs:1.1,\d) {$\overline{u}_2$};
                            \addplot[signalblue, thick, name path = B] coordinates {(-0.1,1) (\t1,1) (\t1,-1) (1-\t1,-1) (1-\t1,1) (1.1,1)};
                            \coordinate (a2) at (axis cs:\t1,0);
                            \coordinate (b2) at (axis cs:1-\t1,0);
                            \draw[thin] (axis cs:0.55,-0.4) -- (axis cs:0.7,-0.6) node[right, anchor=west]{\footnotesize$e(t)$};
                            \draw[thin] (axis cs:\t1,-1.1) -- (axis cs:\t1-0.05,-1.3) node[left, anchor=north east, inner sep = 1pt]{\footnotesize$t_1$};
                            \draw[thin] (axis cs:1-\t1,-1.1) -- (axis cs:1-\t1+0.05,-1.3) node[right, anchor=north west, inner sep = 1pt]{\footnotesize$t_2$};
                            \tikzfillbetween[of=A and B, soft clip={domain=0:1}]{shadecolor, opacity=0.3};
                     \end{groupplot}
                     \begin{scope}[on background layer]
                        \draw [dashed] (a1) -- (a2);
                        \draw [dashed] (b1) -- (b2);
                    \end{scope}
             \end{tikzpicture}
             \vspace{-0.25cm}
             \caption{Pulse pattern for complementary PWM}
             \label{fig:complementary_PWM_single_phase_error}
            \end{figure}
        \end{column}
        \begin{column}{0.5\textwidth}
            \onslide<2->{%
            \begin{figure}
                \begin{tikzpicture}[baseline=(current bounding box.center)] % interleaved switching
                    \tikzmath{
                                real \d, \t1;
                                \d = 0.6;
                                \t1 = 0.5*(0.5+\d/2);
                                \t2 = (1-\d)/4;
                            }
                     \begin{groupplot}[group style={group size=1 by 4, xticklabels at = edge bottom, vertical sep=1em}, 
                         width=0.9\textwidth,
                         height=0.27\textheight,
                         axis x line=middle,
                         axis y line=left,
                         xmin=-0.1, xmax=1.1,
                         ymin=-1.10, ymax=1.10,
                         xtick={0, 1/2, 1},
                         xticklabels={$0$,$\frac{T_\mathrm{s}}{2}$,$T_\mathrm{s}$},
                         ytick={-1,0,1},
                         yticklabels={$-1$,$0$,$1$},
                         grid=both,
                         clip=false,
                         xlabel={$t$},
                         xlabel style={anchor=west}
                         ]
                     \nextgroupplot[ylabel = {$s^*(t), c(t)$}, height=0.36\textheight]
                         \addplot[signalblue, thick] coordinates {(-0.1,-0.6) (0,-1) (0.5,1) (1,-1)(1.1,-0.6)};
                         \addplot[domain = -0.1:1.1, samples = 10, signalred, thick] {\d};   
                         \addplot[domain = -0.1:1.1, samples = 10, signalred, thick, dashed] {-\d};   
                         \node[anchor=west] at (axis cs:1.1,\d) {$s^*$};
                         \node[anchor=west, overlay] at (axis cs:1.1,-\d) {$-s^*$};
                         \draw[<->] (axis cs:\t1,-1) -- node[above, fill=white, inner sep=1pt,yshift=2pt]{\footnotesize$\frac{T_\mathrm{s}(1-|s^*|)}{2}$} (axis cs:1-\t1,-1);
                         \draw[<->] (axis cs:0,1) -- node[above, fill=white, inner sep=1pt,yshift=2pt]{\footnotesize$\frac{T_\mathrm{s}(1+|s^*|)}{4}$} (axis cs:\t1,1);
                         \draw[<->] (axis cs:1-\t1,1) -- node[above, fill=white, inner sep=1pt,yshift=2pt]{\footnotesize$\frac{T_\mathrm{s}(1+|s^*|)}{4}$} (axis cs:1,1);
                         \coordinate (a1) at (axis cs:\t1,1);
                         \coordinate (b1) at (axis cs:1-\t1,1);
                        
                        \nextgroupplot[ylabel = {$s_1(t)$}];
                            \addplot[signalgreen, thick] coordinates {(-0.1,1) (\t1,1) (\t1,-1) (1-\t1,-1) (1-\t1,1) (1.1,1)};
            
                        \nextgroupplot[ylabel = {$s_2(t)$}];
                        \addplot[signallavender, thick] coordinates {(-0.1,1) (\t2,1) (\t2,-1) (1-\t2,-1) (1-\t2,1) (1.1,1)};
            
                        \nextgroupplot[ylabel = {$u_2(t)/U_1$}, , height=0.36\textheight, xticklabel style={below, yshift=-0.75cm}];
                            \addplot[domain = -0.1:1.1, samples = 10, signalblue, thick, dashed, name path = A] {\d}; 
                            \node[anchor=west] at (axis cs:1.1,\d) {$\overline{u}_2$};
                            \addplot[signalblue, thick, name path = B] coordinates {(-0.1,0) (\t2,0) (\t2,1) (\t1,1) (\t1,0) (1-\t1,0) (1-\t1,1) (1-\t2,1) (1-\t2,0) (1.1,0)};
                            \coordinate (a2) at (axis cs:\t1,0);
                            \coordinate (b2) at (axis cs:1-\t1,0);
                            \draw node[inner sep = 1pt, anchor=north] at (\t1, -0.1) {\footnotesize$t_1$};
                            \draw node[inner sep = 1pt, anchor=north] at (1-\t1, -0.1) {\footnotesize$t_2$};
                            \tikzfillbetween[of=A and B, soft clip={domain=0:1}]{shadecolor, opacity=0.3};
                            \draw[thin] (axis cs:0.565,0.25) -- (axis cs:0.75,-0.5) node[right, anchor=west]{\footnotesize$e(t)$};
                     \end{groupplot}
                     \begin{scope}[on background layer]
                        \draw [dashed] (a1) -- (a2);
                        \draw [dashed] (b1) -- (b2);
                    \end{scope}
             \end{tikzpicture}
             \vspace{-0.25cm}
             \caption{Pulse pattern for interleaved PWM}
             \label{fig:interleaved_PWM_single_phase_error}
            \end{figure}}%
        \end{column}
    \end{columns}  
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM approximation error analysis (cont.)%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM approximation error analysis (cont.)} 
    To evaluate the error between the reference $s^*(t)$ and the switched output voltage $u_2(t)$, we introduce the following \hl{normalized integral difference}:
    \begin{equation}
        e(t) = \frac{1}{T_\mathrm{s}}\int_{t_0}^{t}\left(s^*(\tau)-s(\tau)\right)\mathrm{d}\tau.
    \end{equation}\pause
    This error can be interpreted as the resulting \hl{current ripple} assuming a pure inductive load $L$ at a constant input voltage $u_1(t)=U_1$:
    \begin{equation}
        \Delta i_2(t) = \frac{T_\mathrm{s}U_1}{2 L } \left|e(t)\right|.
        \label{eq:current_ripple_PWM_single_phase_ACDC}
    \end{equation}\pause
    For a constant reference $s^*(t)=s^*$, the biggest error corresponds to the integral over the time interval $[t_1, t_2]$ as can be seen in \figref{fig:complementary_PWM_single_phase_error} and \figref{fig:interleaved_PWM_single_phase_error}:
    \begin{equation}
        \begin{alignedat}{3}
        &\mbox{complimentary switching (cs):}\quad &&\max_t e_{\mathrm{cs}}(t) &&= \frac{1}{T_s}\left(s^* + 1\right)\left(t_2-t_1\right) = \frac{1}{2}\left(s^* + 1\right)\left(1-s^*\right),\\
        &\mbox{interleaved switching (is):}\quad &&\max_t e_{\mathrm{is}}(t) &&= \frac{1}{T_s}\left|s^*\right|\left(t_2-t_1\right) = \frac{1}{2}\left|s^*\right|\left(1-\left|s^*\right|\right).
        \end{alignedat}
        \label{eq:max_errors_comp_int_PWM_signle_phase}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM approximation error analysis (cont.)%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM approximation error analysis (cont.)} 
    Further, analyzing \eqref{eq:max_errors_comp_int_PWM_signle_phase}
    \begin{equation}
            \frac{\mathrm{d}}{\mathrm{d}s^*}\left(\max_t e_{\mathrm{cs}}(t)\right) = -2s^*,\qquad
            \frac{\mathrm{d}}{\mathrm{d}s^*}\left(\max_t e_{\mathrm{is}}(t)\right) = \mathrm{sgn}(s^*) -2s^*
    \end{equation}\pause
    reveals the worst case deviation at a switching reference of:
    \begin{equation}
            \argmax_{s^*}\left\{\max_t e_{\mathrm{cs}}(t)\right\} = 0,\qquad
             \argmax_{s^*}\left\{\max_t e_{\mathrm{is}}(t)\right\} = \pm \frac{1}{2}.
    \end{equation}\pause
    Inserting this finding into \eqref{eq:current_ripple_PWM_single_phase_ACDC} delivers
    \begin{equation}
        \begin{alignedat}{4}
        &\Delta i_{2,\mathrm{cs}} &&= (1-s^*)(1+s^*) \Delta i_{2,\mathrm{cs}, \mathrm{max}} \quad &&\mbox{with} \quad &&\Delta i_{2,\mathrm{cs}, \mathrm{max}} = \frac{T_\mathrm{s}U_1}{2L},\\ 
        &\Delta i_{2,\mathrm{is}} &&= 4\left|s^*\right|(1-\left|s^*\right|) \Delta i_{2,\mathrm{is}, \mathrm{max}} \quad &&\mbox{with} \quad &&\Delta i_{2,\mathrm{is}, \mathrm{max}} = \frac{T_\mathrm{s}U_1}{8L}.
        \end{alignedat}
    \end{equation}
    Hence, the current ripple of the interleaved PWM is only $\nicefrac{1}{4}$ of the complementary PWM.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM approximation error analysis (cont.)%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM approximation error analysis (cont.)} 
    \begin{columns}
        \begin{column}{0.45\textwidth}
            \onslide<2->{Reasons for current ripple reduction of interleaved vs. complimentary PWM:}%
            \begin{itemize}
                \item<2-> Effective pulse number doubled:
                \begin{itemize} 
                    \item<2-> CS: $f_\mathrm{p} = f_\mathrm{s}$
                    \item<2-> IS: $f_\mathrm{p} = 2f_\mathrm{s}$
                \end{itemize}\vspace{1em}
                \item<3-> Output voltage steps halved: 
                \begin{itemize} 
                    \item<3-> CS: $\Delta u_2 = \pm 2 U_1$
                    \item<4-> IS: $\Delta u_2 = \pm  U_1$
                \end{itemize}
            \end{itemize}
            \vspace{-0.2cm}
            \onslide<4->{%
            \begin{varblock}{Note on applicability}
                This analysis only holds for $s^*=\mathrm{const.}$ and can be transferred only approximately for $s^*(t)=f(\omega)$ if $T_s<<\frac{2\pi}{\omega}$. 
            \end{varblock}}
        \end{column}
        \begin{column}{0.55\textwidth}
            \begin{figure}
                \begin{tikzpicture}
                    \begin{axis}[
                        xlabel={$s^*$},
                        ylabel={$\Delta i_2 / \Delta i_{2,\mathrm{cs}, \mathrm{max}}$},
                        ymin=0, ymax=1.1,
                        xmin=-1, xmax=1,
                        width = 0.99\textwidth,
                        height = 0.65\textheight,
                        grid,
                        thick,
                        clip = true,
                        xtick = {-1, -0.5, 0, 0.5,1.0}, 
                        ytick = {0, 0.25, 0.5, 0.75, 1.0}, 
                        ]
                        \addplot[signalblue, domain=-1:1, samples=50] {(1-x)*(1+x)};
                        \addplot[signalred, domain=-1:1, samples=50] {(1-abs(x))*abs(x)};
                        \legend{cs, is};
                    \end{axis}
                \end{tikzpicture}
                \caption{Current ripple as a function of the single-phase AC/DC normalized reference output voltage $s^*$}
                \label{fig:current_ripple_single_phase_ACDC}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Overmodulation %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Overmodulation} 
    \vspace{-0.1cm}
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec06}}
            \begin{groupplot}[group style={group size=1 by 5, xticklabels at = edge bottom, vertical sep=0.25cm}, height=0.31\textheight, width=0.875\textwidth, xmin=0, xmax=2*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi}, xticklabels = {0,$\nicefrac{1}{2}\pi$,$\pi$, $\nicefrac{3}{2}\pi$, $2\pi$}, ytick = {-1, 0, 1}, yticklabels = {$-1$, $0$, $1$}]

                 % Top plot: duty cycle reference and carrier signal
                \nextgroupplot[ylabel = {$s^*(t), c(t)$}, ymin = -1.25, ymax =1.25, legend pos=north east, legend columns=2 ]
                \addplot[signalred, thick] table[x=wt, y=d, col sep=comma] {PWM_single_phase_overmod_example.csv}; 
                \addplot[signalblue, thick] table[x=wt, y=c, col sep=comma] {PWM_single_phase_overmod_example.csv}; 
                \addplot[signalred, thick, dashed] table[x=wt, y expr=-\thisrow{d}, col sep=comma] {PWM_single_phase_overmod_example.csv};
                \legend{$s^*(t)$, $c(t)$}

                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$s_1(t)$}] 
                \addplot[signalgreen, thick] table[x=wt, y=s1, col sep=comma] {PWM_single_phase_overmod_example.csv}; 

                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$s_2(t)$}] 
                \addplot[signallavender, thick] table[x=wt, y=s2, col sep=comma] {PWM_single_phase_overmod_example.csv}; 

                % bottom middle plot: combined switching signal
                \nextgroupplot[ylabel = {$s(t)$}] 
                \addplot[signalblue, thick] table[x=wt, y=s, col sep=comma] {PWM_single_phase_overmod_example.csv}; 

                % bottom plot: approximation error 
                \nextgroupplot[ylabel = {$e(t)$}, xlabel={$\omega t$}, ymax = 0.2, ymin = -0.2, ytick = {-0.15, 0, 0.15}, yticklabels = {$-0.15$, $0$, $0.15$}] 
                \addplot[signalblue, thick] table[x=wt, y=e, col sep=comma] {PWM_single_phase_overmod_example.csv}; 
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Overmodulation (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Overmodulation (cont.)} 
    \begin{columns}
        \begin{column}{0.45\textwidth}
            Considering a normalized input reference
        $$ s^*(t) = A\sin(\omega t)$$
        one can distinguish two PWM operation areas:
        \begin{itemize}
            \item $A \leq 1$: linear modulation, 
            \item $A > 1$: overmodulation.
        \end{itemize}
        \vspace{-0.25cm}
        \onslide<2->{%
            \begin{varblock}{Harmonics}
                While the normalized output voltage fundamental can be increased beyond unity via overmodulation, increased voltage harmonics must be accepted.   
            \end{varblock}}
        \end{column}
        \begin{column}{0.55\textwidth}
            \begin{figure}
                \begin{tikzpicture}
                    \begin{axis}[
                        xlabel={$A$},
                        ylabel={$\hat{u}_2^{(1)}/U_1$},
                        ymin=0, ymax=4/pi*1.2,
                        xmin=0, xmax=3,
                        width = 0.95\textwidth,
                        height = 0.7\textheight,
                        grid,
                        thick,
                        clip = true,
                        ytick = {0, 0.25, 0.5, 0.75, 1.0, 4/pi}, 
                        yticklabels = {$0$, $0.25$, $0.5$, $0.75$, $1$, $\nicefrac{4}{\pi}$}, 
                        ]
                        \addplot[signalblue, domain=0:1, samples=10] {x};
                        \addplot[signalblue, domain=1:3, samples=40, smooth] {4/pi + rad(asin(1/x))*(2/pi -8/pi^2)};
                        \draw[dashed] (axis cs:0, 4/pi) -- (axis cs:3, 4/pi);
                        \draw[dash dot] (axis cs:1, 0) -- (axis cs:1, 4/pi);
                        \draw node[fill=white, inner sep = 1pt] at (axis cs:0.5,1) {\small linear mod.};
                        \draw node[fill=white, inner sep = 1pt] at (axis cs:2,1) {\small overmodulation};
                        \draw node[fill=white, inner sep = 1pt, above] at (axis cs:1.5,4/pi) {\small Fundamental freq. mod. ($f_\mathrm{s}=2\cdot\nicefrac{\omega}{2 \pi}$)};
                    \end{axis}
                \end{tikzpicture}
                \caption{Reference amplitude to output voltage fundamental amplitude}
                \label{fig:Overmodulation_single_phase_gain}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Fundamental frequency modulation %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Fundamental frequency modulation (aka square wave modulation)} 
    \begin{figure}
        \begin{tikzpicture}
            \def\a{0.6*pi}
            \begin{groupplot}[group style={group size=1 by 4, xticklabels at = edge bottom, vertical sep=0.25cm}, height=0.34\textheight, width=0.875\textwidth, xmin=0, xmax=2*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi}, xticklabels = {0,$\nicefrac{1}{2}\pi$,$\pi$, $\nicefrac{3}{2}\pi$, $2\pi$}, ytick = {-1, 0, 1}, yticklabels = {$-1$, $0$, $1$}]


                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$s_1(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,-1) (\a,-1) (\a,1) (\a+pi,1) (\a+pi,-1) (2*pi,-1)}; 

                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$s_2(t)$}] 
                \addplot[signallavender, thick, domain = 0:2*pi, samples = 100] coordinates {(0,1) (\a,1) (\a,-1) (\a+pi,-1) (\a+pi,1) (2*pi,1)}; 

                % bottom middle plot: combined switching signal
                \nextgroupplot[ylabel = {$s(t)$}, ymin = -1.1*4/pi, ymax =1.1*4/pi] 
                \addplot[signalblue, thick, domain = 0:2*pi, samples = 100] coordinates {(0,-1) (\a,-1) (\a,1) (\a+pi,1) (\a+pi,-1) (2*pi,-1)}; 
                \addplot[signalblue, thick, domain=0:2*pi, samples=50, dashed] {4/pi*sin(deg(x-\a))};
                \draw[->] (axis cs:0,0) -- node[above, fill=white, inner sep=1pt]{\small$\alpha$} (axis cs:\a,0); 
                \draw[thin] (axis cs:\a+pi+0.2, -0.1) -- node[right, fill=white, inner sep=1pt]{\small $\frac{\hat{u}_2^{(1)}}{U_1}=s^*$} (axis cs:\a+pi+0.5, 0.6);

                % bottom plot: approximation error 
                \nextgroupplot[ylabel = {$e(t)$}, xlabel={$\omega t$}, ymin=-0.5, ymax=0.5, ytick = {-0.5, 0, 0.5}, yticklabels = {$-0.5$, $0$, $0.5$}] 
                \addplot[signalblue, thick, domain=0:\a, samples=25] {-4/pi*(cos(deg(x-\a))-cos(deg(-\a)))+x}; 
                \addplot[signalblue, thick, domain=\a:\a+pi, samples=25] {-4/pi*(cos(deg(x-\a))-cos(deg(\a)))-(x-2*\a)}; 
                \addplot[signalblue, thick, domain=\a+pi:2*pi, samples=25] {-4/pi*(cos(deg(x-\a))-cos(deg(\a)))+(x-2*pi)}; 
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Fundamental frequency modulation %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Fundamental frequency modulation (cont.)} 
    \onslide<1->{The fundamental frequency modulation leads to a pulse pattern synchronized with the fundamental output voltage $\hat{u}_2^{(1)}(t)$, i.e., there are exactly \hl{two switching actions per fundamental} period $$ f_\mathrm{s} = 2\frac{\omega}{2\pi} = \frac{\omega}{\pi}.$$}% 
    \onslide<2->{The fundamental output voltage amplitude can be derived from the corresponding \hl{Fourier coefficient}}
    \begin{equation}
        \begin{split}
            \onslide<2->{\hat{u}_2^{(k)} &= \frac{1}{\pi} \int_{\alpha}^{\alpha + \pi} u_2(t)\sin(k (\omega t-\alpha)) \mathrm{d}\omega t}\onslide<3->{ = \frac{2}{\pi} \int_{}^{\pi/2} U_1 \sin(k \omega t) \mathrm{d}\omega t} \\
                & \onslide<4->{= \frac{2}{\pi} \left[-\frac{U_1}{k} \cos(k \omega t)\right]_{0}^{\pi/2}} \onslide<5->{= \frac{2}{\pi} \left[\frac{U_1}{k} \left(\cos(0) - \cos(k(\pi/2))\right)\right]} \\
                &\onslide<6->{= \frac{4}{\pi} U_1 \frac{1}{k}, \quad k=1,3,5,7,\ldots}
            \end{split}
    \end{equation}
    \onslide<7->{The fundamental output voltage amplitude is thus given by $ \hat{u}_2^{(1)} = \nicefrac{4}{\pi} \cdot U_1$ which is fixed due to fundamental frequency modulation while only the phase angle $\alpha$ can be adjusted.}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Blanking / interlocking time %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Blanking / interlocking time} 
    \begin{columns}
        \begin{column}{0.45\textwidth}
            When the $i$-th half bridge is actuated, i.e., changes it switching state, an interlocking / blanking time $t_0$ is introduced to avoid short-circuiting the DC link:
            \begin{itemize}
                \item First: turn off conducting transistor,
                \item Second: wait $t_0$ \newline(ensure safe turn off),
                \item Third: turn on the other transistor.
            \end{itemize}
            \vspace{-0.5cm}
            \begin{varblock}{Background}
                Signal delays or component tolerances lead to varying switch on/off times, which is why the interlock ensures an orderly switching process.
            \end{varblock}
        \end{column}
        \hfill
        \begin{column}{0.55\textwidth}
            \begin{figure}
                \begin{circuitikz}[]
                    \ctikzset{amplifiers/scale=0.25} % Scale of amplifier
                    \draw (0,0) to [Tnpn, n=npn1, invert, bodydiode] ++(0,-2) coordinate (A)
                    to [Tnpn, n=npn2, invert, bodydiode] ++(0,-2) coordinate (B)
                    ($(npn1.E)!0.5!(npn2.C)$) to [short, i=$i_2(t)$, *-o] ++(1.5,0) coordinate (C);
                    \draw (npn1.B) node[plain mono amp, anchor = out, name=amp1]{};
                    \draw (npn2.B) node[plain mono amp, anchor = out, name=amp2]{};
                    \draw let \p1 = (amp1.up) in node[anchor=south, yshift=1mm] at (\x1,\y1) {$s_{i,1}(t)$};
                    \draw let \p1 = (amp2.up) in node[anchor=south, yshift=1mm] at (\x1,\y1) {$s_{i,2}(t)$};
                    \draw let \p1 = (npn1.C) in node[anchor=north east, yshift=1mm] at (\x1,\y1) {$T_1$};
                    \draw let \p1 = (npn2.C) in node[anchor=north east, yshift=1mm] at (\x1,\y1) {$T_2$};
                    \draw ($(amp1.in)!0.5!(amp2.in) + (-1.25,0)$) node [block, minimum width = 1cm, minimum height = 0.75cm] (driver) {\small Driver};
                    \draw ($(driver.north east)!0.5!(driver.east)$) to ++(0.25,0) |- (amp1.in);
                    \draw ($(driver.south east)!0.5!(driver.east)$) to ++(0.25,0) |- (amp2.in);
                    \draw[<-] (driver.west) to node[above]{$s_i(t)$} ++(-0.75,0) coordinate (D);
                    \draw let \p1 = (D) in (B) to [short] ++($(\x1 - 0.5cm, 0)$) coordinate (E);
                    \draw let \p1 = (D) in (0,0) to [short, -o, -o, i<_=$i_1(t)$] ++($(\x1 - 0.5cm, 0)$) to [open, v=$u_1(t)\hspace{0.5cm}$, voltage = straight]  (E);
                    \draw (C) to [open, v^=$\hspace{0.5cm}u_2(t)$, voltage = straight] ++(0,-2) to [short, o-*] (B);
                \end{circuitikz}
                \caption{Actuation of one half-bridge branch}
                \label{fig:half_bridge_actuation}
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{Current paths depending on the switching state and current flow direction} 
    \begin{figure}
        \centering
        \begin{subfigure}{0.32\textwidth}
            \centering
            \begin{circuitikz}[]
                \draw (0,0) node[npn, bodydiode]{};
                \draw (0,0) node[npn, name=npn1, color=signalred]{};
                \draw (0,-1.5) node[npn, name=npn2, bodydiode]{};
                \draw[signalred] (npn1.E) to [short,*-, color=signalred] ++(0.5,0) to [short, i={$i>0$}, color=signalred] ++(0.5,0);
                \draw (npn1.B) node[anchor=east, yshift=-1pt] {$s_{i,1}=1$};
                \draw (npn2.B) node[anchor=east, yshift=-1pt] {$s_{i,2}=0$};
            \end{circuitikz}
            \\[1em]
            \begin{circuitikz}[]
                \draw[signalred] (0,0) node[npn, bodydiode, color=signalred]{};
                \draw (0,0) node[npn, name=npn1]{};
                \draw[signalred] (npn1.body E in) to (npn1.E);
                \draw[signalred] (npn1.body C in) to (npn1.C);
                \draw (0,-1.5) node[npn, name=npn2, bodydiode]{};
                \draw[signalred] (npn1.E) to [short,*-, color=signalred] ++(0.5,0) to [short, i={$i<0$}, color=signalred] ++(0.5,0);
                \draw (npn1.B) node[anchor=east, yshift=-1pt] {$s_{i,1}=1$};
                \draw (npn2.B) node[anchor=east, yshift=-1pt] {$s_{i,2}=0$};
            \end{circuitikz}
            \caption{Upper transistor on}
        \end{subfigure}
        %
        \begin{subfigure}{0.32\textwidth}
            \centering
            \begin{circuitikz}[]
                \draw (0,0) node[npn, name=npn1, bodydiode]{};
                \draw[signalred] (0,-1.5) node[npn, name=npn2, bodydiode, color=signalred]{};
                \draw (0,-1.5) node[npn]{};
                \draw[signalred] (npn1.E) to [short,*-, color=signalred] ++(0.5,0) to [short, i={$i>0$}, color=signalred] ++(0.5,0);
                \draw (npn1.B) node[anchor=east, yshift=-1pt] {$s_{i,1}=0$};
                \draw (npn2.B) node[anchor=east, yshift=-1pt] {$s_{i,2}=1$};
                \draw[signalred] (npn2.body E in) to (npn2.E);
                \draw[signalred] (npn2.body C in) to (npn2.C);
            \end{circuitikz}
            \\[1em]
            \begin{circuitikz}[]
                \draw (0,0) node[npn, name=npn1, bodydiode]{};
                \draw (0,-1.5) node[npn, name=npn2, bodydiode]{};
                \draw[signalred] (0,-1.5) node[npn, color=signalred]{};
                \draw[signalred] (npn1.E) to [short,*-, color=signalred] ++(0.5,0) to [short, i={$i<0$}, color=signalred] ++(0.5,0);
                \draw (npn1.B) node[anchor=east, yshift=-1pt] {$s_{i,1}=0$};
                \draw (npn2.B) node[anchor=east, yshift=-1pt] {$s_{i,2}=1$};
            \end{circuitikz}
            \caption{Lower transistor on}
        \end{subfigure}
        \begin{subfigure}{0.32\textwidth}
            \centering
            \begin{circuitikz}[]
                \draw (0,0) node[npn, name=npn1, bodydiode]{};
                \draw[signalred] (0,-1.5) node[npn, name=npn2, bodydiode, color=signalred]{};
                \draw (0,-1.5) node[npn]{};
                \draw[signalred] (npn1.E) to [short,*-, color=signalred] ++(0.5,0) to [short, i={$i>0$}, color=signalred] ++(0.5,0);
                \draw (npn1.B) node[anchor=east, yshift=-1pt] {$s_{i,1}=0$};
                \draw (npn2.B) node[anchor=east, yshift=-1pt] {$s_{i,2}=0$};
                \draw[signalred] (npn2.body E in) to (npn2.E);
                \draw[signalred] (npn2.body C in) to (npn2.C);
            \end{circuitikz}
            \\[1em]
            \begin{circuitikz}[]
                \draw[signalred] (0,0) node[npn, bodydiode, color=signalred]{};
                \draw (0,0) node[npn, name=npn1]{};
                \draw[signalred] (npn1.body E in) to (npn1.E);
                \draw[signalred] (npn1.body C in) to (npn1.C);
                \draw (0,-1.5) node[npn, name=npn2, bodydiode]{};
                \draw[signalred] (npn1.E) to [short,*-, color=signalred] ++(0.5,0) to [short, i={$i<0$}, color=signalred] ++(0.5,0);
                \draw (npn1.B) node[anchor=east, yshift=-1pt] {$s_{i,1}=0$};
                \draw (npn2.B) node[anchor=east, yshift=-1pt] {$s_{i,2}=0$};
            \end{circuitikz}
            \caption{Both transistors off}
        \end{subfigure}
    \end{figure}                
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Blanking / interlocking time: positive load current %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Blanking / interlocking time: positive load current} 
    \vspace{-0.1cm}
    \begin{figure}
        \begin{tikzpicture}
            \def\a{0.33*pi}
            \def\it{0.1*pi}
            \begin{groupplot}[group style={group size=1 by 5, xticklabels at = edge bottom, vertical sep=0.25cm}, height=0.31\textheight, width=0.875\textwidth, xmin=0, xmax=2*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi}, xticklabels = {0,$\nicefrac{1}{4}$,$\nicefrac{1}{2}$, $\nicefrac{3}{2}$, $1$}, ytick = {-1, 0, 1}, yticklabels = {$-1$, $0$, $1$}]

                % switching input
                \nextgroupplot[ylabel = {$s_i(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,-1) (\a,-1) (\a,1) (\a+pi,1) (\a+pi,-1) (2*pi,-1)};
                \coordinate (a1) at (axis cs:\a,1);
                \coordinate (a2) at (axis cs:\a+\it,1);
                \coordinate (a3) at (axis cs:\a+pi,1);

                % top transistor 
                \nextgroupplot[ylabel = {$s_{i,1}(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,-1) (\a+\it,-1) (\a+\it,1) (\a+pi,1) (\a+pi,-1) (2*pi,-1)}; 
                \draw[<->] (axis cs:\a,0) -- node[above, fill=white, inner sep=1pt, yshift=1mm]{\small$t_0$} (axis cs:\a+\it,0);
                

                % bottom transistor
                \nextgroupplot[ylabel = {$s_{i,2}(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,1) (\a,1) (\a,-1) (\a+pi+\it,-1) (\a+pi+\it,1) (2*pi,1)}; 
                

                % current 
                \nextgroupplot[ylabel = {$i_{2}(t)$}, ytick = {0}, yticklabels = {$0$}, ymin = 0] 
                \addplot[signalred, thick] coordinates {(0,0.95/pi*\a) (\a,0.2) (\a+pi,0.95) (2*pi,0.95/pi*\a)}; 

                % switching input
                \nextgroupplot[ylabel = {$u_2(t)/U_1$}, ymin = -0.1, xlabel={$t/T_\mathrm{s}$}] 
                \addplot[signalblue, thick] coordinates {(0,0) (\a+\it,0) (\a+\it,1) (\a+pi,1) (\a+pi,0) (2*pi,0)}; 
                \addplot[signalblue, thick, dashed] coordinates {(\a,0) (\a,1) (\a+\it,1)}; 
                \fill [signalblue, opacity=0.3] (axis cs:\a,0) rectangle (axis cs:\a+\it,1);
                \draw[thin] (axis cs:\a+\it/2,0.5) -- (axis cs:\a-0.2,0.5) node[anchor=east, align=center]{$\Delta u$}; 
                \coordinate (b1) at (axis cs:\a,0);
                \coordinate (b2) at (axis cs:\a+\it,0);
                \coordinate (b3) at (axis cs:\a+pi,0);
            \end{groupplot}
            \draw[thin, dashed] (a1) -- (b1);
            \draw[thin, dashed] (a2) -- (b2);
            \draw[thin, dashed] (a3) -- (b3);
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Blanking / interlocking time: negative load current %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Blanking / interlocking time: negative load current} 
    \vspace{-0.1cm}
    \begin{figure}
        \begin{tikzpicture}
            \def\a{0.33*pi}
            \def\it{0.1*pi}
            \begin{groupplot}[group style={group size=1 by 5, xticklabels at = edge bottom, vertical sep=0.25cm}, height=0.31\textheight, width=0.875\textwidth, xmin=0, xmax=2*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi}, xticklabels = {0,$\nicefrac{1}{4}$,$\nicefrac{1}{2}$, $\nicefrac{3}{2}$, $1$}, ytick = {-1, 0, 1}, yticklabels = {$-1$, $0$, $1$}]

                % switching input
                \nextgroupplot[ylabel = {$s_i(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,-1) (\a,-1) (\a,1) (\a+pi,1) (\a+pi,-1) (2*pi,-1)};
                \coordinate (a1) at (axis cs:\a,1);
                \coordinate (a2) at (axis cs:\a+pi,1);
                \coordinate (a3) at (axis cs:\a+pi+\it,1);

                % top transistor 
                \nextgroupplot[ylabel = {$s_{i,1}(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,-1) (\a+\it,-1) (\a+\it,1) (\a+pi,1) (\a+pi,-1) (2*pi,-1)}; 
                

                % bottom transistor
                \nextgroupplot[ylabel = {$s_{i,2}(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,1) (\a,1) (\a,-1) (\a+pi+\it,-1) (\a+pi+\it,1) (2*pi,1)}; 
                \draw[<->] (axis cs:\a+pi,0) -- node[above, fill=white, inner sep=1pt, yshift=1mm]{\small$t_0$} (axis cs:\a+\it+pi,0);

                % current 
                \nextgroupplot[ylabel = {$i_{2}(t)$}, ytick = {0}, yticklabels = {$0$}, ymin = -1, ymax=0] 
                \addplot[signalred, thick] coordinates {(0,{-0.2-0.65*(1-\a/pi)}) (\a,0.2-1) (\a+pi,0.85-1) (2*pi,{-0.2-0.65*(1-\a/pi)})}; 

                % switching input
                \nextgroupplot[ylabel = {$u_2(t)/U_1$}, ymin = -0.1, xlabel={$t/T_\mathrm{s}$}] 
                \addplot[signalblue, thick] coordinates {(0,0) (\a,0) (\a,1) (\a+pi+\it,1) (\a+pi+\it,0) (2*pi,0)}; 
                \addplot[signalblue, thick, dashed] coordinates {(\a+pi,1) (\a+pi+\it,1) (\a+\it+pi,0)}; 
                \fill [signalblue, opacity=0.3] (axis cs:\a+pi,0) rectangle (axis cs:\a+\it+pi,1);
                \draw[thin] (axis cs:\a+\it/2+pi,0.5) -- (axis cs:\a+0.2+pi+\it,0.5) node[anchor=west, align=center]{$\Delta u$}; 
                \coordinate (b1) at (axis cs:\a,0);
                \coordinate (b2) at (axis cs:\a+pi,0);
                \coordinate (b3) at (axis cs:\a+\it+pi,0);
            \end{groupplot}
            \draw[thin, dashed] (a1) -- (b1);
            \draw[thin, dashed] (a2) -- (b2);
            \draw[thin, dashed] (a3) -- (b3);
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Blanking / interlocking time: discontinuous conduction %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Blanking / interlocking time: discontinuous conduction} 
    \vspace{-0.1cm}
    \begin{figure}
        \begin{tikzpicture}
            \def\a{0.33*pi}
            \def\it{0.1*pi}
            \begin{groupplot}[group style={group size=1 by 5, xticklabels at = edge bottom, vertical sep=0.25cm}, height=0.31\textheight, width=0.875\textwidth, xmin=0, xmax=2*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi}, xticklabels = {0,$\nicefrac{1}{4}$,$\nicefrac{1}{2}$, $\nicefrac{3}{2}$, $1$}, ytick = {-1, 0, 1}, yticklabels = {$-1$, $0$, $1$}]

                % switching input
                \nextgroupplot[ylabel = {$s_i(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,-1) (\a,-1) (\a,1) (\a+pi,1) (\a+pi,-1) (2*pi,-1)};
                \coordinate (a1) at (axis cs:\a,1);
                \coordinate (a2) at (axis cs:\a+\it,1);
                \coordinate (a3) at (axis cs:\a+pi,1);

                % top transistor 
                \nextgroupplot[ylabel = {$s_{i,1}(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,-1) (\a+\it,-1) (\a+\it,1) (\a+pi,1) (\a+pi,-1) (2*pi,-1)}; 
                \draw[<->] (axis cs:\a,0) -- node[above, fill=white, inner sep=1pt, yshift=1mm]{\small$t_0$} (axis cs:\a+\it,0);
                

                % bottom transistor
                \nextgroupplot[ylabel = {$s_{i,2}(t)$}] 
                \addplot[signalgreen, thick] coordinates {(0,1) (\a,1) (\a,-1) (\a+pi+\it,-1) (\a+pi+\it,1) (2*pi,1)}; 
                

                % current 
                \nextgroupplot[ylabel = {$i_{2}(t)$}, ytick = {0}, yticklabels = {$0$}, ymin = 0] 
                \addplot[signalred, thick] coordinates {(0,0.95/pi*\a) (\a+0.15,0) (\a+\it,0) (\a+pi,0.95) (2*pi,0.95/pi*\a)}; 

                % switching input
                \nextgroupplot[ylabel = {$u_2(t)/U_1$}, ymin = -0.1, xlabel={$t/T_\mathrm{s}$}] 
                \addplot[signalblue, thick] coordinates {(0,0) (\a,0) (\a+0.15,0) (\a+0.15,0.66) (\a+\it,0.66) (\a+\it,1) (\a+pi,1) (\a+pi,0) (2*pi,0)}; 
                \addplot[signalblue, thick, dashed] coordinates {(\a,0) (\a,1) (\a+\it,1)}; 
                \fill [signalblue, opacity=0.3] (axis cs:\a,0) rectangle (axis cs:\a+0.15,1);
                \fill [signalblue, opacity=0.3] (axis cs:\a+0.15,0.66) rectangle (axis cs:\a+\it,1);
                \draw[thin] (axis cs:\a+\it/4,0.5) -- (axis cs:\a-0.2,0.5) node[anchor=east, align=center]{$\Delta u$}; 
                \draw[thin] (axis cs:\a+\it+0.05,0.66) -- (axis cs:\a+\it+0.25,0.5) node[anchor=west, align=center]{\small Depends on load voltage}; 
                \coordinate (b1) at (axis cs:\a,0);
                \coordinate (b2) at (axis cs:\a+\it,0);
                \coordinate (b3) at (axis cs:\a+pi,0);
            \end{groupplot}
            \draw[thin, dashed] (a1) -- (b1);
            \draw[thin, dashed] (a2) -- (b2);
            \draw[thin, dashed] (a3) -- (b3);
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Blanking / interlocking time: current paths %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Blanking / interlocking time (cont.)} 
        For the continuous conduction case, the \hl{voltage error} $\Delta u$ due to the interlocking time $t_0$ is given by
        \begin{equation}
            \Delta u =\overline{u}_2 - U_1s^* = -\mathrm{sgn}(i_2)\frac{t_0}{T_\mathrm{s}}  U_1= -\mathrm{sgn}(i_2)t_0 f_\mathrm{s} U_1.
        \end{equation}
        Hence, the error depends on the relative duration of the interlocking time $t_0$ compared to the switching period $T_\mathrm{s}$ which is a device-specific parameter (cf. below). 

        \begin{table}
            \begin{tabular}{c c c}
                \toprule
                Device type & $t_0$ & $f_\mathrm{s}$ \\
                \midrule
                GTO & \SIrange{10}{30}{\micro\second} & \SIrange{200}{500}{\hertz} \\
                IGBT & \SIrange{2}{4}{\micro\second} & \SIrange{5}{20}{\kilo\hertz} \\
                MOSFET & \SI{\leq 1}{\micro\second} & \SIrange{20}{1000}{\kilo\hertz} \\
                \bottomrule
            \end{tabular}
            \caption{Typical interlocking times and switching frequencies for different power semiconductor devices}
            \label{tab:interlocking_times}
        \end{table}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Outlook: multi-level converters %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Outlook: multi-level converters} 
    \begin{figure}
        \centering
        \begin{subfigure}{0.32\textwidth}
            \centering
            \begin{circuitikz}
                \draw
                    (0,0) to [short, o-*] ++(1,0) coordinate (A)
                    to [capacitor, -*, v={$\frac{U_\mathrm{dc}}{2}$}, voltage = straight] ++(0,-2) coordinate (B)
                    to [capacitor, -*, v={$\frac{U_\mathrm{dc}}{2}$}, voltage = straight] ++(0,-2) coordinate (C)
                    to [short, -o] ++(-1,0) coordinate (D)
                    (B) to [short] ++(-0.5, 0) coordinate (E)
                    (E) node[rground, rotate=-90, name = gnd1]{}; 
                \draw 
                    ($(B) + (1.5,0)$) node[cute spdt up arrow, xscale=-1] (Sw1) {}
                    (A) -| (Sw1-out 1.n)
                    (C) -| (Sw1-out 2.s)
                    (Sw1-in) to [short, -o] ++(1,0) coordinate (F);
                \draw 
                    (F |- C) node[rground, anchor = south, name = gnd2]{}
                    (F) to [open, v={$u_2(t)\hspace{0.3cm}$}, voltage = straight] (gnd2); 
            \end{circuitikz}\\[1em]
            \begin{tikzpicture}
                \begin{axis}[
                    width=0.99\textwidth,
                    height=0.375\textheight,
                    xlabel={$t$},
                    ylabel={$u_2$},
                    xmin=0, xmax=1.2,
                    ymin=-1.15, ymax=1.15,
                    ytick={-1,0,1},
                    yticklabels={$-\frac{U_\mathrm{dc}}{2}$,$0$,$\frac{U_\mathrm{dc}}{2}$},
                    xticklabels={},
                    grid=both,
                    axis lines=middle,
                    xlabel style={anchor=west},
                    ylabel style={anchor=south},
                ]
                \addplot[signalblue, thick] coordinates {(0,-1) (0.1,-1) (0.1,1) (0.6,1) (0.6,-1) (1.1,-1) (1.1,1) (1.2,1)};
                \end{axis}
            \end{tikzpicture}
            \caption{2-level half bridge}
        \end{subfigure}
        \begin{subfigure}{0.32\textwidth}
            \centering
            \begin{circuitikz}
                \draw
                    (0,0) to [short, o-*] ++(1,0) coordinate (A)
                    to [capacitor, -*, v={$\frac{U_\mathrm{dc}}{2}$}, voltage = straight] ++(0,-2) coordinate (B)
                    to [capacitor, -*, v={$\frac{U_\mathrm{dc}}{2}$}, voltage = straight] ++(0,-2) coordinate (C)
                    to [short, -o] ++(-1,0) coordinate (D)
                    (B) to [short] ++(-0.5, 0) coordinate (E)
                    (E) node[rground, rotate=-90, name = gnd1]{}; 
                \draw 
                    ($(B) + (1.0,0)$) node[rotary switch ->=3 in 90 wiper 90, xscale=-1, anchor=out 2](Sw1){}
                    (A) -| (Sw1-out 1.n)
                    (C) -| (Sw1-out 3.s)
                    (Sw1-in) to [short, -o] ++(1,0) coordinate (F)
                    (Sw1-out 2.w) to [short] (B);
                \draw 
                    (F |- C) node[rground, anchor = south, name = gnd2]{}
                    (F) to [open, v={$u_2(t)\hspace{0.3cm}$}, voltage = straight] (gnd2); 
            \end{circuitikz}\\[1em]
            \begin{tikzpicture}
                \begin{axis}[
                    width=0.99\textwidth,
                    height=0.375\textheight,
                    xlabel={$t$},
                    ylabel={$u_2$},
                    xmin=0, xmax=1.2,
                    ymin=-1.15, ymax=1.15,
                    ytick={-1,0,1},
                    yticklabels={$-\frac{U_\mathrm{dc}}{2}$,$0$,$\frac{U_\mathrm{dc}}{2}$},
                    xticklabels={},
                    grid=both,
                    axis lines=middle,
                    xlabel style={anchor=west},
                    ylabel style={anchor=south},
                ]
                \addplot[signalblue, thick] coordinates {(0,-1) (0.1,-1) (0.1,0) (0.35,0) (0.35,1) (0.6,1) (0.6,0) (0.85,0) (0.85,-1) (1.1,-1) (1.1,0) (1.1,0) (1.2,0)};
                \end{axis}
            \end{tikzpicture}
            \caption{3-level half bridge}
        \end{subfigure}
        \begin{subfigure}{0.32\textwidth}
            \centering
            \begin{circuitikz}
                \draw
                    (0,0) to [short, o-*] ++(1,0) coordinate (A)
                    to [capacitor, -*, v={$\frac{U_\mathrm{dc}}{3}$}, voltage = straight] ++(0,-1.0) coordinate (B)
                    to [capacitor, -*, v={$\frac{U_\mathrm{dc}}{6}$}, voltage = straight] ++(0,-1.0) coordinate (C)
                    to [capacitor, -*, v={$\frac{U_\mathrm{dc}}{6}$}, voltage = straight] ++(0,-1.0) coordinate (D)
                    to [capacitor, -*, v={$\frac{U_\mathrm{dc}}{3}$}, voltage = straight] ++(0,-1.0) coordinate (E)
                    to [short, -o] ++(-1,0) coordinate (F)
                    (C) to [short] ++(-0.5, 0) coordinate (G)
                    (G) node[rground, rotate=-90, name = gnd1]{}; 
                \draw 
                    ($(C) + (1.75,0)$) node[rotary switch ->=4 in 90 wiper 90, xscale=-1, anchor=in](Sw1){}
                    (A) -| (Sw1-out 1.n)
                    (E) -| (Sw1-out 4.s)
                    (Sw1-in) to [short, -o] ++(1,0) coordinate (H)
                    (Sw1-out 2.n) |- (B)
                    (Sw1-out 3.s) |- (D);
                \draw 
                    (H |- E) node[rground, anchor = south, name = gnd2]{}
                    (H) to [open, v={$u_2(t)\hspace{0.3cm}$}, voltage = straight] (gnd2); 
            \end{circuitikz}\\[1em]
            \begin{tikzpicture}
                \begin{axis}[
                    width=0.99\textwidth,
                    height=0.375\textheight,
                    xlabel={$t$},
                    ylabel={$u_2$},
                    xmin=0, xmax=1.2,
                    ymin=-1.15, ymax=1.15,
                    ytick={-1,0,1},
                    yticklabels={$-\frac{U_\mathrm{dc}}{2}$,$0$,$\frac{U_\mathrm{dc}}{2}$},
                    xticklabels={},
                    grid=both,
                    axis lines=middle,
                    xlabel style={anchor=west},
                    ylabel style={anchor=south},
                ]
                \addplot[signalblue, thick] coordinates {(0,-1) (1/4,-1) (1/4,-1/3) (1/4+1/8,-1/3) (1/4+1/8,1/3) (2/4,1/3) (2/4,1) (3/4,1) (3/4,1/3) (3/4+1/8,1/3) (3/4+1/8,-1/3) (1,-1/3) (1,-1) (1.2,-1)};
                \end{axis}
            \end{tikzpicture}
            \caption{4-level half bridge}
        \end{subfigure}
        \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Rectifier operation for single-phase grids %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Rectifier operation for single-phase grids} 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Rectifier application setup %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Rectifier application setup} 
        \begin{figure}
            \begin{circuitikz}
                \draw (0,0) node[cute spdt up arrow] (Sw1) {};
                \draw (-2,-1.5) node[cute spdt down arrow] (Sw2) {};
                \draw (Sw2.in) to [short, -o] ++(-1,0) coordinate (out2);
                \draw (Sw1.in) to [short] ++(-1.75,0) to [short, -o, i_<=$i_2(t)$] (Sw1.in -| out2) coordinate (out1);
                \draw (out1) to [open, v=$u_2(t)\hspace{0.5cm}$, voltage = straight] (out2);
                \draw (Sw1-out 1.n) to [short, -*] ++(0,0.5) coordinate (int1);
                \draw (Sw2-out 2.s) to [short] ++(0,-0.5) coordinate (int2);
                \draw (int2) to [short] (int2 -| Sw1-out 2.s) coordinate (int3) to [short, *-] (Sw1-out 2.s);
                \draw node[crossingshape, name=x1, rotate=-90] at (out1 -| Sw2-out 1.n) {};
                \draw (x1.west) to [short] (int1 -| x1.west) to [short] (int1);
                \draw (x1.east) to [short] (Sw2-out 1.n);
                \draw (int1) to [short,i=$i_1(t)$] ++(1.5,0) coordinate (c1) to [short, i={$I_0$}, -o] ++(1,0) coordinate (in1);
                \draw (int3) to [short, -o] ++(2.5,0) coordinate (in2);
                \draw (in1) to [open, v^=$\hspace{0.5cm}u_1(t)$, voltage = straight] (in2);
                \draw node[anchor = west, xshift=0.3cm] at (Sw1) {$s_1(t)$};
                \draw node[anchor = west, xshift=0.3cm] at (Sw2) {$s_2(t)$};
                \draw (c1) to [capacitor, *-*, l=$C$, i_=$i_\mathrm{C}(t)$] (c1 |- int2);
                \draw (out1) to [inductor, v<=$u_{\mathrm{L}}(t)$, voltage = straight, l=$L$, mirror, o-] ++(-2.5,0) to [sinusoidal voltage source, v_=$u_{\mathrm{g}}(t)$] (\tikztostart |- out2) to [short,-o] (out2);
            \end{circuitikz}
            \caption{Single-phase grid rectification: full bidirectional operation possible (e.g., for electrical rail vehicles with a \SI{15}{\kilo\volt}, \SI[parse-numbers = false]{16\frac{2}{3}}{\hertz} grid). Note: converter topology is flipped to align $u_2$ with the AC grid side while $u_1$ is the DC output.}
            \label{fig:recitifier_single_phase_transistor_bridge_converter}
        \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state operation %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state operation} 
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \onslide<1->{Assuming steady state, the grid side input loop from \figref{fig:recitifier_single_phase_transistor_bridge_converter} can be described with \hl{complex phasors}:
            \begin{equation}
                \underline{\hat{u}}_2 = \underline{\hat{u}}_\mathrm{g} - \mathrm{j}\omega L \underline{\hat{i}}_2.
            \end{equation}} 
            \onslide<2->{The converter's input voltage amplitude is
            \begin{equation}
                \hat{u}_2 = \sqrt{\hat{u}^2_\mathrm{g} + \left(\omega L \hat{i}_2\right)^2}.
            \end{equation}}
            \onslide<3->{As the converter boosts the grid voltage towards the DC-link, the following condition must apply:
            \begin{equation}
                u_1(t)\approx U_\mathrm{dc} \geq \hat{u}_2 = \sqrt{\hat{u}^2_\mathrm{g} + \left(\omega L \hat{i}_2\right)^2}.
            \end{equation}}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \begin{tikzpicture}
                    \draw[->] (-0.5,0) to (3.5,0) node[right]{$\mathrm{Re}$};
                    \draw[->] (0,-2) to (0,2) node[above]{$\mathrm{Im}$};
                    \draw[->, thick, signalblue] (0,0) to (3,0) node[above]{$\underline{\hat{u}}_{\mathrm{g}}$} coordinate (ug);
                    \draw[->, thick, signalred] (0,0) to (1.5,0) node[above]{$\underline{\hat{i}}_{\mathrm{g}}$};
                    \draw[<-, thick, signalblue] (ug) to node[right]{$\underline{\hat{u}}_{\mathrm{L}}$}  ++(0,-1.5) coordinate (ul);
                    \draw[->, thick, signalblue] (0,0) to (ul) node[below]{$\underline{\hat{u}}_2$};
                    \draw[->] let \p1 = (ul) in (1,0) arc(0:atan(\y1/\x1):1);
                    \draw node[right] at (1.1, -0.4) {$\varphi_2$};
                \end{tikzpicture}
                \caption{Steady-state phasor diagram
                assuming $\cos(\varphi)=1$ operation (enforced via some supervisory control)}
                \label{fig:recitifier_single_phase_transistor_phasors}
            \end{figure}
        \end{column}
    \end{columns}  
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state operation (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state operation (cont.)} 
    \onslide<1->{With the assumption of $\cos(\varphi)=1$ operation and a lossless converter, the following relations hold:}
    \begin{equation}
        \onslide<1->{P = P_1} \onslide<2->{= P_2 = P_\mathrm{g}} \onslide<3->{=  U_\mathrm{g}I_\mathrm{g}} \onslide<4->{= \frac{1}{2}  \hat{u}_\mathrm{g}\hat{i}_\mathrm{g}.}
    \end{equation}
    \onslide<5->{While there is no reactive power exchange with the grid, the converter needs to supply the reactive power $Q_2$ to compensate for the line inductance demand:
    \begin{equation}
        Q_2 = \omega L I_\mathrm{g}^2.}
    \end{equation}
    \onslide<6->{The resulting apparent power $S_2$ is}
    \begin{equation}
        \onslide<6->{S_2 = \sqrt{P^2 + Q_2^2}} \onslide<7->{= \sqrt{P^2 + \left(\omega L I_\mathrm{g}\right)^2}} \onslide<8->{= \sqrt{P^2 + \left(\frac{\omega L}{U_\mathrm{g}^2}P^2\right)^2}}\onslide<9->{ = P\sqrt{1 + \left(\frac{\omega L}{U_\mathrm{g}^2}P\right)^2}.}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state operation (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state operation (cont.)} 
    \onslide<1->{Neglecting the switching-induced current and voltage ripples, the instantaneous grid power is}
    \begin{equation}
        \onslide<1->{p_\mathrm{g}(t) = u_\mathrm{g}(t)i_\mathrm{g}(t) = \hat{u}_\mathrm{g}\hat{i}_\mathrm{g}\cos^2(\omega t)} \onslide<2->{= P + P \cos(2\omega t).}
    \end{equation}
    \onslide<3->{The instantaneous converter power at its AC input is}
    \begin{equation}
        \begin{split}
            \onslide<3->{p_2(t) &= u_2(t)i_2(t)} \onslide<4->{= \left(u_\mathrm{g}(t) + u_\mathrm{L}(t)\right)i_\mathrm{g}(t)} \onslide<5->{= \left(u_\mathrm{g}(t) + L\frac{\mathrm{d}}{\mathrm{d}t}i_\mathrm{g}(t)\right)i_\mathrm{g}(t)}\\
               & \onslide<6->{= \hat{u}_\mathrm{g}\hat{i}_\mathrm{g}\cos^2(\omega t) + \omega L \hat{i}_\mathrm{g}^2\sin(\omega t)\cos(\omega t)}\\
                & \onslide<7->{= P\left(1 + \cos(2\omega t)\right) + Q_2 \sin(2\omega t)} \onslide<8->{= P + S_2\cos(2\omega t- 2\varphi_2)}
        \end{split}
    \end{equation}
    \onslide<8->{with $\varphi_2$ being the phase angle between $i_2(t)$ and $u_2(t)$.}\onslide<9->{ Hence, the converter power oscillates at twice the grid frequency with an amplitude of $S_2$. As $S_2>P$ applies, the instantaneous output power gets temporarily negative as a result of the reactive power compensation on the grid input side. }
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state operation (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state operation (cont.)} 
    \onslide<1->{Assuming a nearly constant DC-link voltage $u_1(t)\approx U_\mathrm{dc}$, the converter DC-side current $i_1(t)$ oscillates as well:}
    \begin{equation}
        \onslide<1->{i_1(t) = \frac{p_1(t)}{U_\mathrm{dc}}}\onslide<2->{= \frac{p_2(t)}{U_\mathrm{dc}} = \frac{P}{U_\mathrm{dc}}+ \frac{S_2}{U_\mathrm{dc}}\cos(2\omega t - 2\varphi_2).}
    \end{equation}
    \onslide<3->{For a constant load current $$I_0 = \frac{P}{U_\mathrm{dc}},$$ the converter's output current can be rewritten as
    \begin{equation}
        i_1(t) = I_0 \left(1 + \sqrt{1+\left(\frac{\omega L U_\mathrm{dc}}{U_\mathrm{g}^2}\right)^2}\cos(2\omega t - 2\varphi_2)\right).
    \end{equation}}%
    \onslide<4->{Consequently, the DC-link capacitor current carries the harmonic content:
    \begin{equation}
        i_\mathrm{C}(t) =  i_1(t) - I_0 = I_0 \sqrt{1+\left(\frac{\omega L U_\mathrm{dc}}{U_\mathrm{g}^2}\right)^2}\cos(2\omega t - 2\varphi_2).
        \label{eq:DC_link_current_single_phase_ACDC}
    \end{equation}}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state operation (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state operation (cont.)} 
    \onslide<1->{Assuming that the voltage ripple of  the DC-link capacitor does not significantly affect the output current, the voltage ripple amplitude can be approximated as:
    \begin{equation}
        \hat{u}_\mathrm{C} = \hat{u}_1 \approx \frac{\hat{i}_1}{2\omega C} = \frac{I_0}{2C} \sqrt{1+\left(\frac{\omega L U_\mathrm{dc}}{U_\mathrm{g}^2}I_0\right)^2}.
        \label{eq:DC_link_voltage_single_phase_ACDC}}%
    \end{equation}
    \onslide<2->{This relation results from the complex phasor analysis of the capacitor's impedance given the current ripple \eqref{eq:DC_link_current_single_phase_ACDC}.} \onslide<3->{From \eqref{eq:DC_link_voltage_single_phase_ACDC} one can }
    \begin{itemize}
        \item<3-> derive the required DC-link capacitance for a given voltage ripple,
        \item<4-> estimate the voltage ripple for a given DC-link capacitance.
    \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Steady-state operation (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Steady-state operation (cont.)} 
    \begin{figure}
        \begin{tikzpicture}
            \def\p{0.2*pi}
            \begin{groupplot}[group style={group size=1 by 2, xticklabels at = edge bottom, vertical sep=0.25cm}, height=0.4\textheight, width=0.875\textwidth, xmin=0, xmax=2*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi}, xticklabels = {0,$\nicefrac{1}{2}\pi$,$\pi$, $\nicefrac{3}{2}\pi$, $2\pi$}, ytick = {-1, 0, 1}, yticklabels = {$-1$, $0$, $1$}]


                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$x(t)$}, legend pos=north east, legend columns=3, ytick = {0}, yticklabels = {$0$}] 
                \addplot[signalblue, thick, domain=0:2*pi, samples = 100] {cos(deg(x))};
                \addplot[signalred, thick, domain=0:2*pi, samples = 100] {0.6*cos(deg(x))};
                \addplot[signalblue, thick, domain=0:2*pi, samples = 100, dashed] {cos(deg(x-\p))};
                \draw[->] (axis cs:pi/2,0) -- node[above, fill=white, inner sep=1pt]{$\varphi_2$} (axis cs:pi/2+\p,0);
                \legend{$u_\mathrm{g}(t)$, $i_\mathrm{g}(t)$, $u_2(t)$};


                % top middle plot: individual switching signals
                \nextgroupplot[ylabel = {$p(t)/P$}, legend pos=north east, legend columns=2, ymin= -0.2, ymax = 2.2, ytick = {0, 1, 2}, yticklabels = {$0$, $1$, $2$}, xlabel={$\omega t$}] 
                \addplot[signalblue, thick, domain=0:2*pi, samples = 100] {1+cos(deg(2*x))}; 
                \addplot[signalblue, thick, domain=0:2*pi, samples = 100, dashed] {1+1.15*cos(deg(2*x-2*\p))};  
                \draw[<->] (axis cs:pi/2+\p,-0.15) -- node[left, fill=white, inner sep=1pt]{$S_2$} (axis cs:pi/2+\p,1);      
                \draw[<->] (axis cs:pi+\p,1) -- node[left, fill=white, inner sep=1pt]{$S_2$} (axis cs:pi+\p,2.15);         
                \legend{$p_\mathrm{g}(t)$, $p_2(t)$};
            \end{groupplot}
        \end{tikzpicture}
        \caption{Steady-state operation of the single-phase four-quadrant rectifier: (top) individual signals and (bottom) power oscillations at twice the grid frequency}
        \label{fig:recitifier_single_phase_transistor_power_oscillations}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Three-phase AC/DC bridge converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Three-phase AC/DC bridge converter} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Idealized switch representation %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Idealized switch representation of a three-phase AC/DC bridge converter}
        \begin{figure}
            \begin{circuitikz}
                \draw (0,0) node[cute spdt up arrow, xscale=-1] (Sw1) {};
                \draw (1.5,-1.5) node[cute spdt down arrow, xscale=-1] (Sw2) {};
                \draw (3,-3) node[cute spdt down arrow, xscale=-1] (Sw3) {};
                \draw (Sw2.in) to [short, -o] ++(3,0) coordinate (out2);
                \draw (Sw1.in) to [short] ++(3.75,0) to [short, -o] (Sw1.in -| out2) coordinate (out1); 
                \draw (Sw3.in) to [short, -o, i=$i_{2\mathrm{c}}(t)$] (Sw3.in -| out2) coordinate (out3);
                \draw (Sw3.in |- Sw2.in) to [short, -o, i=$i_{2\mathrm{b}}(t)$] (Sw2.in -| out2);
                \draw (Sw3.in |- Sw1.in) to [short, -o, i=$i_{2\mathrm{a}}(t)$] (Sw1.in -| out2);
                \draw (out1) to [open, v^=$\hspace{0.75cm}u_{2\mathrm{ab}}(t)$, voltage = straight] (out2);
                \draw (out2) to [open, v^=$\hspace{0.75cm}u_{2\mathrm{bc}}(t)$, voltage = straight] (out3);
                \draw ($(out3) + (1.5,0)$) to [open, v_=$\hspace{0.75cm}u_{2\mathrm{ca}}(t)$, voltage = straight] ($(out1) + (1.5,0)$);
                \draw (Sw1-out 1.n) to [short, -*] ++(0,0.5) coordinate (int1);
                \draw (Sw3-out 2.s) to [short] ++(0,-0.5) coordinate (int3);
                \draw (int3) to [short] (int3 -| Sw1-out 2.s) coordinate (int4) to [short, *-] (Sw1-out 2.s);
                \draw node[crossingshape, name=x1, rotate=-90] at (out1 -| Sw2-out 1.n) {};
                \draw (x1.west) to [short] (int1 -| x1.west) coordinate (int2) to [short] (int1);
                \draw (x1.east) to [short] (Sw2-out 1.n);
                \draw (int1) to [short] ++(-1,0) to [short, i_<=$i_1(t)$, -o] ++(-1,0) coordinate (in1);
                \draw (int4) to [short, -o] ++(-2,0) coordinate (in2);
                \draw (in1) to [open, v=$u_1(t)\hspace{0.5cm}$, voltage = straight] (in2);
                \draw node[anchor = east, xshift=-0.3cm] at (Sw1) {$s_1(t)$};
                \draw node[anchor = east, xshift=-0.3cm] at (Sw2) {$s_2(t)$};
                \draw node[anchor = east, xshift=-0.3cm] at (Sw3) {$s_3(t)$};
                \draw (Sw2-out 2.s) to [short, -*] (int3 -| Sw2-out 2.s);
                \draw node[crossingshape, name=x2, rotate=-90] at (out1 -| Sw3-out 1.n) {};
                \draw node[crossingshape, name=x3, rotate=-90] at (out2 -| Sw3-out 1.n) {};
                \draw (x3.west) to [short] (x2.east);
                \draw (x3.east) to [short] (Sw3-out 1.n);
                \draw (x2.west) to [short] (int2 -| x2.west) to [short,-*] (int2);
            \end{circuitikz}
            \caption{Idealized switch representation of a three-phase two-level AC/DC bridge converter}
            \label{fig:idealized_switch_three_phase_bridge_converter}
        \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Circuit realization %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Circuit realization}
    \begin{figure}
        \begin{circuitikz}[]
            \draw (0,4) coordinate (A) to [capacitor, *-*, v = $\frac{u_1(t)}{2}$, voltage = straight] ++(0,-3) coordinate (Z) to [capacitor, *-*, v = $\frac{u_1(t)}{2}$, voltage = straight] ++(0,-3) coordinate (B)
            (Z) node[rground, rotate=-90, name = gnd1]{}
            (A) to [short, *-o] ++(-2,0) coordinate (Y)
            (B) to [short, *-o] ++(-2,0) coordinate (X)
            (Y) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] (X)
            (A) to [short, i=$i_{1}(t)$] ++(2,0) coordinate (E)
            to [Tnpn, n=npn1, invert, bodydiode] ++(0,-2) coordinate (C)
            to [short, *-] ++(1,0) to [crossing] ++(2,0) to [crossing] ++(2,0)   
            to [short, i=$i_{2\mathrm{a}}(t)$] ++(1,0) coordinate (U) to [short] ++(1,0) coordinate (G)
            (C) to [short] ++(0,-2) 
            to [Tnpn, n=npn2, invert, bodydiode] ++(0,-2) coordinate (D)
            (E) to [short, *-] ++(2,0) coordinate (I)
            to [Tnpn, n=npn3, invert, bodydiode] ++(0,-2)
            to [short] ++(0,-1) coordinate (F)
            to [short] ++(0,-1)
            to [Tnpn, n=npn4, invert, bodydiode] ++(0,-2) 
            to [short, -*] ++(-2,0)
            to [short, -o] (B)
            (I) to [short, *-] ++(2,0)
            to [Tnpn, n=npn5, invert, bodydiode] ++(0,-2) coordinate (J)
            to [short] ++(0,-2) coordinate (K)
            to [Tnpn, n=npn6, invert, bodydiode] ++(0,-2) 
            to [short, -*] ++(-2,0)
            (F) to [short, *-] ++(1,0) to [crossing] ++(2,0) to [short, i=$i_{2\mathrm{b}}(t)$] ++(1,0) coordinate (V) to [short] ++(1,0) coordinate (H)
            (K) to [short, *-] ++(1,0) to [short, i=$i_{2\mathrm{c}}(t)$] ++(1,0) to [short] ++(0.5,0) coordinate(W) to [short] ++(0.5,0) coordinate (L)
            (G) to [open, o-o, v^=$\hspace{0.75cm}u_{2\mathrm{ab}}(t)$, voltage = straight] (H)
            (H) to [open, o-o, v^=$\hspace{0.75cm}u_{2\mathrm{bc}}(t)$, voltage = straight] (L)
            ($(L) + (1.5,0)$) to [open, v_=$\hspace{0.75cm} u_{2\mathrm{bc}}(t)$, voltage = straight] ($(G) + (1.5,0)$);
            \draw let \p1 = (npn1.B) in node[anchor=east] at (\x1,\y1) {$T_1$};
            \draw let \p1 = (npn2.B) in node[anchor=east] at (\x1,\y1) {$T_2$};
            \draw let \p1 = (npn3.B) in node[anchor=east] at (\x1,\y1) {$T_3$};
            \draw let \p1 = (npn4.B) in node[anchor=east] at (\x1,\y1) {$T_4$};
            \draw let \p1 = (npn5.B) in node[anchor=east] at (\x1,\y1) {$T_5$};
            \draw let \p1 = (npn6.B) in node[anchor=east] at (\x1,\y1) {$T_6$};
            \draw 
                    (W |- D) node[rground, anchor = south, name = gnd2]{};
            \draw[->] ($(W) + (0.5,-0.2)$) to ($(W |- gnd2) + (0.5,0.2)$);
            \draw[->] ($(V) + (0.5,-0.2)$) to ($(V |- gnd2) + (0.5,0.2)$);
            \draw[->] ($(U) + (0,-0.2)$) to ($(U |- gnd2) + (0,0.2)$);
            \draw ($(W)!0.5!(gnd2) + (0.5,0)$) node[anchor = west] {$u_{2i0}(t)$};
        \end{circuitikz}
        \caption{Three-phase two-level AC/DC converter}
        \label{fig:VSI_three_phase_two_level_bridge_converter}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Switching states and load-independent output voltages %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Switching states and load-independent output voltages}
    Reutilizing the switching function definition \eqref{eq:switching_function_VSI}, the \hl{line-to-line voltages} can be expressed as
    \begin{equation}
        \begin{split}
            u_{2\mathrm{ab}}(t) &= \frac{1}{2}\left(s_{\mathrm{a}}(t)-s_{\mathrm{b}}(t)\right)u_1(t),\\
            u_{2\mathrm{bc}}(t) &= \frac{1}{2}\left(s_{\mathrm{b}}(t)-s_{\mathrm{c}}(t)\right)u_1(t),\\
            u_{2\mathrm{ca}}(t) &= \frac{1}{2}\left(s_{\mathrm{c}}(t)-s_{\mathrm{a}}(t)\right)u_1(t).
        \end{split}
    \end{equation}
    The \hl{line-to-neutral voltages} are given by
    \begin{equation}
        \begin{split}
            u_{2\mathrm{a}0}(t) &= \frac{1}{2}s_{\mathrm{a}}(t)u_1(t),\\
            u_{2\mathrm{b}0}(t) &= \frac{1}{2}s_{\mathrm{b}}(t)u_1(t),\\
            u_{2\mathrm{c}0}(t) &= \frac{1}{2}s_{\mathrm{c}}(t)u_1(t).
        \end{split}
    \end{equation}    
\end{frame}