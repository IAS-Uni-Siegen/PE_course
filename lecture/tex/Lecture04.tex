%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Diode-based rectifiers %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Diode-based rectifiers}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% High-level view of the rectification task %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{High-level view of the rectification task}
    Assuming that the input voltage is an \hl{ideal sinusoidal signal} $$u_1(t) = \hat{u}_1 \sin(\omega t)$$ with the angular frequency $\omega = 2\pi f$ and the amplitude $\hat{u}_1$, the task of a rectifier is to convert this input into a \hl{unidirectional, ideally constant, voltage} $u_2(t)\approx u_2$, as shown in Figure \ref{fig:rectification_task}. A typical application is the grid voltage rectification in power supplies.

    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_1(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}_1$,$0$,$\hat{u}_1$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{sin(deg(x))};
            \end{axis}
        \end{tikzpicture}
        \hspace{0.5cm}
        \begin{circuitikz}[]
            \ctikzset{blocks/scale=2, block lateral anchors pos=0.7}
            \path (0,0) node[sacdcshape](acdc){} ; 
            \draw (acdc.left up) -- ++(-1,0) coordinate (A1) 
            (acdc.left down) to [short] ++(-1,0) coordinate (A2)
            (A1) to [open, v_=$u_1$, voltage = straight, o-o] (A2)
            (acdc.right up) to [short, -o]  ++(1,0) coordinate (B1)
            (acdc.right down) to [short, -o] ++(1,0) coordinate (B2);
            \draw (B1) to [open, v^=$u_2$, voltage = straight] (B2);
        \end{circuitikz}
        \hspace{0.5cm}
        \begin{tikzpicture}[visible on=<2->]
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_2(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}_2$,$0$,$\hat{u}_2$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{1};
            \end{axis}
        \end{tikzpicture}
        \caption{Simplified representation of a single-phase rectifier}
        \label{fig:rectification_task}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Frequency analysis: Fourier series %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Frequency analysis: Fourier series}
    \onslide<2->{
    Often the rectification introduces non-fundamental frequency components, e.g., due to the output voltage rectification or by a load current feedback towards the input side. To analyze the \hl{frequency spectrum} of a periodic signal $x(t)$, the \hl{Fourier series} is used:
    \begin{equation}
        \begin{gathered}
            x(t) = \frac{a^{(0)}}{2}+\sum_{k=1}^{\infty} \left( a^{(k)} \cos(k\omega t) + b^{(k)} \sin(k\omega t) \right), \quad k\in \mathbb{N},\\
            a^{(k)}= \frac{1}{\pi} \int_{0}^{2\pi} u(t) \cos(k\omega t) \mathrm{d}\omega t,\,\, k\geq 0, \qquad b^{(k)} = \frac{1}{\pi} \int_{0}^{2\pi} u(t) \sin(k\omega t) \mathrm{d}\omega t,\,\, k \geq 1.
        \end{gathered}
        \label{eq:Fourier_series}
    \end{equation}
    }

    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_1(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}_1$,$0$,$\hat{u}_1$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{sin(deg(x))+0.125*sin(deg(3*x))+0.05*sin(deg(6*x))};
            \end{axis}
        \end{tikzpicture}
        \hspace{0.5cm}
        \begin{circuitikz}[]
            \ctikzset{blocks/scale=2, block lateral anchors pos=0.7}
            \path (0,0) node[sacdcshape](acdc){} ; 
            \draw (acdc.left up) -- ++(-1,0) coordinate (A1) 
            (acdc.left down) to [short] ++(-1,0) coordinate (A2)
            (A1) to [open, v_=$u_1$, voltage = straight, o-o] (A2)
            (acdc.right up) to [short, -o]  ++(1,0) coordinate (B1)
            (acdc.right down) to [short, -o] ++(1,0) coordinate (B2);
            \draw (B1) to [open, v^=$u_2$, voltage = straight] (B2);
        \end{circuitikz}
        \hspace{0.5cm}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_2(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}_2$,$0$,$\hat{u}_2$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{1+0.075*sin(deg(3*x))+0.05*sin(deg(7*x))};
            \end{axis}
        \end{tikzpicture}
        \caption{Rectification under distorted conditions}
        \label{fig:rectification_task_distortion}
    \end{figure}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Frequency analysis: Fourier series (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Frequency analysis: Fourier series (cont.)}

    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.85\textwidth,
                height=0.7\textheight,
                xlabel={$\omega t$},
                ylabel={$u(\omega t)$},
                grid=both,
                domain=0:6*pi,
                samples=1000,
                xtick={0,pi,2*pi,3*pi,4*pi,5*pi,6*pi},
                xticklabels={$0$, $\pi$, $2\pi$, $3\pi$, $4\pi$, $5\pi$, $6\pi$},
                ytick={-1,-0.5,0,0.5,1},
                ymin=-1.5, ymax=1.5,
                axis lines=middle,
                enlargelimits=false,
                clip=false,
                xlabel style={
                    anchor=west,
                },
                ylabel style={
                    anchor=east,
                },
                xticklabel style={
                    anchor=north east,
                    yshift=0.1cm,
                },
            ]
            
                       
            % First component
            \addplot[signalred, thick, domain=0:6*pi, visible on=<2->] {4/pi * sin(deg(x))};
            \node[anchor=south, signalred, visible on=<2->] at (axis cs:3.14/2,4/3.14) {$k \leq 1$};
            
            % First 5 components
            \addplot[signalblue, thick, domain=0:6*pi, visible on=<3->] {4/pi * (sin(deg(x)) + 1/3*sin(deg(3*x)) + 1/5*sin(deg(5*x)))};
            \node[anchor=west, signalblue, fill=white, inner sep = 2pt, visible on=<3->] at (axis cs:3.14,0.5) {$k \leq 5$};
            
            % First 7 components
            \addplot[signalgreen, thick, domain=0:6*pi, visible on=<4->] {4/pi * (sin(deg(x)) + 1/3*sin(deg(3*x)) + 1/5*sin(deg(5*x)) + 1/7*sin(deg(7*x)) + 1/9*sin(deg(9*x)))};
            \node[anchor=east, signalgreen, fill=white, inner sep = 2pt, visible on=<4->] at (axis cs:3.14,-0.5) {$k \leq 7$};
            
            % First 13 components
            \addplot[signalbrown, thick, domain=0:6*pi, visible on=<5->] {4/pi * (sin(deg(x)) + 1/3*sin(deg(3*x)) + 1/5*sin(deg(5*x)) + 1/7*sin(deg(7*x)) + 1/9*sin(deg(9*x)) + 1/11*sin(deg(11*x)) + 1/13*sin(deg(13*x)))};
            \node[anchor=west, signalbrown, fill=white, inner sep = 2pt, visible on=<5->] at (axis cs:2*3.14,-0.5) {$k \leq 13$};

            % Square wave signal 
            \addplot[black, thick, domain=0:6*pi, dashed, visible on=<1->] {sign(sin(deg(x)))};
            
            \end{axis}
            \end{tikzpicture}
        
        \caption{Fourier series example: representation of a square wave signal}
        \label{fig:Fourier_series_square_wave}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Half-cycle rectification / M1U circuit %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Half-cycle rectification / M1U circuit} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M1U uncontrolled rectifier circuit %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M1U uncontrolled rectifier circuit}
    \onslide<2->{
    Based on \figref{fig:M1U_topology}, the output voltage $u_2(t)$ of the M1U rectifier is
    \begin{equation}
        u_2(t) = \begin{cases}
            u_1(t)=\hat{u}_1 \sin(\omega t), & 0\leq \omega t < \pi, \\
            0, & \pi \leq \omega t < 2\pi.
        \end{cases}
        \label{eq:u2_M1U}
    \end{equation}
    }

    \begin{figure}
        \begin{tikzpicture} % left plot
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_1(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}$,$0$,$\hat{u}$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{sin(deg(x))};
            \end{axis}
        \end{tikzpicture}
        \hspace{0.5cm}
        \begin{circuitikz}[] % circuit (center plot)
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short] ++(0.75,0)
            to [diode, l=$D$]  ++(1.5,0)
            to [short, i=$i_2(t)$] ++(0.75,0)
            to [R, v^= $u_2(t)$, voltage = straight, l_=$R$] ++(0,-2) coordinate (B)
            (A) -- (B);
        \end{circuitikz}
        \hspace{0.5cm}
        \begin{tikzpicture}[visible on=<2->] % right plot
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_2(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}$,$0$,$\hat{u}$},
                grid=both,
                ]
                \addplot[domain=0:pi, samples=100, signalblue, thick]{sin(deg(x))};
                \addplot[domain=pi:2*pi, samples=10, signalblue, thick]{0};
            \end{axis}
        \end{tikzpicture}
        \caption{M1U topology (aka \hl{single pulse rectifier}) with typical input and output voltage signals feeding a resistive load}
        \label{fig:M1U_topology}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M1U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M1U uncontrolled rectifier circuit (cont.)}
    \onslide<1->{
    From \eqref{eq:u2_M1U}, the \hl{average output} voltage of the M1U rectifier is}
    \begin{equation}
        \begin{split}
            \onslide<1->{\overline{u}_2 &= \frac{1}{T} \int_{0}^{T} u_2(t) \mathrm{d}t} \onslide<2->{ = \frac{1}{2\pi} \int_{0}^{2\pi} u_2(\omega t) \mathrm{d}\omega t } \onslide<3->{= \frac{1}{2\pi} \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \mathrm{d}\omega t}\\ 
            \onslide<4->{&= \frac{\hat{u}_1}{2\pi} \left[ - \cos(\omega t) \right]_{0}^{\pi} }\onslide<5->{ = \frac{\hat{u}_1}{2\pi} \left( 1+1 \right) }\onslide<6->{= \frac{\hat{u}_1}{\pi}  = \frac{\sqrt{2}U_1}{\pi}}
        \end{split}
        \label{eq:u2_M1U_avg}
    \end{equation}
    \onslide<6->{with $U_1$ being the RMS value of the input voltage $u_1(t)$.} \onslide<7->{The \hl{RMS value} of the output voltage $u_2(t)$ results in}
    \begin{equation}
        \begin{split}
            \onslide<7->{ U_2 &= \sqrt{\frac{1}{2\pi} \int_{0}^{\pi} \hat{u}_1^2 \sin^2(\omega t) \mathrm{d}\omega t} } \onslide<8->{= \hat{u}_1 \sqrt{\frac{1}{2\pi}\left[\frac{1}{2}\omega t - \frac{\sin(2 \omega t)}{4}\right]_0^\pi}}\\ &\onslide<9->{= \frac{\hat{u}_1}{2} = \frac{U_1}{\sqrt{2}}.}
        \end{split}
        \label{eq:u2_M1U_rms}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M1U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M1U uncontrolled rectifier circuit (cont.)}
    \onslide<1->{The \hl{Fourier coefficients} of the output voltage $u_2(t)$ from \eqref{eq:u2_M1U} are}
    \begin{equation}
        \begin{split}
            \onslide<1->{a^{(0)} &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \mathrm{d} \omega t} \onslide<2->{= 2 \overline{u}_2= 2 \frac{\hat{u}_1}{\pi},}\\
            \onslide<3->{a^{(k)} &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \cos(k\omega t) \mathrm{d}\omega t }\onslide<4->{= \frac{1}{\pi} \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \cos(k\omega t) \mathrm{d}\omega t}\\  &\onslide<5->{= \frac{\hat{u}_1}{2\pi} \int_{0}^{\pi}  \sin(\omega t(1-k)) + \sin(\omega t(1+k)) \mathrm{d}\omega t} \onslide<6->{= \ldots =  \begin{cases}\frac{\hat{u}_1}{\pi}\frac{2}{1-k^2}, & k=2,4,6,\ldots\\ 0, & \mbox{otherwise}. \end{cases} }\\
            \onslide<7->{b^{(k)} &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \sin(k\omega t) \mathrm{d}\omega t = \frac{1}{\pi} \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \sin(k\omega t) \mathrm{d}\omega t} \\ &\onslide<8->{=\frac{\hat{u}_1}{2\pi} \int_{0}^{\pi}  \cos(\omega t(1-k)) - \cos(\omega t(k+1)) \mathrm{d}\omega t}\onslide<9->{ = \ldots = \begin{cases} \frac{\hat{u}_1}{2}, & k =1,\\ 0, & k \geq 2. \end{cases}}
        \end{split}
        \label{eq:u2_M1U_Fourier}
    \end{equation}
    \onslide<10->{Above, $a^{(0)}$ represents a \hl{DC component}, while the $a^{(k)} \neq 0$ coefficients indicate \hl{harmonics}.}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M1U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M1U uncontrolled rectifier circuit (cont.)}
    \onslide<1->{From \eqref{eq:u2_M1U_Fourier} the Fourier series of $u_2(t)$ results in
    \begin{equation}
        u_2(t) = \hat{u}_1\left(\frac{1}{\pi} + \frac{1}{2}\sin(\omega t)+ \sum_{k=2,4,6,\ldots} \frac{2}{\pi(1-k^2)} \cos(k\omega t)\right).
    \end{equation}}
    \onslide<2->{For a resistive load, the output current has the same harmonic spectrum:}
    \begin{equation}
        \onslide<2->{i_2(t) = \frac{\hat{u}_1}{R}\left(\frac{1}{\pi} + \frac{1}{2}\sin(\omega t)+ \sum_{k=2,4,6,\ldots} \frac{2}{\pi(1-k^2)} \cos(k\omega t)\right)}.
    \end{equation}
    \onslide<3->{Resulting observations are:}
    \begin{itemize}
        \item<3-> Non-fundamental current frequency components can distort the input side.
        \item<4-> Higher frequency harmonics decrease with $\sim 1/(1-k^2)$.
    \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Transformer input filtering  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Transformer input filtering}
    To reduce the input side distortion, a transformer can be used to filter out the harmonics:
    \begin{itemize}
        \item Impedance of magnetizing inductance $L_\mathrm{m}$ is zero for DC components, i.e., the transformer blocks the DC current from the input (cf. dotted red line for $\overline{i}_2$ below).
        \item<2-> With higher frequency harmonics, the impedance of $L_\mathrm{m}$ increases, i.e., filtering out the harmonics less effectively.
    \end{itemize}
    \begin{figure}
           \begin{circuitikz}[]
            \draw (0,0) node[transformer core](T){$N_1:N_2$}
            (T.inner dot A1) node[circ]{}
            (T.inner dot B1) node[circ]{}
            (T.A1) to [short, -*, i<_=$i'_1(t)$] ++(-1,0) coordinate (A1)
            (T.A2) to [short, -*] ++(-1,0) coordinate (A2)
            (A1) to [inductor, l=$L_\mathrm{m}$, i=$i_\mathrm{m}(t)$] (A2)
            (A1) to [short, -o, i<_=$i_1(t)$] ++(-1.5,0) coordinate (A11)
            (A2) to [short, -o] ++(-1.5,0) coordinate (A22)
            (T.B1) to [short, i=$i_\mathrm{s}(t)$] ++(1,0) coordinate (B1)
            (T.B2) to [short] ++(1,0) coordinate (B2);
            \draw (A11) to [open, v=$u_1(t)\hspace{0.5cm}$, voltage = straight] (A22)
            (B1) to [open, v = $u_\mathrm{s}(t)\hspace{0.5cm}$, voltage = straight] (B2); 
            \draw (B1) to [open] (B2 -| B1) coordinate (A)
            (B1) to [short] ++(0.25,0)
            to [diode, l=$D$]  ++(1.5,0)
            to [short, i=$i_2(t)$] ++(1.0,0) coordinate (C)
            to [R, v^= $u_2(t)$, voltage = straight, l_=$R$] (A -| C) coordinate (B)
            (A) -- (B);
            \draw[signalred, dashed, thick] (A1) -- (A2) -- (B) -- (C) -- (A1);
            \node[signalred, above] at ($(B2)!0.5!(B)$) {$\overline{i}_2$};
        \end{circuitikz}
        \caption{M1U topology with input transformer and DC current path (red dotted line)}
        \label{fig:M1U_transformer_topology_DC-current}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Transformer input filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Transformer input filtering (cont.)}
    \onslide<2->{While the transformer can help out filter unwanted harmonics, the output DC current also introduces an offset magnetization to the transformer's core. Issues related with this are:}
    \begin{itemize}
        \item<2-> \textbf{Core utilization:} To prevent core saturation, the transformer must be oversized.
        \item<3-> \textbf{Core losses:} The magnetization offset can increase the core losses.
    \end{itemize}
    \begin{figure}
            \centering
            \begin{tikzpicture}
                \tikzmath{
                    real \a, \b, \c, \d, \hn, \hc, \hm, \bc, \off;
                    \a = 6.0;
                    \b = 1.7;
                    \c = 1.5;
                    \d = 3.0;
                    \hn = 1.5; % nominal, utilized H field value
                    \hm = 7.0; % maximal H field value
                    \hc = -\hn + 2*\c/\b; % hyteresis return H value for nominal H field
                    \off = 0.4; % offset for the hysteresis curve
                    \bcp = \a/(1 + exp(-\b*\hc+\c-\b*\off))-\d; % hyteresis return B value for nominal H field
                    \bcn = \a/(1 + exp(-\b*\hc+\c+\b*\off))-\d; % hyteresis return B value for nominal H field
                }
                \begin{axis}[very thick,
                             samples = 100,
                             xlabel = $H$,
                             ylabel = $B$,
                             xmin = -\hm,
                             xmax = \hm,
                             ymin = -4,
                             ymax = 4,
                             axis x line = middle,
                             axis y line = middle,
                             ticks = none,
                             height=0.7\textheight]
                    \addplot[shadecolor, dashed, domain = -\hm:\hm] {\a/(1 + exp(-\b*x+\c))-\d};
                    \addplot[shadecolor, dashed ,domain = -\hm:\hm] {\a/(1 + exp(-\b*x-\c))-\d};
                    \addplot[signalred, name path=A, domain=\hc+\off:\hn+\off, samples = 100] {\a/(1 + exp(-\b*x+\c))-\d};
                    \addplot[signalred, name path=B, domain=-\hn+\off:-\hc+\off, samples = 100] {\a/(1 + exp(-\b*x-\c))-\d};
                    \addplot[shadecolor, opacity=0.3] fill between[of=A and B];
                    \addplot[signalred] coordinates {(-\hc+\off, -\bcn) (\hn+\off, -\bcn)};
                    \addplot[signalred] coordinates {(-\hn+\off, \bcp) (\hc+\off, \bcp)};
                    % indicate DC shift via an arrow from the origin to the middle of the shaded hysteresis curve
                    \draw[-{Latex[length=2mm]}, signalred, thick] (axis cs:0,0) -- (axis cs:\off,\bcp/2 - \bcn/2);
                    %indicate small red dots at the beginning and end of the arrow
                    \node[signalred, circle, fill, inner sep=1pt] at (axis cs:0,0) {};
                    \node[signalred, circle, fill, inner sep=1pt] at (axis cs:\off,\bcp/2 - \bcn/2) {};
                    %indicate the sift via labeling the arrow in a pin like fashion with the label being left from the arrow
                    \node[signalred, pin={[pin edge={signalred, thin, inner sep = 2mm, anchor = east}]above left:$\sim \overline{i}_2$}] at (axis cs:\off/2,\bcp/4 - \bcn/4) {};
                \end{axis}
            \end{tikzpicture}
            \caption{Shift of the hysteresis curve due to the DC magnetization}
        \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Capacitive output filtering %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Capacitive output filtering}
    To smooth the output voltage $u_2(t)$, a capacitor $C$ is added. \onslide<2->{The initial charging voltage is
    \begin{equation}
        u_2(t) = \begin{cases}
            u_1(t)=\hat{u}_1 \sin(\omega t) , & 0\leq \omega t < \nicefrac{\pi}{2}, \\
            \hat{u}_1, & \omega t > \nicefrac{\pi}{2}
        \end{cases}
    \end{equation}}
    \onslide<3->{with the capacitor current $i_2(t)$ being
    \begin{equation}
        i_2(t) = \begin{cases}
            C\nicefrac{\mathrm{d}u_2(t)}{\mathrm{d}t} = \hat{i}_2 \cos(\omega t)= C \omega  \hat{u}_1 \cos(\omega t) , & 0\leq \omega t < \nicefrac{\pi}{2}, \\
            0, & \omega t > \nicefrac{\pi}{2}.
        \end{cases}
    \end{equation}}
    \begin{figure}
        \begin{circuitikz}[baseline=(current bounding box.center)] 
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short] ++(0.75,0)
            to [diode, l=$D$]  ++(1.5,0)
            to [short, i=$i_2(t)$] ++(0.75,0)
            to [C, v^= $u_2(t)$, voltage = straight, l_=$C$] ++(0,-2) coordinate (B)
            (A) -- (B);
        \end{circuitikz}
        \hspace{1cm}
        \begin{tikzpicture}[baseline=(current bounding box.center), visible on=<2->]
            \begin{axis}[
                width=0.4\textwidth,
                height=0.45\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=-0.25*pi, xmax=2*pi+0.25*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]
                \addplot[domain=-0.25*pi:0, samples=10, signalbrown, thick]{0};
                \addplot[domain=0:pi/2, samples=100, signalbrown, thick]{sin(deg(x))};
                \addplot[domain=pi/2:2*pi+0.25, samples=10, signalbrown, thick]{1};
                \addplot[domain=-0.25*pi:0, samples=10, signalred, thick]{0};
                \addplot[domain=0:pi/2, samples=100, signalred, thick]{cos(deg(x))};
                \addplot[domain=pi/2:2*+pi+0.25*pi, samples=10, signalred, thick]{0};
                \draw[signalred, thick] (axis cs:0,0) -- (axis cs:0,1);
                \addplot[domain=-0.25*pi:2*pi+0.25*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};
    
                \node[signalblue, above, yshift = 1mm] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalbrown, below] at (axis cs:3.14*3/2,1.0) {$u_2(t)$};
                \node[signalred, below] at (axis cs:3.14/2,0) {$i_2(t)$};
            \end{axis}
        \end{tikzpicture}
        \caption{M1U topology with output capacitor (unloaded and idealized charging curve)}
        \label{fig:M1U_topology_capacitor}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Capacitive output filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Capacitive output filtering (cont.)}
    If the rectified output is loaded, the capacitor voltage ripples:
    \begin{itemize}
        \item<2-> If $u_2(t) \leq u_1(t)$: diode conducts, capacitor charges (follows input voltage).
        \item<3-> If $u_2(t) > u_1(t)$: diode blocks, capacitor discharges via $I_0$. 
    \end{itemize}

    \begin{figure}
        \begin{circuitikz}[baseline=(current bounding box.center)] 
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i=$i_1(t)$] ++(0.75,0)
            to [diode, l=$D$]  ++(1.5,0)
            to [short, i=${i_2(t)}$] ++(0.75,0) coordinate (C)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, *-*, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            (C) to [short] ++(1.5,0)
            to [isource, l=$I_0$] ++(0,-2) coordinate (B)    
            (A) -- (B);
        \end{circuitikz}
        \hspace{0.5cm}
        \begin{tikzpicture}[baseline=(current bounding box.center), visible on =<4->]
            \tikzmath{
                    real \i0, \deltaT, \a;
                    \i0 = 0.4;
                    \deltaT = 0.15;
                    \a = -(sin(\deltaT*180) - cos(asin(\i0)))/(3/2*pi-asin(\i0)*pi/180+\deltaT*pi);
                }
            \begin{axis}[
                width=0.55\textwidth,
                height=0.6\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=3*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14/2,3.14, 3.14*3/2,6.28, 2.5*3.14},
                xticklabels={$0$, ,$\pi$, , $2\pi$, },
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]
                
                %input current
                \addplot[domain=0:pi/2+asin(\i0)*pi/180, samples=100, signalred, thick]{cos(deg(x))+\i0};
                \addplot[domain=pi/2+asin(\i0)*pi/180:2*pi+\deltaT*pi, samples=10, signalred, thick]{0};
                \addplot[domain=2*pi+\deltaT*pi:2.5*pi+asin(\i0)*pi/180, samples=100, signalred, thick]{cos(deg(x))+\i0};
                \draw[signalred, thick] (axis cs:2*pi+\deltaT*pi,0) -- (axis cs:2*pi+\deltaT*pi,{\i0 + cos(\deltaT*180)});
                \addplot[domain=2.5*pi+asin(\i0)*pi/180:3*pi, samples=10, signalred, thick]{0};

                %Capacitor current
                \addplot[domain=0:pi/2+asin(\i0)*pi/180, samples=100, signalred, thick, dotted]{cos(deg(x))};
                \addplot[domain=pi/2+asin(\i0)*pi/180:2*pi+\deltaT*pi, samples=10, signalred, thick, dotted]{-\i0};
                \addplot[domain=2*pi+\deltaT*pi:2.5*pi+asin(\i0)*pi/180, samples=100, signalred, thick, dotted]{cos(deg(x))};
                \draw[signalred, thick, dotted] (axis cs:2*pi+\deltaT*pi,-\i0) -- (axis cs:2*pi+\deltaT*pi,{cos(\deltaT*180)});
                \addplot[domain=2.5*pi+asin(\i0)*pi/180:3*pi, samples=10, signalred, thick, dotted]{-\i0};

                %Capacitor voltage
                \addplot[domain=0:pi/2+asin(\i0)*pi/180, samples=100, signalbrown, thick]{sin(deg(x))};
                \addplot[domain=pi/2+asin(\i0)*pi/180:2*pi+\deltaT*pi, samples=10, signalbrown, thick]{cos(asin(\i0))-\a*(x-pi/2-asin(\i0)*pi/180)};
                \addplot[domain=2*pi+\deltaT*pi:2.5*pi+asin(\i0)*pi/180, samples=10, signalbrown, thick]{sin(deg(x))};
                \addplot[domain=pi/2+asin(\i0)*pi/180+2*pi:2*pi+\deltaT*pi+2*pi, samples=10, signalbrown, thick]{cos(asin(\i0))-\a*(x-pi/2-asin(\i0)*pi/180-2*pi)};

                %input voltage
                \addplot[domain=0*pi:3*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};


                %Blocking time of diode indication
                \draw[dashed] (axis cs:{pi/2+asin(\i0)*pi/180},-\i0) -- (axis cs:{pi/2+asin(\i0)*pi/180},1.5);
                \draw[<->] (axis cs:{pi/2+asin(\i0)*pi/180},1.2) -- (axis cs:{2*pi+\deltaT*pi},1.2);
                \node[fill=white, inner sep=2pt] at (axis cs:{pi/4+asin(\i0)*pi/180/2 + pi+\deltaT*pi/2},1.2) {${u_2 \geq u_1}$};

                %signal labels
                \node[signalblue, left, fill=white, inner sep=2pt, xshift=-5mm] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalbrown, below, xshift=-3mm] at (axis cs:3.0*3/2,0.65) {$u_2(t)$};
                \node[signalred, left] at (axis cs:3.14/2,-\i0) {${i_\mathrm{C}(t)}$};
                \node[signalred, right, xshift=3mm, fill=white, inner sep=2pt] at (axis cs:{(2+\deltaT)*pi},1.25) {${i_1(t)}$};
            \end{axis}
        \end{tikzpicture}
        \caption{M1U topology with output capacitor and constant load current}
        \label{fig:M1U_topology_capacitor_loaded}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Full-cycle rectification / M2U circuit %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Full-cycle rectification / M2U circuit} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M2U uncontrolled rectifier circuit  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M2U uncontrolled rectifier circuit}
    The previous M1U topology only rectified half of a cycle resulting in a reduced output voltage utilization and increased voltage ripple. By adding another diode and utilizing a center-tapped transformer, the circuit can be extended towards a \hl{full-cycle rectifier}.
    \begin{figure}
           \begin{circuitikz}[baseline=(current bounding box.center)]
            \draw (0,0) node[transformer core](T){$N_1:N_2$}
            (T.inner dot A1) node[circ]{}
            (T.inner dot B1) node[circ]{}
            (T.A1) to [short] ++(0,1) to [short, -o, i<_=$i_1(t)$] ++(-1,0) coordinate (A1)
            (T.A2) to [short] ++(0,-1) to [short, -o] ++(-1,0) coordinate (A2)
            (T.B1) to [short] ++(0, 1) coordinate (B1)
            (T.B2) to [short] ++(0,-1) coordinate (B2);
            \draw (A1) to [open, v=$u_1(t)\hspace{0.5cm}$, voltage = straight] (A2); 
            \draw (B1) to [diode, l=$D_1$] ++(2.5,0) coordinate (C1)
            (B2) to [diode, l=$D_2$] ++(2.5,0)
            to [crossing, -*, mirror] (C1)
            to [short, i=$i_2(t)$] ++(1.25,0) coordinate (D)
            to [R, v^= $u_2(t)$, voltage = straight, l_=$R$] (T-L2.midtap -| D)
            to [short] (T-L2.midtap);
            \draw let \p1 = (B1), \p2 = (T-L2.midtap) in (\x1 + 0.5cm, \y1) to [open, v^=$\hspace{0.5cm}{u_\mathrm{s,1}(t)}$, voltage = straight] (\x1 + 0.5cm, \y2);
            \draw let \p1 = (B2), \p2 = (T-L2.midtap) in (\x1 + 0.5cm, \y1) to [open, v=$\hspace{0.5cm}{u_\mathrm{s,2}(t)}$, voltage = straight] (\x1 + 0.5cm, \y2);
        \end{circuitikz}%
        \begin{tikzpicture}[baseline=(current bounding box.center), , visible on =<2->]
            \begin{axis}[
                width=0.375\textwidth,
                height=0.65\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2.5*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,-2/5, 0,2/5, 1},
                yticklabels={$-\hat{u}_1$,$-\frac{\hat{u}_1}{2}\frac{N_2}{N_1}$, $0$,$\frac{\hat{u}_1}{2}\frac{N_2}{N_1}$, $\hat{u}_1$},
                grid=both,
                ]
                \addplot[domain=0:2.5*pi, samples=100, signalbrown, thick]{2/5*abs(sin(deg(x)))};
                \addplot[domain=0:2.5*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};
                \node[signalblue, above, yshift = 2mm] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalbrown, above] at (axis cs:3.14*3/2,2/5) {$u_2(t)$};
            \end{axis}
        \end{tikzpicture}
        \caption{M2U topology (aka \hl{two pulse mid-point rectifier}) with center-tapped transformer}
        \label{fig:M2U_topology}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M2U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M2U uncontrolled rectifier circuit (cont.)}
    From \figref{fig:M2U_topology} we can conclude the following:
    \begin{itemize}
        \item During the positive half-cycle of $u_1(t)$: $D_1$ conducts, $D_2$ blocks, and $u_2(t) = u_\mathrm{s,1}(t)$.
        \item During the negative half-cycle of $u_1(t)$: $D_2$ conducts, $D_1$ blocks, and $u_2(t) = u_\mathrm{s,2}(t)$.
    \end{itemize}\pause
    The output voltages of the center-tapped transformer are
    \begin{equation}
        u_\mathrm{s,1}(t) = \frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \sin(\omega t) \quad \text{and} \quad u_\mathrm{s,2}(t) = -\frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \sin(\omega t).
    \end{equation}
    Here, it should be noted that both $u_\mathrm{s,1}(t)$ and $u_\mathrm{s,2}(t)$ are utilizing only half of the secondary winding turns due to the central tapping.\pause The output voltage results in
    \begin{equation}
        u_2(t) = \frac{1}{2}\frac{N_2}{N_1}\left|u_1(t)\right| = \frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \left|\sin(\omega t)\right|.
        \label{eq:u2_M2U}
    \end{equation} 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M2U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M2U uncontrolled rectifier circuit (cont.)}
    \onslide<1->{From \eqref{eq:u2_M2U}, the \hl{average output} voltage of the M2U rectifier is}
    \begin{equation}
        \begin{split}
            \onslide<1->{\overline{u}_2 &= \frac{1}{T} \int_{0}^{T} u_2(t) \mathrm{d}t}\onslide<2->{ = \frac{1}{2\pi} \int_{0}^{2\pi} \frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \left|\sin(\omega t)\right| \mathrm{d}\omega t}\onslide<3->{ =\frac{1}{\pi} \int_{0}^{\pi} \frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \sin(\omega t) \mathrm{d}\omega t}\\
            &\onslide<4->{= \frac{1}{2\pi}\frac{N_2}{N_1}\hat{u}_1 \left[ - \cos(\omega t) \right]_{0}^{\pi}} \onslide<5->{= \frac{1}{2\pi}\frac{N_2}{N_1}\hat{u}_1 \left( 1+1 \right) = \frac{1}{\pi}\frac{N_2}{N_1}\hat{u}_1.}
        \end{split}
        \label{eq:u2_M2U_avg}
    \end{equation}
    \onslide<5->{Not considering the transformer conversion via $\nicefrac{N_2}{N_1}$, this is twice as much as in the M1U case, compare \eqref{eq:u2_M1U_avg}.} \onslide<6->{The \hl{RMS value} of the output voltage $u_2(t)$ results in}
    \begin{equation}
        \begin{split}
            \onslide<6->{U_2 &= \sqrt{\frac{1}{2\pi} \frac{1}{2^2}\frac{N_2^2}{N_1^2} \hat{u}_1^2 \int_{0}^{2 \pi}  \sin^2(\omega t) \mathrm{d}\omega t}}\onslide<7->{ = \frac{1}{2}\frac{N_2}{N_1} \hat{u}_1 \sqrt{\frac{1}{\pi}  \int_{0}^{\pi}  \sin^2(\omega t) \mathrm{d}\omega t}} \\\onslide<8->{&= \frac{1}{2}\frac{N_2}{N_1} \hat{u}_1 \sqrt{\frac{1}{2\pi}\left[\frac{1}{2}\omega t - \frac{\sin(2 \omega t)}{4}\right]_0^\pi}}\onslide<9->{= \frac{N_2}{N_1} \hat{u}_1\frac{\hat{u}_1}{\sqrt{2}} = \frac{N_2}{N_1} U_1.}
        \end{split}
        \label{eq:u2_M2U_rms}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M2U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M2U uncontrolled rectifier circuit (cont.)}
    \onslide<1->{The \hl{Fourier coefficients} of the output voltage $u_2(t)$ from \eqref{eq:u2_M2U} are}
    \begin{equation}
        \begin{split}
            \onslide<1->{a^{(0)} &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \mathrm{d} \omega t} \onslide<2->{= 2 \overline{u}_2= \frac{2}{\pi}\frac{N_2}{N_1}\hat{u}_1,}\\
            \onslide<3->{a^{(k)} &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \cos(k\omega t) \mathrm{d}\omega t} \onslide<4->{= \frac{1}{2\pi}\frac{N_2}{N_1}\left( \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \cos(k\omega t) \mathrm{d}\omega t \right.\\ & \left.+ \int_{\pi}^{2\pi} (-1)\hat{u}_1 \sin(\omega t) \cos(k\omega t) \mathrm{d}\omega t\right)} \onslide<5->{= \ldots = \begin{cases}\frac{\hat{u}_1}{\pi}\frac{N_2}{N_1}\frac{2}{1-k^2}, & k=2,4,6,\ldots\\ 0, & \mbox{otherwise}. \end{cases}}\\
            \onslide<6->{b^{(k)} &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \sin(k\omega t) \mathrm{d}\omega t} \onslide<7->{= \frac{1}{2\pi}\frac{N_2}{N_1}\left( \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \sin(k\omega t) \mathrm{d}\omega t \right.\\ & \left.+ \int_{\pi}^{2\pi} (-1)\hat{u}_1 \sin(\omega t) \sin(k\omega t) \mathrm{d}\omega t\right)}\onslide<8->{ = \ldots = 0.}
        \end{split}
        \label{eq:u2_M2U_Fourier}
    \end{equation}
    \onslide<9->{These coefficients also indicate significant harmonics, which are in particular scaled by the transformer turns ratio.}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Full-cycle rectification / B2U circuit %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Full-cycle rectification / B2U circuit} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit}
    The B2U circuit also allows full-cycle rectification but without the need for a center-tapped transformer, that is, fully utilizes the input voltage without halving it on the output side.
    \begin{figure}
           \begin{circuitikz}[baseline=(current bounding box.center)]
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i=$i_1(t)$, -*] ++(2,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(2,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-2,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [crossing, *-, mirror] ++(-4,0)
            to [short] (A)
            (C) to [short, i=$i_2(t)$] ++(2,0)
            to [short] ++(0,-1.5)
            to [R, v= $u_2(t)$, voltage = straight, l=$R$] ++(0,-2)
            to [short] ++(0,-1.5)
            to [short] (D);
        \end{circuitikz}%
        \hspace{0.5cm}
        \begin{tikzpicture}[baseline=(current bounding box.center)]
            \begin{axis}[
                width=0.375\textwidth,
                height=0.65\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2.5*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0, 1},
                yticklabels={$-\hat{u}_1$,$0$,$\hat{u}_1$},
                grid=both,
                ]
                \addplot[domain=0:2.5*pi, samples=100, signalbrown, thick]{abs(sin(deg(x)))};
                \addplot[domain=0:2.5*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};
                \node[signalblue, above, yshift = 3mm] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalbrown, above, yshift = -2mm] at (axis cs:3.14*3/2,2/5) {$u_2(t)$};
            \end{axis}
        \end{tikzpicture}
        \caption{B2U topology (aka \hl{two pulse bridge rectifier}) with resistive load}
        \label{fig:B2U_topology}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit (cont.)}
    \onslide<1->{For a purely resistive load as in \figref{fig:B2U_topology} the output voltage $u_2(t)$ is
    \begin{equation}
        u_2(t) = \left|u_1(t)\right| = \hat{u}_1 \left|\sin(\omega t)\right|.
        \label{eq:u2_B2U_resistive}
    \end{equation}}
    \onslide<2->{Here, following diodes are conducting:}
    \begin{itemize}
        \item<2-> Positive half-cycle: $D_1$ and $D_2$,
        \item<3-> Negative half-cycle: $D_3$ and $D_4$.
    \end{itemize}
    \onslide<4->{The average output voltage $\overline{u}_2$ is}
    \begin{equation}
        \begin{split}
            \onslide<4->{\overline{u}_2 &= \frac{1}{T} \int_{0}^{T} u_2(t) \mathrm{d}t} \onslide<5->{= \frac{1}{2\pi} \int_{0}^{2\pi} \hat{u}_1 \left|\sin(\omega t)\right| \mathrm{d}\omega t} \onslide<6->{= \ldots = \frac{2}{\pi}\hat{u}_1.}
        \end{split}
        \label{eq:u2_B2U_resistive_avg}
    \end{equation}
    \onslide<7->{The Fourier coefficients of the output voltage $u_2(t)$ are analogous to the M2U case, compare \eqref{eq:u2_M2U_Fourier} with appropriate scaling considering the lack of the center-tapped transformer.}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit with capacitive output filtering %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit with capacitive output filtering}
    \begin{figure}
           \begin{circuitikz}
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i=$i_1(t)$, -*] ++(2,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(2,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-2,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [crossing, *-, mirror] ++(-4,0)
            to [short] (A)
            (C) to [short, i=$i_2(t)$] ++(2,0) coordinate (E)
            to [short] ++(0,-1.5)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            to [short] ++(0,-1.5) coordinate (F)
            to [short] (D)
            (E) to [short, *-] ++(2,0)
            to [short] ++(0,-1.5)
            to [isource, l=$I_0$] ++(0,-2)
            to [short] ++(0,-1.5)
            to [short, -*] (F);
        \end{circuitikz}%
        \caption{B2U topology with output capacitor and constant load}
        \label{fig:B2U_topology_capacitive_filter}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit with capacitive output filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit with capacitive output filtering (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                    real \i0, \a, \b, \c, \ihat;
                    \i0 = 0.15; % normalized load current
                    \a = acos(-\i0)*pi/180; %Phase angle alpha until cap current hits -i0 and diodes block
                    \b = 0.3*pi; % Phase angle beta indicating the time until the cap voltage is hit by the input voltage and diodes start conducting again
                    \c = (sin(deg(\a)) + sin(deg(pi+\b)))/(\i0*(pi + \b - \a)); % slope of the capacitor voltage during the discharge phase
                    \ihat = -\i0/cos(deg(\a));%-\i0*(pi+\b-\a)/(sin(deg(\a))+sin(deg(\b+pi))); 
                }
            \begin{axis}[
                width=0.79\textwidth,
                height=0.85\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=3*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14/2, \a, 3.14, pi+\b, 3.14*3/2,6.28, 2.5*3.14},
                xticklabels={$0$, ,$\omega t_1$ ,$\pi$, $\omega t_2$, , $2\pi$, },
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]

                % %input voltage
                \addplot[domain=0*pi:3*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};
                \addplot[domain=0*pi:3*pi, samples=100, signalblue, thick, dash dot]{abs(sin(deg(x)))}; %rectified input voltage
                
                % capacitor current
                \addplot[domain=0:\a, samples=100, signalred, dotted, thick]{\ihat*cos(deg(x))};
                \addplot[domain=\a:pi+\b, samples=100, signalred, dotted, thick]{-\i0};
                \draw[signalred, thick, dotted] (axis cs:pi+\b,-\i0) -- (axis cs:pi+\b,{\ihat*-cos(deg(pi+\b))});
                \addplot[domain=pi+\b:pi+\a, samples=100, signalred, dotted, thick]{\ihat*-cos(deg(x))};
                \addplot[domain=pi+\a:2*pi+\b, samples=100, signalred, dotted, thick]{-\i0};
                \draw[signalred, thick, dotted] (axis cs:2*pi+\b,-\i0) -- (axis cs:2*pi+\b,{\ihat*-cos(deg(pi+\b))});
                \addplot[domain=2*pi+\b:2*pi+\a, samples=100, signalred, dotted, thick]{\ihat*cos(deg(x))};
                \addplot[domain=2*pi+\a:3*pi+\b, samples=100, signalred, dotted, thick]{-\i0};
                
                % input current
                \addplot[domain=0:\a, samples=100, signalred, thick]{cos(deg(x))+\i0};
                \addplot[domain=\a:pi+\b, samples=100, signalred, thick]{0};
                \draw[signalred, thick] (axis cs:pi+\b,0) -- (axis cs:pi+\b,{-cos(deg(pi+\b))+\i0});
                \addplot[domain=pi+\b:pi+\a, samples=100, signalred, thick]{-cos(deg(x))+\i0};
                \addplot[domain=pi+\a:2*pi+\b, samples=100, signalred, thick]{0};
                \draw[signalred, thick] (axis cs:2*pi+\b,0) -- (axis cs:2*pi+\b,{-cos(deg(pi+\b))+\i0});
                \addplot[domain=2*pi+\b:2*pi+\a, samples=100, signalred, thick]{cos(deg(x))+\i0};
                \addplot[domain=2*pi+\a:3*pi+\b, samples=100, signalred, thick]{0};

                % %Capacitor voltage
                \addplot[domain=0:\a, samples=100, signalbrown, thick]{sin(deg(x))};
                \addplot[domain=\a:pi+\b, samples=100, signalbrown, thick]{sin(deg(\a))-\c*\i0*(x-\a)};
                \addplot[domain=pi+\b:pi+\a, samples=100, signalbrown, thick]{abs(sin(deg(x)))};
                \addplot[domain=pi+\a:2*pi+\b, samples=100, signalbrown, thick]{sin(deg(\a))-\c*\i0*(x-\a-pi)};
                \addplot[domain=2*pi+\b:2*pi+\a, samples=100, signalbrown, thick]{abs(sin(deg(x)))};
                \addplot[domain=2*pi+\a:3*pi+\b, samples=100, signalbrown, thick]{sin(deg(\a))-\c*\i0*(x-\a-2*pi)};

                %dashed horizontal lines for alpha beta angles
                \draw[dotted] (axis cs:\a,-1.5) -- (axis cs:\a,1.5);
                \draw[dotted] (axis cs:pi+\b,-1.5) -- (axis cs:pi+\b,1.5);
                \draw[->]  (0,-0.9) -- node[above]{$\alpha$}(\a, -0.9);
                \draw[<->]  (\a,-1.2) -- node[above]{$\beta$}(\b+pi, -1.2);
                
                % %signal labels
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,-0.9) {$u_1(t)$};
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14*2,1.0) {$|u_1(t)|$};
                \draw[signalblue, thin] (axis cs:3.14*2-0.2,0.95) -- (axis cs:3.14*2-0.5,0.7);
                \node[signalbrown, above] at (axis cs:3.0,0.9) {$u_2(t)$};
                \node[signalred, left] at (axis cs:3.14/2,-\i0) {${i_\mathrm{C}(t)}$};
                \node[signalred, right, fill=white, inner sep=2pt] at (axis cs:0.2*pi,1.25) {${i_2(t)}$};
            \end{axis}
        \end{tikzpicture}
        \caption{Typical signal curves for B2U topology with output capacitor and constant load}
        \label{fig:B2U_topology_capacitive_filter_signals}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit with capacitive output filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit with capacitive output filtering (cont.)}
    The filter capacitor current $i_\mathrm{C}(t)$ is
    \begin{equation}
        i_\mathrm{C}(t) = \begin{cases}
            -I_0, & i_2(t) = 0,\\
            C\frac{\mathrm{d}}{\mathrm{d}t}u_2(t), & i_2(t) > 0,
        \end{cases}
        \label{eq:iC_B2U_cap_filt}
    \end{equation}
    that is, if the output current $i_2(t)$ is zero, the diode bridge blocks and the capacitor discharges via the load. Contrary, if the output current is positive, the diodes conduct and the capacitor voltage is determined by the rectified input voltage.\pause The output current is given by
    \begin{equation}
        i_2(t) = i_\mathrm{C}(t) + I_0.
        \label{eq:i2_B2U_cap_filt}
    \end{equation} \pause
    Inserting \eqref{eq:iC_B2U_cap_filt} in \eqref{eq:i2_B2U_cap_filt} delivers the output current during the conduction phase:
    \begin{equation}
        i_2(t) = C\omega \hat{u}_1 \cos(\omega t) + I_0, \quad 0 \leq \omega t < \omega t_1.
        \label{eq:i2_B2U_cap_filt_conduct}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit with capacitive output filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit with capacitive output filtering (cont.)}
    \onslide<1->{The \hl{conduction phase} lasts until $\omega t_1 = \alpha$ which can be determined from \eqref{eq:i2_B2U_cap_filt_conduct}:
    \begin{equation}
            \alpha = \arccos\left(-\frac{I_0}{C\omega \hat{u}_1}\right).
        \label{eq:omega_t1_B2U_cap_filt}
    \end{equation}}
    \onslide<2->{For $\alpha < \omega t < \omega t_2$ the capacitor discharges via the load:}
    \begin{equation}
        \begin{split}
            \onslide<2->{u_2(t) &= u_2(\omega t_1) + \int_{t_1}^t -\frac{I_0}{C} \mathrm{d} \tau} \onslide<3->{= u_2(\alpha) + \int_{\alpha}^{\omega t} -\frac{I_0}{\omega C} \mathrm{d} \omega \tau}\\
                   &\onslide<4->{=  u_2(\alpha) - \frac{I_0}{\omega C} (\omega t - \alpha), \quad \omega t_1 \leq \omega t < \omega t_2.}
        \end{split}
    \end{equation}
    \onslide<5->{The \hl{blocking phase} lasts until $\omega t_2 = \alpha + \beta$, that is, the rectified input voltage is equal to the capacitor voltage (note: not solvable for $\omega t_2$ in closed-form, requires numerical methods):}
    \begin{equation}
        \begin{split}
            \onslide<5->{u_2(\omega t_2) = u_2(\alpha) - \frac{I_0}{\omega C} (\omega t_2 - \alpha) }\onslide<6->{\stackrel{!}{=} \hat{u}_1 |\sin(\omega t_2)| = |u_1(\omega t_2)|.}
        \end{split}
        \label{eq:u2_B2U_cap_filt_block}
    \end{equation}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance}
    \begin{figure}
           \begin{circuitikz}
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [L, i>^=$i_1(t)$, -*, l=$L$, v=$u_\mathrm{L}(t)$, voltage = straight] ++(3,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(2,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-2,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [crossing, *-, mirror] ++(-4,0)
            to [short] (A)
            (C) to [short, i=$i_2(t)$] ++(2,0) coordinate (E)
            to [short] ++(0,-1.5)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            to [short] ++(0,-1.5) coordinate (F)
            to [short] (D)
            (E) to [short, *-] ++(2,0)
            to [short] ++(0,-1.5)
            to [isource, l=$I_0$] ++(0,-2)
            to [short] ++(0,-1.5)
            to [short, -*] (F);
        \end{circuitikz}%
        \caption{B2U topology considering an output capacitor, constant load, and grid impedance}
        \label{fig:B2U_topology_capacitive_filter_grid}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \onslide<1->{For the modified scenario form \eqref{fig:B2U_topology_capacitive_filter_grid} we assume an infinite capacitance capacitor, i.e.,
    $$ u_2(t)\approx U_2$$
    to keep the analysis simple.} \onslide<2->{Like before, the diode bridge conduction is determined by the output current $i_2(t)$:}
    \begin{itemize}
        \item<2-> $i_2(t)>0$: diode bridge conducts, $u_\mathrm{L}(t) = |u_1(t)|-U_2$,
        \item<3-> $i_2(t)=0$: diode bridge blocks, $u_\mathrm{L}(t) = \max\{0, |u_1(t)|-U_2\}$.
    \end{itemize}
    \onslide<4->{Hence, the B2U rectifier behavior is driven by the grid impedance current and the dynamics introduced by $L$.} \onslide<5->{Similar to the previous analysis on DC-DC converters, the \hl{discontinuous conduction mode (DCM)} and the \hl{boundary conduction mode (BCM)} will be differentiated in the following.}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                    real \a, \b, \i0, \gain;
                    \b = 0.6*pi; % Phase angle beta indicating the time length of diode conduction
                    \a = rad(atan((1-cos(deg(\b)))/(\b - sin(deg(\b))))); % Phase angle alpha indicating the start time of conducting diodes
                    \gain = sin(deg(\a)); % gain of average output voltage to input voltage amplitude
                    \i0 = 0.5*((1-cos(deg(\b)))/\gain - \gain*\b^2/2); % normalized load current
                }
            \begin{axis}[
                width=0.79\textwidth,
                height=0.85\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0, \a, 3.14/2, pi-\a, \b+\a, 3.14, 3.14*3/2,6.28},
                xticklabels={$0$, $\omega t_1$, $\frac{\pi}{2}$,$\omega t_2$, $\omega t_3$, $\pi$, $\frac{3}{2}\pi$, $2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]

                % %input voltage
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dashed, name path = A]{sin(deg(x))};
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dash dot]{abs(sin(deg(x)))}; %rectified input voltage
                
                % output current (with double height for better visibility)
                \addplot[domain=0:\a, samples=10, signalred, thick]{0};
                \addplot[domain=\a:\a+\b, samples=100, signalred, thick]{pi*(cos(deg(\a))-cos(deg(x))-\gain*(x-\a))};
                \addplot[domain=\a+\b:pi+\a, samples=10, signalred, thick]{0};
                \addplot[domain=\a+pi:\a+\b+pi, samples=100, signalred, thick]{pi*(cos(deg(\a))-cos(deg(x-pi))-\gain*(x-\a-pi))};
                \addplot[domain=\a+\b+pi:2*pi, samples=10, signalred, thick]{0};
        
                % dashed vertical lines for averages
                \draw[dashed, name path = B] (axis cs:0,\gain) -- (axis cs:2*pi,\gain);
                \draw[dashed, signalred] (axis cs:0,\i0*2) -- (axis cs:2*pi,\i0*2);

                %dashed horizontal lines for alpha beta angles
                \draw[dotted] (axis cs:\a,-1.5) -- (axis cs:\a,1.5);
                \draw[dotted] (axis cs:\a+\b,-1.5) -- (axis cs:\a+\b,1.5);
                \draw[dotted] (axis cs:pi-\a,-1.5) -- (axis cs:pi-\a,1.5);
                \draw[->]  (0,-0.7) -- node[above]{$\alpha$}(\a, -0.7);
                \draw[<->]  (\a,-0.9) -- node[above]{$\beta$}(\a+\b, -0.9);

                % signal labels
                \node[signalblue, below, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,1.0) {$|u_1(t)|$};
                \node[signalred, left] at (axis cs:pi/2+0.1,0.4) {$i_2(t)$};
                \node[signalred, above, yshift = 2mm] at (axis cs:pi*1.3,\i0) {$\overline{i}_2$};
                \node[above] at (axis cs:pi,\gain) {$U_2$};

                % fill area for depicting voltage balance
                \addplot [shadecolor, opacity=0.3] fill between [of=A and B, soft clip={domain=\a:\b+\a}]; 
            \end{axis}
        \end{tikzpicture}
        \caption{Typical signal curves for B2U topology feeding a constant load from the grid and an infinite output capacitance in DCM}
        \label{fig:B2U_topology_capacitive_filter_grid_signals_DCM}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \onslide<1->{In \hl{steady-state DCM} the output current is zero for
   \begin{equation}
        i_2(\omega t) = 0, \quad 0 \leq \omega t < \omega t_1.
   \end{equation}
   Until then the diode bridge is in blocking mode and disconnects the input from the output.}\onslide<2->{ At $\omega t_1 = \alpha$ the diodes start conducting since the input voltage exceeds the output voltage:}
   \begin{equation}
    \onslide<2->{u_1(\omega t_1 = \alpha) = \hat{u}_1 \sin(\alpha)} \onslide<3->{\stackrel{!}{=} U_2 \quad \Leftrightarrow \quad \alpha = \arcsin\left(\frac{U_2}{\hat{u}_1}\right).}
   \end{equation}
   \onslide<4->{At this point, the output current is rising due to the positive inductor voltage:}
   \begin{equation}
    \begin{split}
        \onslide<4->{i_2(\omega t) &= \frac{1}{L} \int_{t_1}^t u_1(t)-U_2 \mathrm{d}\tau}\onslide<5->{= \frac{1}{\omega L} \int_{\omega t_1}^{\omega t} u_1(\omega \tau)-U_2 \mathrm{d}\omega \tau} \onslide<6->{= \frac{1}{\omega L} \int_{\omega t_1}^{\omega t} \hat{u}_1 \sin(\omega \tau)-U_2 \mathrm{d}\omega \tau }\\
               & \onslide<7->{= \frac{\hat{u}_1}{\omega L} \left(\cos(\alpha)-\cos(\omega t)-\frac{U_2}{\hat{u}_1}(\omega t - \alpha)\right), \quad \omega t_1 \leq \omega t < \omega t_3.} 
    \end{split}
    \label{eq:i2_B2U_cap_filt_grid_conduct_DCM}
   \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \onslide<1->{At $\omega t_2 = \alpha + \beta$ the current reaches zero again and the diode bridge blocks again:}
   \begin{equation}
    \begin{split}
        \onslide<1->{i_2(\omega t_2) &= \frac{\hat{u}_1}{\omega L} \left(\cos(\alpha)-\cos(\omega t_2)-\frac{U_2}{\hat{u}_1}(\omega t_2 - \alpha)\right) \stackrel{!}{=} 0}\\
        \onslide<2->{&\Leftrightarrow \cos(\alpha)-\cos(\alpha+\beta)-\beta\sin(\alpha) = 0.}
    \end{split}
   \end{equation}
   \onslide<3->{For a given $\alpha$, this equation is not solvable in closed-form w.r.t. $\beta$ and requires numerical methods.} \onslide<4->{However, if $\beta$ is known, $\alpha$ can be determined leading to
    \begin{equation}
         \alpha = \arctan\left(\frac{1-\cos(\beta)}{\beta-\sin(\beta)}\right).
    \end{equation}}
    \onslide<5->{The average output current in DCM is}
    \begin{equation}
        \onslide<5->{\overline{i}_2 = \frac{1}{T} \int_{0}^{T} i_2(t) \mathrm{d}t} \onslide<6->{= \frac{1}{\pi} \int_{\alpha}^{\alpha+\beta} i_2(\omega t) \mathrm{d}\omega t}\onslide<7->{ = \ldots = \frac{\hat{u}_1}{\pi \omega L} \left(\frac{\hat{u}_1}{U_2}(1-\cos(\beta))-\frac{U_2}{\hat{u}_1}\frac{\beta^2}{2}\right).}
    \end{equation}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \onslide<1->{For a better representation in the following, the average current is \hl{normalized}:}
    \begin{equation}
        \onslide<1->{\overline{i}'_2 = \frac{\overline{i}_2}{\frac{2}{\pi}\frac{\hat{u}_1}{\omega L}}} \onslide<2->{= \frac{1}{2} \left(\frac{\hat{u}_1}{U_2}(1-\cos(\beta))-\frac{U_2}{\hat{u}_1}\frac{\beta^2}{2}\right).}
        \label{eq:i2_avg_norm_B2U_cap_filt_grid_DCM}
    \end{equation}
    \onslide<1->{Here, the denominator $\nicefrac{2}{\pi}\cdot\nicefrac{\hat{u}_1}{\omega L}$ is the absolute average value of the inductor current in case of a grid short circuit.\\[1em]}

    \onslide<3->{Based on the correlations found, the operating characteristics in DCM of the rectifier can be visualized, which has been implemented in \figref{fig:B2U_load_curve} (left part):}
    \begin{itemize}
        \item<3-> In DCM, $\beta \in [0, \pi[$ holds, i.e., the diode bridge is conducting for $0\ldots100 \,\%$ per half cycle.
        \item<4-> At $\beta = \pi$ the diode bridge is conducting for the full half cycle (i.e., entering BCM).
        \item<5-> In order to achieve a commutation of the current between the diode pairs D1/D4 and D2/D3, the current gets zero (for a short time) so that the rectifier operates in BCM. 
    \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                    real \a, \i0, \gain, \w2;
                    \a = 0.25*pi; % Phase angle alpha' indicating the start time of conducting diodes
                    \gain = 2/pi*cos(deg(\a)); % gain of average output voltage to input voltage amplitude
                    \i0 = sin(deg(\a)); % normalized load current
                    \w2 = pi-rad(asin(\gain));
                }
            \begin{axis}[
                width=0.79\textwidth,
                height=0.85\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0, \a, 3.14/2, \w2, 3.14, 3.14*3/2, 6.28},
                xticklabels={$0$, $\omega t_1$, $\frac{\pi}{2}$, $\omega t_2$, $\pi$, $\frac{3}{2}\pi$, $2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]

                % %input voltage
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dashed, name path = A]{sin(deg(x))};
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dash dot]{abs(sin(deg(x)))}; %rectified input voltage
                
                % output current
                \addplot[domain=0:\a, samples=100, signalred, thick]{1/4*(cos(deg(\a))*(pi/2+\a)-(x+pi)*cos(deg(\a))-pi/2*cos(deg(x+pi)))};
                \addplot[domain=\a:\a+pi, samples=100, signalred, thick]{1/4*(cos(deg(\a))*(pi/2+\a)-x*cos(deg(\a))-pi/2*cos(deg(x)))};
                \addplot[domain=\a+pi:\a+2*pi, samples=100, signalred, thick]{1/4*(cos(deg(\a))*(pi/2+\a)-(x-pi)*cos(deg(\a))-pi/2*cos(deg(x-pi)))};
     
        
                % dashed vertical lines for averages
                \draw[dashed, name path = B] (axis cs:0,\gain) -- (axis cs:2*pi,\gain);
                \draw[dashed, signalred] (axis cs:0,1/4*\i0) -- (axis cs:2*pi,1/4*\i0);

                %dashed horizontal lines for alpha beta angles
                \draw[dotted] (axis cs:\a,-1.5) -- (axis cs:\a,1.5);
                \draw[dotted] (axis cs:pi+\a,-1.5) -- (axis cs:pi+\a,1.5);
                \draw[->]  (0,-0.7) -- node[above]{$\alpha'$}(\a, -0.7);
                \draw[<->]  (\a,-0.9) -- node[above]{$\alpha'+\pi$}(\a+pi, -0.9);

                % signal labels
                \node[signalblue, below, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,1.0) {$|u_1(t)|$};
                \node[signalred, left] at (axis cs:pi/2+0.22,0.31) {$i_2(t)$};
                \node[signalred, above, yshift=-1mm] at (axis cs:pi*1.3,\i0/4) {$\overline{i}_2$};
                \node[above] at (axis cs:pi,\gain) {$U_2$};

                % fill area for depicting voltage balance
                \addplot [shadecolor, opacity=0.3] fill between [of=A and B, soft clip={domain=\a:pi+\a}]; 
            \end{axis}
        \end{tikzpicture}
        \caption{Typical signal curves for B2U topology feeding a constant load from the grid and an infinite output capacitance in BCM}
        \label{fig:B2U_topology_capacitive_filter_grid_signals_BCM}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \onslide<1->{In \hl{steady-state BCM}, the output current is analogous to the DCM as from \eqref{eq:i2_B2U_cap_filt_grid_conduct_DCM} leading to
    \begin{equation}
            i_2(\omega t) = \frac{\hat{u}_1}{\omega L} \left(\cos(\alpha')-\cos(\omega t)-\frac{U_2}{\hat{u}_1}(\omega t - \alpha')\right), \quad \alpha' \leq \omega t < \alpha' + \pi 
       \end{equation}
    with $\alpha'$ being the phase angle at which the diodes start conducting in BCM -- cf. \figref{fig:B2U_topology_capacitive_filter_grid_signals_BCM}.} \onslide<2->{After a half cycle, the current reaches zero for a short moment enabling the diode bridge to commutate the current between the diode pairs:}
    \begin{equation}
        \onslide<2->{i_2(\omega t = \alpha'+\pi) = 0}\onslide<3->{ \quad \Leftrightarrow \quad \cos(\alpha')-\cos(\alpha'+\pi)-\frac{U_2}{\hat{u}_1}\pi = 0} 
    \end{equation}
    \onslide<4->{from which 
    \begin{equation}
        \frac{U_2}{\hat{u}_1} = \frac{2}{\pi} \cos(\alpha')
        \label{eq:U2_u1_relation_B2U_cap_filt_grid_BCM}
    \end{equation}
    follows after some intermediate calculation steps.} 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \onslide<1->{The average output current in BCM follows as}
    \begin{equation}
        \begin{split}
            \onslide<1->{\overline{i}_2 &= \frac{1}{T} \int_{0}^{T} i_2(t) \mathrm{d}t}\onslide<2->{ = \frac{1}{\pi} \int_{\alpha'}^{\alpha'+\pi} i_2(\omega t) \mathrm{d}\omega t} \onslide<3->{= \ldots \\ &= \frac{2}{\pi} \frac{\hat{u}_1}{ \omega L} \sin(\alpha').}
        \end{split}
    \end{equation}
    \onslide<4->{Applying the same normalization as \eqref{eq:i2_avg_norm_B2U_cap_filt_grid_DCM} leads to
    \begin{equation}
        \overline{i}'_2 = \frac{\overline{i}_2}{\frac{2}{\pi}\frac{\hat{u}_1}{\omega L}} = \sin(\alpha').
        \label{eq:i2_avg_norm_B2U_cap_filt_grid_BCM}
    \end{equation}}
    \onslide<5->{Combining \eqref{eq:U2_u1_relation_B2U_cap_filt_grid_BCM} and \eqref{eq:i2_avg_norm_B2U_cap_filt_grid_BCM} reveals
    \begin{equation}
        \frac{U_2}{\hat{u}_1} = \frac{2}{\pi}\cos(\arcsin(\overline{i}'_2)).
    \end{equation}
    The resulting load curve for the BCM is also depicted in \figref{fig:B2U_load_curve} (right part).}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec04}}
            \begin{axis}[
                     width=0.65\textwidth,
                     height=0.85\textheight,
                     axis lines=middle,
                     xlabel={$\overline{i}'_2$},
                     xmin=0, xmax=1,
                     ymin=0, ymax=1.05,
                     grid=both,
                     xlabel style={anchor = west},
                     ]
                    \addplot[signalblue, thick] table[x=I_out, y=gain, col sep=comma] {Load_curve_B2U_rectifier.csv}; 
                    \addplot[signalred, thick] table[x=I_out, y=alpha, col sep=comma] {Load_curve_B2U_rectifier.csv}; 
                    \addplot[signalbrown, thick] table[x=I_out, y=beta, col sep=comma] {Load_curve_B2U_rectifier.csv}; 
                    \draw[dashed] (axis cs:0.535,0) -- (axis cs:0.535,1);
                    \node[signalred, above, fill=white, inner sep=2pt] at (axis cs:0.3,0.24) {$\frac{\alpha}{\pi}$};
                    \node[signalred, above, fill=white, inner sep=2pt] at (axis cs:0.65,0.24) {$\frac{\alpha'}{\pi}$};
                    \node[signalbrown, above, fill=white, inner sep=2pt] at (axis cs:0.3,0.87) {$\frac{\beta}{\pi}$};
                    \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:0.44,0.6) {$\frac{U_2}{\hat{u}_1}$};
                    \draw[thin] (axis cs:0.54,0.6) -- (axis cs:0.75,0.7);
                    \node[left, fill=white, inner sep=2pt, anchor=west] at (axis cs:0.75,0.7) {BCM limit};
            \end{axis}                
          \end{tikzpicture}
        \caption{Load curve of the B2U rectifier with capacitive output filtering and grid impedance}
        \label{fig:B2U_load_curve}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \onslide<1->{Assuming DCM, the \hl{input current} of the B2U rectifier is
    \begin{equation}
        i_1(t) = \begin{cases}
            i_2(t), & \alpha \leq \omega t < \alpha+\beta,\\
            -i_2(t), & \pi+\alpha \leq \omega t < \pi+\alpha+\beta.
        \end{cases}
    \end{equation}}
    \onslide<2->{The minus sign during the second half-cycle results from the conducting diodes D3/D4 reversing the current direction in the inductor -- cf. \figref{fig:B2U_topology_capacitive_filter_grid}.}\onslide<3->{ The input current can be decomposed into its \hl{fundamental and harmonic components}:
    \begin{equation}
        i_1(t) = \underbrace{a_1 \cos(\omega t) + b_1 \sin(\omega t)\vphantom{\sum_{k=2}^{\infty}}}_{=i_1^{(1)}(t)} + \underbrace{\sum_{k=2}^{\infty} \left( a^{(k)} \cos(k\omega t) + b^{(k)} \sin(k\omega t) \right)}_{i_1^{(\mathrm{h})}(t)}, \quad k\in \mathbb{N}.
        \label{eq:input_current_decomposition_B2U}
    \end{equation}}
    \onslide<4->{As will be discussed in the following, the harmonic components $i_1^{(\mathrm{h})}(t)$ are considered distortions negatively impacting the grid quality.}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec04}}
            \pgfmathsetmacro\a{0.25}
            \begin{axis}[
                     width=0.65\textwidth,
                     height=0.85\textheight,
                     axis lines=middle,
                     xlabel={$\omega t$},
                     xmin=0, xmax=2*pi,
                     %ymin=-0.55, ymax=0.55,
                     grid=both,
                     xlabel style={anchor = west},
                     xtick={0, 3.14/2, 3.14, 3.14*3/2, 6.28},
                    xticklabels={$0$, $\frac{\pi}{2}$, $\pi$, $\frac{3}{2}\pi$, $2\pi$},
                    ytick={\pgfkeysvalueof{/pgfplots/ymin},-\a,0,\a,\pgfkeysvalueof{/pgfplots/ymax}},
                    yticklabels={$-\hat{i}$,$-\hat{u}$, $0$,$\hat{u}$, $\hat{i}$},
                     ]
                    \addplot[signalred, thick] table[x=wt, y=i_1, col sep=comma] {Grid_current_B2U_decomposition.csv}; 
                    \addplot[signalred, thick, dashed] table[x=wt, y=i_1_fundamental, col sep=comma] {Grid_current_B2U_decomposition.csv}; 
                    \addplot[signalred, thick, dash dot] table[x=wt, y=i_1_harmonic, col sep=comma] {Grid_current_B2U_decomposition.csv}; 
                    \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick]{\a*sin(deg(x))};
                    \node[signalred, above, fill=white, inner sep=2pt] at (axis cs:pi-0.06,0.29) {$i_1(t)$};
                    \node[signalred, right, fill=white, inner sep=2pt] at (axis cs:pi,0.20) {$i_1^{(1)}(t)$};
                    \node[signalred, above, fill=white, inner sep=2pt] at (axis cs:pi*3/2,0.10) {$i_1^{(\mathrm{h})}(t)$};
                    \node[signalblue, left, fill=white, inner sep=2pt] at (axis cs:pi/3,0.25) {$u_1(t)$};
            \end{axis}                
          \end{tikzpicture}
        \caption{Input current decomposition of the B2U rectifier with $i^{(1)}_1(t)$ being the fundamental and $i^{(\mathrm{h})}_1(t)$ harmonic components}
        \label{fig:B2U_input_current_decomposition}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Recap: active, reactive and apparent power in sinusoidal steady-state %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Recap: active, reactive, and apparent power in sinusoidal steady-state}
    The \hl{complex power} is defined as
    \begin{equation}
        \underline{S} = \underline{U} \cdot \underline{I}^* = P + \mathrm{j}Q = S e^{ \mathrm{j} \varphi},
        \label{eq:complex_power}
    \end{equation}
    with the active power $P$, the reactive power $Q$, and the apparent power $S$ as well as $\underline{U}$ and $\underline{I}$ being the complex voltage and current phasors.\pause From \eqref{eq:complex_power} directly follows:
    \begin{equation}
        S = |\underline{S}| = \sqrt{P^2 + Q^2}.
    \end{equation}\pause
    The \hl{power factor} $\lambda$ is defined as
    \begin{equation}
        \lambda =\cos(\varphi) = \frac{P}{S}.
    \end{equation}\pause
    Typically, one tries to operate power converters with a \hl{unity power factor $\lambda \approx 1$} to avoid reactive power transfer (i.e., additional reactive currents leading to more losses in the grid).
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Active power transfer considering harmonics %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Active power transfer considering harmonics}
    The active power can be alternatively expressed as the average of the instantaneous power:
    \begin{equation}
        P = \frac{1}{T} \int_{0}^{T} p(t) \mathrm{d}t = \frac{1}{2\pi} \int_{0}^{2\pi} u(\omega t) i(\omega t) \mathrm{d}\omega t.
    \end{equation}\pause
    To generalize the analysis for arbitrary voltage and current harmonics, we consider both  Fourier decompositions
    \begin{equation}
            u(\omega t) = \overline{u} + \sum_{k=1}^{\infty} \hat{u}^{(k)}\cos(k\omega t -\varphi_u^{(k)}),\quad 
            i(\omega t) = \overline{i} + \sum_{k=1}^{\infty} \hat{i}^{(k)}\cos(k\omega t -\varphi_i^{(k)})
    \end{equation}
    with $\overline{u}$ and $\overline{i}$ being the DC components, $\hat{u}^{(k)}$ and $\hat{i}^{(k)}$ the amplitudes of the $k$-th harmonic and $\varphi_u^{(k)}$ and $\varphi_i^{(k)}$ the phase angles of the voltage and current harmonics.\pause This amplitude-phase representation is analogous to \eqref{eq:Fourier_series} with the relations:
    \begin{equation}
            \hat{x}^{(k)} = \sqrt{(a^{(k)})^2 + (b^{(k)})^2}, \quad \varphi_x^{(k)} = -\arccos\left(\frac{a^{(k)}}{\hat{x}^{(k)}}\right) \cdot \mathrm{sign}\left(b^{(k)}\right).
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Active power transfer considering harmonics (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Active power transfer considering harmonics (cont.)}
Substituting the Fourier series of \(u_1(\omega t)\) and \(i_1(\omega t)\) into the instantaneous power expression delivers:
\begin{align*}
    p(t) &= u(\omega t) i(\omega t) \\
    &= \left( \overline{u} + \sum_{k=1}^\infty \hat{u}^{(k)} \cos(k\omega t - \varphi_u^{(k)}) \right)
    \left( \overline{i} + \sum_{m=1}^\infty \hat{i}^{(m)} \cos(m\omega t - \varphi_i^{(m)}) \right).
\end{align*}\pause

Expanding this product yields:
\begin{align*}
    p(t) &= \overline{u} \overline{i} 
    + \overline{u} \sum_{m=1}^\infty \hat{i}^{(m)} \cos(m\omega t - \varphi_i^{(m)}) 
    + \overline{i} \sum_{k=1}^\infty \hat{u}^{(k)} \cos(k\omega t - \varphi_u^{(k)}) \\
    &+ \sum_{k=1}^\infty \sum_{m=1}^\infty \hat{u}^{(k)} \hat{i}^{(m)} 
    \cos(k\omega t - \varphi_u^{(k)}) \cos(m\omega t - \varphi_i^{(m)}).
\end{align*}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Active power transfer considering harmonics (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Active power transfer considering harmonics (cont.)}

\onslide<1->{Using the trigonometric identities the last term becomes:}
\begin{align*}
    \onslide<1->{&\sum_{k=1}^\infty \sum_{m=1}^\infty \hat{u}^{(k)} \hat{i}^{(m)} \cos(k\omega t - \varphi_u^{(k)}) \cos(m\omega t - \varphi_i^{(m)})} \\
    \onslide<2->{= &\sum_{k=1}^\infty \sum_{m=1}^\infty \hat{u}^{(k)} \hat{i}^{(m)} \frac{1}{2} \left[ \cos((k-m)\omega t + \varphi_i^{(k)} - \varphi_u^{(m)}) + \cos((k+m)\omega t - \varphi_u^{(k)} - \varphi_i^{(m)}) \right].}
\end{align*}
\onslide<3->{Hence, we receive integral terms of the form
$$
\int_0^{2\pi} \cos(n\omega t + \varphi) \mathrm{d}\omega t = \begin{cases} 2\pi \cos(\varphi), & n = 0, \\ 0 & n \neq 0 \end{cases}
$$
with $n=k-m\in\mathbb{Z}$ or $n=k+m\in\mathbb{Z}$, respectively.} \onslide<4->{Due to the periodicity and symmetry of the cosine function, the integral over a full period is zero for $n\neq 0$.}\\[1em]
\onslide<5->{\hl{Conclusion:} Cross-frequency terms (\(k \neq m\)) cancel due to their oscillatory nature, leaving only contributions from voltage and current harmonics of the same order (\(k = m\)).}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Active power transfer considering harmonics (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Active power transfer considering harmonics (cont.)}
    \onslide<1->{Summarizing the previous considerations, the active power can be expressed as:
    \begin{equation}
        P = \frac{1}{T} \int_0^T p(t) \, \mathrm{d}t = \sum_{k=1}^\infty \frac{\hat{u}^{(k)} \hat{i}^{(k)}}{2} \cos(\varphi_i^{(k)} - \varphi_u^{(k)}).
    \end{equation}}%
    \onslide<2->{Inserting the B2U ideal input voltage assumption $u(t)=u_1(t)=\hat{u}_1\sin(\omega t)$, this boils down to:}
    \begin{equation}
        \onslide<2->{P = \frac{\hat{u}_1 \hat{i}_1^{(1)}}{2} \cos(\varphi_i^{(1)} - \varphi_u^{(1)})}\onslide<3->{ = U_1 I_1^{(1)} \cos(\varphi_i^{(1)} - \varphi_u^{(1)})}
    \end{equation}
    \onslide<3->{with $U_1$ and $I_1^{(1)}$ being the RMS values of the fundamental voltage and current component and $\varphi_i^{(1)}$ the phase angle between the fundamental voltage and current component.}\onslide<4->{ The power factor results in}
    \begin{equation}
        \onslide<4->{\lambda = \frac{P}{S}}\onslide<5->{ = \frac{U_1 I_1^{(1)}}{U_1 I_1}\cos(\varphi_i^{(1)} - \varphi_u^{(1)})}\onslide<6->{ = \frac{I_1^{(1)}}{I_1}\cos(\varphi_i^{(1)} - \varphi_u^{(1)}).}
        \label{eq:power_factor_B2U}
    \end{equation}
    \onslide<6->{i.e., the harmonics increase the apparent power $S$ but do not contribute to the active power $P$. Consequently, the B2U's power factor is typically limited to $70\,\%$ or lower.}    
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Total harmonic distortion (THD) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Total harmonic distortion (THD)}
    Another important measure for the quality of the input current is the \hl{total harmonic distortion (THD)}:  
    \begin{equation}
        \mathrm{THD}(i_1) = \frac{\sqrt{\sum_{k=2}^{\infty} \left(I_1^{(k)}\right)^2}}{I_1^{(1)}} = \frac{I_1^{(\mathrm{h})}}{I_1^{(1)}}.
        \label{eq:THD}
    \end{equation}
    The THD quantifies the ratio of the RMS value of the harmonic components to the RMS value of the fundamental component.\pause Rewriting the decomposition \eqref{eq:input_current_decomposition_B2U} in the RMS form
    \begin{equation}
        I_1^2 = \left(I_1^{(1)}\right)^2 + \left(I_1^{(\mathrm{h})}\right)^2,
    \end{equation}\pause
    and inserting \eqref{eq:THD} in the power factor expression \eqref{eq:power_factor_B2U} leads to
    \begin{equation}
        \lambda = \frac{1}{\sqrt{1+\mathrm{THD}^2(i_1)}} \cos(\varphi_i^{(1)} - \varphi_u^{(1)}).
    \end{equation}
    Hence, the larger the THD, the more the power factor deviates from unity.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier: THD and power factor %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier: THD and power factor}
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec04}}
            \begin{axis}[
                     width=0.65\textwidth,
                     height=0.85\textheight,
                     axis lines=middle,
                     xlabel={$\overline{i}'_2$},
                     xmin=0, xmax=1,
                     ymin=0, ymax=1.05,
                     grid=both,
                     xlabel style={anchor = west},
                     ]
                    \addplot[signalblue, thick] table[x=I_out, y=i_1_THD, col sep=comma] {Grid_impacts_B2U_rectifier.csv}; 
                    \addplot[signalred, thick] table[x=I_out, y=lamba, col sep=comma] {Grid_impacts_B2U_rectifier.csv}; 
                    \draw[dashed] (axis cs:0.535,0) -- (axis cs:0.535,1);
                    \node[signalred, above, fill=white, inner sep=2pt] at (axis cs:0.3,0.75) {$\lambda$};
                    \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:0.3,0.35) {$\mathrm{THD}$};
                    \draw[thin] (axis cs:0.54,0.72) -- (axis cs:0.75,0.85);
                    \node[left, fill=white, inner sep=2pt, anchor=west] at (axis cs:0.75,0.85) {BCM limit};
            \end{axis}                
          \end{tikzpicture}
        \caption{THD and power factor of the B2U rectifier with capacitive output filtering and grid impedance}
        \label{fig:B2U_THD_power_factor}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier impact on the grid voltage %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier impact on the grid voltage}
    \begin{figure}
           \begin{circuitikz}[scale = 0.8, transform shape]
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [L, i>^=$i_1(t)$, -*, l=$L$] ++(3,0) coordinate (G)  node[label={above:$\mathrm{PCC}$}] {}
            to [L, l=$L_\mathrm{A}$, i^>=$i_{1\mathrm{A}}(t)$] ++(3,0)
            to [short] ++(0.5,0) coordinate (K)
            to [short, -*] ++(0.5,0) coordinate (H)
            to [diode, l=$D_1$] ++(0,1.5)
            to [short, -*] ++(2,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-2,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [crossing, *-, mirror] ++(-4,0)
            to [short] (A)
            (C) to [short, i=$i_2(t)$] ++(2,0) coordinate (E)
            to [short] ++(0,-1.5)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            to [short] ++(0,-1.5) coordinate (F)
            to [short] (D)
            (E) to [short, *-] ++(2,0)
            to [short] ++(0,-1.5)
            to [isource, l=$I_0$] ++(0,-2)
            to [short] ++(0,-1.5)
            to [short, -*] (F)
            (G) to [crossing] ++(0,-4)
            to [short] ++(0,-1.0) coordinate (J)
            to [L, l=$L_\mathrm{B}$, i^>=$i_{1\mathrm{B}}(t)$] ++(3,0)
            to [short] ++(0.5,0) coordinate (I)
            to ++ (0.5,0) node[fourport, anchor = port4, name=load]{Load B} 
            (A) to [short] (load.port1 -| A)
            to [short] (load.port1)
            (I) to [open, v = $u_{1\mathrm{B}}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-0.9)
            (J) to [open, v = $u_{1\mathrm{PCC}}(t)\hspace{1cm}$, voltage = straight] ++(0,-0.9)
            (K) to [open, v = $u_{1\mathrm{A}}(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2);
        \end{circuitikz}%
        \caption{B2U rectifier and a second load connected to the grid}
        \label{fig:B2U_grid_with_second_load}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier impact on the grid voltage (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier impact on the grid voltage (cont.)}
    In \figref{fig:B2U_grid_with_second_load} the B2U rectifier and a second load are connected to the grid $u_1(t)$ with
    \begin{itemize}
        \item $L$ being the grid inductance (at the point of common coupling -- PCC),\pause
        \item $L_\mathrm{A}$ being the inductance of the cable connecting the B2U rectifier to the PCC,\pause
        \item $L_\mathrm{B}$ being the inductance of the cable connecting the second load to the PCC.\pause
    \end{itemize}
    Assuming $i_{1\mathrm{B}}(t)=0$ for the sake of simplicity, the inductive voltage divider rule yields
    \begin{equation}
        \frac{u_1(t)-u_{1\mathrm{PCC}}(t)}{u_1(t)-u_{1\mathrm{A}}(t)} = \frac{L}{L+L_\mathrm{A}} 
    \end{equation}\pause
    and, therefore, the voltage at the second load's PCC $u_{1\mathrm{PCC}}(t)$ is
    \begin{equation}
        u_{1\mathrm{PCC}}(t) = u_1(t) - \frac{L}{L+L_\mathrm{A}}(u_1(t)-u_{1\mathrm{A}}(t)).
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier impact on the grid voltage (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier impact on the grid voltage (cont.)}
    Assuming again a constant output voltage $u_2(t)=U_2$ (due to an infinite filter capacitance), the B2U's input voltage is
    \begin{equation}
        u_{1\mathrm{A}}(t) = \begin{cases} u_{1\mathrm{A}}(t), &i_{1\mathrm{A}}(t)=0\\ \mathrm{sign}(i_2(t))\cdot U_2, &i_{1\mathrm{A}}(t) \neq 0.
        \end{cases}
    \end{equation}\pause
    Hence, the voltage at the second load's PCC is
    \begin{equation}
        u_{1\mathrm{PCC}}(t) = \begin{cases} u_1(t), & i_{1\mathrm{A}}(t)=0\\  u_1(t)\left(1-\frac{L}{L+L_\mathrm{A}}\right) + \frac{L}{L+L_\mathrm{A}}\mathrm{sign}(i_2(t))\cdot U_2, & i_{1\mathrm{A}}(t) \neq 0. \end{cases}
    \end{equation}\pause
    As on can see on the next slide, the B2U rectifier operation leads to a \hl{distorted grid voltage} $u_{1\mathrm{PCC}}(t)$ which might impair the operation of the second load. Increasing the input inductance $L_\mathrm{A}$ by an \hl{explicit filter inductor} can mitigate this issue, however, at the expense of volume, weight and cost as well as voltage drop associated with the input filter inductor.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier impact on the grid voltage (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier impact on the grid voltage (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                    real \a, \b, \i0, \gain, \ind;
                    \b = 0.6*pi; % Phase angle beta indicating the time length of diode conduction
                    \a = rad(atan((1-cos(deg(\b)))/(\b - sin(deg(\b))))); % Phase angle alpha indicating the start time of conducting diodes
                    \gain = sin(deg(\a)); % gain of average output voltage to input voltage amplitude
                    \i0 = 0.5*((1-cos(deg(\b)))/\gain - \gain*\b^2/2); % normalized load current
                    \ind = 0.6; % inductance ratio L/(L+L_A)
                }
            \begin{axis}[
                width=0.79\textwidth,
                height=0.85\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0, \a, 3.14/2, pi-\a, \b+\a, 3.14, 3.14*3/2,6.28},
                xticklabels={$0$, $\omega t_1$, $\frac{\pi}{2}$,$\omega t_2$, $\omega t_3$, $\pi$, $\frac{3}{2}\pi$, $2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]

                % %input voltage
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick]{sin(deg(x))};

                % u_1N voltage
                \draw[signalgreen, thick] (axis cs:\a,0) -- (axis cs:\a,\gain);
                \addplot[domain=\a:\a+\b, samples=10, signalgreen, thick]{\gain};
                \draw[signalgreen, thick] (axis cs:\a+\b,0) -- (axis cs:\a+\b,\gain);
                \draw[signalgreen, thick] (axis cs:\a+pi,0) -- (axis cs:\a+pi,-\gain);
                \addplot[domain=\a+pi:\a+\b+pi, samples=10, signalgreen, thick]{-\gain};
                \draw[signalgreen, thick] (axis cs:\a+\b+pi,0) -- (axis cs:\a+\b+pi,-\gain);
                
                % input current (with double height for better visibility)
                \addplot[domain=0:\a, samples=10, signalred, thick]{0};
                \addplot[domain=\a:\a+\b, samples=100, signalred, thick]{pi*(cos(deg(\a))-cos(deg(x))-\gain*(x-\a))};
                \addplot[domain=\a+\b:pi+\a, samples=10, signalred, thick]{0};
                \addplot[domain=\a+pi:\a+\b+pi, samples=100, signalred, thick]{-pi*(cos(deg(\a))-cos(deg(x-pi))-\gain*(x-\a-pi))};
                \addplot[domain=\a+\b+pi:2*pi, samples=10, signalred, thick]{0};
        
                % dashed vertical lines for averages
                \draw[dashed] (axis cs:0,\gain) -- (axis cs:2*pi,\gain);


                %dashed horizontal lines for alpha beta angles
                \draw[dotted] (axis cs:\a,-1.5) -- (axis cs:\a,1.5);
                \draw[dotted] (axis cs:\a+\b,-1.5) -- (axis cs:\a+\b,1.5);
                \draw[dotted] (axis cs:pi-\a,-1.5) -- (axis cs:pi-\a,1.5);
                \draw[->]  (0,-0.7) -- node[above]{$\alpha$}(\a, -0.7);
                \draw[<->]  (\a,-0.9) -- node[above]{$\beta$}(\a+\b, -0.9);

                % u_1K voltage
                \addplot[domain=0:\a, samples=25, signalbrown, thick, dashed]{sin(deg(x))};
                \addplot[domain=\a:\a+\b, samples=25, signalbrown, thick, dashed]{sin(deg(x))*(1- \ind)+\ind*\gain};
                \draw[signalbrown, thick, dashed] (axis cs:\a+\b,{sin(deg(\a+\b))*(1- \ind)+\ind*\gain}) -- (axis cs:\a+\b,{sin(deg(\a+\b))});
                \addplot[domain=\a+\b:\a+pi, samples=25, signalbrown, thick, dashed]{sin(deg(x))};
                \addplot[domain=\a+pi:\a+\b+pi, samples=25, signalbrown, thick, dashed]{sin(deg(x))*(1- \ind)-\ind*\gain};
                \draw[signalbrown, thick, dashed] (axis cs:\a+\b+pi,{sin(deg(\a+\b+pi))*(1- \ind)-\ind*\gain}) -- (axis cs:\a+\b+pi,{sin(deg(\a+\b+pi))});
                \addplot[domain=\a+\b+pi:2*pi, samples=25, signalbrown, thick, dashed]{sin(deg(x))};

                % signal labels
                \node[signalblue, below, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalred, left] at (axis cs:pi/2+0.05,0.35) {$i_1(t)$};
                \node[above, fill=white, inner sep=2pt] at (axis cs:pi*3/2,\gain) {$U_2$};
                \draw[thin, signalbrown] (axis cs:\a+\b+0.1,0.5) -- (axis cs:{\a+\b+pi/6},0.6);
                \node[signalbrown, left, fill=white, inner sep=2pt, anchor=west] at (axis cs:{\a+\b+pi/6},0.6) {$u_{1\mathrm{PCC}}(t)$};
                \draw[thin, signalgreen] (axis cs:\a+pi-0.1,-0.3) -- (axis cs:pi+0.4,-0.65);
                \node[signalgreen, left, fill=white, inner sep=2pt, anchor=west] at (axis cs:pi,-0.8) {$u_{1\mathrm{a}}(t)$};

            \end{axis}
        \end{tikzpicture}
        \caption{Relevant signals of the scenario from \eqref{fig:B2U_grid_with_second_load} with B2U in DCM}
        \label{fig:B2U_grid_with_second_load_time_domain}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier impact on the neutral line in three-phase grid %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[c]
    \frametitle{B2U rectifier impact on the neutral line in three-phase grid}
    \begin{figure}
            \begin{circuitikz}
                % Voltage sources and neutral connection
                \draw (0,0) to[sinusoidal voltage source, v^<=$u_{1\mathrm{a}}$, i=$i_{1\mathrm{a}}(t)$, *-] ++(2, 2) coordinate (A);
                \draw (0,0) to[sinusoidal voltage source, v^<=$u_{1\mathrm{b}}$, i=$i_{1\mathrm{b}}(t)$, *-] ++(-2, 2)
                to [short] ++(0,2) coordinate (B);
                \draw (0,0) to[sinusoidal voltage source, v^<=$u_{1\mathrm{c}}$, i=$i_{1\mathrm{c}}(t)$, *-] ++(0,-2) coordinate (C);
                \draw (0,0) to [short, *-*, i^<=$i_{\mathrm{N}}(t)$] ++(2,0) node[ground, label={above:$\mathrm{N}$}] {}
                to [short] ++(6,0) coordinate (D)
                (A) to [short] (A -| D)
                (C) to [short] (C -| D)
                (B) to [short] (B -| D);
            
                % % Rectifier blocks
                \node[draw, fill=shadecolor, minimum width=1.2cm, minimum height=0.8cm] (R1) at (3.5,1) {B2U};
                \node[draw, fill=shadecolor, minimum width=1.2cm, minimum height=0.8cm] (R2) at (4.5,-1) {B2U};
                \node[draw, fill=shadecolor, minimum width=1.2cm, minimum height=0.8cm] (R3) at (5.5,3) {B2U};
                
                % Connections to the rectifiers
                \draw (R1.south) to [short, -*] (R1.south |- D)
                (R1.north) to [short, -*] (R1.north |- A)
                (R2.south) to [short, -*] (R2.south |- C)
                (R2.north) to [short, -*] (R2.north |- D)
                (R3.south) to [crossing] ++(0,-1.2) to [short, -*] (R3.south |- D) 
                (R3.north) to [short, -*] (R3.north |- B);            
            \end{circuitikz}
        \caption{Three-phase grid with single-phase rectifiers connected to neutral}
        \label{fig:three_phase_grid_single_phase_rectifiers}
    \end{figure}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier impact on the neutral line in three-phase grid (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier impact on the neutral line in three-phase grid (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                    real \a, \b, \i0, \gain, \ind, \iamp;
                    \b = 0.3*pi; % Phase angle beta indicating the time length of diode conduction
                    \a = rad(atan((1-cos(deg(\b)))/(\b - sin(deg(\b))))); % Phase angle alpha indicating the start time of conducting diodes
                    \gain = sin(deg(\a)); % gain of average output voltage to input voltage amplitude
                    \iamp = 10; % current amplitude for visualization purposes
                }
            \begin{axis}[
                width=0.79\textwidth,
                height=0.85\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0, 3.14/2, 3.14, 3.14*3/2,6.28},
                xticklabels={$0$, $\frac{\pi}{2}$, $\pi$, $\frac{3}{2}\pi$, $2\pi$},
                ytick={-1,0,1},
                yticklabels={,$0$,},
                grid=both,
                ]

                % input voltages
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick]{sin(deg(x))};
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dashed]{sin(deg(x-pi/3*2))};
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dotted]{sin(deg(x+pi/3*2))};

                % input current i1a(t)
                \addplot[domain=0:\a, samples=10, signalred, thick]{0};
                \addplot[domain=\a:\a+\b, samples=100, signalred, thick]{\iamp*pi*(cos(deg(\a))-cos(deg(x))-\gain*(x-\a))};
                \addplot[domain=\a+\b:pi+\a, samples=10, signalred, thick]{0};
                \addplot[domain=\a+pi:\a+\b+pi, samples=100, signalred, thick]{\iamp*-pi*(cos(deg(\a))-cos(deg(x-pi))-\gain*(x-\a-pi))};
                \addplot[domain=\a+\b+pi:2*pi, samples=10, signalred, thick]{0};

                % input current i1b(t)
                \addplot[domain=\a+2/3*pi:\a+\b+2/3*pi, samples=100, signalred, thick, dashed]{\iamp*pi*(cos(deg(\a))-cos(deg(x-2/3*pi))-\gain*(x-\a-2/3*pi))};
                \addplot[domain={mod(\a+5/3*pi, 2*pi)}:{mod(\a+\b+5/3*pi, 2*pi)}, samples=100, signalred, thick, dashed]{-\iamp*pi*(cos(deg(\a))-cos(deg(x+\a-mod(\a+5/3*pi, 2*pi)))-\gain*(x-mod(\a+5/3*pi, 2*pi)))};

                % input current i1c(t)
                \addplot[domain=\a+pi/3:\a+\b+pi/3, samples=100, signalred, dotted, thick]{\iamp*-pi*(cos(deg(\a))-cos(deg(x-pi/3))-\gain*(x-\a-pi/3))};
                \addplot[domain=\a+4/3*pi:\a+\b+4/3*pi, samples=100, signalred, dotted, thick]{\iamp*pi*(cos(deg(\a))-cos(deg(x-4/3*pi))-\gain*(x-\a-4/3*pi))};
                \addplot[domain=\a-2/3*pi:\a+\b-2/3*pi, samples=100, signalred, dotted, thick]{\iamp*pi*(cos(deg(\a))-cos(deg(x+2/3*pi))-\gain*(x-\a+2/3*pi))};
        
                % dashed vertical lines for averages
                \draw[dashed] (axis cs:0,\gain) -- (axis cs:2*pi,\gain);

                % signal labels
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14/2,1.0) {$u_{1\mathrm{a}}(t)$};
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14/6*7,1.0) {$u_{1\mathrm{b}}(t)$};
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14/6*11,1.0) {$u_{1\mathrm{c}}(t)$};
                \node[signalred, left] at (axis cs:pi/2+0.05,0.35) {$i_{1\mathrm{a}}(t)$};
                \node[signalred, left] at (axis cs:pi/6*7+0.05,0.35) {$i_{1\mathrm{b}}(t)$};
                \node[signalred, left] at (axis cs:pi/6*11+0.05,0.35) {$i_{1\mathrm{c}}(t)$};
                \node[above, fill=white, inner sep=2pt] at (axis cs:pi*3/2,\gain) {$U_2$};
            \end{axis}
        \end{tikzpicture}
        \caption{Relevant signals of the scenario from \eqref{fig:three_phase_grid_single_phase_rectifiers} assuming identical operation conditions for all single-phase rectifiers}
        \label{fig:B2U_three_phase_time_domain}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier impact on the neutral line in three-phase grid (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier impact on the neutral line in three-phase grid (cont.)}
    The neutral conductor current is the sum of the phase currents:
    \begin{equation}
        i_{\mathrm{N}}(t) = i_{1\mathrm{a}}(t) + i_{1\mathrm{b}}(t) + i_{1\mathrm{c}}(t).
    \end{equation}\pause
    In the example from \figref{fig:B2U_three_phase_time_domain} the neutral conductor current corresponds to the enveloping curve over the phase currents shown in the figure:
    \begin{itemize}
        \item The B2U rectifier represents a nonlinear load such that the three-phase currents do not cancel each other out.\pause
        \item The neutral conductor current leads to power losses in the neutral conductor and can cause overheating.\pause
    \end{itemize}
    \vspace{-0.5cm}
    \begin{varblock}{Need for grid-friendly rectification}
        The shown analysis of the B2U rectifier highlights its negative impact on the grid, especially if multiple B2U rectifiers are connected to the same grid. Therefore, grid-friendly rectification alternatives are essential to ensure the stable operation of the grid and the connected loads.
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Power factor correction (PFC) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Power factor correction (PFC)} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% General PFC circuit structure %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{General PFC circuit structure}
    \begin{figure}
           \begin{circuitikz}
            % Input rectifier
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i>^=$i_1(t)$] ++(0.75,0) to [short, -*] ++(0.75,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(1.5,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-1.5,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [short, *-]++(-0.5,0) to [crossing, mirror] ++(-2,0)
            to [short] (A);

            % DC/DC converter
            \draw node[fourport, circuitikz/quadpoles/fourport/width=2.25, circuitikz/quadpoles/fourport/height=2.8, t=${\begin{aligned}
                \frac{u_2}{u'} &= m(d(t))\\
                \frac{i_2}{i'} &= m(d(t))^{-1}
             \end{aligned}}$] (DCDC) at (7.75,-1) {DC/DC}; 
            \draw (C) to [short] ++(1.5,0) coordinate (G)
            to [short] (DCDC.port4 -| G) 
            to [short,-*] ++(0.5,0) coordinate (voltin)
            to [short, i=$i'(t)$] (DCDC.port4)
            (D) to [short] ++(1.5,0) coordinate (H)
            to [short] (DCDC.port1 -| H) -- ++(0.5,0)
            to [currtap, name=ct1] (DCDC.port1)
            (DCDC.port4 -| G) to [open,v = $u'(t)\hspace{0.5cm}$, voltage = straight] (DCDC.port1 -| G);

            % Output filter and load
            \draw (DCDC.port3) to [short, i=$i_2(t)$] ++(0.9,0) coordinate (I)
            to [short] (C -| I)
            to [short] ++(1,0) coordinate (E)
            to [short] ++(0,-1.5)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            to [short] ++(0,-1.5) coordinate (F)
            to [short] (D -| I)
            to [short] (DCDC.port2 -| I) -- (DCDC.port2)
            (E) to [short, *-*] ++(1.25,0) coordinate (currout) -- ++(0.75,0)
            to [short] ++(0,-1.5)
            to [isource, l=$I_0$] ++(0,-2)
            to [short] ++(0,-1.5)
             to [short, -*] (F);

            % Controller
            \draw let \p1 = (DCDC.south) in node[draw, minimum width=1.2cm, minimum height=0.9cm] (ctrl) at (\x1,-4.1) {Controller};
            \coordinate (ctrl1) at ($(ctrl.north west)!.5!(ctrl.west)$);
            \coordinate (ctrl2) at ($(ctrl.south west)!.5!(ctrl.west)$);
            \draw[->, dashed] (ctrl.north) -- (DCDC.south) node[midway, right] {$d(t)$};
            \draw[->, dashed] (ct1.tap) -- (ctrl1 -| ct1.tap) -- (ctrl1) node[right, above, anchor = south east] {$i'(t)$};
            \draw[->, dashed] (voltin) -- (ctrl2 -| voltin) -- (ctrl2) node[right, below, anchor = north east] {$u'(t)$};
            \draw[->, dashed] (currout) -- (ctrl.east -| currout) -- (ctrl.east) node[left, above, anchor = south west] {$u_2(t)$};
        \end{circuitikz}%
        \caption{Rectifier with power factor correction (PFC) realized as a combination of a single-phase diode bridge and a cascaded DC/DC converter with voltage / current transfer ratio $m(t)$}%
        \label{fig:PFC_general_circuit_structure}%
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Idealized PFC signals in the time domain (quasi steady state) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Idealized PFC rectifier signals in the time domain (quasi steady state)} 
    \begin{figure}
        \begin{tikzpicture}
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom, vertical sep=0.75cm}, height=0.375\textheight, width=0.875\textwidth, xmin=0, xmax=4*pi, grid,clip = false, ymin = -1.1, ymax =1.1, xtick = {0, pi/2, pi, 3/2*pi, 2*pi, 2.5*pi, 3*pi, 3.5*pi, 4*pi}, xticklabels = {0, ,$\pi$, ,$2\pi$, ,$3\pi$, ,$4\pi$}, ytick = {-1, 0, 1}, yticklabels = {, 0, }]

                % Top plot: input voltage and current 
                \nextgroupplot[ylabel = {$u_\mathrm{1}(t)/i_\mathrm{1}(t)$}]
                \addplot[domain=0:4*pi, samples=100, signalblue, thick]{sin(deg(x))};
                \addplot[domain=0:4*pi, samples=100, signalred, thick]{0.8*sin(deg(x))};
                \legend{$u_\mathrm{1}(t)$, $i_\mathrm{1}(t)$}


                % middle plot: rectified voltage and current (before DCDC) 
                \nextgroupplot[ylabel = {$u'(t)/i'(t)$}] 
                \addplot[domain=0:4*pi, samples=100, signalblue, thick]{abs(sin(deg(x)))};
                \addplot[domain=0:4*pi, samples=100, signalred, thick]{abs(0.8*sin(deg(x)))};
                \legend{$u'(t)$, $i'(t)$}
    
                
                % Bottom plot: voltage transfer ratio
                \nextgroupplot[ylabel = {$m(t)$}, ytick = {0, 0.25, 1}, yticklabels = {0, $M$, }, xlabel={$\omega t$}, clip = true, ymin = 0]
                \addplot[domain=0:4*pi, samples=100, signalblue, thick]{0.25/max(abs(sin(deg(x))), 0.1)};
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Operation concept and assumptions for the PFC rectifier %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Operation concept and assumptions for the PFC rectifier} 
    \hl{Main idea}: utilize a DC/DC converter to control the input current $i_1(t)$ such that it follows the input voltage $u_1(t)$ in a way that the input current is in phase with the input voltage:
    \begin{equation}
        i_1(t) = \hat{i}_1 \sin(\omega t) \sim  \hat{u}_1 \sin(\omega t) = u_1(t).
        \label{eq:PFC_current_voltage_proportionality}
    \end{equation}
    \hl{Assumptions} for the following PFC rectifier analysis:
    \begin{itemize}
        \item The input voltage $u_1(t)$ is an ideal sinusoidal signal with amplitude $\hat{u}_1$ and frequency $\omega$.
        \item The output voltage is considered constant: $u_2(t)\approx U_2$.
        \item The grid impedance is neglected for the sake of simplicity.
        \begin{itemize}
            \item The grid impedance as in \figref{fig:B2U_topology_capacitive_filter_grid} would (mainly) introduce a phase shift between $|u_1(t)|$ and $u'(t)$ which can be compensated by the control setup. 
        \end{itemize}
    \end{itemize}
    Based on these assumptions and the objective \eqref{eq:PFC_current_voltage_proportionality}, the voltages and currents in front of the DC/DC converter must be proportional to each other (to achieve unity power factor):
    \begin{equation}
        \frac{u_1(t)}{i_1(t)} = \frac{u'(t)}{i'(t)}.
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Voltage transfer ratio %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Voltage transfer ratio} 
    Considering an ideal DC/DC converter with a \hl{voltage transfer ratio} $m(t)$, the converter must deliver a rectified-sinusoidal $u'(t)$ given some constant $U_2$:
    \begin{equation}
        u'(t) = \frac{U_2}{m(t)} \quad \Leftrightarrow \quad \hat{u}_1|\sin(\omega t)| = \frac{U_2}{m(t)}
    \end{equation}
    Hence, the voltage transfer ratio $m(t)$ is given by
    \begin{equation}
        m(t) = \frac{U_2}{u'(t)}=\frac{U_2}{\hat{u}_1|\sin(\omega t)|} 
    \end{equation}
    which varies between
    \begin{equation}
        \begin{alignedat}{2}
            \max_{u'}\{m(t)\} &= \infty, \quad &&\argmax_{u'}\{m(t)\} = 0,\\
            \min_{u'}\{m(t)\} &= \frac{U_2}{\hat{u}_1}=M, \quad &&\argmin_{u'}\{m(t)\} = \hat{u}_1.
        \end{alignedat}
    \end{equation}
    One can conclude that the DC/DC converter must be able to deliver a voltage transfer ratio of 
    $$
     m(t)\in[M,\ldots,\infty].
    $$
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Voltage transfer ratio (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Voltage transfer ratio (cont.)} 
    The above voltage transfer ratio range restricts the possible topologies accordingly, e.g.:
    \begin{itemize}
        \item Standard boost converter: $m(t)=\nicefrac{1}{(1-d(t))}$,
        \item Buck-boost converter or SEPIC: $m(t)=\nicefrac{d(t)}{(1-d(t))}$.
    \end{itemize}
    Due to its simplicity and low component count, the \hl{boost converter is the most common choice for PFC} applications leading to the reference duty cycle (assuming CCM operation):
    \begin{equation}
        d(t) = \frac{U_2-\hat{u}_1|\sin(\omega t)|}{U_2} = 1 - \frac{1}{M}|\sin(\omega t)|.
        \label{eq:PFC_duty_cycle_feed_forward}
    \end{equation} 
    \begin{varblock}{Remark on nomenclature and steady state}
        In contrast to the previous DC/DC converter section, the duty cycle $d(t)$ is now a function of time and not a constant (small $d$ instead of capital $D$). However, the voltage transfer to duty cycle ratio was derived in steady state, i.e., \eqref{eq:PFC_duty_cycle_feed_forward} only holds approximately for $f_\mathrm{s}>> f=\nicefrac{\omega}{2\pi}$ (quasi steady state). 
    \end{varblock}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PFC rectifier with boost converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PFC rectifier with boost converter}
    \begin{figure}
           \begin{circuitikz}
            % Input rectifier
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i>^=$i_1(t)$] ++(0.75,0) to [short, -*] ++(0.75,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(1.5,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-1.5,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [short, *-]++(-0.5,0) to [crossing, mirror] ++(-2,0)
            to [short] (A);

            % DC/DC converter
            \draw node[fourport, circuitikz/quadpoles/fourport/width=2.25, circuitikz/quadpoles/fourport/height=2.8] (DCDC) at (7.75,-1) {DC/DC}; 
            \draw (C) to [short] ++(1.5,0) coordinate (G)
            to [short] (DCDC.port4 -| G) 
            to [short,-*] ++(0.5,0) coordinate (voltin)
            to [short, i=$i'(t)$] (DCDC.port4)
            (D) to [short] ++(1.5,0) coordinate (H)
            to [short] (DCDC.port1 -| H) -- ++(0.5,0)
            to [currtap, name=ct1] (DCDC.port1)
            (DCDC.port4 -| G) to [open,v = $u'(t)\hspace{0.5cm}$, voltage = straight] (DCDC.port1 -| G);

            % Inner part
            \draw (DCDC.port4) to [L, l=$L$] ++(1.75,0) coordinate (boostup)
            to [diode, l=$D_5$] (DCDC.port3)
            (boostup) to [Tnpn, n=npn, invert,*-*, l=$\hspace{0.5cm}T$] (DCDC.port2 -| boostup)
            (DCDC.port2) -- (DCDC.port1); 


            % Output filter and load
            \draw (DCDC.port3) to [short, i=$i_2(t)$] ++(0.9,0) coordinate (I)
            to [short] (C -| I)
            to [short] ++(1,0) coordinate (E)
            to [short] ++(0,-1.5)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            to [short] ++(0,-1.5) coordinate (F)
            to [short] (D -| I)
            to [short] (DCDC.port2 -| I) -- (DCDC.port2)
            (E) to [short, *-*] ++(1.25,0) coordinate (currout) -- ++(0.75,0)
            to [short] ++(0,-1.5)
            to [isource, l=$I_0$] ++(0,-2)
            to [short] ++(0,-1.5)
             to [short, -*] (F);

            % Controller
            \draw let \p1 = (DCDC.south) in node[draw, minimum width=1.2cm, minimum height=0.9cm] (ctrl) at (\x1,-4.1) {Controller};
            \coordinate (ctrl1) at ($(ctrl.north west)!.5!(ctrl.west)$);
            \coordinate (ctrl2) at ($(ctrl.south west)!.5!(ctrl.west)$);
            \draw[dashed, ->] (ctrl.north) -- (DCDC.south) -- ++(0,0.5) coordinate (ctrl3)
            to [short] (ctrl3 -| npn.B) -- (npn.B);
            \draw[->, dashed] (ct1.tap) -- (ctrl1 -| ct1.tap) -- (ctrl1) node[right, above, anchor = south east] {$i'(t)$};
            \draw[->, dashed] (voltin) -- (ctrl2 -| voltin) -- (ctrl2) node[right, below, anchor = north east] {$u'(t)$};
            \draw[->, dashed] (currout) -- (ctrl.east -| currout) -- (ctrl.east) node[left, above, anchor = south west] {$u_2(t)$};
        \end{circuitikz}%
        \caption{PFC rectifier realized as a combination of a single-phase diode bridge and a cascaded DC/DC boost converter}%
        \label{fig:PFC_with_boost_converter}%
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PFC rectifier with boost converter (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PFC rectifier with boost converter (cont.)}
    The duty cycle from \eqref{eq:PFC_duty_cycle_feed_forward} does not consider the inner voltage demand of the boost converter, in particular of its filter inductor $L$: 
    \begin{equation}
    \begin{split}
        u_\mathrm{L}(t) &= L \frac{\mathrm{d}}{\mathrm{d}t}i'(t) = L \frac{\mathrm{d}}{\mathrm{d}t} \left(\hat{i}_1 |\sin(\omega t)|\right)\\
                        & = \hat{i}_1\omega L\cos(\omega t) \mathrm{sgn}(\sin(\omega t)).
    \end{split}
    \end{equation}
    Within one switching period of the boost converter the voltage balance must hold:
    \begin{equation}
        \begin{split}
            u'(t) &= u_\mathrm{L}(t)+ U_2(1-d(t))\\
            \Leftrightarrow \quad \hat{u}_1 |\sin(\omega t)| &= \hat{i}_1\omega L \cos(\omega t) \mathrm{sgn}(\sin(\omega t)) + M\hat{u}_1 (1-d(t)).
        \end{split}
        \end{equation}
    Rearranging towards the duty cycle $d(t)$ yields
    \begin{equation}
        d(t) = 1 - \frac{1}{M}|\sin(\omega t)| + \frac{\hat{i}_1\omega L}{M\hat{u}_1} \cos(\omega t) \mathrm{sgn}(\sin(\omega t)).
        \label{eq:PFC_duty_cycle_feed_forward_with_inductor}
    \end{equation}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PFC rectifier with boost converter (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PFC rectifier with boost converter (cont.)}
    Evaluating \eqref{eq:PFC_duty_cycle_feed_forward_with_inductor} for $\omega t = \varepsilon$ with $\varepsilon\in\mathbb{R}>0$ being an infinitesimally small value, one obtains 
    $$
    d(\varepsilon/\omega) = 1 -\sin(\varepsilon) + \frac{\hat{i}_1\omega L}{M\hat{u}_1} \cos(\varepsilon)\mathrm{sgn}(\sin(\varepsilon)) \approx 1 +  \frac{\hat{i}_1\omega L}{M\hat{u}_1} > 1. 
    $$
    Hence, the additional voltage demand of the boost converter inductor $L$ leads to a \hl{duty cycle exceeding unity}, that is, exceeding the feasible range and, therefore, the boost converter is not able to deliver the required voltage transfer ratio $m(t)$:
    \begin{itemize}
        \item The boost converter is not able to exactly track the input current reference $i_1(t)=\hat{i}_1\sin(\omega t)$ (especially at the beginning and end of a half period).
        \item The lower $L$ the less the negative impact of the inductor voltage demand.
        \item Consequently, one wants to keep the inductance $L$ as low as possible which on the other hand requires a \hl{high switching frequency} $f_\mathrm{s}$ to keep the current ripple within acceptable bounds.
    \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Pulse width modulation (PWM) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Pulse width modulation (PWM)}
    As seen on the previous slides, the duty cycle $d(t)$ is a function of time. To generate a switching signal $s(t)$ for the boost converter, a \hl{pulse width modulation (PWM)} scheme is used:
    \begin{equation}
        s(t) = \begin{cases}
            1 \quad (\mbox{transistor $T$ on}), & \text{if } d(t) > c(t),\\
            0 \quad (\mbox{transistor $T$ off}), & \text{otherwise}
        \end{cases}
    \end{equation}
    with a (high frequency) \hl{carrier signal} $c(t)$, e.g., a triangular or sawtooth signal. 
    \begin{figure}
        \begin{circuitikz}
            \def\cwidth{1.5}
            \def\cheight{1}
            \draw[->] (0,0) to node[above]{$d(t)$} ++(2,0) node[adder, anchor = west, name=add1]{};
            \draw node[ctrlblock, anchor = west, minimum width = \cwidth cm, minimum height = \cheight cm](carrier) at (0,-2) {}; 
            \path (carrier.south west) coordinate (blockBottomLeft);
            
            % Triangular signal pattern within block
            \begin{scope}
                % Define the number of signal steps
                \def\signalsteps{6}
                
                % Compute step width and height of the triangular pattern
                \pgfmathsetmacro{\stepwidth}{\cwidth/\signalsteps}
                \pgfmathsetmacro{\signalheight}{\cheight/(1.3)}

                % Start drawing the triangular signal
                \draw[signalblue, thick] 
            ($(blockBottomLeft) + (0.025, 0.1*\cheight)$) % Starting point with a margin
            \foreach \x in {1,...,\signalsteps} {
                -- ($
                    (blockBottomLeft) + 
                    (\x*\stepwidth - 0*\stepwidth, {0.1*\cheight + mod(\x, 2)*\signalheight})
                   $)
            };
            \end{scope}
            \draw[->] (carrier.east) -- (carrier.east -| add1.south) -- node[left]{$c(t)$} (add1.south) node[anchor = north west] {$-$};
            \draw[->] (add1.east) -- ++(1,0) node[ctrlblock, anchor = west, minimum width = \cwidth cm, minimum height = \cheight cm](comp){};
            
            % Comperator block 
            \begin{axis}[at={(comp)}, scale only axis, width = 0.8*\cwidth cm, height = 0.8*\cheight cm, anchor = center, xtick=\empty, ytick={0,1}, axis lines=middle,  enlargelimits=upper, ymax=1.25, font = \footnotesize]
                \addplot[thick, signalblue] coordinates {(-1,0) (0,0) (0,1) (1,1)};
              \end{axis}
            
            % Transistor
            \draw[->, dashed] (comp.east) -- node[above]{$s(t)$} ++(1.5,0)node[npn, anchor = B, solid](npn1) {};
            \draw let \p1 = (npn1.B) in node[anchor=west] at (\x1,\y1) {\hspace{1cm}$T$};
        \end{circuitikz}
        \caption{Pulse width modulation with triangular carrier to actuate a transistor}
        \label{fig:PWM_simple_single_phase}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM-based switching signals %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM-based switching signals} 
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec04}}
            \begin{groupplot}[group style={group size=1 by 2, xticklabels at = edge bottom, vertical sep=0.75cm}, height=0.4\textheight, width=0.875\textwidth, xmin=0, xmax=pi, grid,clip = false, ymin = -0.1, ymax =1.1, xtick = {0, pi/4, pi/2, 3*pi/4,pi}, xticklabels = {0,$\frac{1}{4}\pi$, $\frac{1}{2}\pi$,$\frac{3}{4}\pi$, $\pi$}, ytick = {-1, 0, 1}, yticklabels = {, 0, 1}]

                % Top plot: input voltage and current 
                \nextgroupplot[ylabel = {$d(t)/c(t)$}, legend pos=south east, legend columns=2]
                \addplot[signalred, thick] table[x=wt, y=d, col sep=comma] {PWM_triangular_example.csv}; 
                \addplot[signalblue, thick] table[x=wt, y=c, col sep=comma] {PWM_triangular_example.csv}; 
                \legend{$d(t)$, $c(t)$}


                % middle plot: rectified voltage and current (before DCDC) 
                \nextgroupplot[ylabel = {$s(t)$}, xlabel={$\omega t$}] 
                \addplot[signalblue, thick] table[x=wt, y=s, col sep=comma] {PWM_triangular_example.csv}; 
            \end{groupplot}
        \end{tikzpicture}
        \caption{Qualitative illustration of a PWM-based switching signal with a triangular carrier signal}
        \label{fig:PWM_triangular_example}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM-based switching signals (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM-based switching signals (cont.)} 
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec04}}
            \begin{groupplot}[group style={group size=1 by 2, xticklabels at = edge bottom, vertical sep=0.75cm}, height=0.4\textheight, width=0.875\textwidth, xmin=0, xmax=pi, grid,clip = false, ymin = -0.1, ymax =1.1, xtick = {0, pi/4, pi/2, 3*pi/4,pi}, xticklabels = {0,$\frac{1}{4}\pi$, $\frac{1}{2}\pi$,$\frac{3}{4}\pi$, $\pi$}, ytick = {-1, 0, 1}, yticklabels = {, 0, 1}]

                % Top plot: input voltage and current 
                \nextgroupplot[ylabel = {$d(t)/c(t)$}, legend pos=south east, legend columns=2]
                \addplot[signalred, thick] table[x=wt, y=d, col sep=comma] {PWM_sawtooth_example.csv}; 
                \addplot[signalblue, thick] table[x=wt, y=c, col sep=comma] {PWM_sawtooth_example.csv}; 
                \legend{$d(t)$, $c(t)$}


                % middle plot: rectified voltage and current (before DCDC) 
                \nextgroupplot[ylabel = {$s(t)$}, xlabel={$\omega t$}] 
                \addplot[signalblue, thick] table[x=wt, y=s, col sep=comma] {PWM_sawtooth_example.csv}; 
            \end{groupplot}
        \end{tikzpicture}
        \caption{Qualitative illustration of a PWM-based switching signal with a sawtooth carrier signal}
        \label{fig:PWM_sawtooth_example}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM-based open-loop control of the boost converter-based PFC rectifier %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PWM-based open-loop control of the boost converter-based PFC rectifier} 
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec04}}
            \begin{groupplot}[group style={group size=1 by 3, xticklabels at = edge bottom, vertical sep=0.75cm}, height=0.375\textheight, width=0.875\textwidth, xmin=0, xmax=pi, grid,clip = false, ymin = -0.1, ymax =1.1, xtick = {0, pi/4, pi/2, 3*pi/4,pi}, xticklabels = {0,$\frac{1}{4}\pi$, $\frac{1}{2}\pi$,$\frac{3}{4}\pi$, $\pi$}, ytick = {-1, 0, 1}, yticklabels = {, 0, 1}]

                % Top plot: input voltage and current 
                \nextgroupplot[ylabel = {$d(t)/c(t)$}, legend pos=south east, legend columns=2]
                \addplot[signalred, thick] table[x=wt, y=d, col sep=comma] {PWM_PFC_example.csv}; 
                \addplot[signalblue, thick] table[x=wt, y=c, col sep=comma] {PWM_PFC_example.csv}; 
                \legend{$d(t)$, $c(t)$}


                % middle plot: rectified voltage and current (before DCDC) 
                \nextgroupplot[ylabel = {$s(t)$}] 
                \addplot[signalblue, thick] table[x=wt, y=s, col sep=comma] {PWM_PFC_example.csv}; 

                % middle plot: rectified voltage and current (before DCDC) 
                \nextgroupplot[ylabel = {$i_1(t)$}, xlabel={$\omega t$}, ytick = {-1, 0, 0.5, 1}, yticklabels = {}, legend columns=2] 
                \addplot[signalred, thick] table[x=wt, y=i1, col sep=comma] {PWM_PFC_example.csv}; 
                \addplot[thick, dashed] table[x=wt, y=i1ref, col sep=comma] {PWM_PFC_example.csv};
                \legend{$i_1(t)$, $i_1^{(1)}(t)$} 
            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PFC rectifier with boost converter: control structure %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PFC rectifier with boost converter: closed-loop control structure}
    \begin{figure}
           \begin{circuitikz}[scale = 0.8, transform shape]
            
            % Input rectifier
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i>^=$i_1(t)$] ++(0.75,0) to [short, -*] ++(0.75,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(1.5,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-1.5,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [short, *-]++(-0.5,0) to [crossing, mirror] ++(-2,0)
            to [short] (A);

            % DC/DC converter
            \draw node[fourport, circuitikz/quadpoles/fourport/width=2.25, circuitikz/quadpoles/fourport/height=2.8] (DCDC) at (8.5,-1) {DC/DC}; 
            \draw (C) to [short] ++(1.5,0) coordinate (G)
            to [short] (DCDC.port4 -| G) 
            to [short,-*] ++(0.5,0) coordinate (voltin) to [short, i=$i'(t)$] ++(1.75,0) to [short] (DCDC.port4)
            (D) to [short] ++(1.5,0) coordinate (H)
            to [short] (DCDC.port1 -| H) -- ++(0.5,0)
            to [currtap, name=ct1] (DCDC.port1)
            (DCDC.port4 -| G) to [open,v = $u'(t)\hspace{0.5cm}$, voltage = straight] (DCDC.port1 -| G);

            % Inner part
            \draw (DCDC.port4) to [L, l=$L$] ++(1.75,0) coordinate (boostup)
            to [diode, l=$D_5$] (DCDC.port3)
            (boostup) to [Tnpn, n=npn, invert,*-*, l=$\hspace{0.5cm}T$] (DCDC.port2 -| boostup)
            (DCDC.port2) -- (DCDC.port1); 


            % Output filter and load
            \draw (DCDC.port3) to [short, i=$i_2(t)$] ++(0.9,0) coordinate (I)
            to [short] (C -| I)
            to [short] ++(1,0) coordinate (E)
            to [short] ++(0,-1.5)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            to [short] ++(0,-1.5) coordinate (F)
            to [short] (D -| I)
            to [short] (DCDC.port2 -| I) -- (DCDC.port2)
            (E) to [short, *-*] ++(1.25,0) coordinate (currout) -- ++(0.75,0)
            to [short] ++(0,-1.5)
            to [isource, l=$I_0$] ++(0,-2)
            to [short] ++(0,-1.5)
            to [currtap, name=ct2, -*, mirror] (F);

            % Controller
            \draw[->, dashed] (ct2.tap) -- node[midway, right] {$I_0$} ++(0,-3) node[adder, anchor = north, solid, name=add1]{};
            \draw[->, dashed](currout) -- (DCDC.port3 -|currout) -- ++(3.5,0) coordinate (Z) -- node[left, above, anchor = south west] {$u_2$} (add1.north -| Z) node[adder, anchor = north, solid, name=add2]{} node[left, above, anchor = south east] {$-$};
            \draw[<-, dashed] (add2.east) -- node[midway, above] {$u_2^*$} ++(1,0);
            \draw node[ctrlblock, fill=white, solid](vctrl1) at ($(add1.east)!.5!(add2.west)$) {$u_2$ ctrl}; 
            \draw[->, dashed](add2.west) -- (vctrl1.east) node[midway, above]{$\Delta u_2$};
            \draw[->, dashed] (vctrl1.west) -- node[midway, above] {$i_\mathrm{C}^*$}(add1.east); 
            \draw let \p1 = (DCDC.south) in node[ctrlblock, solid] (pwm) at (\x1,-3.6) {PWM};
            \draw[<-, dashed] (pwm.south) -- node[ctrlblock, name=ictrl1, fill=white, solid, anchor=north]{$i'$ ctrl} ++(0,-1.2) node[midway, right, anchor = south west ]{$d(t)$};
            \draw[dashed, ->] (pwm.north) -- (DCDC.south) -- ++(0,0.5) node[midway, right] {$s(t)$} coordinate (ctrl3)
            to [short] (ctrl3 -| npn.B) -- (npn.B);
            \draw node[adder](add3) at (ictrl1.center -| ct1.tap){};
            \draw node[lowpass2shape](lp) at ($(ct1.tap)!.5!(add3.center)$) {};
            \draw[->, dashed] (ct1.tap) -- (lp.north) node[right, midway]{$i'$};
            \draw[->, dashed](lp.south) -- (add3.north) node[left, above, anchor = south west]{$\overline{i}'$} node[left, above, anchor = south east] {$-$};
            \draw[->, dashed](add3.east) -- (ictrl1.west) node[midway, above]{$\Delta i'$};
            \draw node[mixer, anchor = center](mult3) at (add1.center -| lp.center){};
            \draw[->, dashed] (voltin) -- (mult3.center -| voltin) -- (mult3.w) node[right, above, anchor = south east]{$u'$};
            \draw[->, dashed] (mult3.n) -- (add3.south) node[midway, right, anchor = south west]{$i'*$};
            \draw node[mixer, anchor = center, solid](mult2) at ($(mult3.center)!.33!(add1.center)$) {};
            \draw node[mixer, anchor = center, solid](mult1) at ($(mult3.center)!.66!(add1.center)$) {};
            \draw[->, dashed] (add1.west) -- (mult1.east);
            \draw[->, dashed] (mult1.west) -- (mult2.east) node[above, anchor = south west]{$p_2*$};
            \draw[->, dashed] (mult2.west) -- (mult3.east) node[above, anchor = south west]{$G*$};
            \draw[<-, dashed] (mult1.north) -- ++(0,0.75) node[left, midway]{$u_2*$};
            \draw[<-, dashed] (mult2.north) -- ++(0,0.75) node[left, midway]{$\nicefrac{2}{\hat{u}_1^2}$};
        \end{circuitikz}%
        \caption{Control structure of PFC rectifier with boost DC/DC converter}%
        \label{fig:PFC_with_boost_converter_control_structure}%
    \end{figure}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PFC rectifier with boost converter: control structure (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{PFC rectifier with boost converter: closed-loop control structure (cont.)}
    Reasons for closed-loop control:
    \begin{itemize}
        \item Mismatches between the actual system and the plant model behavior result in (steady-state) control errors.
        \item Faster transient response to load changes.
        \item Robustness against further disturbances (e.g., input voltage variations).
    \end{itemize}
\end{frame}