%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Diode-based rectifiers %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Diode-based rectifiers}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% High-level view of the rectification task %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{High-level view of the rectification task}
    Assuming that the input voltage is an \hl{ideal sinusoidal signal} $$u_1(t) = \hat{u}_1 \sin(\omega t)$$ with the angular frequency $\omega = 2\pi f$ and the amplitude $\hat{u}_1$, the task of a rectifier is to convert this signal into a \hl{unidirectional, ideally constant, signal} $u_2(t)\approx u_2$, as shown in Figure \ref{fig:rectification_task}. A typical application is the grid voltage rectification in power supplies.

    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_1(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}_1$,$0$,$\hat{u}_1$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{sin(deg(x))};
            \end{axis}
        \end{tikzpicture}
        \hspace{0.5cm}
        \begin{circuitikz}[]
            \ctikzset{blocks/scale=2, block lateral anchors pos=0.7}
            \path (0,0) node[sacdcshape](acdc){} ; 
            \draw (acdc.left up) -- ++(-1,0) coordinate (A1) 
            (acdc.left down) to [short] ++(-1,0) coordinate (A2)
            (A1) to [open, v_=$u_1$, voltage = straight, o-o] (A2)
            (acdc.right up) to [short, -o]  ++(1,0) coordinate (B1)
            (acdc.right down) to [short, -o] ++(1,0) coordinate (B2);
            \draw (B1) to [open, v^=$u_2$, voltage = straight] (B2);
        \end{circuitikz}
        \hspace{0.5cm}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_2(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}_2$,$0$,$\hat{u}_2$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{1};
            \end{axis}
        \end{tikzpicture}
        \caption{Simplified representation of a single-phase rectifier}
        \label{fig:rectification_task}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Frequency analysis: Fourier series %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Frequency analysis: Fourier series}
    Often the rectification introduces non-fundamental frequency components, e.g., due to the output voltage rectification or by a load current feedback towards the input side. To analyze the \hl{frequency spectrum} of a periodic signal $u(t)$, the \hl{Fourier series} is used:
    \begin{equation}
        \begin{gathered}
            u(t) = \frac{a_0}{2}+\sum_{n=1}^{\infty} \left( a_k \cos(k\omega t) + b_k \sin(k\omega t) \right), \quad k\in \mathbb{N},\\
            a_k= \frac{1}{\pi} \int_{0}^{2\pi} u(t) \cos(k\omega t) \mathrm{d}\omega t,\,\, k\geq 0, \qquad b_k = \frac{1}{\pi} \int_{0}^{2\pi} u(t) \sin(k\omega t) \mathrm{d}\omega t,\,\, k \geq 1.
        \end{gathered}
    \end{equation}

    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_1(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}_1$,$0$,$\hat{u}_1$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{sin(deg(x))+0.125*sin(deg(3*x))+0.05*sin(deg(6*x))};
            \end{axis}
        \end{tikzpicture}
        \hspace{0.5cm}
        \begin{circuitikz}[]
            \ctikzset{blocks/scale=2, block lateral anchors pos=0.7}
            \path (0,0) node[sacdcshape](acdc){} ; 
            \draw (acdc.left up) -- ++(-1,0) coordinate (A1) 
            (acdc.left down) to [short] ++(-1,0) coordinate (A2)
            (A1) to [open, v_=$u_1$, voltage = straight, o-o] (A2)
            (acdc.right up) to [short, -o]  ++(1,0) coordinate (B1)
            (acdc.right down) to [short, -o] ++(1,0) coordinate (B2);
            \draw (B1) to [open, v^=$u_2$, voltage = straight] (B2);
        \end{circuitikz}
        \hspace{0.5cm}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_2(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}_2$,$0$,$\hat{u}_2$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{1+0.075*sin(deg(3*x))+0.05*sin(deg(7*x))};
            \end{axis}
        \end{tikzpicture}
        \caption{Rectification under distorted conditions}
        \label{fig:rectification_task_distortion}
    \end{figure}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Frequency analysis: Fourier series (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Frequency analysis: Fourier series (cont.)}

    \begin{figure}
        \begin{tikzpicture}
            \begin{axis}[
                width=0.85\textwidth,
                height=0.7\textheight,
                xlabel={$\omega t$},
                ylabel={$u(\omega t)$},
                grid=both,
                domain=0:6*pi,
                samples=1000,
                xtick={0,pi,2*pi,3*pi,4*pi,5*pi,6*pi},
                xticklabels={$0$, $\pi$, $2\pi$, $3\pi$, $4\pi$, $5\pi$, $6\pi$},
                ytick={-1,-0.5,0,0.5,1},
                ymin=-1.5, ymax=1.5,
                axis lines=middle,
                enlargelimits=false,
                clip=false,
                xlabel style={
                    anchor=west,
                },
                ylabel style={
                    anchor=east,
                },
                xticklabel style={
                    anchor=north east,
                    yshift=0.1cm,
                },
            ]
            
                       
            % First component
            \addplot[signalred, thick, domain=0:6*pi] {4/pi * sin(deg(x))};
            \node[anchor=south, signalred] at (axis cs:3.14/2,4/3.14) {$k \leq 1$};
            
            % First 5 components
            \addplot[signalblue, thick, domain=0:6*pi] {4/pi * (sin(deg(x)) + 1/3*sin(deg(3*x)) + 1/5*sin(deg(5*x)))};
            \node[anchor=west, signalblue, fill=white, inner sep = 2pt] at (axis cs:3.14,0.5) {$k \leq 5$};
            
            % First 7 components
            \addplot[signalgreen, thick, domain=0:6*pi] {4/pi * (sin(deg(x)) + 1/3*sin(deg(3*x)) + 1/5*sin(deg(5*x)) + 1/7*sin(deg(7*x)) + 1/9*sin(deg(9*x)))};
            \node[anchor=east, signalgreen, fill=white, inner sep = 2pt] at (axis cs:3.14,-0.5) {$k \leq 7$};
            
            % First 13 components
            \addplot[signalbrown, thick, domain=0:6*pi] {4/pi * (sin(deg(x)) + 1/3*sin(deg(3*x)) + 1/5*sin(deg(5*x)) + 1/7*sin(deg(7*x)) + 1/9*sin(deg(9*x)) + 1/11*sin(deg(11*x)) + 1/13*sin(deg(13*x)))};
            \node[anchor=west, signalbrown, fill=white, inner sep = 2pt] at (axis cs:2*3.14,-0.5) {$k \leq 13$};

            % Square wave signal 
            \addplot[black, thick, domain=0:6*pi, dashed] {sign(sin(deg(x)))};
            
            \end{axis}
            \end{tikzpicture}
        
        \caption{Fourier series example: representation of a square wave signal}
        \label{fig:Fourier_series_square_wave}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Half-cycle rectification / M1U circuit %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Half-cycle rectification / M1U circuit} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M1U uncontrolled rectifier circuit %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M1U uncontrolled rectifier circuit}
    Based on \figref{fig:M1U_topology}, the output voltage $u_2(t)$ of the M1U rectifier is
    \begin{equation}
        u_2(t) = \begin{cases}
            u_1(t)=\hat{u}_1 \sin(\omega t), & 0\leq \omega t < \pi, \\
            0, & \pi \leq \omega t < 2\pi.
        \end{cases}
        \label{eq:u2_M1U}
    \end{equation}

    \begin{figure}
        \begin{tikzpicture} % left plot
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_1(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}$,$0$,$\hat{u}$},
                grid=both,
                ]
                \addplot[domain=0:2*pi, samples=100, signalblue, thick]{sin(deg(x))};
            \end{axis}
        \end{tikzpicture}
        \hspace{0.5cm}
        \begin{circuitikz}[] % circuit (center plot)
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short] ++(0.75,0)
            to [diode, l=$D$]  ++(1.5,0)
            to [short, i=$i_2(t)$] ++(0.75,0)
            to [R, v^= $u_2(t)$, voltage = straight, l_=$R$] ++(0,-2) coordinate (B)
            (A) -- (B);
        \end{circuitikz}
        \hspace{0.5cm}
        \begin{tikzpicture} % right plot
            \begin{axis}[
                width=0.28\textwidth,
                height=0.425\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                ylabel={$u_2(\omega t)$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{u}$,$0$,$\hat{u}$},
                grid=both,
                ]
                \addplot[domain=0:pi, samples=100, signalblue, thick]{sin(deg(x))};
                \addplot[domain=pi:2*pi, samples=10, signalblue, thick]{0};
            \end{axis}
        \end{tikzpicture}
        \caption{M1U topology (aka \hl{single pulse rectifier}) with typical input and output voltage signals (assuming a resistive load)}
        \label{fig:M1U_topology}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M1U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M1U uncontrolled rectifier circuit (cont.)}
    From \eqref{eq:u2_M1U}, the average output voltage of the M1U rectifier is
    \begin{equation}
        \begin{split}
            \overline{u}_2 &= \frac{1}{T} \int_{0}^{T} u_2(t) \mathrm{d}t = \frac{1}{2\pi} \int_{0}^{2\pi} \hat{u}_1 \sin(\omega t) \mathrm{d}\omega t = \frac{1}{2\pi} \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \mathrm{d}\omega t\\
            &= \frac{\hat{u}_1}{2\pi} \left[ - \cos(\omega t) \right]_{0}^{\pi} = \frac{\hat{u}_1}{2\pi} \left( 1+1 \right) = \frac{\hat{u}_1}{\pi} = \frac{\sqrt{2}U_1}{\pi}
        \end{split}
        \label{eq:u2_M1U_avg}
    \end{equation}
    with $U_1$ being the RMS value of the input voltage $u_1(t)$. The RMS value of the output voltage $u_2(t)$ results in
    \begin{equation}
        \begin{split}
        U_2 &= \sqrt{\frac{1}{2\pi} \int_{0}^{\pi} \hat{u}_1^2 \sin^2(\omega t) \mathrm{d}\omega t} = \hat{u}_1 \sqrt{\frac{1}{2\pi}\left[\frac{1}{2}\omega t - \frac{\sin(2 \omega t)}{4}\right]_0^\pi}\\&= \frac{\hat{u}_1}{2} = \frac{U_1}{\sqrt{2}}.
        \end{split}
        \label{eq:u2_M1U_rms}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M1U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M1U uncontrolled rectifier circuit (cont.)}
    The Fourier coefficients of the output voltage $u_2(t)$ from \eqref{eq:u2_M1U} are
    \begin{equation}
        \begin{split}
            a_0 &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \mathrm{d} \omega t = 2 \overline{u}_2= 2 \frac{\hat{u}_1}{\pi},\\
            a_k &= \frac{1}{2\pi} \int_{0}^{2\pi} u_2(t) \cos(k\omega t) \mathrm{d}\omega t = \frac{1}{2\pi} \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \cos(k\omega t) \mathrm{d}\omega t\\  &= \frac{\hat{u}_1}{4\pi} \int_{0}^{\pi}  \sin(\omega t(1-k)) + \sin(\omega t(1+k)) \mathrm{d}\omega t = \ldots =  \frac{\hat{u}_1}{\pi}\frac{1}{1-k^2}, \quad k=2,4,6,\ldots\\
            b_k &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \sin(k\omega t) \mathrm{d}\omega t = \frac{1}{2\pi} \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \sin(k\omega t) \mathrm{d}\omega t \\ &=\frac{\hat{u}_1}{4\pi} \int_{0}^{\pi}  \cos(\omega t(1-k)) - \cos(\omega t(k+1)) \mathrm{d}\omega t = \ldots = 0.
        \end{split}
        \label{eq:u2_M1U_Fourier}
    \end{equation}
    Above, $a_0$ represents a \hl{DC component}, while the $a_k \neq 0$ coefficients indicate even-numbered \hl{harmonics}.
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M1U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M1U uncontrolled rectifier circuit (cont.)}
    From \eqref{eq:u2_M1U_Fourier} the Fourier series of $u_2(t)$ results in
    \begin{equation}
        u_2(t) = \frac{\hat{u}_1}{\pi}\left(1 + \sum_{k=2,4,6,\ldots} \frac{1}{1-k^2} \cos(k\omega t)\right).
    \end{equation}
    For a resistive load, the output current has the same harmonic spectrum:
    \begin{equation}
        i_2(t) = \frac{\hat{u}_1}{\pi R}\left(1 + \sum_{k=2,4,6,\ldots} \frac{1}{1-k^2} \cos(k\omega t)\right) = \overline{i}_2 + \sum_{k=2,4,6,\ldots} \hat{i}_{2,k} \cos(k\omega t).
    \end{equation}
    Resulting observations are:
    \begin{itemize}
        \item Non-fundamental current frequency components can distort the input side.
        \item Higher frequency harmonics decrease with $\sim 1/(1-k^2)$.
    \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Transformer input filtering  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Transformer input filtering}
    To reduce the input side distortion, a transformer can be used to filter out the harmonics:
    \begin{itemize}
        \item Impedance of magnetizing inductance $L_\mathrm{m}$ is zero for DC components, i.e., the transformer blocks the DC current path (cf. dotted red line for $\overline{i}_2$ below).
        \item With higher frequency harmonics, the impedance of $L_\mathrm{m}$ increases, i.e., filtering out the harmonics less effectively.
    \end{itemize}
    \begin{figure}
           \begin{circuitikz}[]
            \draw (0,0) node[transformer core](T){$N_1:N_2$}
            (T.inner dot A1) node[circ]{}
            (T.inner dot B1) node[circ]{}
            (T.A1) to [short, -*, i<_=$i'_1(t)$] ++(-1,0) coordinate (A1)
            (T.A2) to [short, -*] ++(-1,0) coordinate (A2)
            (A1) to [inductor, l=$L_\mathrm{m}$, i=$i_\mathrm{m}(t)$] (A2)
            (A1) to [short, -o, i<_=$i_1(t)$] ++(-1.5,0) coordinate (A11)
            (A2) to [short, -o] ++(-1.5,0) coordinate (A22)
            (T.B1) to [short, i=$i_\mathrm{s}(t)$] ++(1,0) coordinate (B1)
            (T.B2) to [short] ++(1,0) coordinate (B2);
            \draw (A11) to [open, v=$u_1(t)\hspace{0.5cm}$, voltage = straight] (A22)
            (B1) to [open, v = $u_\mathrm{s}(t)\hspace{0.5cm}$, voltage = straight] (B2); 
            \draw (B1) to [open] (B2 -| B1) coordinate (A)
            (B1) to [short] ++(0.25,0)
            to [diode, l=$D$]  ++(1.5,0)
            to [short, i=$i_2(t)$] ++(1.0,0) coordinate (C)
            to [R, v^= $u_2(t)$, voltage = straight, l_=$R$] (A -| C) coordinate (B)
            (A) -- (B);
            \draw[signalred, dashed, thick] (A1) -- (A2) -- (B) -- (C) -- (A1);
            \node[signalred, above] at ($(B2)!0.5!(B)$) {$\overline{i}_2$};
        \end{circuitikz}
        \caption{M1U topology with input transformer and DC current path (red dotted line)}
        \label{fig:M1U_transformer_topology_DC-current}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Transformer input filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Transformer input filtering (cont.)}
    While the transformer can help out filter unwanted harmonics, the output DC current also introduces an offset magnetization to the transformer core. Issues related with this are:
    \begin{itemize}
        \item \textbf{Core utilization:} To prevent core saturation, the transformer must be oversized.
        \item \textbf{Core losses:} The magnetization offset can increase the core losses.
    \end{itemize}
    \begin{figure}
            \centering
            \begin{tikzpicture}
                \tikzmath{
                    real \a, \b, \c, \d, \hn, \hc, \hm, \bc, \off;
                    \a = 6.0;
                    \b = 1.7;
                    \c = 1.5;
                    \d = 3.0;
                    \hn = 1.5; % nominal, utilized H field value
                    \hm = 7.0; % maximal H field value
                    \hc = -\hn + 2*\c/\b; % hyteresis return H value for nominal H field
                    \off = 0.4; % offset for the hysteresis curve
                    \bcp = \a/(1 + exp(-\b*\hc+\c-\b*\off))-\d; % hyteresis return B value for nominal H field
                    \bcn = \a/(1 + exp(-\b*\hc+\c+\b*\off))-\d; % hyteresis return B value for nominal H field
                }
                \begin{axis}[very thick,
                             samples = 100,
                             xlabel = $H$,
                             ylabel = $B$,
                             xmin = -\hm,
                             xmax = \hm,
                             ymin = -4,
                             ymax = 4,
                             axis x line = middle,
                             axis y line = middle,
                             ticks = none,
                             height=0.7\textheight]
                    \addplot[shadecolor, dashed, domain = -\hm:\hm] {\a/(1 + exp(-\b*x+\c))-\d};
                    \addplot[shadecolor, dashed ,domain = -\hm:\hm] {\a/(1 + exp(-\b*x-\c))-\d};
                    \addplot[signalred, name path=A, domain=\hc+\off:\hn+\off, samples = 100] {\a/(1 + exp(-\b*x+\c))-\d};
                    \addplot[signalred, name path=B, domain=-\hn+\off:-\hc+\off, samples = 100] {\a/(1 + exp(-\b*x-\c))-\d};
                    \addplot[shadecolor, opacity=0.3] fill between[of=A and B];
                    \addplot[signalred] coordinates {(-\hc+\off, -\bcn) (\hn+\off, -\bcn)};
                    \addplot[signalred] coordinates {(-\hn+\off, \bcp) (\hc+\off, \bcp)};
                    % indicate DC shift via an arrow from the origin to the middle of the shaded hysteresis curve
                    \draw[-{Latex[length=2mm]}, signalred, thick] (axis cs:0,0) -- (axis cs:\off,\bcp/2 - \bcn/2);
                    %indicate small red dots at the beginning and end of the arrow
                    \node[signalred, circle, fill, inner sep=1pt] at (axis cs:0,0) {};
                    \node[signalred, circle, fill, inner sep=1pt] at (axis cs:\off,\bcp/2 - \bcn/2) {};
                    %indicate the sift via labeling the arrow in a pin like fashion with the label being left from the arrow
                    \node[signalred, pin={[pin edge={signalred, thin, inner sep = 2mm, anchor = east}]above left:$\sim \overline{i}_2$}] at (axis cs:\off/2,\bcp/4 - \bcn/4) {};
                \end{axis}
            \end{tikzpicture}
            \caption{Shift of the hysteresis curve due to the DC magnetization}
        \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Capacitive output filtering %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Capacitive output filtering}
    To smooth the output voltage $u_2(t)$, a capacitor $C$ is added. The initial charging voltage is
    \begin{equation}
        u_2(t) = \begin{cases}
            u_1(t)=\hat{u}_1 \sin(\omega t) , & 0\leq \omega t < \nicefrac{\pi}{2}, \\
            \hat{u}_1, & \omega t > \nicefrac{\pi}{2}
        \end{cases}
    \end{equation}
    with the capacitor current $i_2(t)$ being
    \begin{equation}
        i_2(t) = \begin{cases}
            C\nicefrac{\mathrm{d}u_2(t)}{\mathrm{d}t} = \hat{i}_2 \cos(\omega t)= C \omega  \hat{u}_1 \cos(\omega t) , & 0\leq \omega t < \nicefrac{\pi}{2}, \\
            0, & \omega t > \nicefrac{\pi}{2}.
        \end{cases}
    \end{equation}
    \begin{figure}
        \begin{circuitikz}[baseline=(current bounding box.center)] 
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short] ++(0.75,0)
            to [diode, l=$D$]  ++(1.5,0)
            to [short, i=$i_2(t)$] ++(0.75,0)
            to [C, v^= $u_2(t)$, voltage = straight, l_=$C$] ++(0,-2) coordinate (B)
            (A) -- (B);
        \end{circuitikz}
        \hspace{1cm}
        \begin{tikzpicture}[baseline=(current bounding box.center)]
            \begin{axis}[
                width=0.4\textwidth,
                height=0.45\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=-0.25*pi, xmax=2*pi+0.25*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]
                \addplot[domain=-0.25*pi:0, samples=10, signalbrown, thick]{0};
                \addplot[domain=0:pi/2, samples=100, signalbrown, thick]{sin(deg(x))};
                \addplot[domain=pi/2:2*pi+0.25, samples=10, signalbrown, thick]{1};
                \addplot[domain=-0.25*pi:0, samples=10, signalred, thick]{0};
                \addplot[domain=0:pi/2, samples=100, signalred, thick]{cos(deg(x))};
                \addplot[domain=pi/2:2*+pi+0.25*pi, samples=10, signalred, thick]{0};
                \draw[signalred, thick] (axis cs:0,0) -- (axis cs:0,1);
                \addplot[domain=-0.25*pi:2*pi+0.25*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};
    
                \node[signalblue, above, yshift = 1mm] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalbrown, below] at (axis cs:3.14*3/2,1.0) {$u_2(t)$};
                \node[signalred, below] at (axis cs:3.14/2,0) {$i_2(t)$};
            \end{axis}
        \end{tikzpicture}
        \caption{M1U topology with output capacitor (unloaded and idealized charging curve)}
        \label{fig:M1U_topology_capacitor}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Capacitive output filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{Capacitive output filtering (cont.)}
    If the rectified output is loaded, the capacitor voltage ripples:
    \begin{itemize}
        \item If $u_2(t) \leq u_1(t)$: diode conducts, capacitor charges (follows input voltage).
        \item If $u_2(t) > u_1(t)$: diode blocks, capacitor discharges via $I_0$. 
    \end{itemize}

    \begin{figure}
        \begin{circuitikz}[baseline=(current bounding box.center)] 
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i=$i_1(t)$] ++(0.75,0)
            to [diode, l=$D$]  ++(1.5,0)
            to [short, i=${i_2(t)}$] ++(0.75,0) coordinate (C)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, *-*, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            (C) to [short] ++(1.5,0)
            to [isource, l=$I_0$] ++(0,-2) coordinate (B)    
            (A) -- (B);
        \end{circuitikz}
        \hspace{0.5cm}
        \begin{tikzpicture}[baseline=(current bounding box.center)]
            \tikzmath{
                    real \i0, \deltaT, \a;
                    \i0 = 0.4;
                    \deltaT = 0.15;
                    \a = -(sin(\deltaT*180) - cos(asin(\i0)))/(3/2*pi-asin(\i0)*pi/180+\deltaT*pi);
                }
            \begin{axis}[
                width=0.55\textwidth,
                height=0.6\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=3*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14/2,3.14, 3.14*3/2,6.28, 2.5*3.14},
                xticklabels={$0$, ,$\pi$, , $2\pi$, },
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]
                
                %input current
                \addplot[domain=0:pi/2+asin(\i0)*pi/180, samples=100, signalred, thick]{cos(deg(x))+\i0};
                \addplot[domain=pi/2+asin(\i0)*pi/180:2*pi+\deltaT*pi, samples=10, signalred, thick]{0};
                \addplot[domain=2*pi+\deltaT*pi:2.5*pi+asin(\i0)*pi/180, samples=100, signalred, thick]{cos(deg(x))+\i0};
                \draw[signalred, thick] (axis cs:2*pi+\deltaT*pi,0) -- (axis cs:2*pi+\deltaT*pi,{\i0 + cos(\deltaT*180)});
                \addplot[domain=2.5*pi+asin(\i0)*pi/180:3*pi, samples=10, signalred, thick]{0};

                %Capacitor current
                \addplot[domain=0:pi/2+asin(\i0)*pi/180, samples=100, signalred, thick, dotted]{cos(deg(x))};
                \addplot[domain=pi/2+asin(\i0)*pi/180:2*pi+\deltaT*pi, samples=10, signalred, thick, dotted]{-\i0};
                \addplot[domain=2*pi+\deltaT*pi:2.5*pi+asin(\i0)*pi/180, samples=100, signalred, thick, dotted]{cos(deg(x))};
                \draw[signalred, thick, dotted] (axis cs:2*pi+\deltaT*pi,-\i0) -- (axis cs:2*pi+\deltaT*pi,{cos(\deltaT*180)});
                \addplot[domain=2.5*pi+asin(\i0)*pi/180:3*pi, samples=10, signalred, thick, dotted]{-\i0};

                %Capacitor voltage
                \addplot[domain=0:pi/2+asin(\i0)*pi/180, samples=100, signalbrown, thick]{sin(deg(x))};
                \addplot[domain=pi/2+asin(\i0)*pi/180:2*pi+\deltaT*pi, samples=10, signalbrown, thick]{cos(asin(\i0))-\a*(x-pi/2-asin(\i0)*pi/180)};
                \addplot[domain=2*pi+\deltaT*pi:2.5*pi+asin(\i0)*pi/180, samples=10, signalbrown, thick]{sin(deg(x))};
                \addplot[domain=pi/2+asin(\i0)*pi/180+2*pi:2*pi+\deltaT*pi+2*pi, samples=10, signalbrown, thick]{cos(asin(\i0))-\a*(x-pi/2-asin(\i0)*pi/180-2*pi)};

                %input voltage
                \addplot[domain=0*pi:3*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};


                %Blocking time of diode indication
                \draw[dashed] (axis cs:{pi/2+asin(\i0)*pi/180},-\i0) -- (axis cs:{pi/2+asin(\i0)*pi/180},1.5);
                \draw[<->] (axis cs:{pi/2+asin(\i0)*pi/180},1.2) -- (axis cs:{2*pi+\deltaT*pi},1.2);
                \node[fill=white, inner sep=2pt] at (axis cs:{pi/4+asin(\i0)*pi/180/2 + pi+\deltaT*pi/2},1.2) {${u_2 \geq u_1}$};

                %signal labels
                \node[signalblue, left, fill=white, inner sep=2pt, xshift=-5mm] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalbrown, below, xshift=-3mm] at (axis cs:3.0*3/2,0.65) {$u_2(t)$};
                \node[signalred, left] at (axis cs:3.14/2,-\i0) {${i_\mathrm{C}(t)}$};
                \node[signalred, right, xshift=3mm, fill=white, inner sep=2pt] at (axis cs:{(2+\deltaT)*pi},1.25) {${i_1(t)}$};
            \end{axis}
        \end{tikzpicture}
        \caption{M1U topology with output capacitor and constant load current}
        \label{fig:M1U_topology_capacitor_loaded}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Full-cycle rectification / M2U circuit %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Full-cycle rectification / M2U circuit} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M2U uncontrolled rectifier circuit  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M2U uncontrolled rectifier circuit}
    The previous M1U topology only rectified half of a cycle resulting in a reduced output voltage utilization and increased voltage ripple. By adding another diode and utilizing a center-tapped transformer, the circuit can be extended towards a \hl{full-cycle rectifier}.
    \begin{figure}
           \begin{circuitikz}[baseline=(current bounding box.center)]
            \draw (0,0) node[transformer core](T){$N_1:N_2$}
            (T.inner dot A1) node[circ]{}
            (T.inner dot B1) node[circ]{}
            (T.A1) to [short] ++(0,1) to [short, -o, i<_=$i_1(t)$] ++(-1,0) coordinate (A1)
            (T.A2) to [short] ++(0,-1) to [short, -o] ++(-1,0) coordinate (A2)
            (T.B1) to [short] ++(0, 1) coordinate (B1)
            (T.B2) to [short] ++(0,-1) coordinate (B2);
            \draw (A1) to [open, v=$u_1(t)\hspace{0.5cm}$, voltage = straight] (A2); 
            \draw (B1) to [diode, l=$D_1$] ++(2.5,0) coordinate (C1)
            (B2) to [diode, l=$D_2$] ++(2.5,0)
            to [crossing, -*, mirror] (C1)
            to [short, i=$i_2(t)$] ++(1.25,0) coordinate (D)
            to [R, v^= $u_2(t)$, voltage = straight, l_=$R$] (T-L2.midtap -| D)
            to [short] (T-L2.midtap);
            \draw let \p1 = (B1), \p2 = (T-L2.midtap) in (\x1 + 0.5cm, \y1) to [open, v^=$\hspace{0.5cm}{u_\mathrm{s,1}(t)}$, voltage = straight] (\x1 + 0.5cm, \y2);
            \draw let \p1 = (B2), \p2 = (T-L2.midtap) in (\x1 + 0.5cm, \y1) to [open, v=$\hspace{0.5cm}{u_\mathrm{s,2}(t)}$, voltage = straight] (\x1 + 0.5cm, \y2);
        \end{circuitikz}%
        \begin{tikzpicture}[baseline=(current bounding box.center)]
            \begin{axis}[
                width=0.375\textwidth,
                height=0.65\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2.5*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,-2/5, 0,2/5, 1},
                yticklabels={$-\hat{u}_1$,$-\frac{\hat{u}_1}{2}\frac{N_2}{N_1}$, $0$,$\frac{\hat{u}_1}{2}\frac{N_2}{N_1}$, $\hat{u}_1$},
                grid=both,
                ]
                \addplot[domain=0:2.5*pi, samples=100, signalbrown, thick]{2/5*abs(sin(deg(x)))};
                \addplot[domain=0:2.5*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};
                \node[signalblue, above, yshift = 2mm] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalbrown, above] at (axis cs:3.14*3/2,2/5) {$u_2(t)$};
            \end{axis}
        \end{tikzpicture}
        \caption{M2U topology (aka \hl{two pulse mid-point rectifier}) with center-tapped transformer}
        \label{fig:M2U_topology}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M2U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M2U uncontrolled rectifier circuit (cont.)}
    From \figref{fig:M2U_topology} we can conclude the following:
    \begin{itemize}
        \item During the positive half-cycle of $u_1(t)$: $D_1$ conducts, $D_2$ blocks, and $u_2(t) = u_\mathrm{s,1}(t)$.
        \item During the negative half-cycle of $u_1(t)$: $D_2$ conducts, $D_1$ blocks, and $u_2(t) = u_\mathrm{s,2}(t)$.
    \end{itemize}
    The output voltages of the center-tapped transformer are
    \begin{equation}
        u_\mathrm{s,1}(t) = \frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \sin(\omega t) \quad \text{and} \quad u_\mathrm{s,2}(t) = -\frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \sin(\omega t).
    \end{equation}
    Here, it should be noted that both $u_\mathrm{s,1}(t)$ and $u_\mathrm{s,2}(t)$ are utilizing only half of the secondary winding turns due to the central tapping. The output voltage results in
    \begin{equation}
        u_2(t) = \frac{1}{2}\frac{N_2}{N_1}\left|u_1(t)\right| = \frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \left|\sin(\omega t)\right|.
        \label{eq:u2_M2U}
    \end{equation} 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M2U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M2U uncontrolled rectifier circuit (cont.)}
    From \eqref{eq:u2_M2U}, the average output voltage of the M2U rectifier is
    \begin{equation}
        \begin{split}
            \overline{u}_2 &= \frac{1}{T} \int_{0}^{T} u_2(t) \mathrm{d}t = \frac{1}{2\pi} \int_{0}^{2\pi} \frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \left|\sin(\omega t)\right| \mathrm{d}\omega t =\frac{1}{\pi} \int_{0}^{\pi} \frac{1}{2}\frac{N_2}{N_1}\hat{u}_1 \sin(\omega t) \mathrm{d}\omega t =\\
            &= \frac{1}{2\pi}\frac{N_2}{N_1}\hat{u}_1 \left[ - \cos(\omega t) \right]_{0}^{\pi} = \frac{1}{2\pi}\frac{N_2}{N_1}\hat{u}_1 \left( 1+1 \right) = \frac{1}{\pi}\frac{N_2}{N_1}\hat{u}_1.
        \end{split}
        \label{eq:u2_M2U_avg}
    \end{equation}
    Not considering the transformer conversion via $\nicefrac{N_2}{N_1}$, this is twice as much as in the M1U case, compare \eqref{eq:u2_M1U_avg}. The RMS value of the output voltage $u_2(t)$ results in
    \begin{equation}
        \begin{split}
        U_2 &= \sqrt{\frac{1}{2\pi} \frac{1}{2^2}\frac{N_2^2}{N_1^2} \hat{u}_1^2 \int_{0}^{2 \pi}  \sin^2(\omega t) \mathrm{d}\omega t} = \frac{1}{2}\frac{N_2}{N_1} \hat{u}_1 \sqrt{\frac{1}{\pi}  \int_{0}^{\pi}  \sin^2(\omega t) \mathrm{d}\omega t} \\&= \frac{1}{2}\frac{N_2}{N_1} \hat{u}_1 \sqrt{\frac{1}{2\pi}\left[\frac{1}{2}\omega t - \frac{\sin(2 \omega t)}{4}\right]_0^\pi}= \frac{N_2}{N_1} \hat{u}_1\frac{\hat{u}_1}{\sqrt{2}} = \frac{N_2}{N_1} U_1.
        \end{split}
        \label{eq:u2_M2U_rms}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% M2U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{M2U uncontrolled rectifier circuit (cont.)}
    The Fourier coefficients of the output voltage $u_2(t)$ from \eqref{eq:u2_M2U} are
    \begin{equation}
        \begin{split}
            a_0 &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \mathrm{d} \omega t = 2 \overline{u}_2= \frac{2}{\pi}\frac{N_2}{N_1}\hat{u}_1,\\
            a_k &= \frac{1}{2\pi} \int_{0}^{2\pi} u_2(t) \cos(k\omega t) \mathrm{d}\omega t = \frac{1}{4\pi}\frac{N_2}{N_1}\left( \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \cos(k\omega t) \mathrm{d}\omega t \right.\\ & \left.+ \int_{\pi}^{2\pi} (-1)\hat{u}_1 \sin(\omega t) \cos(k\omega t) \mathrm{d}\omega t\right) = \ldots =  \frac{N_2}{N_1}\frac{\hat{u}_1}{\pi}\frac{2}{1-k^2}, \quad k=2,4,6,\ldots\\
            b_k &= \frac{1}{\pi} \int_{0}^{2\pi} u_2(t) \sin(k\omega t) \mathrm{d}\omega t = \frac{1}{4\pi}\frac{N_2}{N_1}\left( \int_{0}^{\pi} \hat{u}_1 \sin(\omega t) \sin(k\omega t) \mathrm{d}\omega t \right.\\ & \left.+ \int_{\pi}^{2\pi} (-1)\hat{u}_1 \sin(\omega t) \sin(k\omega t) \mathrm{d}\omega t\right) = \ldots = 0.
        \end{split}
        \label{eq:u2_M2U_Fourier}
    \end{equation}
    These coefficients are structurally identical to the M1U case, but scaled due to the center-tapped transformer conversion ratios and full-cycle rectification.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Full-cycle rectification / B2U circuit %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Full-cycle rectification / B2U circuit} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit}
    The B2U circuit also allows full-cycle rectification but without the need for a center-tapped transformer, that is, fully utilizes the input voltage without halving it on the output side.
    \begin{figure}
           \begin{circuitikz}[baseline=(current bounding box.center)]
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i=$i_1(t)$, -*] ++(2,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(2,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-2,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [crossing, *-, mirror] ++(-4,0)
            to [short] (A)
            (C) to [short, i=$i_2(t)$] ++(2,0)
            to [short] ++(0,-1.5)
            to [R, v= $u_2(t)$, voltage = straight, l=$R$] ++(0,-2)
            to [short] ++(0,-1.5)
            to [short] (D);
        \end{circuitikz}%
        \hspace{0.5cm}
        \begin{tikzpicture}[baseline=(current bounding box.center)]
            \begin{axis}[
                width=0.375\textwidth,
                height=0.65\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2.5*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14,6.28},
                xticklabels={$0$,$\pi$,$2\pi$},
                ytick={-1,0, 1},
                yticklabels={$-\hat{u}_1$,$0$,$\hat{u}_1$},
                grid=both,
                ]
                \addplot[domain=0:2.5*pi, samples=100, signalbrown, thick]{abs(sin(deg(x)))};
                \addplot[domain=0:2.5*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};
                \node[signalblue, above, yshift = 3mm] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalbrown, above, yshift = -2mm] at (axis cs:3.14*3/2,2/5) {$u_2(t)$};
            \end{axis}
        \end{tikzpicture}
        \caption{B2U topology (aka \hl{two pulse bridge rectifier}) with resistive load}
        \label{fig:B2U_topology}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit (cont.)}
    For a purely resistive load as in \figref{fig:B2U_topology} the output voltage $u_2(t)$ is
    \begin{equation}
        u_2(t) = \left|u_1(t)\right| = \hat{u}_1 \left|\sin(\omega t)\right|.
        \label{eq:u2_B2U_resistive}
    \end{equation}
    Here, following diodes are conducting:
    \begin{itemize}
        \item Positive half-cycle: $D_1$ and $D_2$,
        \item Negative half-cycle: $D_3$ and $D_4$.
    \end{itemize}
    The average output voltage $\overline{u}_2$ is
    \begin{equation}
        \begin{split}
            \overline{u}_2 &= \frac{1}{T} \int_{0}^{T} u_2(t) \mathrm{d}t = \frac{1}{2\pi} \int_{0}^{2\pi} \hat{u}_1 \left|\sin(\omega t)\right| \mathrm{d}\omega t = \ldots = \frac{2}{\pi}\hat{u}_1.
        \end{split}
        \label{eq:u2_B2U_resistive_avg}
    \end{equation}
    The Fourier coefficients of the output voltage $u_2(t)$ are analogous to the M2U case, compare \eqref{eq:u2_M2U_Fourier} with appropriate scaling considering the lack of the center-tapped transformer.
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit with capacitive output filtering %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit with capacitive output filtering}
    \begin{figure}
           \begin{circuitikz}
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [short, i=$i_1(t)$, -*] ++(2,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(2,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-2,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [crossing, *-, mirror] ++(-4,0)
            to [short] (A)
            (C) to [short, i=$i_2(t)$] ++(2,0) coordinate (E)
            to [short] ++(0,-1.5)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            to [short] ++(0,-1.5) coordinate (F)
            to [short] (D)
            (E) to [short, *-] ++(2,0)
            to [short] ++(0,-1.5)
            to [isource, l=$I_0$] ++(0,-2)
            to [short] ++(0,-1.5)
            to [short, -*] (F);
        \end{circuitikz}%
        \caption{B2U topology with output capacitor and constant load}
        \label{fig:B2U_topology_capacitive_filter}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit with capacitive output filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit with capacitive output filtering (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                    real \i0, \a, \b, \c;
                    \i0 = 0.4; % normalized load current
                    \a = acos(-\i0)*pi/180; %Phase angle alpha until cap current hits -i0 and diodes block
                    \b = 0.3*pi; % Phase angle beta indicating the time until the cap voltage is hit by the input voltage and diodes start conducting again
                    \c = (sin(deg(\a)) + sin(deg(pi+\b)))/(\i0*(pi + \b - \a)); % slope of the capacitor voltage during the discharge phase
                }
            \begin{axis}[
                width=0.79\textwidth,
                height=0.85\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=3*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0,3.14/2, \a, 3.14, pi+\b, 3.14*3/2,6.28, 2.5*3.14},
                xticklabels={$0$, ,$\omega t_1$ ,$\pi$, $\omega t_2$, , $2\pi$, },
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]

                % %input voltage
                \addplot[domain=0*pi:3*pi, samples=100, signalblue, thick, dashed]{sin(deg(x))};
                \addplot[domain=0*pi:3*pi, samples=100, signalblue, thick, dash dot]{abs(sin(deg(x)))}; %rectified input voltage
                
                % capacitor current
                \addplot[domain=0:\a, samples=100, signalred, dotted, thick]{cos(deg(x))};
                \addplot[domain=\a:pi+\b, samples=100, signalred, dotted, thick]{-\i0};
                \draw[signalred, thick, dotted] (axis cs:pi+\b,-\i0) -- (axis cs:pi+\b,{-cos(deg(pi+\b))});
                \addplot[domain=pi+\b:pi+\a, samples=100, signalred, dotted, thick]{-cos(deg(x))};
                \addplot[domain=pi+\a:2*pi+\b, samples=100, signalred, dotted, thick]{-\i0};
                \draw[signalred, thick, dotted] (axis cs:2*pi+\b,-\i0) -- (axis cs:2*pi+\b,{-cos(deg(pi+\b))});
                \addplot[domain=2*pi+\b:2*pi+\a, samples=100, signalred, dotted, thick]{cos(deg(x))};
                \addplot[domain=2*pi+\a:3*pi+\b, samples=100, signalred, dotted, thick]{-\i0};
                
                % input current
                \addplot[domain=0:\a, samples=100, signalred, thick]{cos(deg(x))+\i0};
                \addplot[domain=\a:pi+\b, samples=100, signalred, thick]{0};
                \draw[signalred, thick] (axis cs:pi+\b,0) -- (axis cs:pi+\b,{-cos(deg(pi+\b))+\i0});
                \addplot[domain=pi+\b:pi+\a, samples=100, signalred, thick]{-cos(deg(x))+\i0};
                \addplot[domain=pi+\a:2*pi+\b, samples=100, signalred, thick]{0};
                \draw[signalred, thick] (axis cs:2*pi+\b,0) -- (axis cs:2*pi+\b,{-cos(deg(pi+\b))+\i0});
                \addplot[domain=2*pi+\b:2*pi+\a, samples=100, signalred, thick]{cos(deg(x))+\i0};
                \addplot[domain=2*pi+\a:3*pi+\b, samples=100, signalred, thick]{0};

                % %Capacitor voltage
                \addplot[domain=0:\a, samples=100, signalbrown, thick]{sin(deg(x))};
                \addplot[domain=\a:pi+\b, samples=100, signalbrown, thick]{sin(deg(\a))-\c*\i0*(x-\a)};
                \addplot[domain=pi+\b:pi+\a, samples=100, signalbrown, thick]{abs(sin(deg(x)))};
                \addplot[domain=pi+\a:2*pi+\b, samples=100, signalbrown, thick]{sin(deg(\a))-\c*\i0*(x-\a-pi)};
                \addplot[domain=2*pi+\b:2*pi+\a, samples=100, signalbrown, thick]{abs(sin(deg(x)))};
                \addplot[domain=2*pi+\a:3*pi+\b, samples=100, signalbrown, thick]{sin(deg(\a))-\c*\i0*(x-\a-2*pi)};

                %dashed horizontal lines for alpha beta angles
                \draw[dotted] (axis cs:\a,-1.5) -- (axis cs:\a,1.5);
                \draw[dotted] (axis cs:pi+\b,-1.5) -- (axis cs:pi+\b,1.5);
                \draw[->]  (0,-0.9) -- node[above]{$\alpha$}(\a, -0.9);
                \draw[<->]  (\a,-1.2) -- node[above]{$\beta$}(\b+pi, -1.2);
                
                % %signal labels
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,-0.9) {$u_1(t)$};
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14*2,1.0) {$|u_1(t)|$};
                \draw[signalblue, thin] (axis cs:3.14*2-0.2,0.95) -- (axis cs:3.14*2-0.5,0.7);
                \node[signalbrown, above] at (axis cs:3.0,0.9) {$u_2(t)$};
                \node[signalred, left] at (axis cs:3.14/2,-\i0) {${i_\mathrm{C}(t)}$};
                \node[signalred, right, fill=white, inner sep=2pt] at (axis cs:0.3*pi,1.25) {${i_2(t)}$};
            \end{axis}
        \end{tikzpicture}
        \caption{Typical signal curves for B2U topology with output capacitor and constant load}
        \label{fig:B2U_topology_capacitive_filter_signals}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit with capacitive output filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit with capacitive output filtering (cont.)}
    The filter capacitor current $i_\mathrm{C}(t)$ is
    \begin{equation}
        i_\mathrm{C}(t) = \begin{cases}
            -I_0, & i_2(t) = 0,\\
            C\frac{\mathrm{d}}{\mathrm{d}t}u_2(t), & i_2(t) > 0,
        \end{cases}
        \label{eq:iC_B2U_cap_filt}
    \end{equation}
    that is, if the output current $i_2(t)$ is zero, the diode bridge blocks and the capacitor discharges via the load. Contrary, if the output current is positive, the diodes conduct and the capacitor voltage is determined by the rectified input voltage. The output current is given by
    \begin{equation}
        i_2(t) = i_\mathrm{C}(t) + I_0.
        \label{eq:i2_B2U_cap_filt}
    \end{equation} 
    Inserting \eqref{eq:iC_B2U_cap_filt} in \eqref{eq:i2_B2U_cap_filt} delivers the output current during the conduction phase:
    \begin{equation}
        i_2(t) = C\omega \hat{u}_1 \cos(\omega t) + I_0, \quad 0 \leq \omega t < \omega t_1.
        \label{eq:i2_B2U_cap_filt_conduct}
    \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U uncontrolled rectifier circuit with capacitive output filtering (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U uncontrolled rectifier circuit with capacitive output filtering (cont.)}
    The \hl{conduction phase} lasts until $\omega t_1 = \alpha$ which can be determined from \eqref{eq:i2_B2U_cap_filt_conduct}:
    \begin{equation}
            \alpha = \arccos\left(-\frac{I_0}{C\omega \hat{u}_1}\right).
        \label{eq:omega_t1_B2U_cap_filt}
    \end{equation}
    For $\alpha < \omega t < \omega t_2$ the capacitor discharges via the load:
    \begin{equation}
        \begin{split}
            u_2(t) &= u_2(\omega t_1) + \int_{t_1}^t -\frac{I_0}{C} \mathrm{d} \tau = u_2(\alpha) + \int_{\alpha}^{\omega t} -\frac{I_0}{\omega C} \mathrm{d} \omega \tau\\
                   &=  u_2(\alpha) - \frac{I_0}{\omega C} (\omega t - \alpha), \quad \omega t_1 \leq \omega t < \omega t_2.
        \end{split}
    \end{equation}
    The \hl{blocking phase} lasts until $\omega t_2 = \alpha + \beta$, that is, the rectified input voltage is equal to the capacitor voltage (note: not solvable for $\omega t_2$ in closed-form, requires numerical methods):
    \begin{equation}
        \begin{split}
            u_2(\omega t_2) = u_2(\alpha) - \frac{I_0}{\omega C} (\omega t_2 - \alpha) \stackrel{!}{=} \hat{u}_1 |\sin(\omega t_2)| = |u_1(\omega t_2)|.
        \end{split}
        \label{eq:u2_B2U_cap_filt_block}
    \end{equation}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance}
    \begin{figure}
           \begin{circuitikz}
            \draw (0,0) to [open, o-o, v = $u_1(t)\hspace{0.5cm}$, voltage = straight] ++(0,-2) coordinate (A)
            (0,0) to [L, i>^=$i_1(t)$, -*, l=$L$, v=$u_\mathrm{L}(t)$, voltage = straight] ++(3,0)
            to [diode, l=$D_1$]  ++(0,1.5)
            to [short, -*] ++(2,0) coordinate (C)
            to [diode, l=$D_3$, invert]  ++(0,-1.5)
            to [short] ++(0, -2) coordinate (B)
            to [diode, l=$D_2$, invert, -*]  ++(0, -1.5) coordinate (D)
            to [short] ++(-2,0)
            to [diode, l=$D_4$]  ++(0, 1.5)
            to [short] ++(0, 2)
            (B) to [crossing, *-, mirror] ++(-4,0)
            to [short] (A)
            (C) to [short, i=$i_2(t)$] ++(2,0) coordinate (E)
            to [short] ++(0,-1.5)
            to [C, v= $u_2(t)$, voltage = straight, l=$C$, i=${i_\mathrm{C}(t)}$] ++(0,-2)
            to [short] ++(0,-1.5) coordinate (F)
            to [short] (D)
            (E) to [short, *-] ++(2,0)
            to [short] ++(0,-1.5)
            to [isource, l=$I_0$] ++(0,-2)
            to [short] ++(0,-1.5)
            to [short, -*] (F);
        \end{circuitikz}%
        \caption{B2U topology considering an output capacitor, constant load, and grid impedance}
        \label{fig:B2U_topology_capacitive_filter_grid}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    For the modified scenario form \eqref{fig:B2U_topology_capacitive_filter_grid} we assume an infinite capacitance capacitor, i.e.,
    $$ u_2(t)\approx U_2$$
    to keep the analysis simple. Like before, the diode bridge conduction is determined by the output current $i_2(t)$:
    \begin{itemize}
        \item $i_2(t)>0$: diode bridge conducts, $u_\mathrm{L}(t) = |u_1(t)|-U_2$,
        \item $i_2(t)=0$: diode bridge blocks, $u_\mathrm{L}(t) = \max\{0, |u_1(t)|-U_2\}$.
    \end{itemize}
    Hence, the B2U rectifier behavior is driven by the grid impedance current and the dynamics introduced by $L$. Similar to the previous analysis on DC-DC converters, the discontinuous conduction mode (DCM) and the boundary conduction mode (BCM) will be differentiated in the following. 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                    real \a, \b, \i0, \gain;
                    \b = 0.6*pi; % Phase angle beta indicating the time length of diode conduction
                    \a = rad(atan((1-cos(deg(\b)))/(\b - sin(deg(\b))))); % Phase angle alpha indicating the start time of conducting diodes
                    \gain = sin(deg(\a)); % gain of average output voltage to input voltage amplitude
                    \i0 = 0.5*((1-cos(deg(\b)))/\gain - \gain*\b^2/2); % normalized load current
                }
            \begin{axis}[
                width=0.79\textwidth,
                height=0.85\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0, \a, 3.14/2, pi-\a, \b+\a, 3.14, 3.14*3/2,6.28},
                xticklabels={$0$, $\omega t_1$, $\frac{\pi}{2}$,$\omega t_2$, $\omega t_3$, $\pi$, $\frac{3}{2}\pi$, $2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]

                % %input voltage
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dashed, name path = A]{sin(deg(x))};
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dash dot]{abs(sin(deg(x)))}; %rectified input voltage
                
                % output current (with double height for better visibility)
                \addplot[domain=0:\a, samples=10, signalred, dotted, thick]{0};
                \addplot[domain=\a:\a+\b, samples=100, signalred, thick]{pi*(cos(deg(\a))-cos(deg(x))-\gain*(x-\a))};
                \addplot[domain=\a+\b:pi+\a, samples=10, signalred, thick]{0};
                \addplot[domain=\a+pi:\a+\b+pi, samples=100, signalred, thick]{pi*(cos(deg(\a))-cos(deg(x-pi))-\gain*(x-\a-pi))};
                \addplot[domain=\a+\b+pi:2*pi, samples=10, signalred, thick]{0};
        
                % dashed vertical lines for averages
                \draw[dashed, name path = B] (axis cs:0,\gain) -- (axis cs:2*pi,\gain);
                \draw[dashed, signalred] (axis cs:0,\i0*2) -- (axis cs:2*pi,\i0*2);

                %dashed horizontal lines for alpha beta angles
                \draw[dotted] (axis cs:\a,-1.5) -- (axis cs:\a,1.5);
                \draw[dotted] (axis cs:\a+\b,-1.5) -- (axis cs:\a+\b,1.5);
                \draw[dotted] (axis cs:pi-\a,-1.5) -- (axis cs:pi-\a,1.5);
                \draw[->]  (0,-0.7) -- node[above]{$\alpha$}(\a, -0.7);
                \draw[<->]  (\a,-0.9) -- node[above]{$\beta$}(\a+\b, -0.9);

                % signal labels
                \node[signalblue, below, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,1.0) {$|u_1(t)|$};
                \node[signalred, left] at (axis cs:pi/2+0.1,0.4) {$i_2(t)$};
                \node[signalred, above, yshift = 2mm] at (axis cs:pi*1.3,\i0) {$\overline{i}_2$};
                \node[above] at (axis cs:pi,\gain) {$U_2$};

                % fill area for depicting voltage balance
                \addplot [shadecolor, opacity=0.3] fill between [of=A and B, soft clip={domain=\a:\b+\a}]; 
            \end{axis}
        \end{tikzpicture}
        \caption{Typical signal curves for B2U topology feeding a constant load from the grid and an infinite output capacitance in DCM}
        \label{fig:B2U_topology_capacitive_filter_grid_signals_DCM}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
   In \hl{steady-state DCM} the output current is zero for
   \begin{equation}
        i_2(\omega t) = 0, \quad 0 \leq \omega t < \omega t_1.
   \end{equation}
   Until then the diode bridge is in blocking mode and disconnects the input from the output. At $\omega t_1 = \alpha$ the diodes start conducting since the input voltage exceeds the output voltage:
   \begin{equation}
      u_1(\omega t_1 = \alpha) = \hat{u}_1 \sin(\alpha) \stackrel{!}{=} U_2 \quad \Leftrightarrow \quad \alpha = \arcsin\left(\frac{U_2}{\hat{u}_1}\right).
   \end{equation}
   At this point, the output current is rising due to the positive inductor voltage:
   \begin{equation}
    \begin{split}
        i_2(\omega t) &= \frac{1}{L} \int_{t_1}^t u_1(t)-U_2 \mathrm{d}t= \frac{1}{\omega L} \int_{\omega t_1}^{\omega t} u_1(\omega t)-U_2 \mathrm{d}\omega t = \frac{1}{\omega L} \int_{\omega t_1}^{\omega t} \hat{u}_1 \sin(\omega t)-U_2 \mathrm{d}\omega t \\
               & = \frac{\hat{u}_1}{\omega L} \left(\cos(\alpha)-\cos(\omega t)-\frac{U_2}{\hat{u}_1}(\omega t - \alpha)\right), \quad \omega t_1 \leq \omega t < \omega t_2. 
    \end{split}
    \label{eq:i2_B2U_cap_filt_grid_conduct_DCM}
   \end{equation}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
   At $\omega t_2 = \alpha + \beta$ the current reaches zero again and the diode bridge blocks again:
   \begin{equation}
    \begin{split}
        i_2(\omega t_2) &= \frac{\hat{u}_1}{\omega L} \left(\cos(\alpha)-\cos(\omega t_2)-\frac{U_2}{\hat{u}_1}(\omega t_2 - \alpha)\right) \stackrel{!}{=} 0\\
        &\Leftrightarrow \cos(\alpha)-\cos(\alpha+\beta)-\beta\sin(\alpha) = 0.
    \end{split}
   \end{equation}
   For a given $\alpha$, this equation is not solvable in closed-form w.r.t. $\beta$ and requires numerical methods. However, if $\beta$ is known, $\alpha$ can be determined leading to
    \begin{equation}
         \alpha = \arctan\left(\frac{1-\cos(\beta)}{\beta-\sin(\beta)}\right).
    \end{equation}
    The average output current in DCM is
    \begin{equation}
        \overline{i}_2 = \frac{1}{T} \int_{0}^{T} i_2(t) \mathrm{d}t = \frac{1}{\pi} \int_{\alpha}^{\alpha+\beta} i_2(\omega t) \mathrm{d}\omega t = \ldots = \frac{\hat{u}_1}{\pi \omega L} \left(\frac{\hat{u}_1}{U_2}(1-\cos(\beta))-\frac{U_2}{\hat{u}_1}\frac{\beta^2}{2}\right).
    \end{equation}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    For a better representation in the following, the average current is normalized:
    \begin{equation}
        \overline{i}'_2 = \frac{\overline{i}_2}{\frac{2}{\pi}\frac{\hat{u}_1}{\omega L}} = \frac{1}{2} \left(\frac{\hat{u}_1}{U_2}(1-\cos(\beta))-\frac{U_2}{\hat{u}_1}\frac{\beta^2}{2}\right).
        \label{eq:i2_avg_norm_B2U_cap_filt_grid_DCM}
    \end{equation}
    Here, the denominator $\nicefrac{2}{\pi}\cdot\nicefrac{\hat{u}_1}{\omega L}$ is the absolute average value of the inductor current in case of a grid short circuit.\\[1em]

    Based on the correlations found, the operating characteristics in DCM of the rectifier can be visualized, which has been implemented in \figref{fig:B2U_load_curve} (left part):
    \begin{itemize}
        \item In DCM, $\beta \in [0, \pi[$ holds, i.e., the diode bridge is conducting for $0\ldots100 \,\%$ per half cycle.
        \item At $\beta = \pi$ the diode bridge is conducting for the full half cycle.
        \item In order to achieve a commutation of the current between the diode pairs D1/D4 and D2/D3, the current gets zero (for a short time) so that the rectifier operates in BCM. 
    \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \tikzmath{
                    real \a, \i0, \gain, \w2;
                    \a = 0.25*pi; % Phase angle alpha' indicating the start time of conducting diodes
                    \gain = 2/pi*cos(deg(\a)); % gain of average output voltage to input voltage amplitude
                    \i0 = sin(deg(\a)); % normalized load current
                    \w2 = pi-rad(asin(\gain));
                }
            \begin{axis}[
                width=0.79\textwidth,
                height=0.85\textheight,
                axis lines=middle,
                xlabel={$\omega t$},
                xlabel style={yshift=.0*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=west,
                inner xsep=0pt,
                xshift=0.5*\pgfkeysvalueof{/pgfplots/major tick length}},
                ylabel style={yshift=1.5*\pgfkeysvalueof{/pgfplots/major tick length},
                anchor=north west,
                inner ysep=0pt},
                yticklabel style={inner sep=2pt,
                fill = white},
                xmin=0, xmax=2*pi,
                ymin=-1.5, ymax=1.5,
                xtick={0, \a, 3.14/2, \w2, 3.14, 3.14*3/2, 6.28},
                xticklabels={$0$, $\omega t_1$, $\frac{\pi}{2}$, $\omega t_2$, $\pi$, $\frac{3}{2}\pi$, $2\pi$},
                ytick={-1,0,1},
                yticklabels={$-\hat{x}$,$0$,$\hat{x}$},
                grid=both,
                ]

                % %input voltage
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dashed, name path = A]{sin(deg(x))};
                \addplot[domain=0*pi:2*pi, samples=100, signalblue, thick, dash dot]{abs(sin(deg(x)))}; %rectified input voltage
                
                % output current
                \addplot[domain=0:\a, samples=100, signalred, thick]{1/4*(cos(deg(\a))*(pi/2+\a)-(x+pi)*cos(deg(\a))-pi/2*cos(deg(x+pi)))};
                \addplot[domain=\a:\a+pi, samples=100, signalred, thick]{1/4*(cos(deg(\a))*(pi/2+\a)-x*cos(deg(\a))-pi/2*cos(deg(x)))};
                \addplot[domain=\a+pi:\a+2*pi, samples=100, signalred, thick]{1/4*(cos(deg(\a))*(pi/2+\a)-(x-pi)*cos(deg(\a))-pi/2*cos(deg(x-pi)))};
     
        
                % dashed vertical lines for averages
                \draw[dashed, name path = B] (axis cs:0,\gain) -- (axis cs:2*pi,\gain);
                \draw[dashed, signalred] (axis cs:0,1/4*\i0) -- (axis cs:2*pi,1/4*\i0);

                %dashed horizontal lines for alpha beta angles
                \draw[dotted] (axis cs:\a,-1.5) -- (axis cs:\a,1.5);
                \draw[dotted] (axis cs:pi+\a,-1.5) -- (axis cs:pi+\a,1.5);
                \draw[->]  (0,-0.7) -- node[above]{$\alpha'$}(\a, -0.7);
                \draw[<->]  (\a,-0.9) -- node[above]{$\alpha'+\pi$}(\a+pi, -0.9);

                % signal labels
                \node[signalblue, below, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,-1.0) {$u_1(t)$};
                \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:3.14*3/2,1.0) {$|u_1(t)|$};
                \node[signalred, left] at (axis cs:pi/2+0.22,0.31) {$i_2(t)$};
                \node[signalred, above, yshift=-1mm] at (axis cs:pi*1.3,\i0/4) {$\overline{i}_2$};
                \node[above] at (axis cs:pi,\gain) {$U_2$};

                % fill area for depicting voltage balance
                \addplot [shadecolor, opacity=0.3] fill between [of=A and B, soft clip={domain=\a:pi+\a}]; 
            \end{axis}
        \end{tikzpicture}
        \caption{Typical signal curves for B2U topology feeding a constant load from the grid and an infinite output capacitance in BCM}
        \label{fig:B2U_topology_capacitive_filter_grid_signals_BCM}
    \end{figure}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    In \hl{steady-state BCM}, the output current is analogous to the DCM as from \eqref{eq:i2_B2U_cap_filt_grid_conduct_DCM} leading to
    \begin{equation}
            i_2(\omega t) = \frac{\hat{u}_1}{\omega L} \left(\cos(\alpha')-\cos(\omega t)-\frac{U_2}{\hat{u}_1}(\omega t - \alpha')\right), \quad \alpha' \leq \omega t < \alpha' + \pi 
       \end{equation}
    with $\alpha'$ being the phase angle at which the diodes start conducting in BCM -- cf. \figref{fig:B2U_topology_capacitive_filter_grid_signals_BCM}. After a half cycle, the current reaches zero for a short moment enabling the diode bridge to commutate the current between the diode pairs:
    \begin{equation}
        i_2(\omega t = \alpha'+\pi) = 0 \quad \Leftrightarrow \quad \cos(\alpha')-\cos(\alpha'+\pi)-\frac{U_2}{\hat{u}_1}\pi = 0 
    \end{equation}
    from which 
    \begin{equation}
        \frac{U_2}{\hat{u}_1} = \frac{2}{\pi} \cos(\alpha')
        \label{eq:U2_u1_relation_B2U_cap_filt_grid_BCM}
    \end{equation}
    follows after some intermediate calculation steps. 
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    The average output current in BCM follows as
    \begin{equation}
        \begin{split}
            \overline{i}_2 &= \frac{1}{T} \int_{0}^{T} i_2(t) \mathrm{d}t = \frac{1}{\pi} \int_{\alpha'}^{\alpha'+\pi} i_2(\omega t) \mathrm{d}\omega t = \ldots \\ &= \frac{2}{\pi} \frac{\hat{u}_1}{ \omega L} \sin(\alpha').
        \end{split}
    \end{equation}
    Applying the same normalization as \eqref{eq:i2_avg_norm_B2U_cap_filt_grid_DCM} leads to
    \begin{equation}
        \overline{i}'_2 = \frac{\overline{i}_2}{\frac{2}{\pi}\frac{\hat{u}_1}{\omega L}} = \sin(\alpha').
        \label{eq:i2_avg_norm_B2U_cap_filt_grid_BCM}
    \end{equation}
    Combining \eqref{eq:U2_u1_relation_B2U_cap_filt_grid_BCM} and \eqref{eq:i2_avg_norm_B2U_cap_filt_grid_BCM} reveals
    \begin{equation}
        \frac{U_2}{\hat{u}_1} = \frac{2}{\pi}\cos(\arcsin(\overline{i}'_2)).
    \end{equation}
    The resulting load curve for the BCM is also depicted in \figref{fig:B2U_load_curve} (right part).
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% B2U rectifier with capacitive output filtering and grid impedance (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
    \frametitle{B2U rectifier with capacitive output filtering and grid impedance (cont.)}
    \begin{figure}
        \begin{tikzpicture}
            \pgfplotsset{table/search path={fig/lec04}}
            \begin{axis}[
                     width=0.65\textwidth,
                     height=0.85\textheight,
                     axis lines=middle,
                     xlabel={$\overline{i}'_2$},
                     xmin=0, xmax=1,
                     ymin=0, ymax=1.05,
                     grid=both,
                     xlabel style={anchor = west},
                     ]
                    \addplot[signalblue, thick] table[x=I_out, y=gain, col sep=comma] {Load_curve_B2_rectifier.csv}; 
                    \addplot[signalred, thick] table[x=I_out, y=alpha, col sep=comma] {Load_curve_B2_rectifier.csv}; 
                    \addplot[signalbrown, thick] table[x=I_out, y=beta, col sep=comma] {Load_curve_B2_rectifier.csv}; 
                    \draw[dashed] (axis cs:0.535,0) -- (axis cs:0.535,1);
                    \node[signalred, above, fill=white, inner sep=2pt] at (axis cs:0.3,0.24) {$\frac{\alpha}{\pi}$};
                    \node[signalred, above, fill=white, inner sep=2pt] at (axis cs:0.65,0.24) {$\frac{\alpha'}{\pi}$};
                    \node[signalbrown, above, fill=white, inner sep=2pt] at (axis cs:0.3,0.87) {$\frac{\beta}{\pi}$};
                    \node[signalblue, above, fill=white, inner sep=2pt] at (axis cs:0.44,0.6) {$\frac{U_2}{\hat{u}_1}$};
                    \draw[thin] (axis cs:0.54,0.6) -- (axis cs:0.75,0.7);
                    \node[left, fill=white, inner sep=2pt, anchor=west] at (axis cs:0.75,0.7) {BCM limit};
            \end{axis}                
          \end{tikzpicture}
        \caption{Load curve of the B2U rectifier with capacitive output filtering and grid impedance}
        \label{fig:B2U_load_curve}
    \end{figure}
\end{frame}