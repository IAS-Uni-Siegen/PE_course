%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% PWM-based PFC rectifier current ripple (cont.) %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        \begin{figure}
        \begin{tikzpicture}
          %  \pgfplotsset{table/search path={"/Users/Silas Elter/Desktop/GitHub/PE_course/lecture/fig/lec04"}}
          plotsset{table/search path={"/lecture/fig/lec04"}}
            \begin{groupplot}[group style={group size=1 by 2, xticklabels at = edge bottom, vertical sep=0.75cm}, height=0.4\textheight, width=0.875\textwidth, xmin=0, xmax=pi, grid,clip = false, ymin = -0.1, ymax =1.1, xtick = {0, pi/4, pi/2, 3*pi/4,pi}, xticklabels = {0,$\frac{1}{4}\pi$, $\frac{1}{2}\pi$,$\frac{3}{4}\pi$, $\pi$}, ytick = {-1, 0, 1}, yticklabels = {, 0, 1}]

                
                % top plot: input current
                \nextgroupplot[ylabel = {$i_1(t)$}, ytick = {-1, 0, 0.5, 1}, yticklabels = {}, legend columns=2] 
                \addplot[signalred, thick] table[x=wt, y=i1, col sep=comma] {PWM_PFC_example.csv}; 
                \addplot[thick, dashed] table[x=wt, y=i1ref, col sep=comma] {PWM_PFC_example.csv};
                \addplot[domain=0:pi, samples=100, signalgreen, dashed, thick]{0.81*sin(deg(x))+0.9*sin(deg(x))*(1-sin(deg(x))/1.3)};
                \addplot[domain=0:pi, samples=100, signalgreen, dashed, thick]{0.81*sin(deg(x))-0.9*sin(deg(x))*(1-sin(deg(x))/1.3)};
                \legend{$i_1(t)$, $i_1^{(1)}(t)$} 
                
                % bottom plot: ripple current
                \nextgroupplot[ylabel = {$\Delta i_1(t)$}, ytick = {-1, -0.5, 0, 0.5, 1}, yticklabels = {}, ymin = -0.6, ymax =0.6, xlabel={$\omega t$}] 
                \addplot[signalred, thick, dashed] table[x=wt, y=i1delta, col sep=comma] {PWM_PFC_example.csv}; 
                \addplot[domain=0:pi, samples=100, signalgreen, thick]{0.9*sin(deg(x))*(1-sin(deg(x))/1.3)};
                \addplot[domain=0:pi, samples=100, signalgreen, thick]{-0.9*sin(deg(x))*(1-sin(deg(x))/1.3)};

            \end{groupplot}
        \end{tikzpicture}
    \end{figure}
