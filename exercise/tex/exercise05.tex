%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Begin exercise %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ex{Rectifiers}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 1: B2U topology with capacitive filtering %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\task{B2U topology with capactive filtering}
An uncontrolled single-phase, two-pulse rectifier circuit with capacitive filtering 
is shown in \autoref{fig:B2U_Topology_Cap_Filtering}.
All components, including the diodes, are assumed to be ideal. On the input side, 
the single-phase AC supply with voltage $u$ is connected, while on the output side, 
a smoothing capacitor $C$ and a constant current load $I_\mathrm{0}$ are present.

\input{fig/ex05/Fig_B2U_TopologyWithCapactiveFiltering.tex}

\begin{table}[ht]
    \centering  % Zentriert die Tabelle
    \begin{tabular}{llll}
        \toprule
        
        Input voltage: &  $u_\mathrm{1}(t) = \SI{156}{\volt}\cdot \sin(\omega t)$ & Load current: & $I_{\mathrm{0}} = \SI{7.5}{\ampere}$ \\ 
        Filter capacitance: & $C = \SI{330}{\micro\farad}$  & Frequency: & $f= \SI{60}{\hertz}$ \\ 
        \bottomrule
    \end{tabular}
    \caption{Parameters of the B2U rectifier.}  
    \label{table:ex05_Parameters of the circuit}
\end{table}

The angle $\alpha$ represents the phase angle range between zero crossing of the supply voltage and the point in time
at which all four diodes are blocked, meaning the capacitor discharges through the load. The angle $\beta$ 
represents the phase angle range between $\alpha$ and the phase angle at which two of the four diodes begin to 
conduct, i.e., when the capacitor is recharged from the mains supply.
A steady-state operation is assumed for this task.

\subtask{Calculate the two angles $\alpha$ and $\beta$.
Note: For the calculation of $\beta$ you can use the following simple approximation: $\text{sin(x) = x}$.
(This approximation is sufficiently accurate within a range of approximately $x=\pm \SI{25}{\degree}$.)}
\begin{solutionblock}
    As long as the voltage $\left| u_\mathrm{1}(t) \right|$ increase the voltage $u_\mathrm{2}(t)$ of the capacitor follows:
    \begin{equation} 
        u_\mathrm{2}(t) = \left| \hat{u}_\mathrm{1}\sin(\omega t)\right|.
    \end{equation}
    If the capacitor supplies the load current $I_\mathrm{0}$ the voltage $u_\mathrm{2}(t)$ at the capacitor 
    decreases linear with:
    \begin{equation} 
        dU_\mathrm{C}(t)=\frac{d(u_\mathrm{2}(t))}{dt} = -\frac{I_\mathrm{0}}{C}=-\frac{\SI{7.5}{\ampere}}{\SI{330}{\micro\farad}}
        =-\SI{22.7}{\kilo\volt/\second}.
    \end{equation} 
    If the voltage $u_\mathrm{2}(t)$ decreases faster than $d(u_\mathrm{2}(t))/dt$
    then all diodes blocks and the capacitor supplies the current load $I_\mathrm{0}$. This leads to:
    \begin{equation} 
        \frac{d(u_\mathrm{2}(t))}{dt} = \frac{d(\left| \hat{u}_\mathrm{1}\sin(\omega t)\right|)}{dt} 
        = \omega\left| \hat{u}_\mathrm{1}\cos(\omega t)\right| = -\frac{I_\mathrm{0}}{C}.
        \label{eq:deltaVoltageAtCapacitor_ex05}
    \end{equation} 
    Solving \eqref{eq:deltaVoltageAtCapacitor_ex05} with respect to $\omega \cdot t = \alpha$ yields
    \begin{equation}
        \alpha = \arccos(-\frac{I_\mathrm{0}}{\omega C \cdot \hat{u}_\mathrm{1}})
        = \arccos(-\frac{\SI{7.5}{\ampere}}{2 \pi \cdot \SI{60}{\hertz} \cdot \SI{330}{\micro\farad} \cdot \SI{156}{\volt}}) = \SI{112.8}{\degree}.
    \end{equation}
    The capacitor is discharging by the load  $I_\mathrm{0}$ at $\alpha$, which corresponds to a 
    voltage of: 
    \begin{equation}
        \hat{u}_\mathrm{1}sin(\omega t) = \hat{u}_\mathrm{1}sin(\alpha) 
        = \SI{156}{\volt} \cdot sin(\SI{112.8}{\degree})=\SI{143.4}{\volt}.
    \end{equation}    
    In that moment when the voltage $\left| u_\mathrm{1}(t) \right|$ becomes equal to $u_\mathrm{2}(t)$ 
    the discharge of the capacitor stops and $u_\mathrm{2}(t)$ follows again $\left| u_\mathrm{1}(t) \right|$.
    The voltage $\left| \hat{u}_\mathrm{1}(t) \right|$ increases again at $\pi$ with:
    \begin{equation}
        \left| \hat{u}_\mathrm{1}sin(\omega t + \pi ) \right| = \hat{u}_\mathrm{1}sin(\omega t) \quad \text{for} \quad t \leq \pi.
    \end{equation}
    If we consider $t=0$ as the point in time at which the voltage $u_\mathrm{2}(t)$ begins to rise, the following 
    results compared to the previous point in time at which the capacitor begins to discharge:      
    \begin{equation}
        t_\mathrm{\alpha}=\frac{\pi - \alpha_\mathrm{rad}}{\omega} = 
        \frac{\pi - \SI{1.969}{\radian}}{\SI{377}{\hertz}} = \SI{-3.111}{\milli\second}
    \end{equation}   
    With the approximation $sin(x) = x$ we get
    \begin{equation}
        \hat{u}_\mathrm{1}sin(\alpha) + dU_\mathrm{C}(t) \cdot (t-t_\mathrm{\alpha}) = \hat{u}_\mathrm{1}\cdot \omega t.
        \label{eq:stopCapacitordischarge_ex05}
    \end{equation}   
    Solving \eqref{eq:stopCapacitordischarge_ex05} with respect to $\omega t$ leads to
    \begin{equation}
        \omega t = \frac{\hat{u}_\mathrm{1}sin(\alpha) - dU_\mathrm{C}(t) \cdot t_\mathrm{\alpha}}
                   {\hat{u}_\mathrm{1}-\frac{dU_\mathrm{C}(t)}{\omega}}=
                   \frac{\SI{143.4}{\volt} - \SI{22.7}{\kilo\volt/\second} \cdot ()\SI{3.111}{\milli\second}}
                   {\SI{156}{\volt}-\frac{dU_\mathrm{C}(t)}{\SI{377}{\hertz}}}=\SI{0.337}{\radian}.
    \end{equation}
    $\beta$ is to calculate by distance between $alpha$ and the calculated $\omega t$:
    \begin{equation}
        \beta=\omega t + \pi - \alpha = \SI{0.337}{\radian} + \pi - \SI{1.969}{\radian}
        = \SI{1.51}{\radian} = \SI{86.5}{\degree}.
    \end{equation}
\end{solutionblock}

\vspace{2em}\par
If you were unable to solve task (a), please use $\alpha=\SI{112.8}{\degree}$ and $\beta=\SI{86.5}{\degree}$.

\subtask{Sketch the capacitor voltage $u_\mathrm{2}(\omega t)$ considering $\omega t \in [0,...,2\pi]$ taking 
into account the previously calculated angles $\alpha$ and $\beta$.}
\subtask{Calculate the currents $i_\mathrm{1}(\omega t)$  and $i_\mathrm{C}(\omega t)$ and sketch it considering $\omega t \in [0,...,2\pi]$.}
\begin{solutionblock}
    For current of $i_\mathrm{1}(\omega t)$ and  $i_\mathrm{C}(\omega t)$ two cases are to consider. If $\alpha<\omega t<\alpha+\beta$
    and $\pi+\alpha<\omega t<\pi+\alpha+\beta$,the capacitor supplies the load current $I_{\mathrm{0}}$.
    The remaining phase angle range the input voltage supplies the current load $I_{\mathrm{0}}$ and charge the capacitor.
    For $\alpha<\omega t<(\alpha+\beta)$ and $(\pi+\alpha)<\omega t<(\pi+\alpha+\beta)$ the current $i_\mathrm{C}(\omega t)$ 
    corresponds to the current $-I_{\mathrm{0}}$ while all diodes are inactive.
    \begin{equation} 
        i_\mathrm{C}(\omega t)=-I_{\mathrm{0}} \quad \text{and} \quad i_\mathrm{1}(\omega t)= i_\mathrm{2}(\omega t)= \SI{0}{\ampere}
    \end{equation}
    For $(\alpha+\beta-\pi)\leq\omega t\leq\alpha$ and $(\alpha+\beta)\leq\omega t\leq(\pi+\alpha)$ the current $i_\mathrm{C}(\omega t)$ results in:
    \begin{equation} 
        i_\mathrm{C}(\omega t)=C\frac{d(u_\mathrm{2}(t))}{dt}=C\frac{d(\left| \hat{u}_\mathrm{1}\sin(\omega t)\right|)}{dt}
        = \omega C \left|\hat{u}_\mathrm{1}\cos(\omega t)\right|
        = \SI{377}{\hertz} \SI{330}{\micro\farad} \left|\SI{156}{\volt}\cos(\omega t)\right|=\SI{19.4}{\ampere}\left|\cos(\omega t)\right| 
    \end{equation}
    Entering numbers leads to
    \begin{equation} 
        i_\mathrm{C}(\omega t)= \SI{377}{\hertz} \SI{330}{\micro\farad} \left|\SI{156}{\volt}\cos(\omega t)\right|=\SI{19.4}{\ampere}\left|\cos(\omega t)\right| 
    \end{equation}
    The current $i_\mathrm{2}(\omega t)$ is the sum of $I_{\mathrm{0}}$ and $i_\mathrm{C}(\omega t)$.
    \begin{equation} 
        i_\mathrm{2}(\omega t)=i_\mathrm{C}(\omega t) + I_{\mathrm{0}}=\SI{19.4}{\ampere}\left|\cos(\omega t)\right| + \SI{7.5}{\ampere}
    \end{equation}
    The current $i_\mathrm{1}(\omega t)$ depends on the diodes, which are active.
    \begin{align}
        \begin{split}
            i_\mathrm{1}(\omega t)=i_\mathrm{2}(\omega t) \quad \text{for} \quad (\alpha+\beta-\pi)\leq\omega t\leq\alpha \\
            i_\mathrm{1}(\omega t)=-i_\mathrm{2}(\omega t) \quad \text{for} \quad (\alpha+\beta)\leq\omega t\leq\pi+\alpha
        \end{split}
    \end{align}
\end{solutionblock}

\subtask{Assume the smoothing capacitor is very large, i.e., $C\rightarrow \infty$. What is the average active power $P_\mathrm{0}$ 
absorbed by the current source? What will $P_\mathrm{0}$ be if $C=\SI{330}{\micro\farad}$?}


\subtask{What is the minimum blocking voltage ratings of the diodes to ensure that the rectifiers is not damaged?}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 2: PFC rectifier %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\task{PFC rectifier}
Due to the constantly increasing load on the grid with harmonics as a result of the use of power converters, the regulations regarding the permissible harmonic content of the current consumption of electrical consumers are being tightened. It is therefore necessary, e.g. for the rectification of single-phase AC mains voltage, to design power converters with a high power factor. 
A variant of a PFC rectifier circuit is shown in \autoref{fig:Boost converter with single-phase diode bridge_topology}. The prerequisite for the use of the boost converter is: $u_\mathrm{2} = U_\mathrm{2}>U_\mathrm{1}$. The boost converter is operated with a pulse width modulated (PWM)-based controller for which the switching frequency $f_\mathrm{T}$ has a constant value $f_\mathrm{T} = \SI{20}{\kilo\hertz}$. CCM is assumed as the operating mode.
\input{fig/ex05/Fig_BoostConverter_with_Rectifiers.tex}

\begin{table}[ht]
    \centering  % Zentriert die Tabelle
    \begin{tabular}{llll}
        \toprule
        
        Input voltage: &  $u_{\mathrm{1}}(t) = \hat U_{\mathrm{1}} \sin(\omega t) = \sqrt{2} \cdot \SI{230}{\volt} \cdot \sin(\omega t)$ & Output voltage: & $u_{\mathrm{2}}(t) = \SI{400}{\volt}$ \\ 
        Output power: & $P_\mathrm{2} = \SI{4}{\kilo\watt}$  & Grid frequency: & $ f =  \SI{50}{\hertz}$ \\ 
        Inductance: & $L = \SI{570}{\micro\henry}$
         & Switching frequency: & $f_\mathrm{T} = \SI{20}{\kilo\hertz}$\\
        \bottomrule
    \end{tabular}
    \caption{Parameters of the PFC rectifier.}  
    \label{table:ex05_Parameters of the circuit}
\end{table}

\subtask{Specify the voltage transformation ratio $m(t)= \frac{u_{\mathrm{2}}(t)}{u'(t)}$ as a function of the duty cycle $d(t)$.}
\begin{solutionblock}
    The equation for the voltage $U_{\mathrm{L}}$ is given with:
    \begin{equation}
        U_{\mathrm{L}} = (d(t) u'(t) + (1-d(t))(u'(t)-U_{\mathrm{2}}))f_\mathrm{T}. 
    \end{equation}
The average voltage over the inductance for a stable operation is zero $U_{\mathrm{L}} = \SI{0}{\volt}$. 
    \begin{equation}
    0 = (d(t) u'(t) + (1-d(t))(u'(t)-U_{\mathrm{2}}))f_\mathrm{T}. \label{eq:ex05ratio2.2}
    \end{equation}   
The ratio $m(t)= \frac{U_\mathrm{2}}{u'(t)}$ can now be determined from \eqref{eq:ex05ratio2.2}: 
  \begin{equation}
    0 = f_\mathrm{T}d(t)u'(t)+f_\mathrm{T}(u'(t)-d(t)u'(t)-U_{\mathrm{2}}+d(t)U_{\mathrm{2}}),
  \end{equation}
  \begin{equation}
    0 = f_\mathrm{T}(u'(t)-(1-d(t))U_{\mathrm{2}}).\label{eq:ex05ratio2.1}
  \end{equation}
  From equation \eqref{eq:ex05ratio2.1} it can now be concluded:
  \begin{equation}
    m(t) = \frac{U_{\mathrm{2}}}{u'(t)}=\frac{1}{1-d(t)}. \label{eq:ex05ratio_m(t)}
  \end{equation}
\end{solutionblock}

\subtask{Specify the conduction time of the transistor and the diode as a function of the transformation ratio $M$ and the time $t$.} 
\begin{solutionblock}
    Using $M = \frac{U_{\mathrm{2}}}{\hat U_{\mathrm{1}}}$, the transformation ratio is given with:
    \begin{equation}
        m(t) = \frac{U_{\mathrm{2}}}{u'(t)}=\frac{U_{\mathrm{2}}}{\hat U_{\mathrm{1}} \sin(\omega t)} = M \frac{1}{\sin(\omega t)}.
    \end{equation}
    For the condition transistor $T$ is conducting, the duty cycle $d(t)$ is derived from \eqref{eq:ex05ratio_m(t)} as:
\begin{equation}
    d(t) = 1-\frac{1}{m(t)} = 1- \frac{u'(t)}{U_{\mathrm{2}}}=1- \frac{U_{\mathrm{1}}\sin(\omega t)}{U_{\mathrm{2}}} = 1 -\frac{1}{M} \sin(\omega t)
\end{equation}.
For the condition diode $D_{\mathrm{5}}$ is conducting, the duty cycle $1-d(t)$ is derived from \eqref{eq:ex05ratio_m(t)} as:
\begin{equation}
    1-d(t) = \frac{1}{m(t)}=\frac{1}{M} \sin(\omega t)
\end{equation}
\end{solutionblock}

\subtask{Calculate the maximum amplitude of the switching frequency fluctuation of the mains current $i_\mathrm{1}$ for the specified operating point.
Note: Consider the conductive state of $T$ and set the voltage across the inductance as a function of the phase angle $(\omega t)$ and the conduction time of the transistor according to the previous subtask.} 
\input{fig/ex05/Fig_courses_i'}
\begin{solutionblock}
    To solve this task the inductance equation is used:
    \begin{equation}
        U_{\mathrm{L}} = L \frac{\mathrm{d}i'(t)}{\mathrm{d}t}.
    \end{equation}
    As a simplification, it is assumed that the $\Delta$ is an approximation of the total differential by a difference equation with the differences $\Delta$. This leads to the component differential equations becoming mean value equations such as:
    \begin{equation}
        \frac{\Delta i'(t)}{\Delta t} = \frac{U_{\mathrm{L}}}{L}.
    \end{equation}
    When transistor $T$ is conducting it applies $U_{\mathrm{L}} = u'(t) = \hat U_{\mathrm{1}} \sin(\omega t)$.
    This means for $\Delta i'(t)$:
\begin{equation}
    \Delta i'(t) = \frac{ U_{\mathrm{L}} \Delta t}{L} = \frac{\hat U_{\mathrm{1}} \sin(\omega t) d(t) T_{\mathrm{on}}}{L} = \Delta i'_{\mathrm{1}}(t).
\end{equation}


 \begin{equation}
     \Delta i'_{\mathrm{1}}(t) = \frac{U_{\mathrm{2}}\hat U_{\mathrm{1}}\sin (\omega t)}{U_{\mathrm{2}}L}(1-\frac{1}{M}\sin(\omega t)) T_{\mathrm{on}}.%\label{eq:ex05\Delta i'}
 \end{equation}
 Using $\frac{\hat U_{\mathrm{1}}}{U_{\mathrm{2}}} = \frac{1}{M}$ %\eqref{eq:ex05\Delta i'} becomes:
 \begin{equation}
     \Delta i'_{\mathrm{1}}(t) = 44
 \end{equation}

    \begin{equation}
        \frac{\mathrm{d}i'}{\mathrm{d}}  = \frac{1}{L} \hat U_\mathrm{1} \sin(\omega t)
    \end{equation}
   % \begin{equation}
    %    i' = \frac{1}{L \omega} \hat U_\mathrm{1} \[ \int_{0}^{T_\mathrm{p1_off}} \sin (\omega t) \,dt \]
   % \end{equation}
    
\end{solutionblock}

\subtask{Complete the current curve for a switching frequency $f_\mathrm{T2} = \SI{2}{\kilo\hertz}$ and a inductance $L = \SI{5}{\milli\henry}$ in \autoref{fig:Current i' control signal ex05}. Note: At the time $t =0$ is $i'=0$. The switch-on and switch-off times are determined by the control signal of the transistor $T$ and are summarized for the first 4 switching times in \autoref{tab:switching_times}.}

\begin{table}[ht]
    \centering
    
    \begin{tabular}{lcccc}
        \toprule
        & $i = 1$ & $2$ & $3$ & $4$ \\
        \midrule
       $T_\mathrm{i,OFF}$& \SI{480}{\micro\second} & \SI{935}{\micro\second} & \SI{1388}{\micro\second} & \SI{1852}{\micro\second} \\
        $T_\mathrm{i,ON}$  & \SI{500}{\micro\second} & \SI{1008}{\micro\second} & \SI{1520}{\micro\second} & \SI{2044}{\micro\second} \\
        \bottomrule
    \end{tabular}
    \caption{Switching times $T_\mathrm{i,OFF}$ and $T_\mathrm{i,ON}$ for different $i$-Values.}
    \label{tab:switching_times}
\end{table}

\input{fig/ex05/Fig_VoltageCourses_UL_No2}

\subtask{Approximately sketch the envelope of the current ripple in \autoref{fig:Current i' control signal ex05}. Sketch the voltage across the inductor in \autoref{fig:Voltage curve ul signal Transistor ex05} and enter the local average value of the voltage as an approximation. How would the switch-on/switch-off ratio of the transistor have to be changed before and after the current peak in order to bring the average actual current value closer to the current setpoint?}

\subtask{Dimension the output capacitance $C$ in a way that the amplitude of the output voltage ripple is $\hat U_{\mathrm{2}}<0.05  u_{\mathrm{2}}(t)$.
Note: assume an idealized lossless converter.}

\subtask{Calculate the RMS value of the current through the capacitor $I_{\mathrm{C}}$.
Note: the mean value of the current through the capacitor is $\overline i_{\mathrm{C}}=0$!}

\subtask{The current carrying capacity of the capacitor is $\frac{\SI{10}{\ampere}}{\SI{1}{\milli\farad}}$. How large must its capacitance be selected to stay below this threshold? Is the permissible output voltage fluctuation or is it the current carrying capacity that determines the capacitance?}

\subtask{What is the current load (effective and average value) of the mains diodes?}