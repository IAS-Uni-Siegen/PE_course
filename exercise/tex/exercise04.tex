%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Begin exercise %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ex{Flyback converter /}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 1: Flyback converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\task{Flyback converter}
A flyback converter with an input voltage range $U_\mathrm{1} = \SI{300}{\volt} \, \dots \, \SI{900}{\volt}$ is used to supply the control electronics of a frequency inverter. The converter delivers a rated output power of  $P_\mathrm{2} = \SI{30}{\watt}$ at a regulated (constant) output voltage of  $U_\mathrm{2} = \SI{15}{\volt}$. The flyback converter is operated in discontinuous current mode with a constant frequency of  $f_\mathrm{p} = \SI{500}{\kilo\hertz}$. The transformation ratio of the transformer is $N_\mathrm{1}/N_\mathrm{2}=60/12$, the inductance of the primary winding is $L_\mathrm{1} = \SI{760}{\micro\henry}$. The coupling between the primary and secondary windings is ideal. You can assume stationary operation for all calculations.

\input{./fig/ex04/Fig_FlybackConverter.tex}

\begin{table}[ht]
    \centering  % Zentriert die Tabelle
    \begin{tabular}{llll}
        \toprule
        
        Input voltage: &  $U_{\mathrm{1}} = \SI{300}{\volt} \, \dots \, \SI{900}{\volt}$ & Output voltage: & $U_{\mathrm{2}} = \SI{15}{\volt}$ \\ 
        Output power: & $P_2 = \SI{30}{\watt}$  & Transformation ratio: & $N_\mathrm{1}/N_\mathrm{2}=60/12$ \\ 
        Inductance of the primary winding: & $L_\mathrm{1} = \SI{760}{\micro\henry}$ & Switching frequency: & $f_{\mathrm{s}} = \SI{50}{\kilo\hertz}$ \\ 
        \bottomrule
    \end{tabular}
    \caption{Parameters of the boost converter.}  % Beschriftung der Tabelle
    \label{table:ex04_Parameters of the circuit}
\end{table}

\subtask{The input voltage is $U_\mathrm{1}=\SI{760}{\volt}$ at rated power at the output. What is the peak value $\hat I_\mathrm{1}$ of the primary current $i_\mathrm{1}$? What is the peak value $\hat I_\mathrm{2}$ of the secundary current $i_\mathrm{2}$? Calculate the duty cycle of the transistor for this operating case.}

\begin{solutionblock}
\begin{equation}
    P_\mathrm{2} = W_\mathrm{L} f_\mathrm{p}
\end{equation}

\begin{equation}
    W_\mathrm{L} = \frac{1}{2}L_\mathrm{1}\hat I_\mathrm{1}^2 
\end{equation}

\begin{equation}
    \hat I_\mathrm{1} = \sqrt{\frac{2P_\mathrm{2}}{L_\mathrm{1}f_\mathrm{p}}}= \sqrt{\frac{2\cdot\SI{30}{\watt}}{\SI{760}{\micro\henry}\cdot\SI{50}{\kilo\hertz}}}=\SI{1.257}{\ampere}
\end{equation}

\begin{equation}
    \hat I_\mathrm{1} = \hat I_\mathrm{2}
\end{equation}

\begin{equation}
    \hat I_\mathrm{2} = \hat I_\mathrm{1} \frac{N_\mathrm{1}}{N_\mathrm{2}} = \SI{1.257}{\ampere} \cdot \frac{60}{12} = \SI{6.28}{\ampere}
\end{equation}
Because of CCM the duty cycle $D$ is expressed .....
\begin{equation}
    \frac{U_2}{U_1} = \frac{D^2}{2} \frac{\Delta i_\mathrm{m,max}}{\overline{i}_2} \label{eq:Duty cycle ex04}
\end{equation}
Because of the unknown $\Delta i_\mathrm{m,max}$ this value has to be calculate first as
\begin{equation}
    \Delta i_\mathrm{m,max}= \frac{T_\mathrm{s} \cdot U_1}{L} = \frac{\frac{1}{\SI{50}{\kilo\hertz}}\cdot \SI{760}{\volt}}{\SI{760}{\micro\henry}}=\SI{20}{\ampere}.
\end{equation}
Now $\Delta i_\mathrm{m,max}=\SI{20}{\ampere}$ can be used in \eqref{eq:Duty cycle ex04}:

\begin{equation}
    D = \sqrt{\frac{2U_2\overline{i}_2}{U_1\Delta i_\mathrm{m,max}}} = \sqrt{\frac{2\cdot \SI{15}{\volt}\cdot\SI{30}{\watt}}{\SI{760}{\volt}\cdot\SI{15}{\volt}\cdot\SI{20}{\ampere}}} = 0.063.
\end{equation}

\end{solutionblock}

\subtask{The input voltage is  $U_\mathrm{1}=\SI{382}{\volt}$ at nominal load. Calculate and sketch the following voltage and current curves for this operating case over one cycle period: $u_\mathrm{T}(t), u_\mathrm{s}(t), i_\mathrm{2}(t), i_\mathrm{1}(t)$ (Note: corresponds to the switch-on time of the transistor).}

\input{./fig/ex04/Fig_voltageTransistorPeriodTask1.tex}
    


\subtask{The input voltage is  $U_\mathrm{1}=\SI{382}{\volt}$ at nominal load. Determine the mean value $\overline i_\mathrm{T}$ and the effective value of the current $i_\mathrm{T, rms}$ through the transistor. Determine the mean value $\overline i_\mathrm{D}$ and the effective value of the current $i_\mathrm{D, rms}$ through the diode. What is the maximum reverse voltage load $u_\mathrm{T, max}$ of the transistor? What is the maximum reverse voltage load $u_\mathrm{D, max}$ of the diode? Calculate the fluctuation range $\Delta i_\mathrm{C, pp}$ of the current $i_\mathrm{C}$ in the output capacitor.}

\subtask{The input voltage is  $U_\mathrm{1}=\SI{382}{\volt}$ at nominal load.How much energy is transferred from the input to the output per switching period $\Delta E$ and what is the resulting average power? What happens if there is no ideal voltage source on the output side but an unloaded capacitor and the circuit is operated with $D>0$?}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 2: Forward converter with asymmetric half-bridge
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\task{Forward converter with asymmetric half-bridge}

The schematic of a forward converter with asymmetric half-bridge is shown in \autoref{fig:ex04_ForwardConverterWithAsymHalfBridge}. 
For the calculations the diodes and transistors are considered as ideal components.

\input{./fig/ex04/Fig_ForwardConverterWithAsymHalfBridge}

The parameters are listed in \autoref{fig:ex04_ForwardConverterWithAsymHalfBridge}
\input{./fig/ex04/FigTab_ForwardConverterWithAsymHalfBridge}

The leakage inductance, the resistive losses, and the core losses of the transformer are negligible. 
The converter operates in steady-state conditions. Both transistors are controlled by the same signal.

\subtask{At what duty cycle $D$ does the circuit operate?}
\subtask{Calculate the average value of $i_\mathrm{2}$ and $i_\mathrm{1}$ over a clock cycle, 
         assuming ideal filtering of $i_\mathrm{2}$.}
\subtask{Calculate the peak value of $\hat{i}_\mu$ the magnetizing current $i_\mu$.}
\subtask{Sketch the waveforms of $U_\mathrm{p}$, $U_\mathrm{D4}$, $i_\mu$, $i_2$, $i_\mathrm{2}$, 
         $i_\mathrm{p}$ and $i_\mathrm{1}$ for the case of non-ideal current smoothing $L \neq \infty$. 
         Note: $i_2(t=0)=i_\mathrm{2min}$.}
\subtask{Calculate the minimal necessary input voltage $U_\mathrm{1}$, if the output voltage $U_\mathrm{2}$ = \SI{20}{\volt} shall being constant.}
\subtask{Calculate the inductance of $L$, if the peak-to-peak value $\Delta i_\mathrm{pp}$ of the 
         switching frequency ripple current $\Delta i_\mathrm{2}$ is to be 10\% of the average value $I_\mathrm{2}$?}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 3: Singled-ended forward converter (demagnetization winding)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\task{Singled-ended forward converter (demagnetization winding)}

The power supply of a data processing system shall be realized by a singled-ended forward converter as shown in \autoref{fig:ex04_SingledEndedForwardConverter}.

\input{./fig/ex04/Fig_SingledEndedForwardConverter}

The parameters are listed in \autoref{table:Ex04_Parameters of the singled ended forward converter.}.
The output inductance is dimensioned so that the current $i_\mathrm{L}$ exhibits a continuous waveform.
The transformer's leakage inductance can be neglected.
\input{./fig/ex04/FigTab_SingledEndedForwardConverter}

\subtask{Calculate the turns ratio $N_\mathrm{T}$/$N_\mathrm{1}$ so that the maximum blocking voltage 
         across the transistor during demagnetization is $\SI{600}{\volt}$.}
\subtask{What is the maximum permissible duty cycle of the power transistor in this case?}
\subtask{What turns ratio $N_\mathrm{1}$/$N_\mathrm{2}$ should be chosen to achieve the required secondary voltage?}
\subtask{Does the steady-state duty cycle of the transistor need to be adjusted when the output power changes? 
         Over what range must the transistor's duty cycle be adjustable, considering the input voltage range?}
\subtask{What is the maximum blocking voltage occurring across diode $D_\mathrm{1}$ and diode $U_\mathrm{DFs}$?}
\subtask{What should be the value of the primary inductance $L_\mathrm{p}$ to ensure 
        that the peak value of the magnetizing current remains below 10\% of the current $i_\mathrm{L'}$. 
        The current $i_\mathrm{L'}$  corresponds to the current $i_\mathrm{L}$ through the output inductance 
        at a nominal load of $P_2=\SI{125}{\watt}$, which is translated to the primary side. 
        (Assume $i_\mathrm{L}$ is approximately constant).}
\subtask{Sketch the waveform of the voltage across the power transistor, the current through the demagnetization 
        winding, and the current through the freewheeling diode $D_\mathrm{Fs}$ 
        for $U_\mathrm{1}=\SI{240}{\volt}$ and $U_\mathrm{1}=\SI{360}{\volt}$.}
\subtask{Calculate the peak value of the magnetizing current for each case. Consider the current in the output 
          inductance as ideally filtered.}
\subtask{Could a higher power be transferred by doubling the switching frequency of the converter?}
