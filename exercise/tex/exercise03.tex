%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Begin exercise %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ex{Step-down converter and power loss calculation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 1: Inverse converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\task {Inverse converter}
An inverse converter (see Fig. 1) is used to generate the negative supply voltage of a control control electronics, an inverse converter (see Fig. 1) is used. The input voltage is specified as $U_\mathrm{1}=\SI{18}{\volt}$, the output voltage is regulated to $U_\mathrm{2}=\SI{12}{\volt}$. The output power can be values in the range $P_\mathrm{2}=\SI{2}{\watt}$ to $\SI{15}{\watt}$.

\input{./fig/ex03/Fig_inverseConverter.tex}

\subtask{The system should operate at the limit of gap-free operation throughout the entire output power range. How should the inductance be selected so that the switching frequency is always above the hearing threshold $f_\mathrm{P}=\SI{20}{\kilo\hertz}$?}

\begin{solutionblock}
    \begin{equation}
        U_{\mathrm{1}} = u_{\mathrm{L}} = L \frac{\Delta i_{\mathrm{L}} }{\Delta t}. 
    \end{equation}
\begin{equation}
    D = \frac{U_\mathrm{2}}{U_\mathrm{1}+U_\mathrm{2}} = \frac{\SI{12}{\volt}}{\SI{18}{\volt}+\SI{12}{\volt}} = 0.4
\end{equation}
BCM is assumed. A current $I_\mathrm{2}$ is only present when the transistor is open, otherwise the diode blocks. This is taken into account in the following equation as the duty cycle $D = 0.6$ is used for $T_\mathrm{off}$. The equation thus looks as follows:
\begin{equation}
    I_\mathrm{2,min} = \frac{P_\mathrm{2}}{U_\mathrm{2}} \frac{1}{D}=\frac{\SI{15}{\watt}}{\SI{12}{\volt}}\frac{5}{3}=\SI{2.083}{\volt}
\end{equation}
The maximum current at BCM $\Delta i_{\mathrm{L}}$ is twice  $I_\mathrm{2,min}$.
\begin{equation}
    \Delta i_{\mathrm{L}} = 2  I_\mathrm{2,min} = \SI{4.16}{\ampere}
\end{equation}
\begin{equation}
    \Delta t = \frac{D}{f_\mathrm{P}}
\end{equation}
The inductance can therefore be determined using the following equation:
\begin{equation}
    L = \frac{\Delta t  u_{\mathrm{L}}}{\Delta i_{\mathrm{L}}}= \frac{D u_{\mathrm{L}}}{f_\mathrm{P}\Delta i_{\mathrm{L}}}= \frac{D u_{\mathrm{1}}}{f_\mathrm{P}\Delta i_{\mathrm{L}}} = \frac{0.4 \cdot \SI{18}{\volt}}{\SI{20}{\kilo\hertz}\cdot \SI{4.16}{\ampere }} = \SI{86.4}{\micro\henry}
\end{equation}

\end{solutionblock}
\subtask{In what range does the switching frequency $f_\mathrm{P}$ vary?}

 \begin{solutionblock}
     The inductance equation is used again for this task:
     \begin{equation}
        L = \frac{\Delta t  u_{\mathrm{L}}}{\Delta i_{\mathrm{L}}}= \frac{D u_{\mathrm{L}}}{f_\mathrm{P}\Delta i_{\mathrm{L}}}
     \end{equation}
     This equation can be converted to $f_\mathrm{P}$ and used to determine the frequency as follows:
     \begin{equation}
        f_\mathrm{P} = \frac{Du_{\mathrm{1}}}{L\Delta i_{\mathrm{L}}} \label{equation 1.8}
     \end{equation}
      
As the output power is specified as a value range, the highest and lowest values can be used. The lowest and highest current should be determined from these two values, from which the value range of the frequency $f_\mathrm{P}$ can then be determined. Here the inverse converter is considered on the output side and therefore a duty cycle $D = 0.6$ is used again. The following equations can be derived from this:

     \begin{equation}
        I_\mathrm{1,min}= \frac{P_\mathrm{2}}{U_\mathrm{2}}\frac{1}{D}=\frac{\SI{2}{\watt}}{\SI{12}{\volt}}\frac{5}{3}=\SI{0.278}{\volt}
     \end{equation}
     \begin{equation}
        I_\mathrm{1,max}= \frac{P_\mathrm{2}}{U_\mathrm{2}}=\frac{\SI{15}{\watt}}{\SI{12}{\volt}}=\SI{2.0833}{\volt}
     \end{equation}
     Now we can use these two terms in \ref{equation 1.8}:
     \begin{equation}
        f_\mathrm{P,min}=\frac{0.4\cdot\SI{18}{\volt}}{\SI{86.4}{\micro\henry}\cdot 2\cdot \SI{0.1}{\volt}}=\SI{416.667}{\kilo \hertz}
     \end{equation}
     \begin{equation}
        f_\mathrm{P,max}=\frac{0.4\cdot\SI{18}{\volt}}{\SI{86.4}{\micro\henry}\cdot 2\cdot \SI{1.38}{\volt}}=\SI{30.193}{\kilo \hertz}
     \end{equation}
 \end{solutionblock}

 \subtask{What is the peak value $\hat I_1$ of the transistor current?}
 \begin{solutionblock}
    As the maximum current through the transistor is the current $I_1$, these values are the same. Since the BCM is considered in this circuit, the maximum current is the peak current, which corresponds to the value of $\SI{4.16}{\ampere}$.
 \end{solutionblock}

 \subtask{How does the duty cycle $D$ change with the output power? Enter the duty cycle values and the absolute values of the transistor switch-on times $T_\mathrm{on} = D T_\mathrm{s}$ for minimum and maximum output power.}

 \subtask{Sketch the course of the current $i_\mathrm{L}$ in the inductance for minimum and maximum output power.}

 \subtask{At which operating point does the maximum switching frequency fluctuation of the output voltage $\Delta u_\mathrm{2pp}$ occurs (the load approximately draws a constant current)?} 

 \subtask{How high should the output capacitance be selected to ensure $Delta u_\mathrm{2pp} < 0.02 U_\mathrm{2}?$}

 \subtask{What is the maximum effective value $i_\mathrm{C,RMS}$ of the output capacitor current?}

 \subtask{Sketch the time curve of the voltage $u_\mathrm{T}$ at the power transistor and the current $i_\mathrm{D}$ in the output diode for $P_\mathrm{2}=\SI{2}{\watt}$. What is the maximum reverse voltage of the transistor?}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 2: Boost-Buck converter and SEPIC topology
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\task {Boost-buck converter and SEPIC topology}

The supply of a plasma coating system is realized by a boost converter followed by a buck converter acccording \autoref{fig:ex03_boost_buck_converter} (with common capacitance).
The converter is connected to a voltage $U_\mathrm{1}$ and provides a variable output voltage $U_\mathrm{2}$. The parameters are displayed in \autoref{table:ParametersOfBoostBuckConverter}.
\vspace{2em}\par

\par
% Schematic of Buck Boost Converter cascade
\input{./fig/ex03/Fig_BoostBuckConverter}
\par
%Table of parameter values 
\input{./fig/ex03/FigTab_BoostBuckConverter}

The output voltage is set to the specified value by adjusting the duty cycles $D_\mathrm{1}$ (of transistor $T_\mathrm{1}$) 
and $D_\mathrm{2}$ (of transistor $T_\mathrm{2}$) using a control system. Both transistors operate at the same switching frequency. 
The switching frequency fluctuation of the intermediate circuit voltage and the currents in the inductors can be neglected unless otherwise stated. 
The currents in $L_\mathrm{1}$ and $L_\mathrm{2}$ show a continuous course. Both transistors are operated with the 
same relative duty cycle $D_\mathrm{1}$ = $D_\mathrm{2}$ = $D$.

\subtask{Calculate the duty cycle $D$ range to achieve the stated output voltage $U_\mathrm{2}$.}

\begin{solutionblock}
    % Solution
    For the boost-buck converter \eqref{eq:DutyCycleEx03} is to apply:
    \begin{equation}
        D = \frac{\frac{U_\mathrm{2}}{U_\mathrm{1}}} {1+{\frac{U_\mathrm{2}}{U_\mathrm{1}}}}.
        \label{eq:DutyCycleEx03}
    \end{equation}
    In case of $U_\mathrm{2}$ = $\SI{380}{\volt}$, the duty cycle is determined using \eqref{eq:DutyCycleEx03} as
    \begin{equation}
       \frac{\frac{\SI{285}{\volt}}{\SI{380}{\volt}}} {1+{\frac{\SI{285}{\volt}}{\SI{380}{\volt}}}} = 0.429.
    \end{equation}
\end{solutionblock}


\subtask{Which intermediate circuit voltage $U_\mathrm{0}$ is determined depending on $U_\mathrm{2}$?}

\begin{solutionblock}
    % Solution
    The first part is the boost converter part. For the output voltage 
    of $\SI{285}{\volt}$, the intermediate circuit voltage $U_\mathrm{0}$ is calculated as
    \begin{equation}
        U_\mathrm{0}=U_\mathrm{1} \frac{1}{1-D_\mathrm{2}} 
        \hspace{1cm} \mathrm{and} \hspace{1cm}  
        \SI{380}{\volt} \frac{1}{1-0.429} = \SI{665}{\volt}.
        \label{eq:DCLinkEx03}        
    \end{equation}
\end{solutionblock}


\subtask{Plot $D$ and $U_\mathrm{0}$ against $U_\mathrm{2}$ and calculate the numerical values for $U_\mathrm{2}$ = 285V, $U_\mathrm{2}$ =
380V and $U_\mathrm{2}$ = 450V.}

\begin{solutionblock}
    % Solution
    For the plot \eqref{fig:DutyCycleDCLinkVoltageAtOutputVoltage} and \eqref{eq:DCLinkEx03} are used for the function and 
    displayed in \autoref{fig:DCLinkVoltageAtOutputVoltage} and \autoref{fig:DutyCycleDCAtOutputVoltage}. The results for the different output values are listed in \autoref{table:DutyCycleDCLinkVoltageAtOutputVoltage}.

    %Plot of DCLinkVoltage
    \input{./fig/ex03/sFigDia_DCLinkVSUoutE3T2}
    %Plot of duty cycle
    \input{./fig/ex03/sFigDia_DutyCycleVSUoutE3T2}


    %Result table
    \input{./fig/ex03/sFigTab_DCLinkVoltageDutycycleE3T2}
\end{solutionblock}

\subtask{What blocking voltage ratings must the transistors $T_\mathrm{1}$ and $T_\mathrm{2}$ and the diodes $D_1$ and
$D_2$ have?}

\begin{solutionblock}
    % Solution
    Based on the schematic \autoref{fig:ex03_boost_buck_converter} the intermediate circuit voltage is to block by the diodes and 
    the transistors within one switching period. The minimum blocking voltage of the component needs to be higher than $U_\mathrm{0}$.
\end{solutionblock}

\vspace{2em}\par
The converter operation continues with $D_\mathrm{1}$ = $D_\mathrm{2}$ = $D$. The input and output inductances 
have the same value $L_\mathrm{1}$ = $L_\mathrm{2}$ = $L$ = $\SI{0.5}{m\henry}$.

\subtask{Drive the input and output current ripple $\Delta i_\mathrm{L1}$ and $\Delta i_\mathrm{L2}$ depending on the duty cycle.}

\begin{solutionblock}
    % Solution
    The current ripple depends on the duty cycle, switching period and inductor voltage.
    This is expressed by:
    \begin{equation}
        \Delta i_\mathrm{L1}=\Delta i_\mathrm{L2}=\frac{U_\mathrm{1}D}{f_\mathrm{s}L}
    \end{equation}
\end{solutionblock}

\subtask{To what minimum value can the output power be reduced while still ensuring continuous operation across the entire output voltage range 
(i.e., continuous current flow in $L_\mathrm{1}$  and $L_\mathrm{2}$)?}

\begin{solutionblock}
    % Solution
    The average inductor current is the half of the ripple current. This is expressed by:
    \begin{equation}
        I_\mathrm{L1}=I_\mathrm{L2}=\frac{\Delta i_\mathrm{L1}}{2}
    \end{equation}
    The maximal current is required at minimal output voltage at constant power.
    \begin{equation}
        P_\mathrm{2,min}=U_\mathrm{2}\frac{U_\mathrm{1}D}{2f_\mathrm{s}L}
    \end{equation}
    The maximal current is required at minimal output voltage at constant power.
    \begin{equation}
        U_\mathrm{2}\frac{U_\mathrm{1}D}{2f_\mathrm{s}L}=
    \end{equation}
\end{solutionblock}



\subtask{At which value of the output voltage range is this limit reached first on the input side and at which value is it reached first on the output side?}
\vspace{2em}\par
For comparison reasons, the single ended primary inductance converter (SEPIC) in \autoref{fig:ex03_SEPIC} shall be considered under similar conditions.

% Schematic of Buck Boost Converter cascade
\input{./fig/ex03/Fig_SepicConverter}

\subtask{What blocking voltage ratings must the transistors $T_\mathrm{1}$ and the diode $D$ have?}

\subtask{Drive the input and output current ripple $\Delta i_\mathrm{L1}$ and $\Delta i_\mathrm{L2}$ depending on the duty cycle.}

\subtask{To what minimum value can the output power be reduced while still ensuring continuous operation across the entire output voltage range? 
(i.e., continuous current flow in $L_\mathrm{1}$  and $L_\mathrm{2}$)?}

\subtask{Describe the advantages and disadvantages of the SEPIC topology compared to the boost-buck converter. Consider the necessary components and the quality of the output voltage.}