%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Begin exercise %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ex{Controlled rectifiers}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 1: M3C converter at a RL-load                     %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\task{M3C converter at an RL-load}
A controlled three-pulse midpoint circuit feeds an ohmic-inductive load. The load inductance $L$ is infinitely large such that a pure direct current $I_\mathrm{2}$ is taken from the converter. The load resistance is $R = \SI{5}{\Omega}$. The converter's ideal transformer is connected to the symmetrical three-phase grid with $U_\mathrm{N} = \SI{230}{\volt} $ (effective value of phase voltage) and  $U_\mathrm{N,LL} = \SI{400}{\volt} $ (line-to-line voltage). The secondary side phase voltages point an effective value of 
$U_{\mathrm{1},i} = \SI{230}{\volt}, \forall i=\mathrm{a,b,c}$. The thyristors and commutation can be assumed to be ideal.

\input{fig/ex06/Fig_M3C_Converter_With_RL_Load.tex}


% Subtask1
\subtask{Calculate the firing angle $\alpha$ such that an active power of $P = \SI{6}{\kilo\watt}$ is delivered to the load. How big is the resulting load current $i_\mathrm{2}(t) = I_\mathrm{2}$?}
    \begin{solutionblock}
        We can calculate $\bar{u}_\mathrm{2}(\alpha)$ and $I_\mathrm{2}$ from the given active power delivered, $P$, using
        \begin{equation} 
            P = \frac{\bar{u}^2_\mathrm{2}(\alpha)}{R} = \bar{u}_\mathrm{2}(\alpha) I_\mathrm{2},
            \label{sub6.1.1:eq:Active_power_formula}
        \end{equation}
    which would result in 
        \begin{equation}
            \bar{u}_\mathrm{2}(\alpha) \approx \SI{173.2}{\volt},\\
            I_\mathrm{2} \approx \SI{34.6}{\ampere}.
        \end{equation}
        The average output voltage for an arbitrary $\alpha$ is calculated by
        \begin{equation}
            \bar{u}_\mathrm{2}(\alpha) = \frac{3\sqrt{3}}{2\pi}\hat{u}_\mathrm{1}\cos(\alpha),
            \label{sub6.1.1:eq:avg_voltage_alpha}
        \end{equation}
        where
        \begin{equation}
            \hat{u}_\mathrm{1} = \sqrt{2}U_\mathrm{1} = \sqrt{2} 230 \approx \SI{325.27}{\volt}.
            \label{sub6.1.1:eq:voltage_amplitude}
    \end{equation}
    Hence, 
    solving \eqref{sub6.1.1:eq:avg_voltage_alpha} with respect to $\alpha$ results in
        \begin{equation}
            \alpha = \arccos\left(\frac{ 2\pi\bar{u}_\mathrm{2}(\alpha)}{3\sqrt{3}\hat{u}_\mathrm{1}}\right) \approx \SI{0.871}{\radian}.
            \label{sub6.1.1:eq:calculate_alpha}
        \end{equation}    
    
    \end{solutionblock}
% Subtask2
\subtask{Draw the normalized control characteristic curve $\nicefrac{U_\mathrm{2}(\alpha)}{U_\mathrm{2}(\alpha=0)}$ and mark the  operating point $P = \SI{6}{\kilo\watt}$ at $R = \SI{5}{\Omega}$.}
    \begin{solutionblock}
        Substituting $\alpha = 0$ in \eqref{sub6.1.1:eq:avg_voltage_alpha} results in
        \begin{equation}
            \bar{u}_\mathrm{2}(\alpha=0) = \frac{3\sqrt{3}}{2\pi}\hat{u}_\mathrm{1}.
            \label{sub6.1.1:eq:avg_voltage_zero_alpha}
        \end{equation}
        Dividing \eqref{sub6.1.1:eq:avg_voltage_alpha} by \eqref{sub6.1.1:eq:avg_voltage_zero_alpha} leads to  
        \begin{equation}
            \frac{ \bar{u}_\mathrm{2}(\alpha)}{\bar{u}_\mathrm{2}(\alpha=0)} = \cos(\alpha).
            \label{sub6.1.1:eq:voltages_relation}
        \end{equation}    
        \input{fig/ex06/Solution_subtask_6_1_2.tex}
    \end{solutionblock}
% Subtask3
\subtask{Draw the curve of the converter's output voltage $u_\mathrm{2}(t)$ for the calculated control angle $\alpha$, from subtask 6.1.1, within a plot of the three-phase transformer's secondary voltages.}
    \begin{solutionblock}
        \input{fig/ex06/Solution_subtask_6_1_3.tex}
    \end{solutionblock}
% Subtask4
\subtask{Calculate the effective value $I^\mathrm{(1)}_\mathrm{1a}$ of the fundamental current component $i^\mathrm{(1)}_\mathrm{1a}(t)$ and add the latter to the previous plot. How big is the phase shift $\varphi_\mathrm{1a}$ between $u_\mathrm{1a}(t)$ and $i^\mathrm{(1)}_\mathrm{1a}(t)$?}
    \begin{solutionblock}
        Observing the $i_\mathrm{1a}(\omega t)$ signal in Fig. \ref{sfig:ex06_current_signals_6_1_4a}, one can see that it is an even signal. Hence, we expect that the fundamental component of the Fourier Series
        would contain only cosine component ($a_1 \neq 0$) and no sine component ($b_1 = 0$). 
        \input{fig/ex06/Solution_subtask_6_1_4a}\\
        For simplification, we can position the y-xis in the middle of the conducting period and make use of the period's symmetry. This would simplify the calculations
        by integrating over one half of the period and then multiply by 2. In this case the integration would be from 0 to $\frac{\pi}{3}$, as one conducting
        period is equal to $\frac{2\pi}{3}$. Thus, $a_1$ ($\hat{i}^\mathrm{(1)}_\mathrm{1a}$) can be calculated as:

        \begin{equation}
            a_1 = \hat{i}^\mathrm{(1)}_\mathrm{1a} = \frac{2}{\pi}\int_{0}^{\frac{\pi}{3}}I_\mathrm{2}\cos(\omega t) d\omega t = \left[\frac{2}{\pi} \sin(\omega t)\right]^{\frac{\pi}{3}}_{0} = \frac{1}{\pi}I_\mathrm{2}\sqrt{3}.
            \label{sub6.1.4:eq:calculate_a1}
        \end{equation}  
        
        Then the effective value $I^\mathrm{(1)}_\mathrm{1a}$ is
            \begin{equation}
                I^\mathrm{(1)}_\mathrm{1a} = \frac{\hat{i}^\mathrm{(1)}_\mathrm{1a}}{\sqrt{2}} \approx \SI{13.5}{\ampere}.
                \label{sub6.1.4:eq:calculate_I_rms}
            \end{equation}   
        
        Fig. \ref{sfig:ex06_current_signals_6_1_4b} shows the fundamental component $i^\mathrm{(1)}_\mathrm{1a}(\omega t)$ compared to the input voltage $u_\mathrm{1a}(\omega t)$.
        \input{fig/ex06/Solution_subtask_6_1_4b.tex}\\
        The phase shift of $i^\mathrm{(1)}_\mathrm{1a}(\omega t)$ can be calculated by calculating the phase of the peak of the signal, which can be calculated as: 
        \begin{equation}
            \varphi_\mathrm{1a} = (-\frac{\pi}{3} + \alpha) + (\frac{2\pi}{3} \cdot \frac{1}{2}) = -\frac{\pi}{3} + \alpha + \frac{\pi}{3} = \alpha   
        \end{equation}
        where -$\frac{\pi}{3} + \alpha$ is the start of the conducting period, while $\frac{2\pi}{3} \cdot \frac{1}{2}$ is half of the period of conduction.
        

    \end{solutionblock}
% Subtask5
\subtask{Calculate the fundamental reactive power $Q^\mathrm{(1)}$ drawn by the converter from the grid.}
    \begin{solutionblock}
        The fundamental reactive power drawn for one full period $(2\pi)$ can be calculated using
        \begin{equation}
            Q^\mathrm{(1)} = 3 U_1 I^\mathrm{(1)}_1 \sin(\alpha)  = 3 \cdot 230 \cdot 13.5 \cdot \sin(0.871) \approx \SI{7.12}{\kilo \volt \ampere} 
        \end{equation}
    \end{solutionblock}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 2: B6C converter at a motor load                   %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\task{B6C converter at a motor load}

In a lifting drive, a permanent magnet DC motor is supplied by a B6C converter circuit. The B6C-topology is connected to the three-phase grid.
With the assumption of $L\rightarrow\infty$ the motor operates with constant nominal current and constant nominal voltage when lifting as well as lowering the load.
This corresponds to a terminal voltage of $u_\mathrm{mot,up}(t)=U_\mathrm{mot}$ when lifting the load and $u_\mathrm{mot,down}(t)=-U_\mathrm{mot}$ when lowering it.
In order to generate the necessary torque, the motor absorbs the current $i_\mathrm{mot}(t)=I_\mathrm{mot}$.

\input{fig/ex06/Fig_B6C_ConverterWithMotorLoad}

\begin{table}[ht]
    \centering  % Zentriert die Tabelle
    \begin{tabular}{ll}
        \toprule
        Input voltages ($i=\mathrm{a,b,c}$): & $U_{\mathrm{1},i}=\SI{230}{\volt}$ (phase voltage) \\
                        & $U_{\mathrm{1,LL},i} = \SI{400}{\volt}$ (line-to-line voltage)\\
        Nom. motor current: & $I_{\mathrm{mot}} = \SI{20}{\ampere}$ \\
        Nom. motor voltage: & $U_\mathrm{mot} = \SI{466}{\volt}$ \\ 
        Grid frequency: & $f= \SI{50}{\hertz}$ \\ 
        \bottomrule
    \end{tabular}
    \caption{Parameters of the lifting drive with B6C converter.}  
    \label{table:ex06_Task2_ParametersOfTheCircuit}
\end{table}


% Subtask1
\subtask{Calculate the firing angle $\alpha_\mathrm{up}$ required for lifting and the firing angle $\alpha_\mathrm{down}$ for lowering the load 
to operate the motor at rated voltage.}
%solution
\begin{solutionblock}
    The voltage $\overline{u}_\mathrm{2}$ is calculated by
    \begin{equation} 
        \overline{u}_\mathrm{2} = \hat{u}_\mathrm{1,LL} \frac{\pi}{p}\sin(\frac{p}{\pi}) \cos(\alpha).
        \label{eq:ex06t2_u2_gen}
    \end{equation}
    $p=6$ for the B6C-topology. The maximum value of $u_\mathrm{1,LL}(t)$ is calculated by
    \begin{equation} 
        \hat{u}_\mathrm{1,LL}=\sqrt{2} \sqrt{3} \cdot U_\mathrm{1}= \sqrt{2} \sqrt{3} \cdot \SI{230}{\volt}=\SI{563}{\volt}.
        \label{eq:ex06t2_u1n_max}
    \end{equation}
    The voltage $\overline{u}_\mathrm{2}$ corresponds to $U_\mathrm{mot}$. Solving \eqref{eq:ex06t2_u2_gen} with respect to $\alpha$ results in
    \begin{equation} 
        \alpha = \arccos( \frac{\overline{u}_\mathrm{2} \cdot p}{\hat{u}_\mathrm{1,LL}\pi \sin(\frac{p}{\pi})}) =
        \begin{cases}
            \alpha_\mathrm{up} = \arccos( \frac{\SI{466}{\volt} \cdot 6}{\SI{563}{\volt}\pi \sin(\frac{6}{\pi})})=\SI{30}{\degree}     \\
            \alpha_\mathrm{down} = \arccos( \frac{\SI{-466}{\volt} \cdot 6}{\SI{563}{\volt}\pi \sin(\frac{6}{\pi})})=\SI{150}{\degree}    \\
        \end{cases}.
        \label{eq:ex06t2_alpha_gen}
    \end{equation}
\end{solutionblock}

% Subtask2
\subtask{Sketch following signals for the two calculated firing angles $\alpha_\mathrm{up}$ and $\alpha_\mathrm{down}$:
\begin{itemize}
    \item The output voltage $u_\mathrm{2,p}(t)$ and $u_\mathrm{2,m}(t)$ of the two partial converters (reference point is neutral)
          and shade the effective voltage-time area for the two cases,
    \item The output voltage $u_\mathrm{2}(t)$ and the mean voltage $\overline{u}_\mathrm{2}$,
    \item The current $i_\mathrm{1a}(t)$ and it's fundamental $i_\mathrm{1a}^{(1)}(t)$,
    \item The voltage of thyristor $u_\mathrm{T1}(t)$,
    \item Indicate which thyristors are conducting during a pulse interval.
\end{itemize}  
}
\begin{solutionblock}
    In \autoref{sfig:ex06_Voltage_u2pm_Up} the output voltages $\overline{u}_\mathrm{2,p}=\SI{233}{\volt}$ and $\overline{u}_\mathrm{2,m}=\SI{-233}{\volt}$
    are entered as dashed blue lines. The ranges in which the respective thyristor conducts are marked with $\mathrm{T_x}$.
    
    \input{fig/ex06/sFig_VoltageU2pmUp}

    In \autoref{sfig:ex06_Voltage_u2pm_Down} the output voltages are $\overline{u}_\mathrm{2,p}=\SI{-233}{\volt}$ and $\overline{u}_\mathrm{2,m}=\SI{233}{\volt}$.
    
    \input{fig/ex06/sFig_VoltageU2pmDown}

    

    \FloatBarrier

    In \autoref{sfig:ex06_Voltage_u2up_down} the output voltages are $\overline{u}_\mathrm{2}$ are entered for both cases.

    \input{fig/ex06/sFig_VoltageU2pUpDown}

    \FloatBarrier

    The amplitude of the fundamental $i_\mathrm{1a}^\mathrm{(1)}(t)$ is determined by calculating the Fourier coefficient.
    To simplify the calculation the current signal $i_\mathrm{1a}(t)$ is shift $\frac{2 \pi}{3}\SI{}{\radian}$ to the left, 
    so that it is axially symmetric. Cause by the symmetry the integration is performed only from \SI{0}{\radian} to \SI{\pi}{\radian}:
    \begin{equation}
        \begin{split}
            \hat{i}_\mathrm{1a}^\mathrm{(1)} &= \frac{2}{\pi} \int_{0}^{\pi} i_\mathrm{1a}(\omega t) \cos(\omega t) \mathrm{d}\omega t=
            \frac{2}{\pi} \left( \int_{0}^{\frac{\pi}{3}} I\mathrm{mot} \cos(\omega t) \mathrm{d}\omega t 
            - \int_{\frac{2\pi}{3}}^{\pi} I_\mathrm{mot} \cos(\omega t) \mathrm{d}\omega t \right)  \\
            &= \frac{2 I_\mathrm{mot}}{\pi} \left( \sin(\frac{\pi}{3}) + \sin(\frac{2\pi}{3}) \right) 
            = \frac{2\cdot \SI{20}{\ampere}}{\pi} \sqrt{3}= \SI{22}{\ampere}.
        \end{split}
    \end{equation}
    The result is valid for raising and lowering load, because in both cases the rectangle width and relative positions are the same.
    The difference belongs only to the phase position relative to $U_\mathrm{1}(t)$.

    \input{fig/ex06/sFig_CurrentI1up}

    \input{fig/ex06/sFig_CurrentI1down}
    
    \FloatBarrier

    The voltage $u_\mathrm{T1}(t)$ is displayed for raising load in \autoref{sfig:ex06_Voltage_u1T_up}  and for lowering load in \autoref{sfig:ex06_Voltage_u1T_down}.

    \input{fig/ex06/sFig_VoltageUT1Up}

    \input{fig/ex06/sFig_VoltageUT1Down}
    
\end{solutionblock}

% Subtask3
\subtask{Calculate the active power $P$, the fundamental reactive power $Q^\mathrm{(1)}$
and the fundamental apparent power $S^\mathrm{(1)}$ for the two considered operating points. Represent $P$, $Q^\mathrm{(1)}$ and $S^\mathrm{(1)}$ in the complex plane.}
\begin{solutionblock}
    \begin{equation}
        \begin{split}
            P_\mathrm{up}&=U_\mathrm{mot} I_\mathrm{mot}=\SI{466}{\volt} \cdot \SI{20}{\ampere}= \SI{9320}{\watt}. \\
            P_\mathrm{down}&=-U_\mathrm{mot} I_\mathrm{mot}=\SI{-466}{\volt} \cdot \SI{20}{\ampere}= \SI{9320}{\watt}.
        \end{split}
    \end{equation}
    The input voltage $U_\mathrm{1}^\mathrm{(1)}$ corresponds to $U_\mathrm{1}$, so that the apparent power results to
    \begin{equation}
        \begin{split}
            S_\mathrm{up}^\mathrm{(1)}&=3 U_\mathrm{1} \frac{\hat{i}_\mathrm{1a}^\mathrm{(1)}}{\sqrt{2}}=\SI{230}{\volt} \cdot \frac{\SI{22}{\ampere}}{\sqrt{2}}= \SI{10760}{\watt}. \\
            S_\mathrm{down}^\mathrm{(1)}&=3 U_\mathrm{1} \frac{\hat{i}_\mathrm{1a}^\mathrm{(1)}}{\sqrt{2}}=\SI{230}{\volt} \cdot \frac{\SI{22}{\ampere}}{\sqrt{2}}= \SI{10760}{\watt}.
        \end{split}
    \end{equation}
    The reactive power is calculated by
    \begin{equation}
        \begin{split}
            Q_\mathrm{up}^\mathrm{(1)}&=3 U_\mathrm{1} \frac{\hat{i}_\mathrm{1a}^\mathrm{(1)}}{\sqrt{2}} \sin{(\alpha_\mathrm{up})}
            =\SI{230}{\volt} \cdot \frac{\SI{22}{\ampere}}{\sqrt{2}}\sin{(\frac{\pi}{6})}= \SI{5380}{\watt}. \\
            Q_\mathrm{down}^\mathrm{(1)}&=3 U_\mathrm{1} \frac{-\hat{i}_\mathrm{1a}^\mathrm{(1)}}{\sqrt{2}} \sin{(\alpha_\mathrm{down})}
            =\SI{230}{\volt} \cdot \frac{\SI{22}{\ampere}}{\sqrt{2}}\sin{(\frac{5\pi}{6})}= \SI{5380}{\watt}.
        \end{split}
    \end{equation}
    \autoref{fig:ex06_Complex_Plane_Power} shows the power in the complex plane.

    \input{fig/ex06/sFig_Complex_Plane_Power}

\end{solutionblock}
% Subtask4
\subtask{Calculate the fundamental current ratio $g=\frac{I^\mathrm{(1)}}{I}$ and the power factor $\lambda$ for the two considered operating points.}
\begin{solutionblock}
    The fundamental current ratio results to
    \begin{equation}
        g=\frac{\frac{\hat{i}_\mathrm{1a}^\mathrm{(1)}}{\sqrt{2}}}{I_\mathrm{mot}}=\frac{\frac{\SI{22}{\ampere}}{\sqrt{2}}}{\SI{20}{\ampere}}=0.78.
    \end{equation}
    The power factor $\lambda$ is calculated by
    \begin{equation}
        \begin{split}
            \lambda_\mathrm{up}&=g \cdot \cos{(\alpha_\mathrm{up})}=0.78  \cdot \cos(\frac{\pi}{6})= 0.68. \\
            \lambda_\mathrm{down}&=g \cdot \cos{(\alpha_\mathrm{down})}=0.78  \cdot \cos(\frac{5\pi}{6})= -0.68.
        \end{split}
    \end{equation}
\end{solutionblock}
